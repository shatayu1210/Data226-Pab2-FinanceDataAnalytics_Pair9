[0m15:13:47.122450 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1091d6910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10924c850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10924cd90>]}


============================== 15:13:47.124307 | cdad2a51-43d6-40a0-bd36-c771948e51fd ==============================
[0m15:13:47.124307 [info ] [MainThread]: Running with dbt=1.8.7
[0m15:13:47.124625 [debug] [MainThread]: running dbt with arguments {'static_parser': 'True', 'log_cache_events': 'False', 'use_colors': 'True', 'no_print': 'None', 'quiet': 'False', 'introspect': 'True', 'warn_error': 'None', 'profiles_dir': '/Users/shatayu/.dbt', 'invocation_command': 'dbt run', 'indirect_selection': 'eager', 'log_path': '/Users/shatayu/Downloads/DATA226_Lab2Prep/build_fda/logs', 'use_experimental_parser': 'False', 'version_check': 'True', 'write_json': 'True', 'printer_width': '80', 'empty': 'False', 'log_format': 'default', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'send_anonymous_usage_stats': 'True', 'debug': 'False', 'partial_parse': 'True', 'fail_fast': 'False', 'cache_selected_only': 'False'}
[0m15:13:48.137478 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'cdad2a51-43d6-40a0-bd36-c771948e51fd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1207fab10>]}
[0m15:13:48.157801 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'cdad2a51-43d6-40a0-bd36-c771948e51fd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108c95950>]}
[0m15:13:48.158389 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m15:13:48.171069 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m15:13:48.171652 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m15:13:48.171864 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'cdad2a51-43d6-40a0-bd36-c771948e51fd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1086c4850>]}
[0m15:13:48.637083 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.build_fda.obv_nvidia' (models/output/obv_nvidia.sql) depends on a node named 'dev.raw_data.stock_data' which was not found
[0m15:13:48.640245 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.5693597, "process_user_time": 1.884442, "process_kernel_time": 1.629931, "process_mem_max_rss": "191266816", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m15:13:48.640505 [debug] [MainThread]: Command `dbt run` failed at 15:13:48.640459 after 1.57 seconds
[0m15:13:48.640680 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104e14150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12222f650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1221377d0>]}
[0m15:13:48.640838 [debug] [MainThread]: Flushing usage events
[0m15:25:36.800036 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107945650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107993c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107990750>]}


============================== 15:25:36.802400 | ed3ca364-baa9-4bc5-8d19-aae7a03e39e7 ==============================
[0m15:25:36.802400 [info ] [MainThread]: Running with dbt=1.8.7
[0m15:25:36.802772 [debug] [MainThread]: running dbt with arguments {'static_parser': 'True', 'log_cache_events': 'False', 'profiles_dir': '/Users/shatayu/.dbt', 'log_path': '/Users/shatayu/Downloads/DATA226_Lab2Prep/build_fda/logs', 'debug': 'False', 'introspect': 'True', 'write_json': 'True', 'target_path': 'None', 'use_experimental_parser': 'False', 'empty': 'False', 'warn_error': 'None', 'printer_width': '80', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'partial_parse': 'True', 'cache_selected_only': 'False', 'no_print': 'None', 'use_colors': 'True', 'fail_fast': 'False', 'version_check': 'True', 'log_format': 'default', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run'}
[0m15:25:37.776656 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ed3ca364-baa9-4bc5-8d19-aae7a03e39e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120705fd0>]}
[0m15:25:37.796777 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ed3ca364-baa9-4bc5-8d19-aae7a03e39e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1073fd610>]}
[0m15:25:37.797344 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m15:25:37.809665 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m15:25:37.810221 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m15:25:37.810458 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'ed3ca364-baa9-4bc5-8d19-aae7a03e39e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12073ec50>]}
[0m15:25:38.311443 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.build_fda.output
[0m15:25:38.317009 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ed3ca364-baa9-4bc5-8d19-aae7a03e39e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1201aad90>]}
[0m15:25:38.376501 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ed3ca364-baa9-4bc5-8d19-aae7a03e39e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11facfa90>]}
[0m15:25:38.376894 [info ] [MainThread]: Found 1 model, 3 sources, 459 macros
[0m15:25:38.377202 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ed3ca364-baa9-4bc5-8d19-aae7a03e39e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1067f5610>]}
[0m15:25:38.377931 [info ] [MainThread]: 
[0m15:25:38.378220 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m15:25:38.378438 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ed3ca364-baa9-4bc5-8d19-aae7a03e39e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120a958d0>]}
[0m15:25:38.378646 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:25:38.378769 [info ] [MainThread]: 
[0m15:25:38.381150 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data
[0m15:25:38.381479 [debug] [Thread-1 (]: Acquiring new snowflake connection 'model.build_fda.stock_data'
[0m15:25:38.381639 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data
[0m15:25:38.385014 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data"
[0m15:25:38.385912 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data
[0m15:25:38.386457 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:25:38.386619 [debug] [MainThread]: Connection 'model.build_fda.stock_data' was properly closed.
[0m15:25:38.386754 [info ] [MainThread]: 
[0m15:25:38.386900 [info ] [MainThread]: Finished running  in 0 hours 0 minutes and 0.01 seconds (0.01s).
[0m15:25:38.387101 [debug] [MainThread]: Command end result
[0m15:25:38.400328 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.653217, "process_user_time": 2.149778, "process_kernel_time": 1.414497, "process_mem_max_rss": "195592192", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m15:25:38.400607 [debug] [MainThread]: Command `dbt run` succeeded at 15:25:38.400563 after 1.65 seconds
[0m15:25:38.400777 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10357c150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103655410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1035c6310>]}
[0m15:25:38.400925 [debug] [MainThread]: Flushing usage events
[0m15:34:11.300023 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105291550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1052d1c90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1052dfc10>]}


============================== 15:34:11.302313 | 630c7d75-641c-4ae4-b5d2-ffd674aabffe ==============================
[0m15:34:11.302313 [info ] [MainThread]: Running with dbt=1.8.7
[0m15:34:11.302660 [debug] [MainThread]: running dbt with arguments {'cache_selected_only': 'False', 'use_experimental_parser': 'False', 'send_anonymous_usage_stats': 'True', 'debug': 'False', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'profiles_dir': '/Users/shatayu/.dbt', 'static_parser': 'True', 'version_check': 'True', 'log_cache_events': 'False', 'log_format': 'default', 'quiet': 'False', 'fail_fast': 'False', 'empty': 'False', 'no_print': 'None', 'invocation_command': 'dbt run', 'partial_parse': 'True', 'printer_width': '80', 'use_colors': 'True', 'log_path': '/Users/shatayu/Downloads/DATA226_Lab2Prep/build_fda/logs', 'warn_error': 'None', 'indirect_selection': 'eager', 'target_path': 'None', 'write_json': 'True'}
[0m15:34:12.311099 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '630c7d75-641c-4ae4-b5d2-ffd674aabffe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a710150>]}
[0m15:34:12.331199 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '630c7d75-641c-4ae4-b5d2-ffd674aabffe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104d49790>]}
[0m15:34:12.331767 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m15:34:12.343471 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m15:34:12.412296 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m15:34:12.412626 [debug] [MainThread]: Partial parsing: added file: build_fda://models/output/obv_apple_summary.sql
[0m15:34:12.512783 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '630c7d75-641c-4ae4-b5d2-ffd674aabffe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11fe0fd10>]}
[0m15:34:12.553358 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '630c7d75-641c-4ae4-b5d2-ffd674aabffe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12834ec10>]}
[0m15:34:12.553689 [info ] [MainThread]: Found 2 models, 3 sources, 459 macros
[0m15:34:12.553854 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '630c7d75-641c-4ae4-b5d2-ffd674aabffe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104164410>]}
[0m15:34:12.554617 [info ] [MainThread]: 
[0m15:34:12.554935 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m15:34:12.555435 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m15:34:12.561452 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m15:34:12.561620 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m15:34:12.561745 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:34:13.391430 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.829 seconds
[0m15:34:13.395150 [debug] [ThreadPool]: On list_dev: Close
[0m15:34:13.529128 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_analytics)
[0m15:34:13.539815 [debug] [ThreadPool]: Using snowflake connection "list_dev_analytics"
[0m15:34:13.540174 [debug] [ThreadPool]: On list_dev_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev_analytics"} */
show objects in dev.analytics limit 10000
[0m15:34:13.540446 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:34:14.067064 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.526 seconds
[0m15:34:14.070699 [debug] [ThreadPool]: On list_dev_analytics: Close
[0m15:34:14.177238 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '630c7d75-641c-4ae4-b5d2-ffd674aabffe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x128336290>]}
[0m15:34:14.178081 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:34:14.178517 [info ] [MainThread]: 
[0m15:34:14.182989 [debug] [Thread-1 (]: Began running node model.build_fda.obv_apple_summary
[0m15:34:14.183661 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.obv_apple_summary ....................... [RUN]
[0m15:34:14.184180 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_analytics, now model.build_fda.obv_apple_summary)
[0m15:34:14.184550 [debug] [Thread-1 (]: Began compiling node model.build_fda.obv_apple_summary
[0m15:34:14.192378 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.obv_apple_summary"
[0m15:34:14.193324 [debug] [Thread-1 (]: Began executing node model.build_fda.obv_apple_summary
[0m15:34:14.212638 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.obv_apple_summary"
[0m15:34:14.213961 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.obv_apple_summary"
[0m15:34:14.214237 [debug] [Thread-1 (]: On model.build_fda.obv_apple_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.obv_apple_summary"} */
create or replace transient table dev.analytics.obv_apple_summary
         as
        (WITH ordered_data AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM dev.raw_data.stock_data -- Referencing the raw data table in the dev database
    WHERE symbol = 'AAPL'  -- Filter for Apple symbol
),

obv_calculation AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        CASE
            WHEN close > LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN volume
            WHEN close < LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN -volume
            ELSE 0
        END AS volume_change
    FROM ordered_data
),

cumulative_obv AS (
    SELECT
        date,
        symbol,
        SUM(volume_change) OVER (PARTITION BY symbol ORDER BY date) AS obv
    FROM obv_calculation
)

SELECT
    date,
    symbol,
    obv
FROM cumulative_obv
ORDER BY date;
[0m15:34:14.214476 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:34:14.658548 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b84f46-0004-26b9-0000-000255f39b99
[0m15:34:14.659280 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 41 at position 13 unexpected ';'.
[0m15:34:14.659819 [debug] [Thread-1 (]: On model.build_fda.obv_apple_summary: Close
[0m15:34:14.794909 [debug] [Thread-1 (]: Database Error in model obv_apple_summary (models/output/obv_apple_summary.sql)
  001003 (42000): SQL compilation error:
  syntax error line 41 at position 13 unexpected ';'.
  compiled code at target/run/build_fda/models/output/obv_apple_summary.sql
[0m15:34:14.796881 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '630c7d75-641c-4ae4-b5d2-ffd674aabffe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x128040450>]}
[0m15:34:14.797702 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model analytics.obv_apple_summary .............. [[31mERROR[0m in 0.61s]
[0m15:34:14.798371 [debug] [Thread-1 (]: Finished running node model.build_fda.obv_apple_summary
[0m15:34:14.798838 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data
[0m15:34:14.799440 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.obv_apple_summary, now model.build_fda.stock_data)
[0m15:34:14.799830 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data
[0m15:34:14.802968 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data"
[0m15:34:14.803948 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data
[0m15:34:14.805093 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:34:14.805362 [debug] [MainThread]: Connection 'model.build_fda.stock_data' was properly closed.
[0m15:34:14.805627 [info ] [MainThread]: 
[0m15:34:14.805914 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 2.25 seconds (2.25s).
[0m15:34:14.806473 [debug] [MainThread]: Command end result
[0m15:34:14.891047 [info ] [MainThread]: 
[0m15:34:14.891300 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m15:34:14.891431 [info ] [MainThread]: 
[0m15:34:14.891593 [error] [MainThread]:   Database Error in model obv_apple_summary (models/output/obv_apple_summary.sql)
  001003 (42000): SQL compilation error:
  syntax error line 41 at position 13 unexpected ';'.
  compiled code at target/run/build_fda/models/output/obv_apple_summary.sql
[0m15:34:14.891716 [info ] [MainThread]: 
[0m15:34:14.891850 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m15:34:14.893670 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 3.6505842, "process_user_time": 2.252354, "process_kernel_time": 1.407271, "process_mem_max_rss": "203735040", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m15:34:14.893907 [debug] [MainThread]: Command `dbt run` failed at 15:34:14.893870 after 3.65 seconds
[0m15:34:14.894094 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100ec8150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x129860dd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x129830c50>]}
[0m15:34:14.894249 [debug] [MainThread]: Flushing usage events
[0m15:37:56.620550 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11858d5d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1185fca10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1185fcf50>]}


============================== 15:37:56.622211 | 53069dd5-6928-4ff6-aede-3ebc9ed46849 ==============================
[0m15:37:56.622211 [info ] [MainThread]: Running with dbt=1.8.7
[0m15:37:56.622549 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True', 'log_format': 'default', 'introspect': 'True', 'write_json': 'True', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'profiles_dir': '/Users/shatayu/.dbt', 'log_cache_events': 'False', 'target_path': 'None', 'use_experimental_parser': 'False', 'partial_parse': 'True', 'invocation_command': 'dbt run', 'static_parser': 'True', 'log_path': '/Users/shatayu/Downloads/DATA226_Lab2Prep/build_fda/logs', 'no_print': 'None', 'warn_error': 'None', 'cache_selected_only': 'False', 'version_check': 'True', 'quiet': 'False', 'indirect_selection': 'eager', 'empty': 'False'}
[0m15:37:57.603077 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '53069dd5-6928-4ff6-aede-3ebc9ed46849', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106496bd0>]}
[0m15:37:57.623103 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '53069dd5-6928-4ff6-aede-3ebc9ed46849', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107f45750>]}
[0m15:37:57.623654 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m15:37:57.635941 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m15:37:57.708000 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m15:37:57.708370 [debug] [MainThread]: Partial parsing: updated file: build_fda://models/input/stock_data.sql
[0m15:37:57.708544 [debug] [MainThread]: Partial parsing: updated file: build_fda://models/output/obv_apple_summary.sql
[0m15:37:57.809250 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '53069dd5-6928-4ff6-aede-3ebc9ed46849', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x152d8e890>]}
[0m15:37:57.849012 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '53069dd5-6928-4ff6-aede-3ebc9ed46849', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1531f35d0>]}
[0m15:37:57.849286 [info ] [MainThread]: Found 2 models, 3 sources, 459 macros
[0m15:37:57.849451 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '53069dd5-6928-4ff6-aede-3ebc9ed46849', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x152d8ed50>]}
[0m15:37:57.850139 [info ] [MainThread]: 
[0m15:37:57.850401 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m15:37:57.850867 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m15:37:57.856691 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m15:37:57.856851 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m15:37:57.856982 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:37:58.443845 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.586 seconds
[0m15:37:58.447138 [debug] [ThreadPool]: On list_dev: Close
[0m15:37:58.572057 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_analytics)
[0m15:37:58.582043 [debug] [ThreadPool]: Using snowflake connection "list_dev_analytics"
[0m15:37:58.582395 [debug] [ThreadPool]: On list_dev_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev_analytics"} */
show objects in dev.analytics limit 10000
[0m15:37:58.582666 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:37:59.078246 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.495 seconds
[0m15:37:59.083433 [debug] [ThreadPool]: On list_dev_analytics: Close
[0m15:37:59.218535 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '53069dd5-6928-4ff6-aede-3ebc9ed46849', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x152faafd0>]}
[0m15:37:59.219453 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:37:59.219913 [info ] [MainThread]: 
[0m15:37:59.223564 [debug] [Thread-1 (]: Began running node model.build_fda.obv_apple_summary
[0m15:37:59.224179 [info ] [Thread-1 (]: 1 of 1 START sql table model analytics.obv_apple_summary ....................... [RUN]
[0m15:37:59.224671 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_analytics, now model.build_fda.obv_apple_summary)
[0m15:37:59.225033 [debug] [Thread-1 (]: Began compiling node model.build_fda.obv_apple_summary
[0m15:37:59.234873 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.obv_apple_summary"
[0m15:37:59.235670 [debug] [Thread-1 (]: Began executing node model.build_fda.obv_apple_summary
[0m15:37:59.255230 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.obv_apple_summary"
[0m15:37:59.256434 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.obv_apple_summary"
[0m15:37:59.256763 [debug] [Thread-1 (]: On model.build_fda.obv_apple_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.obv_apple_summary"} */
create or replace transient table dev.analytics.obv_apple_summary
         as
        (WITH ordered_data AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM dev.raw_data.stock_data -- Referencing the raw data table in the dev database
    WHERE symbol = 'AAPL'  -- Filter for Apple symbol
),

obv_calculation AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        CASE
            WHEN close > LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN volume
            WHEN close < LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN -volume
            ELSE 0
        END AS volume_change
    FROM ordered_data
),

cumulative_obv AS (
    SELECT
        date,
        symbol,
        SUM(volume_change) OVER (PARTITION BY symbol ORDER BY date) AS obv
    FROM obv_calculation
)

SELECT
    date,
    symbol,
    obv
FROM cumulative_obv
ORDER BY date
        );
[0m15:37:59.257048 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:38:00.979312 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.721 seconds
[0m15:38:01.004847 [debug] [Thread-1 (]: On model.build_fda.obv_apple_summary: Close
[0m15:38:01.149002 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '53069dd5-6928-4ff6-aede-3ebc9ed46849', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x153450d90>]}
[0m15:38:01.150209 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analytics.obv_apple_summary .................. [[32mSUCCESS 1[0m in 1.92s]
[0m15:38:01.151072 [debug] [Thread-1 (]: Finished running node model.build_fda.obv_apple_summary
[0m15:38:01.151666 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data
[0m15:38:01.152359 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.obv_apple_summary, now model.build_fda.stock_data)
[0m15:38:01.152931 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data
[0m15:38:01.156413 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data"
[0m15:38:01.157750 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data
[0m15:38:01.159252 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:38:01.159603 [debug] [MainThread]: Connection 'model.build_fda.stock_data' was properly closed.
[0m15:38:01.159909 [info ] [MainThread]: 
[0m15:38:01.160235 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 3.31 seconds (3.31s).
[0m15:38:01.160848 [debug] [MainThread]: Command end result
[0m15:38:01.182897 [info ] [MainThread]: 
[0m15:38:01.183199 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:38:01.183377 [info ] [MainThread]: 
[0m15:38:01.183576 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m15:38:01.185887 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.6118975, "process_user_time": 2.011861, "process_kernel_time": 1.541689, "process_mem_max_rss": "204357632", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m15:38:01.186268 [debug] [MainThread]: Command `dbt run` succeeded at 15:38:01.186213 after 4.61 seconds
[0m15:38:01.186505 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1185ce590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102838150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102911410>]}
[0m15:38:01.186719 [debug] [MainThread]: Flushing usage events
[0m15:48:12.555135 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108e96990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108eebc10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108f0ca90>]}


============================== 15:48:12.557310 | 13655c46-1010-4d00-83f0-985271cc1623 ==============================
[0m15:48:12.557310 [info ] [MainThread]: Running with dbt=1.8.7
[0m15:48:12.557640 [debug] [MainThread]: running dbt with arguments {'partial_parse': 'True', 'log_format': 'default', 'quiet': 'False', 'introspect': 'True', 'cache_selected_only': 'False', 'indirect_selection': 'eager', 'write_json': 'True', 'static_parser': 'True', 'target_path': 'None', 'no_print': 'None', 'log_path': '/Users/shatayu/Downloads/DATA226_Lab2Prep/build_fda/logs', 'log_cache_events': 'False', 'empty': 'False', 'use_experimental_parser': 'False', 'invocation_command': 'dbt run', 'debug': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True', 'use_colors': 'True', 'profiles_dir': '/Users/shatayu/.dbt', 'printer_width': '80', 'version_check': 'True', 'fail_fast': 'False', 'warn_error': 'None'}
[0m15:48:13.523936 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '13655c46-1010-4d00-83f0-985271cc1623', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108e9c590>]}
[0m15:48:13.543963 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '13655c46-1010-4d00-83f0-985271cc1623', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108955690>]}
[0m15:48:13.544524 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m15:48:13.557035 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m15:48:13.625688 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m15:48:13.626005 [debug] [MainThread]: Partial parsing: added file: build_fda://models/output/obv_nvidia_summary.sql
[0m15:48:13.723775 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '13655c46-1010-4d00-83f0-985271cc1623', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x134d7b1d0>]}
[0m15:48:13.763360 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '13655c46-1010-4d00-83f0-985271cc1623', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1351f05d0>]}
[0m15:48:13.763629 [info ] [MainThread]: Found 3 models, 3 sources, 459 macros
[0m15:48:13.763795 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '13655c46-1010-4d00-83f0-985271cc1623', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x135152010>]}
[0m15:48:13.764510 [info ] [MainThread]: 
[0m15:48:13.764786 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m15:48:13.766709 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m15:48:13.772527 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m15:48:13.772686 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m15:48:13.772813 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:48:14.350293 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.576 seconds
[0m15:48:14.353765 [debug] [ThreadPool]: On list_dev: Close
[0m15:48:14.485456 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_analytics)
[0m15:48:14.496388 [debug] [ThreadPool]: Using snowflake connection "list_dev_analytics"
[0m15:48:14.496776 [debug] [ThreadPool]: On list_dev_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev_analytics"} */
show objects in dev.analytics limit 10000
[0m15:48:14.497049 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:48:14.964406 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.467 seconds
[0m15:48:14.967266 [debug] [ThreadPool]: On list_dev_analytics: Close
[0m15:48:15.081476 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '13655c46-1010-4d00-83f0-985271cc1623', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105dcb090>]}
[0m15:48:15.082345 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m15:48:15.082798 [info ] [MainThread]: 
[0m15:48:15.087693 [debug] [Thread-1 (]: Began running node model.build_fda.obv_apple_summary
[0m15:48:15.088528 [info ] [Thread-1 (]: 1 of 2 START sql table model analytics.obv_apple_summary ....................... [RUN]
[0m15:48:15.089111 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_analytics, now model.build_fda.obv_apple_summary)
[0m15:48:15.089498 [debug] [Thread-1 (]: Began compiling node model.build_fda.obv_apple_summary
[0m15:48:15.098134 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.obv_apple_summary"
[0m15:48:15.099072 [debug] [Thread-1 (]: Began executing node model.build_fda.obv_apple_summary
[0m15:48:15.120123 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.obv_apple_summary"
[0m15:48:15.121193 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.obv_apple_summary"
[0m15:48:15.121474 [debug] [Thread-1 (]: On model.build_fda.obv_apple_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.obv_apple_summary"} */
create or replace transient table dev.analytics.obv_apple_summary
         as
        (WITH ordered_data AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM dev.raw_data.stock_data -- Referencing the raw data table in the dev database
    WHERE symbol = 'AAPL'  -- Filter for Apple symbol
),

obv_calculation AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        CASE
            WHEN close > LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN volume
            WHEN close < LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN -volume
            ELSE 0
        END AS volume_change
    FROM ordered_data
),

cumulative_obv AS (
    SELECT
        date,
        symbol,
        SUM(volume_change) OVER (PARTITION BY symbol ORDER BY date) AS obv
    FROM obv_calculation
)

SELECT
    date,
    symbol,
    obv
FROM cumulative_obv
ORDER BY date
        );
[0m15:48:15.121725 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:48:16.461758 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.339 seconds
[0m15:48:16.501281 [debug] [Thread-1 (]: On model.build_fda.obv_apple_summary: Close
[0m15:48:16.644979 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '13655c46-1010-4d00-83f0-985271cc1623', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x134d03290>]}
[0m15:48:16.647693 [info ] [Thread-1 (]: 1 of 2 OK created sql table model analytics.obv_apple_summary .................. [[32mSUCCESS 1[0m in 1.55s]
[0m15:48:16.649754 [debug] [Thread-1 (]: Finished running node model.build_fda.obv_apple_summary
[0m15:48:16.650770 [debug] [Thread-1 (]: Began running node model.build_fda.obv_nvidia_summary
[0m15:48:16.652073 [info ] [Thread-1 (]: 2 of 2 START sql table model analytics.obv_nvidia_summary ...................... [RUN]
[0m15:48:16.653066 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.obv_apple_summary, now model.build_fda.obv_nvidia_summary)
[0m15:48:16.653686 [debug] [Thread-1 (]: Began compiling node model.build_fda.obv_nvidia_summary
[0m15:48:16.660874 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.obv_nvidia_summary"
[0m15:48:16.662462 [debug] [Thread-1 (]: Began executing node model.build_fda.obv_nvidia_summary
[0m15:48:16.666540 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.obv_nvidia_summary"
[0m15:48:16.668751 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.obv_nvidia_summary"
[0m15:48:16.669231 [debug] [Thread-1 (]: On model.build_fda.obv_nvidia_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.obv_nvidia_summary"} */
create or replace transient table dev.analytics.obv_nvidia_summary
         as
        (WITH ordered_data AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM dev.raw_data.stock_data -- Referencing the raw data table in the dev database
    WHERE symbol = 'NVDA'  -- Filter for Nvidia symbol
),

obv_calculation AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        CASE
            WHEN close > LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN volume
            WHEN close < LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN -volume
            ELSE 0
        END AS volume_change
    FROM ordered_data
),

cumulative_obv AS (
    SELECT
        date,
        symbol,
        SUM(volume_change) OVER (PARTITION BY symbol ORDER BY date) AS obv
    FROM obv_calculation
)

SELECT
    date,
    symbol,
    obv
FROM cumulative_obv
ORDER BY date
        );
[0m15:48:16.669660 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:48:18.207723 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.537 seconds
[0m15:48:18.214665 [debug] [Thread-1 (]: On model.build_fda.obv_nvidia_summary: Close
[0m15:48:18.337239 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '13655c46-1010-4d00-83f0-985271cc1623', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107d6c610>]}
[0m15:48:18.340819 [info ] [Thread-1 (]: 2 of 2 OK created sql table model analytics.obv_nvidia_summary ................. [[32mSUCCESS 1[0m in 1.68s]
[0m15:48:18.345706 [debug] [Thread-1 (]: Finished running node model.build_fda.obv_nvidia_summary
[0m15:48:18.347010 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data
[0m15:48:18.347943 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.obv_nvidia_summary, now model.build_fda.stock_data)
[0m15:48:18.348955 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data
[0m15:48:18.357269 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data"
[0m15:48:18.359914 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data
[0m15:48:18.362207 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:48:18.362743 [debug] [MainThread]: Connection 'model.build_fda.stock_data' was properly closed.
[0m15:48:18.363251 [info ] [MainThread]: 
[0m15:48:18.363706 [info ] [MainThread]: Finished running 2 table models in 0 hours 0 minutes and 4.60 seconds (4.60s).
[0m15:48:18.364689 [debug] [MainThread]: Command end result
[0m15:48:18.461707 [info ] [MainThread]: 
[0m15:48:18.461981 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:48:18.462121 [info ] [MainThread]: 
[0m15:48:18.462272 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m15:48:18.464164 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 5.9611855, "process_user_time": 2.086689, "process_kernel_time": 1.68833, "process_mem_max_rss": "204816384", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m15:48:18.464400 [debug] [MainThread]: Command `dbt run` succeeded at 15:48:18.464362 after 5.96 seconds
[0m15:48:18.464558 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104ad4150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10681aa50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104ac3fd0>]}
[0m15:48:18.464703 [debug] [MainThread]: Flushing usage events
[0m18:07:45.475950 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b3cf190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b3dbf10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b3fcd10>]}


============================== 18:07:45.477954 | 3134eb8d-9430-4de5-aa25-da51fd96326a ==============================
[0m18:07:45.477954 [info ] [MainThread]: Running with dbt=1.8.7
[0m18:07:45.478286 [debug] [MainThread]: running dbt with arguments {'indirect_selection': 'eager', 'target_path': 'None', 'invocation_command': 'dbt run', 'version_check': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'printer_width': '80', 'log_format': 'default', 'introspect': 'True', 'send_anonymous_usage_stats': 'True', 'no_print': 'None', 'empty': 'False', 'write_json': 'True', 'static_parser': 'True', 'profiles_dir': '/Users/shatayu/.dbt', 'log_path': '/Users/shatayu/Downloads/DATA226_Lab2Prep/build_fda/logs', 'partial_parse': 'True', 'use_colors': 'True', 'log_cache_events': 'False', 'use_experimental_parser': 'False', 'warn_error': 'None', 'cache_selected_only': 'False', 'debug': 'False', 'fail_fast': 'False', 'quiet': 'False'}
[0m18:07:46.429462 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3134eb8d-9430-4de5-aa25-da51fd96326a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1090613d0>]}
[0m18:07:46.450746 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3134eb8d-9430-4de5-aa25-da51fd96326a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109d45450>]}
[0m18:07:46.451407 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m18:07:46.464386 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m18:07:46.540318 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 3 files added, 1 files changed.
[0m18:07:46.540724 [debug] [MainThread]: Partial parsing: added file: build_fda://models/output/fsi_apple_summary.sql
[0m18:07:46.540886 [debug] [MainThread]: Partial parsing: added file: build_fda://models/input/stock_data_forecast.sql
[0m18:07:46.541019 [debug] [MainThread]: Partial parsing: added file: build_fda://models/output/fsi_nvidia_sumary.sql
[0m18:07:46.541220 [debug] [MainThread]: Partial parsing: updated file: build_fda://models/source.yml
[0m18:07:46.687161 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3134eb8d-9430-4de5-aa25-da51fd96326a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13e873d10>]}
[0m18:07:46.727948 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3134eb8d-9430-4de5-aa25-da51fd96326a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13e6ae290>]}
[0m18:07:46.728246 [info ] [MainThread]: Found 6 models, 6 sources, 459 macros
[0m18:07:46.728417 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3134eb8d-9430-4de5-aa25-da51fd96326a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13e61ae90>]}
[0m18:07:46.729298 [info ] [MainThread]: 
[0m18:07:46.729579 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m18:07:46.731535 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m18:07:46.737627 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m18:07:46.737806 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m18:07:46.737940 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:07:47.419243 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.681 seconds
[0m18:07:47.422155 [debug] [ThreadPool]: On list_dev: Close
[0m18:07:47.558279 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_analytics)
[0m18:07:47.570184 [debug] [ThreadPool]: Using snowflake connection "list_dev_analytics"
[0m18:07:47.570694 [debug] [ThreadPool]: On list_dev_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev_analytics"} */
show objects in dev.analytics limit 10000
[0m18:07:47.570990 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:07:48.380698 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.810 seconds
[0m18:07:48.383860 [debug] [ThreadPool]: On list_dev_analytics: Close
[0m18:07:48.507380 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3134eb8d-9430-4de5-aa25-da51fd96326a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106aa6e50>]}
[0m18:07:48.508103 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m18:07:48.508342 [info ] [MainThread]: 
[0m18:07:48.510976 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_apple_summary
[0m18:07:48.511379 [info ] [Thread-1 (]: 1 of 4 START sql table model analytics.fsi_apple_summary ....................... [RUN]
[0m18:07:48.511680 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_analytics, now model.build_fda.fsi_apple_summary)
[0m18:07:48.511884 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_apple_summary
[0m18:07:48.564465 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_apple_summary"
[0m18:07:48.565011 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_apple_summary
[0m18:07:48.578017 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_apple_summary"
[0m18:07:48.578986 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_apple_summary"
[0m18:07:48.579213 [debug] [Thread-1 (]: On model.build_fda.fsi_apple_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_apple_summary"} */
create or replace transient table dev.analytics.fsi_apple_summary
         as
        (WITH apple_interval_widths AS (
    SELECT
        ts,
        forecast,
        lower_bound,
        upper_bound,
        series,
        (upper_bound - lower_bound) AS interval_width
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
    WHERE series = 'AAPL'  -- Filter for Apple symbol
),

statistics AS (
    SELECT
        series,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM apple_interval_widths
    GROUP BY series
)

SELECT
    a.ts,
    a.series,
    a.forecast,
    a.lower_bound,
    a.upper_bound,
    a.interval_width,
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM apple_interval_widths a
JOIN statistics s
    ON a.series = s.series
ORDER BY a.ts;
[0m18:07:48.579403 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:07:49.088682 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b84fdf-0004-26b4-0000-000255f33b71
[0m18:07:49.089472 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 38 at position 13 unexpected ';'.
[0m18:07:49.090029 [debug] [Thread-1 (]: On model.build_fda.fsi_apple_summary: Close
[0m18:07:49.233119 [debug] [Thread-1 (]: Database Error in model fsi_apple_summary (models/output/fsi_apple_summary.sql)
  001003 (42000): SQL compilation error:
  syntax error line 38 at position 13 unexpected ';'.
  compiled code at target/run/build_fda/models/output/fsi_apple_summary.sql
[0m18:07:49.235364 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3134eb8d-9430-4de5-aa25-da51fd96326a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13eb98610>]}
[0m18:07:49.236197 [error] [Thread-1 (]: 1 of 4 ERROR creating sql table model analytics.fsi_apple_summary .............. [[31mERROR[0m in 0.72s]
[0m18:07:49.236843 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_apple_summary
[0m18:07:49.237266 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_nvidia_sumary
[0m18:07:49.238128 [info ] [Thread-1 (]: 2 of 4 START sql table model analytics.fsi_nvidia_sumary ....................... [RUN]
[0m18:07:49.238905 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_apple_summary, now model.build_fda.fsi_nvidia_sumary)
[0m18:07:49.239529 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_nvidia_sumary
[0m18:07:49.242975 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_nvidia_sumary"
[0m18:07:49.243885 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_nvidia_sumary
[0m18:07:49.247053 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_nvidia_sumary"
[0m18:07:49.249356 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_nvidia_sumary"
[0m18:07:49.250015 [debug] [Thread-1 (]: On model.build_fda.fsi_nvidia_sumary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_nvidia_sumary"} */
create or replace transient table dev.analytics.fsi_nvidia_sumary
         as
        (WITH nvidia_interval_widths AS (
    SELECT
        ts,
        forecast,
        lower_bound,
        upper_bound,
        series,
        (upper_bound - lower_bound) AS interval_width
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
    WHERE series = 'NVDA'  -- Filter for Nvidia symbol
),

statistics AS (
    SELECT
        series,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM nvidia_interval_widths
    GROUP BY series
)

SELECT
    n.ts,
    n.series,
    n.forecast,
    n.lower_bound,
    n.upper_bound,
    n.interval_width,
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM nvidia_interval_widths n
JOIN statistics s
    ON n.series = s.series
ORDER BY n.ts;
[0m18:07:49.250373 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:07:49.754865 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b84fdf-0004-26b2-0000-000255f37bed
[0m18:07:49.756384 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 38 at position 13 unexpected ';'.
[0m18:07:49.757188 [debug] [Thread-1 (]: On model.build_fda.fsi_nvidia_sumary: Close
[0m18:07:49.910228 [debug] [Thread-1 (]: Database Error in model fsi_nvidia_sumary (models/output/fsi_nvidia_sumary.sql)
  001003 (42000): SQL compilation error:
  syntax error line 38 at position 13 unexpected ';'.
  compiled code at target/run/build_fda/models/output/fsi_nvidia_sumary.sql
[0m18:07:49.911026 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3134eb8d-9430-4de5-aa25-da51fd96326a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13e915cd0>]}
[0m18:07:49.911876 [error] [Thread-1 (]: 2 of 4 ERROR creating sql table model analytics.fsi_nvidia_sumary .............. [[31mERROR[0m in 0.67s]
[0m18:07:49.912635 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_nvidia_sumary
[0m18:07:49.913132 [debug] [Thread-1 (]: Began running node model.build_fda.obv_apple_summary
[0m18:07:49.913883 [info ] [Thread-1 (]: 3 of 4 START sql table model analytics.obv_apple_summary ....................... [RUN]
[0m18:07:49.914580 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_nvidia_sumary, now model.build_fda.obv_apple_summary)
[0m18:07:49.915002 [debug] [Thread-1 (]: Began compiling node model.build_fda.obv_apple_summary
[0m18:07:49.917434 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.obv_apple_summary"
[0m18:07:49.917936 [debug] [Thread-1 (]: Began executing node model.build_fda.obv_apple_summary
[0m18:07:49.919550 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.obv_apple_summary"
[0m18:07:49.920585 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.obv_apple_summary"
[0m18:07:49.920832 [debug] [Thread-1 (]: On model.build_fda.obv_apple_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.obv_apple_summary"} */
create or replace transient table dev.analytics.obv_apple_summary
         as
        (WITH ordered_data AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM dev.raw_data.stock_data -- Referencing the raw data table in the dev database
    WHERE symbol = 'AAPL'  -- Filter for Apple symbol
),

obv_calculation AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        CASE
            WHEN close > LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN volume
            WHEN close < LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN -volume
            ELSE 0
        END AS volume_change
    FROM ordered_data
),

cumulative_obv AS (
    SELECT
        date,
        symbol,
        SUM(volume_change) OVER (PARTITION BY symbol ORDER BY date) AS obv
    FROM obv_calculation
)

SELECT
    date,
    symbol,
    obv
FROM cumulative_obv
ORDER BY date
        );
[0m18:07:49.921048 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:07:51.883729 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.962 seconds
[0m18:07:51.902399 [debug] [Thread-1 (]: On model.build_fda.obv_apple_summary: Close
[0m18:07:52.055359 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3134eb8d-9430-4de5-aa25-da51fd96326a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13e8be610>]}
[0m18:07:52.057891 [info ] [Thread-1 (]: 3 of 4 OK created sql table model analytics.obv_apple_summary .................. [[32mSUCCESS 1[0m in 2.14s]
[0m18:07:52.058773 [debug] [Thread-1 (]: Finished running node model.build_fda.obv_apple_summary
[0m18:07:52.059253 [debug] [Thread-1 (]: Began running node model.build_fda.obv_nvidia_summary
[0m18:07:52.059761 [info ] [Thread-1 (]: 4 of 4 START sql table model analytics.obv_nvidia_summary ...................... [RUN]
[0m18:07:52.060180 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.obv_apple_summary, now model.build_fda.obv_nvidia_summary)
[0m18:07:52.060455 [debug] [Thread-1 (]: Began compiling node model.build_fda.obv_nvidia_summary
[0m18:07:52.063069 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.obv_nvidia_summary"
[0m18:07:52.063950 [debug] [Thread-1 (]: Began executing node model.build_fda.obv_nvidia_summary
[0m18:07:52.067562 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.obv_nvidia_summary"
[0m18:07:52.068732 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.obv_nvidia_summary"
[0m18:07:52.069000 [debug] [Thread-1 (]: On model.build_fda.obv_nvidia_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.obv_nvidia_summary"} */
create or replace transient table dev.analytics.obv_nvidia_summary
         as
        (WITH ordered_data AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM dev.raw_data.stock_data -- Referencing the raw data table in the dev database
    WHERE symbol = 'NVDA'  -- Filter for Nvidia symbol
),

obv_calculation AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        CASE
            WHEN close > LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN volume
            WHEN close < LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN -volume
            ELSE 0
        END AS volume_change
    FROM ordered_data
),

cumulative_obv AS (
    SELECT
        date,
        symbol,
        SUM(volume_change) OVER (PARTITION BY symbol ORDER BY date) AS obv
    FROM obv_calculation
)

SELECT
    date,
    symbol,
    obv
FROM cumulative_obv
ORDER BY date
        );
[0m18:07:52.069332 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:07:53.602542 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.533 seconds
[0m18:07:53.608129 [debug] [Thread-1 (]: On model.build_fda.obv_nvidia_summary: Close
[0m18:07:53.742324 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3134eb8d-9430-4de5-aa25-da51fd96326a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13e7fc310>]}
[0m18:07:53.744527 [info ] [Thread-1 (]: 4 of 4 OK created sql table model analytics.obv_nvidia_summary ................. [[32mSUCCESS 1[0m in 1.68s]
[0m18:07:53.745586 [debug] [Thread-1 (]: Finished running node model.build_fda.obv_nvidia_summary
[0m18:07:53.746357 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data
[0m18:07:53.747075 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.obv_nvidia_summary, now model.build_fda.stock_data)
[0m18:07:53.747583 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data
[0m18:07:53.751646 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data"
[0m18:07:53.753013 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data
[0m18:07:53.753434 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data_forecast
[0m18:07:53.753812 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.stock_data, now model.build_fda.stock_data_forecast)
[0m18:07:53.754149 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data_forecast
[0m18:07:53.756745 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data_forecast"
[0m18:07:53.757894 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data_forecast
[0m18:07:53.759252 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:07:53.759532 [debug] [MainThread]: Connection 'model.build_fda.stock_data_forecast' was properly closed.
[0m18:07:53.759911 [info ] [MainThread]: 
[0m18:07:53.760219 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 7.03 seconds (7.03s).
[0m18:07:53.761062 [debug] [MainThread]: Command end result
[0m18:07:53.783299 [info ] [MainThread]: 
[0m18:07:53.783607 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m18:07:53.783793 [info ] [MainThread]: 
[0m18:07:53.784014 [error] [MainThread]:   Database Error in model fsi_apple_summary (models/output/fsi_apple_summary.sql)
  001003 (42000): SQL compilation error:
  syntax error line 38 at position 13 unexpected ';'.
  compiled code at target/run/build_fda/models/output/fsi_apple_summary.sql
[0m18:07:53.784191 [info ] [MainThread]: 
[0m18:07:53.784386 [error] [MainThread]:   Database Error in model fsi_nvidia_sumary (models/output/fsi_nvidia_sumary.sql)
  001003 (42000): SQL compilation error:
  syntax error line 38 at position 13 unexpected ';'.
  compiled code at target/run/build_fda/models/output/fsi_nvidia_sumary.sql
[0m18:07:53.784542 [info ] [MainThread]: 
[0m18:07:53.784712 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=2 SKIP=0 TOTAL=4
[0m18:07:53.786832 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 8.360841, "process_user_time": 2.276005, "process_kernel_time": 1.650015, "process_mem_max_rss": "205783040", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m18:07:53.787163 [debug] [MainThread]: Command `dbt run` failed at 18:07:53.787111 after 8.36 seconds
[0m18:07:53.787385 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1057b0150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13e5dc9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13e5dd950>]}
[0m18:07:53.787584 [debug] [MainThread]: Flushing usage events
[0m18:08:22.139039 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112e4a250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112e91e10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112e9fbd0>]}


============================== 18:08:22.140559 | 9ffdc431-ce09-4d8d-ad5c-81ea6a0be16d ==============================
[0m18:08:22.140559 [info ] [MainThread]: Running with dbt=1.8.7
[0m18:08:22.140887 [debug] [MainThread]: running dbt with arguments {'log_path': '/Users/shatayu/Downloads/DATA226_Lab2Prep/build_fda/logs', 'use_colors': 'True', 'fail_fast': 'False', 'warn_error': 'None', 'quiet': 'False', 'invocation_command': 'dbt run', 'use_experimental_parser': 'False', 'version_check': 'True', 'debug': 'False', 'no_print': 'None', 'partial_parse': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'indirect_selection': 'eager', 'empty': 'False', 'cache_selected_only': 'False', 'profiles_dir': '/Users/shatayu/.dbt', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'printer_width': '80', 'log_cache_events': 'False'}
[0m18:08:22.672440 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9ffdc431-ce09-4d8d-ad5c-81ea6a0be16d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146a33610>]}
[0m18:08:22.693163 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9ffdc431-ce09-4d8d-ad5c-81ea6a0be16d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112341590>]}
[0m18:08:22.693611 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m18:08:22.705403 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m18:08:22.765532 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m18:08:22.765901 [debug] [MainThread]: Partial parsing: updated file: build_fda://models/output/fsi_nvidia_sumary.sql
[0m18:08:22.766072 [debug] [MainThread]: Partial parsing: updated file: build_fda://models/output/fsi_apple_summary.sql
[0m18:08:22.867403 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9ffdc431-ce09-4d8d-ad5c-81ea6a0be16d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146cb19d0>]}
[0m18:08:22.902972 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9ffdc431-ce09-4d8d-ad5c-81ea6a0be16d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146e69850>]}
[0m18:08:22.903279 [info ] [MainThread]: Found 6 models, 6 sources, 459 macros
[0m18:08:22.903448 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9ffdc431-ce09-4d8d-ad5c-81ea6a0be16d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146cc5950>]}
[0m18:08:22.904356 [info ] [MainThread]: 
[0m18:08:22.904640 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m18:08:22.906589 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m18:08:22.912456 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m18:08:22.912633 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m18:08:22.912763 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:08:23.388799 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.476 seconds
[0m18:08:23.392426 [debug] [ThreadPool]: On list_dev: Close
[0m18:08:23.526977 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_analytics)
[0m18:08:23.540066 [debug] [ThreadPool]: Using snowflake connection "list_dev_analytics"
[0m18:08:23.540623 [debug] [ThreadPool]: On list_dev_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev_analytics"} */
show objects in dev.analytics limit 10000
[0m18:08:23.540909 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:08:24.024087 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.483 seconds
[0m18:08:24.027185 [debug] [ThreadPool]: On list_dev_analytics: Close
[0m18:08:24.153299 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9ffdc431-ce09-4d8d-ad5c-81ea6a0be16d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146a4f590>]}
[0m18:08:24.154471 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m18:08:24.155280 [info ] [MainThread]: 
[0m18:08:24.158739 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_apple_summary
[0m18:08:24.159592 [info ] [Thread-1 (]: 1 of 4 START sql table model analytics.fsi_apple_summary ....................... [RUN]
[0m18:08:24.160231 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_analytics, now model.build_fda.fsi_apple_summary)
[0m18:08:24.160738 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_apple_summary
[0m18:08:24.169533 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_apple_summary"
[0m18:08:24.170535 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_apple_summary
[0m18:08:24.191753 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_apple_summary"
[0m18:08:24.193397 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_apple_summary"
[0m18:08:24.193744 [debug] [Thread-1 (]: On model.build_fda.fsi_apple_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_apple_summary"} */
create or replace transient table dev.analytics.fsi_apple_summary
         as
        (WITH apple_interval_widths AS (
    SELECT
        ts,
        forecast,
        lower_bound,
        upper_bound,
        series,
        (upper_bound - lower_bound) AS interval_width
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
    WHERE series = 'AAPL'  -- Filter for Apple symbol
),

statistics AS (
    SELECT
        series,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM apple_interval_widths
    GROUP BY series
)

SELECT
    a.ts,
    a.series,
    a.forecast,
    a.lower_bound,
    a.upper_bound,
    a.interval_width,
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM apple_interval_widths a
JOIN statistics s
    ON a.series = s.series
ORDER BY a.ts
        );
[0m18:08:24.194000 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:08:26.059740 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.865 seconds
[0m18:08:26.081728 [debug] [Thread-1 (]: On model.build_fda.fsi_apple_summary: Close
[0m18:08:26.188161 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9ffdc431-ce09-4d8d-ad5c-81ea6a0be16d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146e27990>]}
[0m18:08:26.189270 [info ] [Thread-1 (]: 1 of 4 OK created sql table model analytics.fsi_apple_summary .................. [[32mSUCCESS 1[0m in 2.03s]
[0m18:08:26.189887 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_apple_summary
[0m18:08:26.190306 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_nvidia_sumary
[0m18:08:26.191187 [info ] [Thread-1 (]: 2 of 4 START sql table model analytics.fsi_nvidia_sumary ....................... [RUN]
[0m18:08:26.191940 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_apple_summary, now model.build_fda.fsi_nvidia_sumary)
[0m18:08:26.192304 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_nvidia_sumary
[0m18:08:26.195753 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_nvidia_sumary"
[0m18:08:26.196721 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_nvidia_sumary
[0m18:08:26.199060 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_nvidia_sumary"
[0m18:08:26.200383 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_nvidia_sumary"
[0m18:08:26.200722 [debug] [Thread-1 (]: On model.build_fda.fsi_nvidia_sumary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_nvidia_sumary"} */
create or replace transient table dev.analytics.fsi_nvidia_sumary
         as
        (WITH nvidia_interval_widths AS (
    SELECT
        ts,
        forecast,
        lower_bound,
        upper_bound,
        series,
        (upper_bound - lower_bound) AS interval_width
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
    WHERE series = 'NVDA'  -- Filter for Nvidia symbol
),

statistics AS (
    SELECT
        series,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM nvidia_interval_widths
    GROUP BY series
)

SELECT
    n.ts,
    n.series,
    n.forecast,
    n.lower_bound,
    n.upper_bound,
    n.interval_width,
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM nvidia_interval_widths n
JOIN statistics s
    ON n.series = s.series
ORDER BY n.ts
        );
[0m18:08:26.201035 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:08:27.497324 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.296 seconds
[0m18:08:27.501852 [debug] [Thread-1 (]: On model.build_fda.fsi_nvidia_sumary: Close
[0m18:08:27.631777 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9ffdc431-ce09-4d8d-ad5c-81ea6a0be16d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110d59050>]}
[0m18:08:27.632900 [info ] [Thread-1 (]: 2 of 4 OK created sql table model analytics.fsi_nvidia_sumary .................. [[32mSUCCESS 1[0m in 1.44s]
[0m18:08:27.633500 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_nvidia_sumary
[0m18:08:27.633876 [debug] [Thread-1 (]: Began running node model.build_fda.obv_apple_summary
[0m18:08:27.634311 [info ] [Thread-1 (]: 3 of 4 START sql table model analytics.obv_apple_summary ....................... [RUN]
[0m18:08:27.634718 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_nvidia_sumary, now model.build_fda.obv_apple_summary)
[0m18:08:27.635009 [debug] [Thread-1 (]: Began compiling node model.build_fda.obv_apple_summary
[0m18:08:27.638210 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.obv_apple_summary"
[0m18:08:27.639083 [debug] [Thread-1 (]: Began executing node model.build_fda.obv_apple_summary
[0m18:08:27.644293 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.obv_apple_summary"
[0m18:08:27.646011 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.obv_apple_summary"
[0m18:08:27.646432 [debug] [Thread-1 (]: On model.build_fda.obv_apple_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.obv_apple_summary"} */
create or replace transient table dev.analytics.obv_apple_summary
         as
        (WITH ordered_data AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM dev.raw_data.stock_data -- Referencing the raw data table in the dev database
    WHERE symbol = 'AAPL'  -- Filter for Apple symbol
),

obv_calculation AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        CASE
            WHEN close > LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN volume
            WHEN close < LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN -volume
            ELSE 0
        END AS volume_change
    FROM ordered_data
),

cumulative_obv AS (
    SELECT
        date,
        symbol,
        SUM(volume_change) OVER (PARTITION BY symbol ORDER BY date) AS obv
    FROM obv_calculation
)

SELECT
    date,
    symbol,
    obv
FROM cumulative_obv
ORDER BY date
        );
[0m18:08:27.646804 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:08:29.009179 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.362 seconds
[0m18:08:29.016675 [debug] [Thread-1 (]: On model.build_fda.obv_apple_summary: Close
[0m18:08:29.172037 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9ffdc431-ce09-4d8d-ad5c-81ea6a0be16d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x147264c90>]}
[0m18:08:29.173448 [info ] [Thread-1 (]: 3 of 4 OK created sql table model analytics.obv_apple_summary .................. [[32mSUCCESS 1[0m in 1.54s]
[0m18:08:29.174258 [debug] [Thread-1 (]: Finished running node model.build_fda.obv_apple_summary
[0m18:08:29.174813 [debug] [Thread-1 (]: Began running node model.build_fda.obv_nvidia_summary
[0m18:08:29.175565 [info ] [Thread-1 (]: 4 of 4 START sql table model analytics.obv_nvidia_summary ...................... [RUN]
[0m18:08:29.176288 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.obv_apple_summary, now model.build_fda.obv_nvidia_summary)
[0m18:08:29.176759 [debug] [Thread-1 (]: Began compiling node model.build_fda.obv_nvidia_summary
[0m18:08:29.180271 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.obv_nvidia_summary"
[0m18:08:29.181102 [debug] [Thread-1 (]: Began executing node model.build_fda.obv_nvidia_summary
[0m18:08:29.183703 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.obv_nvidia_summary"
[0m18:08:29.185106 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.obv_nvidia_summary"
[0m18:08:29.185485 [debug] [Thread-1 (]: On model.build_fda.obv_nvidia_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.obv_nvidia_summary"} */
create or replace transient table dev.analytics.obv_nvidia_summary
         as
        (WITH ordered_data AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM dev.raw_data.stock_data -- Referencing the raw data table in the dev database
    WHERE symbol = 'NVDA'  -- Filter for Nvidia symbol
),

obv_calculation AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        CASE
            WHEN close > LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN volume
            WHEN close < LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN -volume
            ELSE 0
        END AS volume_change
    FROM ordered_data
),

cumulative_obv AS (
    SELECT
        date,
        symbol,
        SUM(volume_change) OVER (PARTITION BY symbol ORDER BY date) AS obv
    FROM obv_calculation
)

SELECT
    date,
    symbol,
    obv
FROM cumulative_obv
ORDER BY date
        );
[0m18:08:29.185822 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:08:30.362607 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.176 seconds
[0m18:08:30.365859 [debug] [Thread-1 (]: On model.build_fda.obv_nvidia_summary: Close
[0m18:08:30.475653 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9ffdc431-ce09-4d8d-ad5c-81ea6a0be16d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146b60450>]}
[0m18:08:30.476821 [info ] [Thread-1 (]: 4 of 4 OK created sql table model analytics.obv_nvidia_summary ................. [[32mSUCCESS 1[0m in 1.30s]
[0m18:08:30.477633 [debug] [Thread-1 (]: Finished running node model.build_fda.obv_nvidia_summary
[0m18:08:30.478241 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data
[0m18:08:30.478800 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.obv_nvidia_summary, now model.build_fda.stock_data)
[0m18:08:30.479405 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data
[0m18:08:30.483586 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data"
[0m18:08:30.484807 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data
[0m18:08:30.485329 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data_forecast
[0m18:08:30.486135 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.stock_data, now model.build_fda.stock_data_forecast)
[0m18:08:30.486554 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data_forecast
[0m18:08:30.489045 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data_forecast"
[0m18:08:30.490222 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data_forecast
[0m18:08:30.491651 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:08:30.492008 [debug] [MainThread]: Connection 'model.build_fda.stock_data_forecast' was properly closed.
[0m18:08:30.492381 [info ] [MainThread]: 
[0m18:08:30.492792 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 7.59 seconds (7.59s).
[0m18:08:30.493760 [debug] [MainThread]: Command end result
[0m18:08:30.517567 [info ] [MainThread]: 
[0m18:08:30.517890 [info ] [MainThread]: [32mCompleted successfully[0m
[0m18:08:30.518072 [info ] [MainThread]: 
[0m18:08:30.518252 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m18:08:30.520449 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 8.426213, "process_user_time": 2.152302, "process_kernel_time": 1.482419, "process_mem_max_rss": "205471744", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m18:08:30.520787 [debug] [MainThread]: Command `dbt run` succeeded at 18:08:30.520735 after 8.43 seconds
[0m18:08:30.521005 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112ec3dd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110dc6a50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112d15090>]}
[0m18:08:30.521208 [debug] [MainThread]: Flushing usage events
[0m18:15:40.159965 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f7bb90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105ffca50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105ffcf90>]}


============================== 18:15:40.162220 | e54edef6-07df-498e-aa4b-ce9d4a34f386 ==============================
[0m18:15:40.162220 [info ] [MainThread]: Running with dbt=1.8.7
[0m18:15:40.162585 [debug] [MainThread]: running dbt with arguments {'indirect_selection': 'eager', 'cache_selected_only': 'False', 'profiles_dir': '/Users/shatayu/.dbt', 'log_path': '/Users/shatayu/Downloads/DATA226_Lab2Prep/build_fda/logs', 'log_format': 'default', 'use_experimental_parser': 'False', 'invocation_command': 'dbt run', 'quiet': 'False', 'version_check': 'True', 'warn_error': 'None', 'write_json': 'True', 'use_colors': 'True', 'fail_fast': 'False', 'no_print': 'None', 'log_cache_events': 'False', 'send_anonymous_usage_stats': 'True', 'empty': 'False', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'debug': 'False', 'printer_width': '80', 'partial_parse': 'True', 'target_path': 'None', 'static_parser': 'True'}
[0m18:15:40.935037 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e54edef6-07df-498e-aa4b-ce9d4a34f386', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x122568150>]}
[0m18:15:40.955523 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e54edef6-07df-498e-aa4b-ce9d4a34f386', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1059458d0>]}
[0m18:15:40.956109 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m18:15:40.968373 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m18:15:41.037818 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 1 files added, 0 files changed.
[0m18:15:41.038185 [debug] [MainThread]: Partial parsing: added file: build_fda://models/output/fsi_nvidia_summary.sql
[0m18:15:41.038328 [debug] [MainThread]: Partial parsing: deleted file: build_fda://models/output/fsi_nvidia_sumary.sql
[0m18:15:41.139390 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e54edef6-07df-498e-aa4b-ce9d4a34f386', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1534f7250>]}
[0m18:15:41.178946 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e54edef6-07df-498e-aa4b-ce9d4a34f386', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1538ca0d0>]}
[0m18:15:41.179245 [info ] [MainThread]: Found 6 models, 6 sources, 459 macros
[0m18:15:41.179423 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e54edef6-07df-498e-aa4b-ce9d4a34f386', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1537af710>]}
[0m18:15:41.180321 [info ] [MainThread]: 
[0m18:15:41.180608 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m18:15:41.182563 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m18:15:41.188426 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m18:15:41.188596 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m18:15:41.188725 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:15:41.790764 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.601 seconds
[0m18:15:41.795123 [debug] [ThreadPool]: On list_dev: Close
[0m18:15:41.911956 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_analytics)
[0m18:15:41.924251 [debug] [ThreadPool]: Using snowflake connection "list_dev_analytics"
[0m18:15:41.924679 [debug] [ThreadPool]: On list_dev_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev_analytics"} */
show objects in dev.analytics limit 10000
[0m18:15:41.924948 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:15:42.532049 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.607 seconds
[0m18:15:42.535002 [debug] [ThreadPool]: On list_dev_analytics: Close
[0m18:15:42.658690 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e54edef6-07df-498e-aa4b-ce9d4a34f386', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105e9f2d0>]}
[0m18:15:42.659430 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m18:15:42.659804 [info ] [MainThread]: 
[0m18:15:42.662441 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_apple_summary
[0m18:15:42.663000 [info ] [Thread-1 (]: 1 of 4 START sql table model analytics.fsi_apple_summary ....................... [RUN]
[0m18:15:42.663469 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_analytics, now model.build_fda.fsi_apple_summary)
[0m18:15:42.663826 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_apple_summary
[0m18:15:42.672377 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_apple_summary"
[0m18:15:42.673234 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_apple_summary
[0m18:15:42.694073 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_apple_summary"
[0m18:15:42.695220 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_apple_summary"
[0m18:15:42.695504 [debug] [Thread-1 (]: On model.build_fda.fsi_apple_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_apple_summary"} */
create or replace transient table dev.analytics.fsi_apple_summary
         as
        (WITH apple_interval_widths AS (
    SELECT
        ts,
        forecast,
        lower_bound,
        upper_bound,
        series,
        (upper_bound - lower_bound) AS interval_width
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
    WHERE series = 'AAPL'  -- Filter for Apple symbol
),

statistics AS (
    SELECT
        series,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM apple_interval_widths
    GROUP BY series
)

SELECT
    a.ts,
    a.series,
    a.forecast,
    a.lower_bound,
    a.upper_bound,
    a.interval_width,
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM apple_interval_widths a
JOIN statistics s
    ON a.series = s.series
ORDER BY a.ts
        );
[0m18:15:42.695751 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:15:43.921994 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.226 seconds
[0m18:15:43.946788 [debug] [Thread-1 (]: On model.build_fda.fsi_apple_summary: Close
[0m18:15:44.075966 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e54edef6-07df-498e-aa4b-ce9d4a34f386', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1539b6a50>]}
[0m18:15:44.077201 [info ] [Thread-1 (]: 1 of 4 OK created sql table model analytics.fsi_apple_summary .................. [[32mSUCCESS 1[0m in 1.41s]
[0m18:15:44.078173 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_apple_summary
[0m18:15:44.078863 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_nvidia_summary
[0m18:15:44.079536 [info ] [Thread-1 (]: 2 of 4 START sql table model analytics.fsi_nvidia_summary ...................... [RUN]
[0m18:15:44.080071 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_apple_summary, now model.build_fda.fsi_nvidia_summary)
[0m18:15:44.080479 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_nvidia_summary
[0m18:15:44.083934 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_nvidia_summary"
[0m18:15:44.084817 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_nvidia_summary
[0m18:15:44.087643 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_nvidia_summary"
[0m18:15:44.089184 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_nvidia_summary"
[0m18:15:44.089590 [debug] [Thread-1 (]: On model.build_fda.fsi_nvidia_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_nvidia_summary"} */
create or replace transient table dev.analytics.fsi_nvidia_summary
         as
        (WITH nvidia_interval_widths AS (
    SELECT
        ts,
        forecast,
        lower_bound,
        upper_bound,
        series,
        (upper_bound - lower_bound) AS interval_width
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
    WHERE series = 'NVDA'  -- Filter for Nvidia symbol
),

statistics AS (
    SELECT
        series,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM nvidia_interval_widths
    GROUP BY series
)

SELECT
    n.ts,
    n.series,
    n.forecast,
    n.lower_bound,
    n.upper_bound,
    n.interval_width,
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM nvidia_interval_widths n
JOIN statistics s
    ON n.series = s.series
ORDER BY n.ts
        );
[0m18:15:44.089962 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:15:45.763991 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.673 seconds
[0m18:15:45.767623 [debug] [Thread-1 (]: On model.build_fda.fsi_nvidia_summary: Close
[0m18:15:45.885180 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e54edef6-07df-498e-aa4b-ce9d4a34f386', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15388f550>]}
[0m18:15:45.886385 [info ] [Thread-1 (]: 2 of 4 OK created sql table model analytics.fsi_nvidia_summary ................. [[32mSUCCESS 1[0m in 1.80s]
[0m18:15:45.887253 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_nvidia_summary
[0m18:15:45.888111 [debug] [Thread-1 (]: Began running node model.build_fda.obv_apple_summary
[0m18:15:45.888917 [info ] [Thread-1 (]: 3 of 4 START sql table model analytics.obv_apple_summary ....................... [RUN]
[0m18:15:45.889589 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_nvidia_summary, now model.build_fda.obv_apple_summary)
[0m18:15:45.890057 [debug] [Thread-1 (]: Began compiling node model.build_fda.obv_apple_summary
[0m18:15:45.893700 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.obv_apple_summary"
[0m18:15:45.894443 [debug] [Thread-1 (]: Began executing node model.build_fda.obv_apple_summary
[0m18:15:45.898379 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.obv_apple_summary"
[0m18:15:45.899813 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.obv_apple_summary"
[0m18:15:45.900157 [debug] [Thread-1 (]: On model.build_fda.obv_apple_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.obv_apple_summary"} */
create or replace transient table dev.analytics.obv_apple_summary
         as
        (WITH ordered_data AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM dev.raw_data.stock_data -- Referencing the raw data table in the dev database
    WHERE symbol = 'AAPL'  -- Filter for Apple symbol
),

obv_calculation AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        CASE
            WHEN close > LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN volume
            WHEN close < LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN -volume
            ELSE 0
        END AS volume_change
    FROM ordered_data
),

cumulative_obv AS (
    SELECT
        date,
        symbol,
        SUM(volume_change) OVER (PARTITION BY symbol ORDER BY date) AS obv
    FROM obv_calculation
)

SELECT
    date,
    symbol,
    obv
FROM cumulative_obv
ORDER BY date
        );
[0m18:15:45.900451 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:15:47.708773 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.808 seconds
[0m18:15:47.714611 [debug] [Thread-1 (]: On model.build_fda.obv_apple_summary: Close
[0m18:15:47.847993 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e54edef6-07df-498e-aa4b-ce9d4a34f386', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1536ea7d0>]}
[0m18:15:47.849170 [info ] [Thread-1 (]: 3 of 4 OK created sql table model analytics.obv_apple_summary .................. [[32mSUCCESS 1[0m in 1.96s]
[0m18:15:47.850038 [debug] [Thread-1 (]: Finished running node model.build_fda.obv_apple_summary
[0m18:15:47.850632 [debug] [Thread-1 (]: Began running node model.build_fda.obv_nvidia_summary
[0m18:15:47.851374 [info ] [Thread-1 (]: 4 of 4 START sql table model analytics.obv_nvidia_summary ...................... [RUN]
[0m18:15:47.852006 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.obv_apple_summary, now model.build_fda.obv_nvidia_summary)
[0m18:15:47.852417 [debug] [Thread-1 (]: Began compiling node model.build_fda.obv_nvidia_summary
[0m18:15:47.856511 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.obv_nvidia_summary"
[0m18:15:47.857404 [debug] [Thread-1 (]: Began executing node model.build_fda.obv_nvidia_summary
[0m18:15:47.860322 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.obv_nvidia_summary"
[0m18:15:47.861877 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.obv_nvidia_summary"
[0m18:15:47.862269 [debug] [Thread-1 (]: On model.build_fda.obv_nvidia_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.obv_nvidia_summary"} */
create or replace transient table dev.analytics.obv_nvidia_summary
         as
        (WITH ordered_data AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM dev.raw_data.stock_data -- Referencing the raw data table in the dev database
    WHERE symbol = 'NVDA'  -- Filter for Nvidia symbol
),

obv_calculation AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        CASE
            WHEN close > LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN volume
            WHEN close < LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN -volume
            ELSE 0
        END AS volume_change
    FROM ordered_data
),

cumulative_obv AS (
    SELECT
        date,
        symbol,
        SUM(volume_change) OVER (PARTITION BY symbol ORDER BY date) AS obv
    FROM obv_calculation
)

SELECT
    date,
    symbol,
    obv
FROM cumulative_obv
ORDER BY date
        );
[0m18:15:47.862628 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:15:49.142065 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.279 seconds
[0m18:15:49.146859 [debug] [Thread-1 (]: On model.build_fda.obv_nvidia_summary: Close
[0m18:15:49.267805 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e54edef6-07df-498e-aa4b-ce9d4a34f386', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1539ea8d0>]}
[0m18:15:49.269135 [info ] [Thread-1 (]: 4 of 4 OK created sql table model analytics.obv_nvidia_summary ................. [[32mSUCCESS 1[0m in 1.42s]
[0m18:15:49.269940 [debug] [Thread-1 (]: Finished running node model.build_fda.obv_nvidia_summary
[0m18:15:49.270506 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data
[0m18:15:49.271064 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.obv_nvidia_summary, now model.build_fda.stock_data)
[0m18:15:49.271888 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data
[0m18:15:49.275949 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data"
[0m18:15:49.277267 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data
[0m18:15:49.277654 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data_forecast
[0m18:15:49.278129 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.stock_data, now model.build_fda.stock_data_forecast)
[0m18:15:49.278523 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data_forecast
[0m18:15:49.281329 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data_forecast"
[0m18:15:49.282555 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data_forecast
[0m18:15:49.283917 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:15:49.284267 [debug] [MainThread]: Connection 'model.build_fda.stock_data_forecast' was properly closed.
[0m18:15:49.284653 [info ] [MainThread]: 
[0m18:15:49.284998 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 8.10 seconds (8.10s).
[0m18:15:49.285812 [debug] [MainThread]: Command end result
[0m18:15:49.307947 [info ] [MainThread]: 
[0m18:15:49.308313 [info ] [MainThread]: [32mCompleted successfully[0m
[0m18:15:49.308518 [info ] [MainThread]: 
[0m18:15:49.308738 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m18:15:49.311253 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 9.200312, "process_user_time": 2.550405, "process_kernel_time": 1.215637, "process_mem_max_rss": "203554816", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m18:15:49.311624 [debug] [MainThread]: Command `dbt run` succeeded at 18:15:49.311568 after 9.20 seconds
[0m18:15:49.311864 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100a58150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105d60410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100aa22d0>]}
[0m18:15:49.312081 [debug] [MainThread]: Flushing usage events
[0m21:03:34.113970 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106f88190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106fd1e10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106fdfc10>]}


============================== 21:03:34.115958 | d9311d1a-5a3b-4e9e-8eec-79f0c3461770 ==============================
[0m21:03:34.115958 [info ] [MainThread]: Running with dbt=1.8.7
[0m21:03:34.116281 [debug] [MainThread]: running dbt with arguments {'invocation_command': 'dbt run', 'write_json': 'True', 'indirect_selection': 'eager', 'log_path': '/Users/shatayu/Downloads/DATA226_Lab2Prep/build_fda/logs', 'use_experimental_parser': 'False', 'quiet': 'False', 'fail_fast': 'False', 'cache_selected_only': 'False', 'log_format': 'default', 'introspect': 'True', 'debug': 'False', 'warn_error': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'profiles_dir': '/Users/shatayu/.dbt', 'target_path': 'None', 'static_parser': 'True', 'version_check': 'True', 'no_print': 'None', 'empty': 'False', 'send_anonymous_usage_stats': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'printer_width': '80', 'use_colors': 'True'}
[0m21:03:35.085786 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd9311d1a-5a3b-4e9e-8eec-79f0c3461770', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x128028150>]}
[0m21:03:35.109371 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd9311d1a-5a3b-4e9e-8eec-79f0c3461770', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106401bd0>]}
[0m21:03:35.110314 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m21:03:35.123802 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m21:03:35.196376 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 2 files added, 0 files changed.
[0m21:03:35.196732 [debug] [MainThread]: Partial parsing: added file: build_fda://models/output/fsi_integ_summary.sql
[0m21:03:35.196883 [debug] [MainThread]: Partial parsing: added file: build_fda://models/output/fsi_stock_summary.sql
[0m21:03:35.298219 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd9311d1a-5a3b-4e9e-8eec-79f0c3461770', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12aff5210>]}
[0m21:03:35.339104 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd9311d1a-5a3b-4e9e-8eec-79f0c3461770', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12ce6c550>]}
[0m21:03:35.339413 [info ] [MainThread]: Found 8 models, 6 sources, 459 macros
[0m21:03:35.339586 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd9311d1a-5a3b-4e9e-8eec-79f0c3461770', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12ce08b50>]}
[0m21:03:35.340473 [info ] [MainThread]: 
[0m21:03:35.340750 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m21:03:35.342895 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m21:03:35.348955 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m21:03:35.349297 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m21:03:35.349520 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:03:36.174029 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.823 seconds
[0m21:03:36.177141 [debug] [ThreadPool]: On list_dev: Close
[0m21:03:36.332876 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_analytics)
[0m21:03:36.344636 [debug] [ThreadPool]: Using snowflake connection "list_dev_analytics"
[0m21:03:36.345197 [debug] [ThreadPool]: On list_dev_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev_analytics"} */
show objects in dev.analytics limit 10000
[0m21:03:36.345487 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:03:36.878798 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.533 seconds
[0m21:03:36.882124 [debug] [ThreadPool]: On list_dev_analytics: Close
[0m21:03:37.027765 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd9311d1a-5a3b-4e9e-8eec-79f0c3461770', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12cd306d0>]}
[0m21:03:37.028919 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m21:03:37.029414 [info ] [MainThread]: 
[0m21:03:37.034296 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_apple_summary
[0m21:03:37.035016 [info ] [Thread-1 (]: 1 of 6 START sql table model analytics.fsi_apple_summary ....................... [RUN]
[0m21:03:37.035566 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_analytics, now model.build_fda.fsi_apple_summary)
[0m21:03:37.035939 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_apple_summary
[0m21:03:37.043939 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_apple_summary"
[0m21:03:37.045064 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_apple_summary
[0m21:03:37.066222 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_apple_summary"
[0m21:03:37.067557 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_apple_summary"
[0m21:03:37.067868 [debug] [Thread-1 (]: On model.build_fda.fsi_apple_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_apple_summary"} */
create or replace transient table dev.analytics.fsi_apple_summary
         as
        (WITH apple_interval_widths AS (
    SELECT
        ts,
        forecast,
        lower_bound,
        upper_bound,
        series,
        (upper_bound - lower_bound) AS interval_width
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
    WHERE series = 'AAPL'  -- Filter for Apple symbol
),

statistics AS (
    SELECT
        series,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM apple_interval_widths
    GROUP BY series
)

SELECT
    a.ts,
    a.series,
    a.forecast,
    a.lower_bound,
    a.upper_bound,
    a.interval_width,
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM apple_interval_widths a
JOIN statistics s
    ON a.series = s.series
ORDER BY a.ts
        );
[0m21:03:37.068111 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:03:39.124287 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.056 seconds
[0m21:03:39.160694 [debug] [Thread-1 (]: On model.build_fda.fsi_apple_summary: Close
[0m21:03:39.283614 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd9311d1a-5a3b-4e9e-8eec-79f0c3461770', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12af30090>]}
[0m21:03:39.287477 [info ] [Thread-1 (]: 1 of 6 OK created sql table model analytics.fsi_apple_summary .................. [[32mSUCCESS 1[0m in 2.25s]
[0m21:03:39.289019 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_apple_summary
[0m21:03:39.290190 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_integ_summary
[0m21:03:39.290992 [info ] [Thread-1 (]: 2 of 6 START sql table model analytics.fsi_integ_summary ....................... [RUN]
[0m21:03:39.292108 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_apple_summary, now model.build_fda.fsi_integ_summary)
[0m21:03:39.292911 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_integ_summary
[0m21:03:39.300212 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_integ_summary"
[0m21:03:39.301677 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_integ_summary
[0m21:03:39.305797 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_integ_summary"
[0m21:03:39.307645 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_integ_summary"
[0m21:03:39.308105 [debug] [Thread-1 (]: On model.build_fda.fsi_integ_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_integ_summary"} */
create or replace transient table dev.analytics.fsi_integ_summary
         as
        (WITH interval_widths AS (
    SELECT
        ts,
        forecast,
        lower_bound,
        upper_bound,
        series,
        (upper_bound - lower_bound) AS interval_width
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
),

statistics AS (
    SELECT
        series,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM apple_interval_widths
    GROUP BY series
)

SELECT
    a.ts,
    a.series,
    a.forecast,
    a.lower_bound,
    a.upper_bound,
    a.interval_width,
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM interval_widths a
JOIN statistics s
    ON a.series = s.series
ORDER BY a.ts
        );
[0m21:03:39.308526 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:03:39.913857 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b8508f-0004-26cb-0000-000255f3bb21
[0m21:03:39.915354 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 002003 (42S02): SQL compilation error:
Object 'APPLE_INTERVAL_WIDTHS' does not exist or not authorized.
[0m21:03:39.916290 [debug] [Thread-1 (]: On model.build_fda.fsi_integ_summary: Close
[0m21:03:40.040755 [debug] [Thread-1 (]: Database Error in model fsi_integ_summary (models/output/fsi_integ_summary.sql)
  002003 (42S02): SQL compilation error:
  Object 'APPLE_INTERVAL_WIDTHS' does not exist or not authorized.
  compiled code at target/run/build_fda/models/output/fsi_integ_summary.sql
[0m21:03:40.042106 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd9311d1a-5a3b-4e9e-8eec-79f0c3461770', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105e667d0>]}
[0m21:03:40.043072 [error] [Thread-1 (]: 2 of 6 ERROR creating sql table model analytics.fsi_integ_summary .............. [[31mERROR[0m in 0.75s]
[0m21:03:40.043899 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_integ_summary
[0m21:03:40.044482 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_nvidia_summary
[0m21:03:40.045323 [info ] [Thread-1 (]: 3 of 6 START sql table model analytics.fsi_nvidia_summary ...................... [RUN]
[0m21:03:40.046066 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_integ_summary, now model.build_fda.fsi_nvidia_summary)
[0m21:03:40.046567 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_nvidia_summary
[0m21:03:40.050882 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_nvidia_summary"
[0m21:03:40.052128 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_nvidia_summary
[0m21:03:40.057418 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_nvidia_summary"
[0m21:03:40.059271 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_nvidia_summary"
[0m21:03:40.131065 [debug] [Thread-1 (]: On model.build_fda.fsi_nvidia_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_nvidia_summary"} */
create or replace transient table dev.analytics.fsi_nvidia_summary
         as
        (WITH nvidia_interval_widths AS (
    SELECT
        ts,
        forecast,
        lower_bound,
        upper_bound,
        series,
        (upper_bound - lower_bound) AS interval_width
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
    WHERE series = 'NVDA'  -- Filter for Nvidia symbol
),

statistics AS (
    SELECT
        series,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM nvidia_interval_widths
    GROUP BY series
)

SELECT
    n.ts,
    n.series,
    n.forecast,
    n.lower_bound,
    n.upper_bound,
    n.interval_width,
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM nvidia_interval_widths n
JOIN statistics s
    ON n.series = s.series
ORDER BY n.ts
        );
[0m21:03:40.131409 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:03:41.587811 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.456 seconds
[0m21:03:41.594224 [debug] [Thread-1 (]: On model.build_fda.fsi_nvidia_summary: Close
[0m21:03:41.721021 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd9311d1a-5a3b-4e9e-8eec-79f0c3461770', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e607f90>]}
[0m21:03:41.722861 [info ] [Thread-1 (]: 3 of 6 OK created sql table model analytics.fsi_nvidia_summary ................. [[32mSUCCESS 1[0m in 1.67s]
[0m21:03:41.723935 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_nvidia_summary
[0m21:03:41.724789 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_stock_summary
[0m21:03:41.725566 [info ] [Thread-1 (]: 4 of 6 START sql table model analytics.fsi_stock_summary ....................... [RUN]
[0m21:03:41.726368 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_nvidia_summary, now model.build_fda.fsi_stock_summary)
[0m21:03:41.726902 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_stock_summary
[0m21:03:41.734807 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_stock_summary"
[0m21:03:41.736894 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_stock_summary
[0m21:03:41.740399 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_stock_summary"
[0m21:03:41.742342 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_stock_summary"
[0m21:03:41.742769 [debug] [Thread-1 (]: On model.build_fda.fsi_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_stock_summary"} */
create or replace transient table dev.analytics.fsi_stock_summary
         as
        (WITH apple_interval_widths AS (
    SELECT
        ts,
        forecast,
        lower_bound,
        upper_bound,
        series,
        (upper_bound - lower_bound) AS interval_width
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
    WHERE series = 'AAPL'  -- Filter for Apple symbol
),

statistics AS (
    SELECT
        series,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM apple_interval_widths
    GROUP BY series
)

SELECT
    a.ts,
    a.series,
    a.forecast,
    a.lower_bound,
    a.upper_bound,
    a.interval_width,
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM apple_interval_widths a
JOIN statistics s
    ON a.series = s.series
ORDER BY a.ts
        );
[0m21:03:41.743098 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:03:43.424040 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.681 seconds
[0m21:03:43.429959 [debug] [Thread-1 (]: On model.build_fda.fsi_stock_summary: Close
[0m21:03:43.548181 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd9311d1a-5a3b-4e9e-8eec-79f0c3461770', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12cea32d0>]}
[0m21:03:43.550431 [info ] [Thread-1 (]: 4 of 6 OK created sql table model analytics.fsi_stock_summary .................. [[32mSUCCESS 1[0m in 1.82s]
[0m21:03:43.551856 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_stock_summary
[0m21:03:43.552884 [debug] [Thread-1 (]: Began running node model.build_fda.obv_apple_summary
[0m21:03:43.553953 [info ] [Thread-1 (]: 5 of 6 START sql table model analytics.obv_apple_summary ....................... [RUN]
[0m21:03:43.555758 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_stock_summary, now model.build_fda.obv_apple_summary)
[0m21:03:43.556936 [debug] [Thread-1 (]: Began compiling node model.build_fda.obv_apple_summary
[0m21:03:43.564687 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.obv_apple_summary"
[0m21:03:43.567000 [debug] [Thread-1 (]: Began executing node model.build_fda.obv_apple_summary
[0m21:03:43.571419 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.obv_apple_summary"
[0m21:03:43.573850 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.obv_apple_summary"
[0m21:03:43.574426 [debug] [Thread-1 (]: On model.build_fda.obv_apple_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.obv_apple_summary"} */
create or replace transient table dev.analytics.obv_apple_summary
         as
        (WITH ordered_data AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM dev.raw_data.stock_data -- Referencing the raw data table in the dev database
    WHERE symbol = 'AAPL'  -- Filter for Apple symbol
),

obv_calculation AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        CASE
            WHEN close > LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN volume
            WHEN close < LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN -volume
            ELSE 0
        END AS volume_change
    FROM ordered_data
),

cumulative_obv AS (
    SELECT
        date,
        symbol,
        SUM(volume_change) OVER (PARTITION BY symbol ORDER BY date) AS obv
    FROM obv_calculation
)

SELECT
    date,
    symbol,
    obv
FROM cumulative_obv
ORDER BY date
        );
[0m21:03:43.574956 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:03:44.795241 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.220 seconds
[0m21:03:44.799651 [debug] [Thread-1 (]: On model.build_fda.obv_apple_summary: Close
[0m21:03:44.912997 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd9311d1a-5a3b-4e9e-8eec-79f0c3461770', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e3a4c50>]}
[0m21:03:44.914136 [info ] [Thread-1 (]: 5 of 6 OK created sql table model analytics.obv_apple_summary .................. [[32mSUCCESS 1[0m in 1.36s]
[0m21:03:44.915040 [debug] [Thread-1 (]: Finished running node model.build_fda.obv_apple_summary
[0m21:03:44.915471 [debug] [Thread-1 (]: Began running node model.build_fda.obv_nvidia_summary
[0m21:03:44.916043 [info ] [Thread-1 (]: 6 of 6 START sql table model analytics.obv_nvidia_summary ...................... [RUN]
[0m21:03:44.916673 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.obv_apple_summary, now model.build_fda.obv_nvidia_summary)
[0m21:03:44.917087 [debug] [Thread-1 (]: Began compiling node model.build_fda.obv_nvidia_summary
[0m21:03:44.920844 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.obv_nvidia_summary"
[0m21:03:44.923129 [debug] [Thread-1 (]: Began executing node model.build_fda.obv_nvidia_summary
[0m21:03:44.925842 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.obv_nvidia_summary"
[0m21:03:44.927468 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.obv_nvidia_summary"
[0m21:03:44.927860 [debug] [Thread-1 (]: On model.build_fda.obv_nvidia_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.obv_nvidia_summary"} */
create or replace transient table dev.analytics.obv_nvidia_summary
         as
        (WITH ordered_data AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM dev.raw_data.stock_data -- Referencing the raw data table in the dev database
    WHERE symbol = 'NVDA'  -- Filter for Nvidia symbol
),

obv_calculation AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        CASE
            WHEN close > LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN volume
            WHEN close < LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN -volume
            ELSE 0
        END AS volume_change
    FROM ordered_data
),

cumulative_obv AS (
    SELECT
        date,
        symbol,
        SUM(volume_change) OVER (PARTITION BY symbol ORDER BY date) AS obv
    FROM obv_calculation
)

SELECT
    date,
    symbol,
    obv
FROM cumulative_obv
ORDER BY date
        );
[0m21:03:44.928221 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:03:46.088201 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.160 seconds
[0m21:03:46.092413 [debug] [Thread-1 (]: On model.build_fda.obv_nvidia_summary: Close
[0m21:03:46.214243 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd9311d1a-5a3b-4e9e-8eec-79f0c3461770', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e607f90>]}
[0m21:03:46.215647 [info ] [Thread-1 (]: 6 of 6 OK created sql table model analytics.obv_nvidia_summary ................. [[32mSUCCESS 1[0m in 1.30s]
[0m21:03:46.216533 [debug] [Thread-1 (]: Finished running node model.build_fda.obv_nvidia_summary
[0m21:03:46.217153 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data
[0m21:03:46.217923 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.obv_nvidia_summary, now model.build_fda.stock_data)
[0m21:03:46.218434 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data
[0m21:03:46.222411 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data"
[0m21:03:46.223632 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data
[0m21:03:46.224085 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data_forecast
[0m21:03:46.224474 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.stock_data, now model.build_fda.stock_data_forecast)
[0m21:03:46.224762 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data_forecast
[0m21:03:46.227137 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data_forecast"
[0m21:03:46.227898 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data_forecast
[0m21:03:46.229207 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:03:46.229567 [debug] [MainThread]: Connection 'model.build_fda.stock_data_forecast' was properly closed.
[0m21:03:46.229963 [info ] [MainThread]: 
[0m21:03:46.230251 [info ] [MainThread]: Finished running 6 table models in 0 hours 0 minutes and 10.89 seconds (10.89s).
[0m21:03:46.231212 [debug] [MainThread]: Command end result
[0m21:03:46.254363 [info ] [MainThread]: 
[0m21:03:46.254655 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m21:03:46.254828 [info ] [MainThread]: 
[0m21:03:46.255034 [error] [MainThread]:   Database Error in model fsi_integ_summary (models/output/fsi_integ_summary.sql)
  002003 (42S02): SQL compilation error:
  Object 'APPLE_INTERVAL_WIDTHS' does not exist or not authorized.
  compiled code at target/run/build_fda/models/output/fsi_integ_summary.sql
[0m21:03:46.255211 [info ] [MainThread]: 
[0m21:03:46.255390 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=0 TOTAL=6
[0m21:03:46.257536 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 12.1928, "process_user_time": 2.623689, "process_kernel_time": 1.574089, "process_mem_max_rss": "205307904", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m21:03:46.257863 [debug] [MainThread]: Command `dbt run` failed at 21:03:46.257812 after 12.19 seconds
[0m21:03:46.258084 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102bc8150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105ee5d50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12af30790>]}
[0m21:03:46.258276 [debug] [MainThread]: Flushing usage events
[0m21:04:22.042236 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109296410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10930c590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10930cad0>]}


============================== 21:04:22.043843 | cd4634e1-5f5e-4afc-bdf6-c133590e153b ==============================
[0m21:04:22.043843 [info ] [MainThread]: Running with dbt=1.8.7
[0m21:04:22.044173 [debug] [MainThread]: running dbt with arguments {'debug': 'False', 'profiles_dir': '/Users/shatayu/.dbt', 'use_experimental_parser': 'False', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'version_check': 'True', 'invocation_command': 'dbt run', 'log_path': '/Users/shatayu/Downloads/DATA226_Lab2Prep/build_fda/logs', 'log_format': 'default', 'warn_error': 'None', 'empty': 'False', 'send_anonymous_usage_stats': 'True', 'target_path': 'None', 'static_parser': 'True', 'introspect': 'True', 'partial_parse': 'True', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'cache_selected_only': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'write_json': 'True', 'printer_width': '80', 'quiet': 'False'}
[0m21:04:22.759274 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'cd4634e1-5f5e-4afc-bdf6-c133590e153b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x133715290>]}
[0m21:04:22.779255 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'cd4634e1-5f5e-4afc-bdf6-c133590e153b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108d55590>]}
[0m21:04:22.780720 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m21:04:22.793360 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m21:04:22.860083 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:04:22.860442 [debug] [MainThread]: Partial parsing: updated file: build_fda://models/output/fsi_integ_summary.sql
[0m21:04:22.962660 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'cd4634e1-5f5e-4afc-bdf6-c133590e153b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137018d10>]}
[0m21:04:23.003049 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'cd4634e1-5f5e-4afc-bdf6-c133590e153b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1372f0250>]}
[0m21:04:23.003333 [info ] [MainThread]: Found 8 models, 6 sources, 459 macros
[0m21:04:23.003506 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cd4634e1-5f5e-4afc-bdf6-c133590e153b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1372a8b10>]}
[0m21:04:23.004417 [info ] [MainThread]: 
[0m21:04:23.004708 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m21:04:23.006716 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m21:04:23.012354 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m21:04:23.012516 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m21:04:23.012642 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:04:23.485637 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.473 seconds
[0m21:04:23.488518 [debug] [ThreadPool]: On list_dev: Close
[0m21:04:23.615561 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_analytics)
[0m21:04:23.625692 [debug] [ThreadPool]: Using snowflake connection "list_dev_analytics"
[0m21:04:23.626070 [debug] [ThreadPool]: On list_dev_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev_analytics"} */
show objects in dev.analytics limit 10000
[0m21:04:23.626354 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:04:24.108240 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.481 seconds
[0m21:04:24.113205 [debug] [ThreadPool]: On list_dev_analytics: Close
[0m21:04:24.231286 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cd4634e1-5f5e-4afc-bdf6-c133590e153b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1337e41d0>]}
[0m21:04:24.232294 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m21:04:24.232760 [info ] [MainThread]: 
[0m21:04:24.237116 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_apple_summary
[0m21:04:24.237739 [info ] [Thread-1 (]: 1 of 6 START sql table model analytics.fsi_apple_summary ....................... [RUN]
[0m21:04:24.238229 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_analytics, now model.build_fda.fsi_apple_summary)
[0m21:04:24.238602 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_apple_summary
[0m21:04:24.246801 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_apple_summary"
[0m21:04:24.247716 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_apple_summary
[0m21:04:24.267795 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_apple_summary"
[0m21:04:24.268875 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_apple_summary"
[0m21:04:24.269164 [debug] [Thread-1 (]: On model.build_fda.fsi_apple_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_apple_summary"} */
create or replace transient table dev.analytics.fsi_apple_summary
         as
        (WITH apple_interval_widths AS (
    SELECT
        ts,
        forecast,
        lower_bound,
        upper_bound,
        series,
        (upper_bound - lower_bound) AS interval_width
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
    WHERE series = 'AAPL'  -- Filter for Apple symbol
),

statistics AS (
    SELECT
        series,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM apple_interval_widths
    GROUP BY series
)

SELECT
    a.ts,
    a.series,
    a.forecast,
    a.lower_bound,
    a.upper_bound,
    a.interval_width,
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM apple_interval_widths a
JOIN statistics s
    ON a.series = s.series
ORDER BY a.ts
        );
[0m21:04:24.269424 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:04:25.720021 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.450 seconds
[0m21:04:25.745717 [debug] [Thread-1 (]: On model.build_fda.fsi_apple_summary: Close
[0m21:04:25.883015 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cd4634e1-5f5e-4afc-bdf6-c133590e153b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1338e2750>]}
[0m21:04:25.884382 [info ] [Thread-1 (]: 1 of 6 OK created sql table model analytics.fsi_apple_summary .................. [[32mSUCCESS 1[0m in 1.64s]
[0m21:04:25.885228 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_apple_summary
[0m21:04:25.885832 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_integ_summary
[0m21:04:25.886606 [info ] [Thread-1 (]: 2 of 6 START sql table model analytics.fsi_integ_summary ....................... [RUN]
[0m21:04:25.887242 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_apple_summary, now model.build_fda.fsi_integ_summary)
[0m21:04:25.887664 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_integ_summary
[0m21:04:25.891542 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_integ_summary"
[0m21:04:25.892837 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_integ_summary
[0m21:04:25.895964 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_integ_summary"
[0m21:04:25.897781 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_integ_summary"
[0m21:04:25.898269 [debug] [Thread-1 (]: On model.build_fda.fsi_integ_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_integ_summary"} */
create or replace transient table dev.analytics.fsi_integ_summary
         as
        (WITH interval_widths AS (
    SELECT
        ts,
        forecast,
        lower_bound,
        upper_bound,
        series,
        (upper_bound - lower_bound) AS interval_width
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
),

statistics AS (
    SELECT
        series,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM interval_widths
    GROUP BY series
)

SELECT
    a.ts,
    a.series,
    a.forecast,
    a.lower_bound,
    a.upper_bound,
    a.interval_width,
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM interval_widths a
JOIN statistics s
    ON a.series = s.series
ORDER BY a.ts
        );
[0m21:04:25.898627 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:04:27.419901 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.521 seconds
[0m21:04:27.424526 [debug] [Thread-1 (]: On model.build_fda.fsi_integ_summary: Close
[0m21:04:27.538453 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cd4634e1-5f5e-4afc-bdf6-c133590e153b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1373307d0>]}
[0m21:04:27.539549 [info ] [Thread-1 (]: 2 of 6 OK created sql table model analytics.fsi_integ_summary .................. [[32mSUCCESS 1[0m in 1.65s]
[0m21:04:27.540160 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_integ_summary
[0m21:04:27.540590 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_nvidia_summary
[0m21:04:27.541019 [info ] [Thread-1 (]: 3 of 6 START sql table model analytics.fsi_nvidia_summary ...................... [RUN]
[0m21:04:27.541371 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_integ_summary, now model.build_fda.fsi_nvidia_summary)
[0m21:04:27.541643 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_nvidia_summary
[0m21:04:27.546135 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_nvidia_summary"
[0m21:04:27.547057 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_nvidia_summary
[0m21:04:27.602303 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_nvidia_summary"
[0m21:04:27.603381 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_nvidia_summary"
[0m21:04:27.603595 [debug] [Thread-1 (]: On model.build_fda.fsi_nvidia_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_nvidia_summary"} */
create or replace transient table dev.analytics.fsi_nvidia_summary
         as
        (WITH nvidia_interval_widths AS (
    SELECT
        ts,
        forecast,
        lower_bound,
        upper_bound,
        series,
        (upper_bound - lower_bound) AS interval_width
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
    WHERE series = 'NVDA'  -- Filter for Nvidia symbol
),

statistics AS (
    SELECT
        series,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM nvidia_interval_widths
    GROUP BY series
)

SELECT
    n.ts,
    n.series,
    n.forecast,
    n.lower_bound,
    n.upper_bound,
    n.interval_width,
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM nvidia_interval_widths n
JOIN statistics s
    ON n.series = s.series
ORDER BY n.ts
        );
[0m21:04:27.603782 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:04:28.792231 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.188 seconds
[0m21:04:28.797982 [debug] [Thread-1 (]: On model.build_fda.fsi_nvidia_summary: Close
[0m21:04:28.907074 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cd4634e1-5f5e-4afc-bdf6-c133590e153b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1096ee6d0>]}
[0m21:04:28.909641 [info ] [Thread-1 (]: 3 of 6 OK created sql table model analytics.fsi_nvidia_summary ................. [[32mSUCCESS 1[0m in 1.37s]
[0m21:04:28.911005 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_nvidia_summary
[0m21:04:28.911467 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_stock_summary
[0m21:04:28.911964 [info ] [Thread-1 (]: 4 of 6 START sql table model analytics.fsi_stock_summary ....................... [RUN]
[0m21:04:28.912376 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_nvidia_summary, now model.build_fda.fsi_stock_summary)
[0m21:04:28.912624 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_stock_summary
[0m21:04:28.915562 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_stock_summary"
[0m21:04:28.916404 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_stock_summary
[0m21:04:28.918316 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_stock_summary"
[0m21:04:28.919384 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_stock_summary"
[0m21:04:28.919657 [debug] [Thread-1 (]: On model.build_fda.fsi_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_stock_summary"} */
create or replace transient table dev.analytics.fsi_stock_summary
         as
        (WITH apple_interval_widths AS (
    SELECT
        ts,
        forecast,
        lower_bound,
        upper_bound,
        series,
        (upper_bound - lower_bound) AS interval_width
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
    WHERE series = 'AAPL'  -- Filter for Apple symbol
),

statistics AS (
    SELECT
        series,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM apple_interval_widths
    GROUP BY series
)

SELECT
    a.ts,
    a.series,
    a.forecast,
    a.lower_bound,
    a.upper_bound,
    a.interval_width,
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM apple_interval_widths a
JOIN statistics s
    ON a.series = s.series
ORDER BY a.ts
        );
[0m21:04:28.919911 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:04:30.356493 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.436 seconds
[0m21:04:30.361944 [debug] [Thread-1 (]: On model.build_fda.fsi_stock_summary: Close
[0m21:04:30.483276 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cd4634e1-5f5e-4afc-bdf6-c133590e153b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1371086d0>]}
[0m21:04:30.484554 [info ] [Thread-1 (]: 4 of 6 OK created sql table model analytics.fsi_stock_summary .................. [[32mSUCCESS 1[0m in 1.57s]
[0m21:04:30.485401 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_stock_summary
[0m21:04:30.486002 [debug] [Thread-1 (]: Began running node model.build_fda.obv_apple_summary
[0m21:04:30.486757 [info ] [Thread-1 (]: 5 of 6 START sql table model analytics.obv_apple_summary ....................... [RUN]
[0m21:04:30.487474 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_stock_summary, now model.build_fda.obv_apple_summary)
[0m21:04:30.487952 [debug] [Thread-1 (]: Began compiling node model.build_fda.obv_apple_summary
[0m21:04:30.492121 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.obv_apple_summary"
[0m21:04:30.493207 [debug] [Thread-1 (]: Began executing node model.build_fda.obv_apple_summary
[0m21:04:30.496033 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.obv_apple_summary"
[0m21:04:30.497586 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.obv_apple_summary"
[0m21:04:30.497962 [debug] [Thread-1 (]: On model.build_fda.obv_apple_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.obv_apple_summary"} */
create or replace transient table dev.analytics.obv_apple_summary
         as
        (WITH ordered_data AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM dev.raw_data.stock_data -- Referencing the raw data table in the dev database
    WHERE symbol = 'AAPL'  -- Filter for Apple symbol
),

obv_calculation AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        CASE
            WHEN close > LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN volume
            WHEN close < LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN -volume
            ELSE 0
        END AS volume_change
    FROM ordered_data
),

cumulative_obv AS (
    SELECT
        date,
        symbol,
        SUM(volume_change) OVER (PARTITION BY symbol ORDER BY date) AS obv
    FROM obv_calculation
)

SELECT
    date,
    symbol,
    obv
FROM cumulative_obv
ORDER BY date
        );
[0m21:04:30.498309 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:04:32.170474 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.671 seconds
[0m21:04:32.175227 [debug] [Thread-1 (]: On model.build_fda.obv_apple_summary: Close
[0m21:04:32.305337 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cd4634e1-5f5e-4afc-bdf6-c133590e153b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137108290>]}
[0m21:04:32.306467 [info ] [Thread-1 (]: 5 of 6 OK created sql table model analytics.obv_apple_summary .................. [[32mSUCCESS 1[0m in 1.82s]
[0m21:04:32.307307 [debug] [Thread-1 (]: Finished running node model.build_fda.obv_apple_summary
[0m21:04:32.307914 [debug] [Thread-1 (]: Began running node model.build_fda.obv_nvidia_summary
[0m21:04:32.308482 [info ] [Thread-1 (]: 6 of 6 START sql table model analytics.obv_nvidia_summary ...................... [RUN]
[0m21:04:32.309049 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.obv_apple_summary, now model.build_fda.obv_nvidia_summary)
[0m21:04:32.309495 [debug] [Thread-1 (]: Began compiling node model.build_fda.obv_nvidia_summary
[0m21:04:32.313691 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.obv_nvidia_summary"
[0m21:04:32.314809 [debug] [Thread-1 (]: Began executing node model.build_fda.obv_nvidia_summary
[0m21:04:32.317568 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.obv_nvidia_summary"
[0m21:04:32.319118 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.obv_nvidia_summary"
[0m21:04:32.319509 [debug] [Thread-1 (]: On model.build_fda.obv_nvidia_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.obv_nvidia_summary"} */
create or replace transient table dev.analytics.obv_nvidia_summary
         as
        (WITH ordered_data AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM dev.raw_data.stock_data -- Referencing the raw data table in the dev database
    WHERE symbol = 'NVDA'  -- Filter for Nvidia symbol
),

obv_calculation AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        CASE
            WHEN close > LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN volume
            WHEN close < LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN -volume
            ELSE 0
        END AS volume_change
    FROM ordered_data
),

cumulative_obv AS (
    SELECT
        date,
        symbol,
        SUM(volume_change) OVER (PARTITION BY symbol ORDER BY date) AS obv
    FROM obv_calculation
)

SELECT
    date,
    symbol,
    obv
FROM cumulative_obv
ORDER BY date
        );
[0m21:04:32.319862 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:04:33.840344 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.520 seconds
[0m21:04:33.844845 [debug] [Thread-1 (]: On model.build_fda.obv_nvidia_summary: Close
[0m21:04:33.972467 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cd4634e1-5f5e-4afc-bdf6-c133590e153b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1371086d0>]}
[0m21:04:33.973757 [info ] [Thread-1 (]: 6 of 6 OK created sql table model analytics.obv_nvidia_summary ................. [[32mSUCCESS 1[0m in 1.66s]
[0m21:04:33.974612 [debug] [Thread-1 (]: Finished running node model.build_fda.obv_nvidia_summary
[0m21:04:33.975217 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data
[0m21:04:33.975907 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.obv_nvidia_summary, now model.build_fda.stock_data)
[0m21:04:33.976491 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data
[0m21:04:33.982761 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data"
[0m21:04:33.984041 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data
[0m21:04:33.984477 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data_forecast
[0m21:04:33.984884 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.stock_data, now model.build_fda.stock_data_forecast)
[0m21:04:33.985169 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data_forecast
[0m21:04:33.987441 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data_forecast"
[0m21:04:33.988196 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data_forecast
[0m21:04:33.989488 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:04:33.989764 [debug] [MainThread]: Connection 'model.build_fda.stock_data_forecast' was properly closed.
[0m21:04:33.990109 [info ] [MainThread]: 
[0m21:04:33.990393 [info ] [MainThread]: Finished running 6 table models in 0 hours 0 minutes and 10.99 seconds (10.99s).
[0m21:04:33.991348 [debug] [MainThread]: Command end result
[0m21:04:34.012781 [info ] [MainThread]: 
[0m21:04:34.013155 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:04:34.013352 [info ] [MainThread]: 
[0m21:04:34.013559 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=0 SKIP=0 TOTAL=6
[0m21:04:34.015745 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 12.018849, "process_user_time": 2.342648, "process_kernel_time": 1.626595, "process_mem_max_rss": "203374592", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m21:04:34.016050 [debug] [MainThread]: Command `dbt run` succeeded at 21:04:34.016003 after 12.02 seconds
[0m21:04:34.016262 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104ed4150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104fad410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f1f450>]}
[0m21:04:34.016452 [debug] [MainThread]: Flushing usage events
[0m21:07:11.822089 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10780a690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107851f90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10785fc10>]}


============================== 21:07:11.823917 | 8b1c1d7e-ba7d-47ef-bde7-e75de772ca2c ==============================
[0m21:07:11.823917 [info ] [MainThread]: Running with dbt=1.8.7
[0m21:07:11.824259 [debug] [MainThread]: running dbt with arguments {'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'write_json': 'True', 'printer_width': '80', 'use_colors': 'True', 'log_path': '/Users/shatayu/Downloads/DATA226_Lab2Prep/build_fda/logs', 'debug': 'False', 'empty': 'False', 'indirect_selection': 'eager', 'warn_error': 'None', 'static_parser': 'True', 'quiet': 'False', 'profiles_dir': '/Users/shatayu/.dbt', 'fail_fast': 'False', 'cache_selected_only': 'False', 'log_cache_events': 'False', 'log_format': 'default', 'send_anonymous_usage_stats': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'use_experimental_parser': 'False', 'version_check': 'True', 'partial_parse': 'True', 'no_print': 'None'}
[0m21:07:12.533538 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8b1c1d7e-ba7d-47ef-bde7-e75de772ca2c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11fd60150>]}
[0m21:07:12.554174 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8b1c1d7e-ba7d-47ef-bde7-e75de772ca2c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1072c9690>]}
[0m21:07:12.555734 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m21:07:12.568347 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m21:07:12.639393 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m21:07:12.639680 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m21:07:12.653795 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8b1c1d7e-ba7d-47ef-bde7-e75de772ca2c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13ba805d0>]}
[0m21:07:12.696665 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8b1c1d7e-ba7d-47ef-bde7-e75de772ca2c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13bb8a790>]}
[0m21:07:12.696983 [info ] [MainThread]: Found 8 models, 6 sources, 459 macros
[0m21:07:12.697158 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8b1c1d7e-ba7d-47ef-bde7-e75de772ca2c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13bbcfed0>]}
[0m21:07:12.698139 [info ] [MainThread]: 
[0m21:07:12.698443 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m21:07:12.700485 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m21:07:12.706849 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m21:07:12.707014 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m21:07:12.707140 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:07:13.262714 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.555 seconds
[0m21:07:13.275726 [debug] [ThreadPool]: On list_dev: Close
[0m21:07:13.431435 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_analytics)
[0m21:07:13.445662 [debug] [ThreadPool]: Using snowflake connection "list_dev_analytics"
[0m21:07:13.445966 [debug] [ThreadPool]: On list_dev_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev_analytics"} */
show objects in dev.analytics limit 10000
[0m21:07:13.446114 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:07:13.984472 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.538 seconds
[0m21:07:13.987763 [debug] [ThreadPool]: On list_dev_analytics: Close
[0m21:07:14.139519 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8b1c1d7e-ba7d-47ef-bde7-e75de772ca2c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13ba34a10>]}
[0m21:07:14.140842 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m21:07:14.141354 [info ] [MainThread]: 
[0m21:07:14.146134 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_apple_summary
[0m21:07:14.146870 [info ] [Thread-1 (]: 1 of 6 START sql table model analytics.fsi_apple_summary ....................... [RUN]
[0m21:07:14.147435 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_analytics, now model.build_fda.fsi_apple_summary)
[0m21:07:14.147940 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_apple_summary
[0m21:07:14.156531 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_apple_summary"
[0m21:07:14.157773 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_apple_summary
[0m21:07:14.177834 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_apple_summary"
[0m21:07:14.179068 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_apple_summary"
[0m21:07:14.179344 [debug] [Thread-1 (]: On model.build_fda.fsi_apple_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_apple_summary"} */
create or replace transient table dev.analytics.fsi_apple_summary
         as
        (WITH apple_interval_widths AS (
    SELECT
        ts,
        forecast,
        lower_bound,
        upper_bound,
        series,
        (upper_bound - lower_bound) AS interval_width
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
    WHERE series = 'AAPL'  -- Filter for Apple symbol
),

statistics AS (
    SELECT
        series,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM apple_interval_widths
    GROUP BY series
)

SELECT
    a.ts,
    a.series,
    a.forecast,
    a.lower_bound,
    a.upper_bound,
    a.interval_width,
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM apple_interval_widths a
JOIN statistics s
    ON a.series = s.series
ORDER BY a.ts
        );
[0m21:07:14.179575 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:07:15.390695 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.211 seconds
[0m21:07:15.406860 [debug] [Thread-1 (]: On model.build_fda.fsi_apple_summary: Close
[0m21:07:15.527788 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8b1c1d7e-ba7d-47ef-bde7-e75de772ca2c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13bbcf350>]}
[0m21:07:15.529092 [info ] [Thread-1 (]: 1 of 6 OK created sql table model analytics.fsi_apple_summary .................. [[32mSUCCESS 1[0m in 1.38s]
[0m21:07:15.529834 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_apple_summary
[0m21:07:15.530348 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_integ_summary
[0m21:07:15.530969 [info ] [Thread-1 (]: 2 of 6 START sql table model analytics.fsi_integ_summary ....................... [RUN]
[0m21:07:15.531555 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_apple_summary, now model.build_fda.fsi_integ_summary)
[0m21:07:15.531966 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_integ_summary
[0m21:07:15.535679 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_integ_summary"
[0m21:07:15.536828 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_integ_summary
[0m21:07:15.539725 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_integ_summary"
[0m21:07:15.541237 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_integ_summary"
[0m21:07:15.541623 [debug] [Thread-1 (]: On model.build_fda.fsi_integ_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_integ_summary"} */
create or replace transient table dev.analytics.fsi_integ_summary
         as
        (WITH interval_widths AS (
    SELECT
        ts,
        forecast,
        lower_bound,
        upper_bound,
        series,
        (upper_bound - lower_bound) AS interval_width
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
),

statistics AS (
    SELECT
        series,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM interval_widths
    GROUP BY series
)

SELECT
    a.ts,
    a.series,
    a.forecast,
    a.lower_bound,
    a.upper_bound,
    a.interval_width,
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM interval_widths a
JOIN statistics s
    ON a.series = s.series
ORDER BY a.ts
        );
[0m21:07:15.541979 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:07:16.648272 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.106 seconds
[0m21:07:16.653077 [debug] [Thread-1 (]: On model.build_fda.fsi_integ_summary: Close
[0m21:07:16.791729 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8b1c1d7e-ba7d-47ef-bde7-e75de772ca2c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13be7c690>]}
[0m21:07:16.794378 [info ] [Thread-1 (]: 2 of 6 OK created sql table model analytics.fsi_integ_summary .................. [[32mSUCCESS 1[0m in 1.26s]
[0m21:07:16.795253 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_integ_summary
[0m21:07:16.795764 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_nvidia_summary
[0m21:07:16.796306 [info ] [Thread-1 (]: 3 of 6 START sql table model analytics.fsi_nvidia_summary ...................... [RUN]
[0m21:07:16.796798 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_integ_summary, now model.build_fda.fsi_nvidia_summary)
[0m21:07:16.797119 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_nvidia_summary
[0m21:07:16.800235 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_nvidia_summary"
[0m21:07:16.801038 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_nvidia_summary
[0m21:07:16.803095 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_nvidia_summary"
[0m21:07:16.804297 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_nvidia_summary"
[0m21:07:16.804597 [debug] [Thread-1 (]: On model.build_fda.fsi_nvidia_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_nvidia_summary"} */
create or replace transient table dev.analytics.fsi_nvidia_summary
         as
        (WITH nvidia_interval_widths AS (
    SELECT
        ts,
        forecast,
        lower_bound,
        upper_bound,
        series,
        (upper_bound - lower_bound) AS interval_width
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
    WHERE series = 'NVDA'  -- Filter for Nvidia symbol
),

statistics AS (
    SELECT
        series,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM nvidia_interval_widths
    GROUP BY series
)

SELECT
    n.ts,
    n.series,
    n.forecast,
    n.lower_bound,
    n.upper_bound,
    n.interval_width,
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM nvidia_interval_widths n
JOIN statistics s
    ON n.series = s.series
ORDER BY n.ts
        );
[0m21:07:16.804881 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:07:18.387356 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.582 seconds
[0m21:07:18.392829 [debug] [Thread-1 (]: On model.build_fda.fsi_nvidia_summary: Close
[0m21:07:18.506948 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8b1c1d7e-ba7d-47ef-bde7-e75de772ca2c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13be850d0>]}
[0m21:07:18.507964 [info ] [Thread-1 (]: 3 of 6 OK created sql table model analytics.fsi_nvidia_summary ................. [[32mSUCCESS 1[0m in 1.71s]
[0m21:07:18.508542 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_nvidia_summary
[0m21:07:18.508951 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_stock_summary
[0m21:07:18.509431 [info ] [Thread-1 (]: 4 of 6 START sql table model analytics.fsi_stock_summary ....................... [RUN]
[0m21:07:18.509890 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_nvidia_summary, now model.build_fda.fsi_stock_summary)
[0m21:07:18.510210 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_stock_summary
[0m21:07:18.514472 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_stock_summary"
[0m21:07:18.515467 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_stock_summary
[0m21:07:18.517745 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_stock_summary"
[0m21:07:18.519095 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_stock_summary"
[0m21:07:18.519431 [debug] [Thread-1 (]: On model.build_fda.fsi_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_stock_summary"} */
create or replace transient table dev.analytics.fsi_stock_summary
         as
        (WITH apple_interval_widths AS (
    SELECT
        ts,
        forecast,
        lower_bound,
        upper_bound,
        series,
        (upper_bound - lower_bound) AS interval_width
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
    WHERE series = 'AAPL'  -- Filter for Apple symbol
),

statistics AS (
    SELECT
        series,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM apple_interval_widths
    GROUP BY series
)

SELECT
    a.ts,
    a.series,
    a.forecast,
    a.lower_bound,
    a.upper_bound,
    a.interval_width,
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM apple_interval_widths a
JOIN statistics s
    ON a.series = s.series
ORDER BY a.ts
        );
[0m21:07:18.519744 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:07:20.001829 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.481 seconds
[0m21:07:20.007855 [debug] [Thread-1 (]: On model.build_fda.fsi_stock_summary: Close
[0m21:07:20.127680 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8b1c1d7e-ba7d-47ef-bde7-e75de772ca2c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13ba44050>]}
[0m21:07:20.130233 [info ] [Thread-1 (]: 4 of 6 OK created sql table model analytics.fsi_stock_summary .................. [[32mSUCCESS 1[0m in 1.62s]
[0m21:07:20.131538 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_stock_summary
[0m21:07:20.132109 [debug] [Thread-1 (]: Began running node model.build_fda.obv_apple_summary
[0m21:07:20.132783 [info ] [Thread-1 (]: 5 of 6 START sql table model analytics.obv_apple_summary ....................... [RUN]
[0m21:07:20.133337 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_stock_summary, now model.build_fda.obv_apple_summary)
[0m21:07:20.133698 [debug] [Thread-1 (]: Began compiling node model.build_fda.obv_apple_summary
[0m21:07:20.137265 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.obv_apple_summary"
[0m21:07:20.138235 [debug] [Thread-1 (]: Began executing node model.build_fda.obv_apple_summary
[0m21:07:20.142303 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.obv_apple_summary"
[0m21:07:20.143695 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.obv_apple_summary"
[0m21:07:20.144035 [debug] [Thread-1 (]: On model.build_fda.obv_apple_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.obv_apple_summary"} */
create or replace transient table dev.analytics.obv_apple_summary
         as
        (WITH ordered_data AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM dev.raw_data.stock_data -- Referencing the raw data table in the dev database
    WHERE symbol = 'AAPL'  -- Filter for Apple symbol
),

obv_calculation AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        CASE
            WHEN close > LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN volume
            WHEN close < LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN -volume
            ELSE 0
        END AS volume_change
    FROM ordered_data
),

cumulative_obv AS (
    SELECT
        date,
        symbol,
        SUM(volume_change) OVER (PARTITION BY symbol ORDER BY date) AS obv
    FROM obv_calculation
)

SELECT
    date,
    symbol,
    obv
FROM cumulative_obv
ORDER BY date
        );
[0m21:07:20.144350 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:07:21.335387 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.190 seconds
[0m21:07:21.341887 [debug] [Thread-1 (]: On model.build_fda.obv_apple_summary: Close
[0m21:07:21.462227 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8b1c1d7e-ba7d-47ef-bde7-e75de772ca2c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13d234ed0>]}
[0m21:07:21.465250 [info ] [Thread-1 (]: 5 of 6 OK created sql table model analytics.obv_apple_summary .................. [[32mSUCCESS 1[0m in 1.33s]
[0m21:07:21.466825 [debug] [Thread-1 (]: Finished running node model.build_fda.obv_apple_summary
[0m21:07:21.467950 [debug] [Thread-1 (]: Began running node model.build_fda.obv_nvidia_summary
[0m21:07:21.469025 [info ] [Thread-1 (]: 6 of 6 START sql table model analytics.obv_nvidia_summary ...................... [RUN]
[0m21:07:21.470159 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.obv_apple_summary, now model.build_fda.obv_nvidia_summary)
[0m21:07:21.471180 [debug] [Thread-1 (]: Began compiling node model.build_fda.obv_nvidia_summary
[0m21:07:21.478933 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.obv_nvidia_summary"
[0m21:07:21.479987 [debug] [Thread-1 (]: Began executing node model.build_fda.obv_nvidia_summary
[0m21:07:21.481969 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.obv_nvidia_summary"
[0m21:07:21.483970 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.obv_nvidia_summary"
[0m21:07:21.484310 [debug] [Thread-1 (]: On model.build_fda.obv_nvidia_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.obv_nvidia_summary"} */
create or replace transient table dev.analytics.obv_nvidia_summary
         as
        (WITH ordered_data AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM dev.raw_data.stock_data -- Referencing the raw data table in the dev database
    WHERE symbol = 'NVDA'  -- Filter for Nvidia symbol
),

obv_calculation AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        CASE
            WHEN close > LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN volume
            WHEN close < LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN -volume
            ELSE 0
        END AS volume_change
    FROM ordered_data
),

cumulative_obv AS (
    SELECT
        date,
        symbol,
        SUM(volume_change) OVER (PARTITION BY symbol ORDER BY date) AS obv
    FROM obv_calculation
)

SELECT
    date,
    symbol,
    obv
FROM cumulative_obv
ORDER BY date
        );
[0m21:07:21.484595 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:07:22.972745 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.488 seconds
[0m21:07:22.977915 [debug] [Thread-1 (]: On model.build_fda.obv_nvidia_summary: Close
[0m21:07:23.121195 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8b1c1d7e-ba7d-47ef-bde7-e75de772ca2c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13d239750>]}
[0m21:07:23.123940 [info ] [Thread-1 (]: 6 of 6 OK created sql table model analytics.obv_nvidia_summary ................. [[32mSUCCESS 1[0m in 1.65s]
[0m21:07:23.125514 [debug] [Thread-1 (]: Finished running node model.build_fda.obv_nvidia_summary
[0m21:07:23.126513 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data
[0m21:07:23.127583 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.obv_nvidia_summary, now model.build_fda.stock_data)
[0m21:07:23.128307 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data
[0m21:07:23.135307 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data"
[0m21:07:23.136718 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data
[0m21:07:23.137106 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data_forecast
[0m21:07:23.137550 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.stock_data, now model.build_fda.stock_data_forecast)
[0m21:07:23.137903 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data_forecast
[0m21:07:23.140454 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data_forecast"
[0m21:07:23.141301 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data_forecast
[0m21:07:23.142563 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:07:23.142827 [debug] [MainThread]: Connection 'model.build_fda.stock_data_forecast' was properly closed.
[0m21:07:23.143158 [info ] [MainThread]: 
[0m21:07:23.143441 [info ] [MainThread]: Finished running 6 table models in 0 hours 0 minutes and 10.44 seconds (10.44s).
[0m21:07:23.144385 [debug] [MainThread]: Command end result
[0m21:07:23.236509 [info ] [MainThread]: 
[0m21:07:23.236819 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:07:23.236979 [info ] [MainThread]: 
[0m21:07:23.237144 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=0 SKIP=0 TOTAL=6
[0m21:07:23.239419 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 11.466455, "process_user_time": 2.535367, "process_kernel_time": 1.303005, "process_mem_max_rss": "202555392", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m21:07:23.239842 [debug] [MainThread]: Command `dbt run` succeeded at 21:07:23.239788 after 11.47 seconds
[0m21:07:23.240074 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103448150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103493450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1034934d0>]}
[0m21:07:23.240284 [debug] [MainThread]: Flushing usage events
[0m22:30:33.499355 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a04a850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a09ff10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a0c0b90>]}


============================== 22:30:33.501502 | 15c94244-5e6f-48a9-929e-2f0672926257 ==============================
[0m22:30:33.501502 [info ] [MainThread]: Running with dbt=1.8.7
[0m22:30:33.501836 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'cache_selected_only': 'False', 'fail_fast': 'False', 'no_print': 'None', 'log_format': 'default', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'indirect_selection': 'eager', 'printer_width': '80', 'use_colors': 'True', 'invocation_command': 'dbt run', 'static_parser': 'True', 'use_experimental_parser': 'False', 'debug': 'False', 'log_path': '/Users/shatayu/Downloads/DATA226_Lab2Prep/build_fda/logs', 'write_json': 'True', 'target_path': 'None', 'empty': 'False', 'profiles_dir': '/Users/shatayu/.dbt', 'introspect': 'True', 'log_cache_events': 'False', 'warn_error': 'None', 'send_anonymous_usage_stats': 'True', 'partial_parse': 'True', 'version_check': 'True'}
[0m22:30:34.502290 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '15c94244-5e6f-48a9-929e-2f0672926257', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14dfa0450>]}
[0m22:30:34.523652 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '15c94244-5e6f-48a9-929e-2f0672926257', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1199453d0>]}
[0m22:30:34.524521 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m22:30:34.538271 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m22:30:34.616664 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m22:30:34.617052 [debug] [MainThread]: Partial parsing: added file: build_fda://models/output/dmi_apple.sql
[0m22:30:34.688551 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.build_fda.dmi_apple' (models/output/dmi_apple.sql) depends on a node named 'stock_data' in package or project 'raw_data' which was not found
[0m22:30:34.690757 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.241316, "process_user_time": 1.800236, "process_kernel_time": 1.426152, "process_mem_max_rss": "195936256", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m22:30:34.691080 [debug] [MainThread]: Command `dbt run` failed at 22:30:34.691029 after 1.24 seconds
[0m22:30:34.691297 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a052c90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102f8c150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14e042950>]}
[0m22:30:34.691478 [debug] [MainThread]: Flushing usage events
[0m22:31:26.884537 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10827bed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1082dbf10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1082fcdd0>]}


============================== 22:31:26.886342 | f85c0561-5fec-493c-80f6-7b7aa32ea93e ==============================
[0m22:31:26.886342 [info ] [MainThread]: Running with dbt=1.8.7
[0m22:31:26.886673 [debug] [MainThread]: running dbt with arguments {'log_cache_events': 'False', 'profiles_dir': '/Users/shatayu/.dbt', 'log_path': '/Users/shatayu/Downloads/DATA226_Lab2Prep/build_fda/logs', 'version_check': 'True', 'no_print': 'None', 'use_colors': 'True', 'send_anonymous_usage_stats': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'empty': 'False', 'partial_parse': 'True', 'use_experimental_parser': 'False', 'printer_width': '80', 'indirect_selection': 'eager', 'fail_fast': 'False', 'static_parser': 'True', 'write_json': 'True', 'cache_selected_only': 'False', 'debug': 'False', 'introspect': 'True', 'log_format': 'default', 'invocation_command': 'dbt run', 'quiet': 'False', 'warn_error': 'None'}
[0m22:31:27.644062 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f85c0561-5fec-493c-80f6-7b7aa32ea93e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1082939d0>]}
[0m22:31:27.666503 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f85c0561-5fec-493c-80f6-7b7aa32ea93e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107c45490>]}
[0m22:31:27.667348 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m22:31:27.680935 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m22:31:27.754584 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m22:31:27.754971 [debug] [MainThread]: Partial parsing: added file: build_fda://models/output/dmi_apple.sql
[0m22:31:27.857361 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f85c0561-5fec-493c-80f6-7b7aa32ea93e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13bbfbc90>]}
[0m22:31:27.899530 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f85c0561-5fec-493c-80f6-7b7aa32ea93e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13dbff850>]}
[0m22:31:27.899803 [info ] [MainThread]: Found 9 models, 6 sources, 459 macros
[0m22:31:27.899970 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f85c0561-5fec-493c-80f6-7b7aa32ea93e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13d90b810>]}
[0m22:31:27.900881 [info ] [MainThread]: 
[0m22:31:27.901170 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m22:31:27.903196 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m22:31:27.908767 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m22:31:27.908926 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m22:31:27.909053 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:31:28.461677 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.552 seconds
[0m22:31:28.467109 [debug] [ThreadPool]: On list_dev: Close
[0m22:31:28.585631 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_analytics)
[0m22:31:28.595052 [debug] [ThreadPool]: Using snowflake connection "list_dev_analytics"
[0m22:31:28.595385 [debug] [ThreadPool]: On list_dev_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev_analytics"} */
show objects in dev.analytics limit 10000
[0m22:31:28.595624 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:31:29.167027 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.571 seconds
[0m22:31:29.173892 [debug] [ThreadPool]: On list_dev_analytics: Close
[0m22:31:29.322475 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f85c0561-5fec-493c-80f6-7b7aa32ea93e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13bba6fd0>]}
[0m22:31:29.323101 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m22:31:29.323490 [info ] [MainThread]: 
[0m22:31:29.325796 [debug] [Thread-1 (]: Began running node model.build_fda.dmi_apple
[0m22:31:29.326237 [info ] [Thread-1 (]: 1 of 7 START sql table model analytics.dmi_apple ............................... [RUN]
[0m22:31:29.326568 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_analytics, now model.build_fda.dmi_apple)
[0m22:31:29.326784 [debug] [Thread-1 (]: Began compiling node model.build_fda.dmi_apple
[0m22:31:29.332112 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.dmi_apple"
[0m22:31:29.333025 [debug] [Thread-1 (]: Began executing node model.build_fda.dmi_apple
[0m22:31:29.354834 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.dmi_apple"
[0m22:31:29.356535 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.dmi_apple"
[0m22:31:29.356894 [debug] [Thread-1 (]: On model.build_fda.dmi_apple: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.dmi_apple"} */
create or replace transient table dev.analytics.dmi_apple
         as
        (WITH apple_prices AS (
    SELECT
        ts,
        close,
        series
    FROM dev.raw_data.stock_data
    WHERE series = 'AAPL'
),

-- Calculate the 20-day SMA and 20-day standard deviation
sma_stddev AS (
    SELECT
        ts,
        close,
        AVG(close) OVER (ORDER BY ts ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS middle_band,
        STDDEV(close) OVER (ORDER BY ts ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS 20_day_stddev
    FROM apple_prices
),

-- Calculate the upper and lower bands
bands AS (
    SELECT
        ts,
        close,
        middle_band,
        (middle_band + (2 * 20_day_stddev)) AS upper_band,
        (middle_band - (2 * 20_day_stddev)) AS lower_band
    FROM sma_stddev
),

-- Calculate +DI and -DI based on daily price movements
directional_indicators AS (
    SELECT
        ts,
        close,
        middle_band,
        upper_band,
        lower_band,
        LAG(close, 1) OVER (ORDER BY ts) AS prev_close,
        -- +DI: Calculate positive movement
        CASE WHEN close > prev_close THEN close - prev_close ELSE 0 END AS plus_di,
        -- -DI: Calculate negative movement
        CASE WHEN close < prev_close THEN prev_close - close ELSE 0 END AS minus_di
    FROM bands
)

SELECT
    ts,
    close,
    middle_band,
    upper_band,
    lower_band,
    -- Summing up DI over the 20-day period for smoother trend analysis
    SUM(plus_di) OVER (ORDER BY ts ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS plus_di_20,
    SUM(minus_di) OVER (ORDER BY ts ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS minus_di_20
FROM directional_indicators
ORDER BY ts
        );
[0m22:31:29.357209 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:31:29.810030 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b850e7-0004-26b4-0000-000255f33bc1
[0m22:31:29.810855 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 18 at position 86 unexpected '20'.
syntax error line 28 at position 30 unexpected '_day_stddev'.
syntax error line 29 at position 30 unexpected '_day_stddev'.
[0m22:31:29.811452 [debug] [Thread-1 (]: On model.build_fda.dmi_apple: Close
[0m22:31:29.929831 [debug] [Thread-1 (]: Database Error in model dmi_apple (models/output/dmi_apple.sql)
  001003 (42000): SQL compilation error:
  syntax error line 18 at position 86 unexpected '20'.
  syntax error line 28 at position 30 unexpected '_day_stddev'.
  syntax error line 29 at position 30 unexpected '_day_stddev'.
  compiled code at target/run/build_fda/models/output/dmi_apple.sql
[0m22:31:29.932241 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f85c0561-5fec-493c-80f6-7b7aa32ea93e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13de81e10>]}
[0m22:31:29.933184 [error] [Thread-1 (]: 1 of 7 ERROR creating sql table model analytics.dmi_apple ...................... [[31mERROR[0m in 0.60s]
[0m22:31:29.933916 [debug] [Thread-1 (]: Finished running node model.build_fda.dmi_apple
[0m22:31:29.934393 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_apple_summary
[0m22:31:29.935208 [info ] [Thread-1 (]: 2 of 7 START sql table model analytics.fsi_apple_summary ....................... [RUN]
[0m22:31:29.935840 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.dmi_apple, now model.build_fda.fsi_apple_summary)
[0m22:31:29.936201 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_apple_summary
[0m22:31:29.939438 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_apple_summary"
[0m22:31:29.940683 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_apple_summary
[0m22:31:29.943649 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_apple_summary"
[0m22:31:29.945119 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_apple_summary"
[0m22:31:29.945465 [debug] [Thread-1 (]: On model.build_fda.fsi_apple_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_apple_summary"} */
create or replace transient table dev.analytics.fsi_apple_summary
         as
        (WITH apple_interval_widths AS (
    SELECT
        ts,
        forecast,
        lower_bound,
        upper_bound,
        series,
        (upper_bound - lower_bound) AS interval_width
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
    WHERE series = 'AAPL'  -- Filter for Apple symbol
),

statistics AS (
    SELECT
        series,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM apple_interval_widths
    GROUP BY series
)

SELECT
    a.ts,
    a.series,
    a.forecast,
    a.lower_bound,
    a.upper_bound,
    a.interval_width,
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM apple_interval_widths a
JOIN statistics s
    ON a.series = s.series
ORDER BY a.ts
        );
[0m22:31:29.945764 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:31:31.446016 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.500 seconds
[0m22:31:31.471296 [debug] [Thread-1 (]: On model.build_fda.fsi_apple_summary: Close
[0m22:31:31.593551 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f85c0561-5fec-493c-80f6-7b7aa32ea93e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13dc36bd0>]}
[0m22:31:31.595305 [info ] [Thread-1 (]: 2 of 7 OK created sql table model analytics.fsi_apple_summary .................. [[32mSUCCESS 1[0m in 1.66s]
[0m22:31:31.596420 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_apple_summary
[0m22:31:31.597133 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_integ_summary
[0m22:31:31.597921 [info ] [Thread-1 (]: 3 of 7 START sql table model analytics.fsi_integ_summary ....................... [RUN]
[0m22:31:31.598548 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_apple_summary, now model.build_fda.fsi_integ_summary)
[0m22:31:31.598951 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_integ_summary
[0m22:31:31.602447 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_integ_summary"
[0m22:31:31.603495 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_integ_summary
[0m22:31:31.608358 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_integ_summary"
[0m22:31:31.609936 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_integ_summary"
[0m22:31:31.610322 [debug] [Thread-1 (]: On model.build_fda.fsi_integ_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_integ_summary"} */
create or replace transient table dev.analytics.fsi_integ_summary
         as
        (WITH interval_widths AS (
    SELECT
        ts,
        forecast,
        lower_bound,
        upper_bound,
        series,
        (upper_bound - lower_bound) AS interval_width
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
),

statistics AS (
    SELECT
        series,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM interval_widths
    GROUP BY series
)

SELECT
    a.ts,
    a.series,
    a.forecast,
    a.lower_bound,
    a.upper_bound,
    a.interval_width,
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM interval_widths a
JOIN statistics s
    ON a.series = s.series
ORDER BY a.ts
        );
[0m22:31:31.674072 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:31:33.135863 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.525 seconds
[0m22:31:33.140491 [debug] [Thread-1 (]: On model.build_fda.fsi_integ_summary: Close
[0m22:31:33.273078 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f85c0561-5fec-493c-80f6-7b7aa32ea93e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102eb23d0>]}
[0m22:31:33.274859 [info ] [Thread-1 (]: 3 of 7 OK created sql table model analytics.fsi_integ_summary .................. [[32mSUCCESS 1[0m in 1.67s]
[0m22:31:33.275933 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_integ_summary
[0m22:31:33.276593 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_nvidia_summary
[0m22:31:33.277302 [info ] [Thread-1 (]: 4 of 7 START sql table model analytics.fsi_nvidia_summary ...................... [RUN]
[0m22:31:33.277875 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_integ_summary, now model.build_fda.fsi_nvidia_summary)
[0m22:31:33.278274 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_nvidia_summary
[0m22:31:33.282150 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_nvidia_summary"
[0m22:31:33.284178 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_nvidia_summary
[0m22:31:33.286810 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_nvidia_summary"
[0m22:31:33.288175 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_nvidia_summary"
[0m22:31:33.288521 [debug] [Thread-1 (]: On model.build_fda.fsi_nvidia_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_nvidia_summary"} */
create or replace transient table dev.analytics.fsi_nvidia_summary
         as
        (WITH nvidia_interval_widths AS (
    SELECT
        ts,
        forecast,
        lower_bound,
        upper_bound,
        series,
        (upper_bound - lower_bound) AS interval_width
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
    WHERE series = 'NVDA'  -- Filter for Nvidia symbol
),

statistics AS (
    SELECT
        series,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM nvidia_interval_widths
    GROUP BY series
)

SELECT
    n.ts,
    n.series,
    n.forecast,
    n.lower_bound,
    n.upper_bound,
    n.interval_width,
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM nvidia_interval_widths n
JOIN statistics s
    ON n.series = s.series
ORDER BY n.ts
        );
[0m22:31:33.288832 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:31:34.670901 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.381 seconds
[0m22:31:34.677162 [debug] [Thread-1 (]: On model.build_fda.fsi_nvidia_summary: Close
[0m22:31:34.792497 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f85c0561-5fec-493c-80f6-7b7aa32ea93e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107b02650>]}
[0m22:31:34.793270 [info ] [Thread-1 (]: 4 of 7 OK created sql table model analytics.fsi_nvidia_summary ................. [[32mSUCCESS 1[0m in 1.51s]
[0m22:31:34.793867 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_nvidia_summary
[0m22:31:34.794276 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_stock_summary
[0m22:31:34.794780 [info ] [Thread-1 (]: 5 of 7 START sql table model analytics.fsi_stock_summary ....................... [RUN]
[0m22:31:34.795270 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_nvidia_summary, now model.build_fda.fsi_stock_summary)
[0m22:31:34.795606 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_stock_summary
[0m22:31:34.798988 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_stock_summary"
[0m22:31:34.799893 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_stock_summary
[0m22:31:34.802159 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_stock_summary"
[0m22:31:34.803457 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_stock_summary"
[0m22:31:34.803790 [debug] [Thread-1 (]: On model.build_fda.fsi_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_stock_summary"} */
create or replace transient table dev.analytics.fsi_stock_summary
         as
        (WITH apple_interval_widths AS (
    SELECT
        ts,
        forecast,
        lower_bound,
        upper_bound,
        series,
        (upper_bound - lower_bound) AS interval_width
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
    WHERE series = 'AAPL'  -- Filter for Apple symbol
),

statistics AS (
    SELECT
        series,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM apple_interval_widths
    GROUP BY series
)

SELECT
    a.ts,
    a.series,
    a.forecast,
    a.lower_bound,
    a.upper_bound,
    a.interval_width,
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM apple_interval_widths a
JOIN statistics s
    ON a.series = s.series
ORDER BY a.ts
        );
[0m22:31:34.804107 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:31:35.748199 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.943 seconds
[0m22:31:35.755457 [debug] [Thread-1 (]: On model.build_fda.fsi_stock_summary: Close
[0m22:31:35.892467 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f85c0561-5fec-493c-80f6-7b7aa32ea93e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13bbf92d0>]}
[0m22:31:35.893941 [info ] [Thread-1 (]: 5 of 7 OK created sql table model analytics.fsi_stock_summary .................. [[32mSUCCESS 1[0m in 1.10s]
[0m22:31:35.894889 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_stock_summary
[0m22:31:35.895514 [debug] [Thread-1 (]: Began running node model.build_fda.obv_apple_summary
[0m22:31:35.896267 [info ] [Thread-1 (]: 6 of 7 START sql table model analytics.obv_apple_summary ....................... [RUN]
[0m22:31:35.896972 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_stock_summary, now model.build_fda.obv_apple_summary)
[0m22:31:35.897382 [debug] [Thread-1 (]: Began compiling node model.build_fda.obv_apple_summary
[0m22:31:35.901569 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.obv_apple_summary"
[0m22:31:35.902723 [debug] [Thread-1 (]: Began executing node model.build_fda.obv_apple_summary
[0m22:31:35.905360 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.obv_apple_summary"
[0m22:31:35.906896 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.obv_apple_summary"
[0m22:31:35.907291 [debug] [Thread-1 (]: On model.build_fda.obv_apple_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.obv_apple_summary"} */
create or replace transient table dev.analytics.obv_apple_summary
         as
        (WITH ordered_data AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM dev.raw_data.stock_data -- Referencing the raw data table in the dev database
    WHERE symbol = 'AAPL'  -- Filter for Apple symbol
),

obv_calculation AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        CASE
            WHEN close > LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN volume
            WHEN close < LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN -volume
            ELSE 0
        END AS volume_change
    FROM ordered_data
),

cumulative_obv AS (
    SELECT
        date,
        symbol,
        SUM(volume_change) OVER (PARTITION BY symbol ORDER BY date) AS obv
    FROM obv_calculation
)

SELECT
    date,
    symbol,
    obv
FROM cumulative_obv
ORDER BY date
        );
[0m22:31:35.907648 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:31:37.332308 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.424 seconds
[0m22:31:37.337665 [debug] [Thread-1 (]: On model.build_fda.obv_apple_summary: Close
[0m22:31:37.454631 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f85c0561-5fec-493c-80f6-7b7aa32ea93e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13dad0210>]}
[0m22:31:37.456518 [info ] [Thread-1 (]: 6 of 7 OK created sql table model analytics.obv_apple_summary .................. [[32mSUCCESS 1[0m in 1.56s]
[0m22:31:37.457512 [debug] [Thread-1 (]: Finished running node model.build_fda.obv_apple_summary
[0m22:31:37.458181 [debug] [Thread-1 (]: Began running node model.build_fda.obv_nvidia_summary
[0m22:31:37.458867 [info ] [Thread-1 (]: 7 of 7 START sql table model analytics.obv_nvidia_summary ...................... [RUN]
[0m22:31:37.459401 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.obv_apple_summary, now model.build_fda.obv_nvidia_summary)
[0m22:31:37.459779 [debug] [Thread-1 (]: Began compiling node model.build_fda.obv_nvidia_summary
[0m22:31:37.463351 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.obv_nvidia_summary"
[0m22:31:37.465540 [debug] [Thread-1 (]: Began executing node model.build_fda.obv_nvidia_summary
[0m22:31:37.469896 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.obv_nvidia_summary"
[0m22:31:37.471271 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.obv_nvidia_summary"
[0m22:31:37.471606 [debug] [Thread-1 (]: On model.build_fda.obv_nvidia_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.obv_nvidia_summary"} */
create or replace transient table dev.analytics.obv_nvidia_summary
         as
        (WITH ordered_data AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM dev.raw_data.stock_data -- Referencing the raw data table in the dev database
    WHERE symbol = 'NVDA'  -- Filter for Nvidia symbol
),

obv_calculation AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        CASE
            WHEN close > LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN volume
            WHEN close < LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN -volume
            ELSE 0
        END AS volume_change
    FROM ordered_data
),

cumulative_obv AS (
    SELECT
        date,
        symbol,
        SUM(volume_change) OVER (PARTITION BY symbol ORDER BY date) AS obv
    FROM obv_calculation
)

SELECT
    date,
    symbol,
    obv
FROM cumulative_obv
ORDER BY date
        );
[0m22:31:37.471908 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:31:38.660981 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.189 seconds
[0m22:31:38.666760 [debug] [Thread-1 (]: On model.build_fda.obv_nvidia_summary: Close
[0m22:31:38.791501 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f85c0561-5fec-493c-80f6-7b7aa32ea93e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1032d11d0>]}
[0m22:31:38.793761 [info ] [Thread-1 (]: 7 of 7 OK created sql table model analytics.obv_nvidia_summary ................. [[32mSUCCESS 1[0m in 1.33s]
[0m22:31:38.794710 [debug] [Thread-1 (]: Finished running node model.build_fda.obv_nvidia_summary
[0m22:31:38.795385 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data
[0m22:31:38.796030 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.obv_nvidia_summary, now model.build_fda.stock_data)
[0m22:31:38.796455 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data
[0m22:31:38.800015 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data"
[0m22:31:38.801201 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data
[0m22:31:38.801592 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data_forecast
[0m22:31:38.801997 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.stock_data, now model.build_fda.stock_data_forecast)
[0m22:31:38.802336 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data_forecast
[0m22:31:38.804492 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data_forecast"
[0m22:31:38.805225 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data_forecast
[0m22:31:38.806389 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:31:38.806630 [debug] [MainThread]: Connection 'model.build_fda.stock_data_forecast' was properly closed.
[0m22:31:38.806959 [info ] [MainThread]: 
[0m22:31:38.807225 [info ] [MainThread]: Finished running 7 table models in 0 hours 0 minutes and 10.91 seconds (10.91s).
[0m22:31:38.808263 [debug] [MainThread]: Command end result
[0m22:31:38.828361 [info ] [MainThread]: 
[0m22:31:38.828619 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m22:31:38.828787 [info ] [MainThread]: 
[0m22:31:38.828987 [error] [MainThread]:   Database Error in model dmi_apple (models/output/dmi_apple.sql)
  001003 (42000): SQL compilation error:
  syntax error line 18 at position 86 unexpected '20'.
  syntax error line 28 at position 30 unexpected '_day_stddev'.
  syntax error line 29 at position 30 unexpected '_day_stddev'.
  compiled code at target/run/build_fda/models/output/dmi_apple.sql
[0m22:31:38.829151 [info ] [MainThread]: 
[0m22:31:38.829325 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=1 SKIP=0 TOTAL=7
[0m22:31:38.831825 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 11.994498, "process_user_time": 2.660625, "process_kernel_time": 1.424435, "process_mem_max_rss": "205045760", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m22:31:38.832200 [debug] [MainThread]: Command `dbt run` failed at 22:31:38.832147 after 11.99 seconds
[0m22:31:38.832420 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102dd8150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1082d88d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10827bb50>]}
[0m22:31:38.832623 [debug] [MainThread]: Flushing usage events
[0m22:38:19.921778 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109c8d4d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109cdb990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109cf8a10>]}


============================== 22:38:19.923742 | 8a780917-d2e8-452e-8aa3-34092f22979b ==============================
[0m22:38:19.923742 [info ] [MainThread]: Running with dbt=1.8.7
[0m22:38:19.924071 [debug] [MainThread]: running dbt with arguments {'invocation_command': 'dbt run', 'target_path': 'None', 'printer_width': '80', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'send_anonymous_usage_stats': 'True', 'profiles_dir': '/Users/shatayu/.dbt', 'static_parser': 'True', 'introspect': 'True', 'write_json': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'warn_error': 'None', 'log_path': '/Users/shatayu/Downloads/DATA226_Lab2Prep/build_fda/logs', 'fail_fast': 'False', 'debug': 'False', 'log_format': 'default', 'no_print': 'None', 'partial_parse': 'True', 'version_check': 'True', 'empty': 'False', 'log_cache_events': 'False', 'quiet': 'False', 'indirect_selection': 'eager', 'use_colors': 'True'}
[0m22:38:20.880391 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8a780917-d2e8-452e-8aa3-34092f22979b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109644790>]}
[0m22:38:20.900329 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8a780917-d2e8-452e-8aa3-34092f22979b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109645550>]}
[0m22:38:20.900929 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m22:38:20.913010 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m22:38:20.985374 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m22:38:20.985790 [debug] [MainThread]: Partial parsing: updated file: build_fda://models/output/dmi_apple.sql
[0m22:38:21.091572 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8a780917-d2e8-452e-8aa3-34092f22979b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1458c73d0>]}
[0m22:38:21.132913 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8a780917-d2e8-452e-8aa3-34092f22979b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14586fe10>]}
[0m22:38:21.133179 [info ] [MainThread]: Found 9 models, 6 sources, 459 macros
[0m22:38:21.133345 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8a780917-d2e8-452e-8aa3-34092f22979b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x145887f50>]}
[0m22:38:21.134277 [info ] [MainThread]: 
[0m22:38:21.134565 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m22:38:21.136616 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m22:38:21.142201 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m22:38:21.142364 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m22:38:21.142489 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:38:21.819977 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.676 seconds
[0m22:38:21.823166 [debug] [ThreadPool]: On list_dev: Close
[0m22:38:21.952379 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_analytics)
[0m22:38:21.964507 [debug] [ThreadPool]: Using snowflake connection "list_dev_analytics"
[0m22:38:21.965430 [debug] [ThreadPool]: On list_dev_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev_analytics"} */
show objects in dev.analytics limit 10000
[0m22:38:21.965727 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:38:22.409736 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.444 seconds
[0m22:38:22.412795 [debug] [ThreadPool]: On list_dev_analytics: Close
[0m22:38:22.531352 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8a780917-d2e8-452e-8aa3-34092f22979b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1457ce490>]}
[0m22:38:22.532594 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m22:38:22.533078 [info ] [MainThread]: 
[0m22:38:22.538431 [debug] [Thread-1 (]: Began running node model.build_fda.dmi_apple
[0m22:38:22.539272 [info ] [Thread-1 (]: 1 of 7 START sql table model analytics.dmi_apple ............................... [RUN]
[0m22:38:22.539892 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_analytics, now model.build_fda.dmi_apple)
[0m22:38:22.540243 [debug] [Thread-1 (]: Began compiling node model.build_fda.dmi_apple
[0m22:38:22.548373 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.dmi_apple"
[0m22:38:22.549179 [debug] [Thread-1 (]: Began executing node model.build_fda.dmi_apple
[0m22:38:22.569699 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.dmi_apple"
[0m22:38:22.571125 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.dmi_apple"
[0m22:38:22.571410 [debug] [Thread-1 (]: On model.build_fda.dmi_apple: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.dmi_apple"} */
create or replace transient table dev.analytics.dmi_apple
         as
        (WITH apple_prices AS (
    SELECT
        ts,
        close,
        series
    FROM dev.raw_data.stock_data
    WHERE series = 'AAPL'
),

-- Calculate the 20-day SMA and 20-day standard deviation
sma_stddev AS (
    SELECT
        ts,
        close,
        AVG(close) OVER (ORDER BY ts ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS middle_band,
        STDDEV(close) OVER (ORDER BY ts ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS stddev_20
    FROM apple_prices
),

-- Calculate the upper and lower bands
bands AS (
    SELECT
        ts,
        close,
        middle_band,
        (middle_band + (2 * stddev_20)) AS upper_band,
        (middle_band - (2 * stddev_20)) AS lower_band
    FROM sma_stddev
),

-- Calculate +DI and -DI based on daily price movements
directional_indicators AS (
    SELECT
        ts,
        close,
        middle_band,
        upper_band,
        lower_band,
        LAG(close, 1) OVER (ORDER BY ts) AS prev_close,
        -- +DI: Calculate positive movement
        CASE WHEN close > prev_close THEN close - prev_close ELSE 0 END AS plus_di,
        -- -DI: Calculate negative movement
        CASE WHEN close < prev_close THEN prev_close - close ELSE 0 END AS minus_di
    FROM bands
)

SELECT
    ts,
    close,
    middle_band,
    upper_band,
    lower_band,
    -- Summing up DI over the 20-day period for smoother trend analysis
    SUM(plus_di) OVER (ORDER BY ts ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS plus_di_twenty,
    SUM(minus_di) OVER (ORDER BY ts ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS minus_di_twenty
FROM directional_indicators
ORDER BY ts
        );
[0m22:38:22.571657 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:38:22.972732 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b850ee-0004-26ba-0000-000255f35c65
[0m22:38:22.973498 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 5 at position 8
invalid identifier 'TS'
[0m22:38:22.974065 [debug] [Thread-1 (]: On model.build_fda.dmi_apple: Close
[0m22:38:23.092899 [debug] [Thread-1 (]: Database Error in model dmi_apple (models/output/dmi_apple.sql)
  000904 (42000): SQL compilation error: error line 5 at position 8
  invalid identifier 'TS'
  compiled code at target/run/build_fda/models/output/dmi_apple.sql
[0m22:38:23.095162 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8a780917-d2e8-452e-8aa3-34092f22979b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1479aef10>]}
[0m22:38:23.095995 [error] [Thread-1 (]: 1 of 7 ERROR creating sql table model analytics.dmi_apple ...................... [[31mERROR[0m in 0.55s]
[0m22:38:23.096691 [debug] [Thread-1 (]: Finished running node model.build_fda.dmi_apple
[0m22:38:23.097174 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_apple_summary
[0m22:38:23.097838 [info ] [Thread-1 (]: 2 of 7 START sql table model analytics.fsi_apple_summary ....................... [RUN]
[0m22:38:23.098623 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.dmi_apple, now model.build_fda.fsi_apple_summary)
[0m22:38:23.099131 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_apple_summary
[0m22:38:23.102356 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_apple_summary"
[0m22:38:23.103164 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_apple_summary
[0m22:38:23.105985 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_apple_summary"
[0m22:38:23.107789 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_apple_summary"
[0m22:38:23.108255 [debug] [Thread-1 (]: On model.build_fda.fsi_apple_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_apple_summary"} */
create or replace transient table dev.analytics.fsi_apple_summary
         as
        (WITH apple_interval_widths AS (
    SELECT
        ts,
        forecast,
        lower_bound,
        upper_bound,
        series,
        (upper_bound - lower_bound) AS interval_width
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
    WHERE series = 'AAPL'  -- Filter for Apple symbol
),

statistics AS (
    SELECT
        series,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM apple_interval_widths
    GROUP BY series
)

SELECT
    a.ts,
    a.series,
    a.forecast,
    a.lower_bound,
    a.upper_bound,
    a.interval_width,
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM apple_interval_widths a
JOIN statistics s
    ON a.series = s.series
ORDER BY a.ts
        );
[0m22:38:23.108601 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:38:24.061606 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.952 seconds
[0m22:38:24.084142 [debug] [Thread-1 (]: On model.build_fda.fsi_apple_summary: Close
[0m22:38:24.215706 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8a780917-d2e8-452e-8aa3-34092f22979b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14778b310>]}
[0m22:38:24.217271 [info ] [Thread-1 (]: 2 of 7 OK created sql table model analytics.fsi_apple_summary .................. [[32mSUCCESS 1[0m in 1.12s]
[0m22:38:24.218181 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_apple_summary
[0m22:38:24.218623 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_integ_summary
[0m22:38:24.219022 [info ] [Thread-1 (]: 3 of 7 START sql table model analytics.fsi_integ_summary ....................... [RUN]
[0m22:38:24.219445 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_apple_summary, now model.build_fda.fsi_integ_summary)
[0m22:38:24.219986 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_integ_summary
[0m22:38:24.223254 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_integ_summary"
[0m22:38:24.224241 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_integ_summary
[0m22:38:24.228465 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_integ_summary"
[0m22:38:24.229917 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_integ_summary"
[0m22:38:24.230577 [debug] [Thread-1 (]: On model.build_fda.fsi_integ_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_integ_summary"} */
create or replace transient table dev.analytics.fsi_integ_summary
         as
        (WITH interval_widths AS (
    SELECT
        ts,
        forecast,
        lower_bound,
        upper_bound,
        series,
        (upper_bound - lower_bound) AS interval_width
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
),

statistics AS (
    SELECT
        series,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM interval_widths
    GROUP BY series
)

SELECT
    a.ts,
    a.series,
    a.forecast,
    a.lower_bound,
    a.upper_bound,
    a.interval_width,
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM interval_widths a
JOIN statistics s
    ON a.series = s.series
ORDER BY a.ts
        );
[0m22:38:24.301925 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:38:25.687113 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.455 seconds
[0m22:38:25.695890 [debug] [Thread-1 (]: On model.build_fda.fsi_integ_summary: Close
[0m22:38:25.795817 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8a780917-d2e8-452e-8aa3-34092f22979b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109514510>]}
[0m22:38:25.796745 [info ] [Thread-1 (]: 3 of 7 OK created sql table model analytics.fsi_integ_summary .................. [[32mSUCCESS 1[0m in 1.58s]
[0m22:38:25.797431 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_integ_summary
[0m22:38:25.797919 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_nvidia_summary
[0m22:38:25.798382 [info ] [Thread-1 (]: 4 of 7 START sql table model analytics.fsi_nvidia_summary ...................... [RUN]
[0m22:38:25.798972 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_integ_summary, now model.build_fda.fsi_nvidia_summary)
[0m22:38:25.799453 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_nvidia_summary
[0m22:38:25.802997 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_nvidia_summary"
[0m22:38:25.805082 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_nvidia_summary
[0m22:38:25.807431 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_nvidia_summary"
[0m22:38:25.808726 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_nvidia_summary"
[0m22:38:25.809057 [debug] [Thread-1 (]: On model.build_fda.fsi_nvidia_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_nvidia_summary"} */
create or replace transient table dev.analytics.fsi_nvidia_summary
         as
        (WITH nvidia_interval_widths AS (
    SELECT
        ts,
        forecast,
        lower_bound,
        upper_bound,
        series,
        (upper_bound - lower_bound) AS interval_width
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
    WHERE series = 'NVDA'  -- Filter for Nvidia symbol
),

statistics AS (
    SELECT
        series,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM nvidia_interval_widths
    GROUP BY series
)

SELECT
    n.ts,
    n.series,
    n.forecast,
    n.lower_bound,
    n.upper_bound,
    n.interval_width,
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM nvidia_interval_widths n
JOIN statistics s
    ON n.series = s.series
ORDER BY n.ts
        );
[0m22:38:25.809370 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:38:26.916175 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.106 seconds
[0m22:38:26.921499 [debug] [Thread-1 (]: On model.build_fda.fsi_nvidia_summary: Close
[0m22:38:27.041645 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8a780917-d2e8-452e-8aa3-34092f22979b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104c66e50>]}
[0m22:38:27.043128 [info ] [Thread-1 (]: 4 of 7 OK created sql table model analytics.fsi_nvidia_summary ................. [[32mSUCCESS 1[0m in 1.24s]
[0m22:38:27.044010 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_nvidia_summary
[0m22:38:27.044604 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_stock_summary
[0m22:38:27.045336 [info ] [Thread-1 (]: 5 of 7 START sql table model analytics.fsi_stock_summary ....................... [RUN]
[0m22:38:27.046039 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_nvidia_summary, now model.build_fda.fsi_stock_summary)
[0m22:38:27.046547 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_stock_summary
[0m22:38:27.050697 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_stock_summary"
[0m22:38:27.051739 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_stock_summary
[0m22:38:27.054467 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_stock_summary"
[0m22:38:27.055966 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_stock_summary"
[0m22:38:27.056345 [debug] [Thread-1 (]: On model.build_fda.fsi_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_stock_summary"} */
create or replace transient table dev.analytics.fsi_stock_summary
         as
        (WITH apple_interval_widths AS (
    SELECT
        ts,
        forecast,
        lower_bound,
        upper_bound,
        series,
        (upper_bound - lower_bound) AS interval_width
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
    WHERE series = 'AAPL'  -- Filter for Apple symbol
),

statistics AS (
    SELECT
        series,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM apple_interval_widths
    GROUP BY series
)

SELECT
    a.ts,
    a.series,
    a.forecast,
    a.lower_bound,
    a.upper_bound,
    a.interval_width,
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM apple_interval_widths a
JOIN statistics s
    ON a.series = s.series
ORDER BY a.ts
        );
[0m22:38:27.056704 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:38:28.041303 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.984 seconds
[0m22:38:28.046029 [debug] [Thread-1 (]: On model.build_fda.fsi_stock_summary: Close
[0m22:38:28.151594 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8a780917-d2e8-452e-8aa3-34092f22979b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106e3e710>]}
[0m22:38:28.153907 [info ] [Thread-1 (]: 5 of 7 OK created sql table model analytics.fsi_stock_summary .................. [[32mSUCCESS 1[0m in 1.11s]
[0m22:38:28.154893 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_stock_summary
[0m22:38:28.155549 [debug] [Thread-1 (]: Began running node model.build_fda.obv_apple_summary
[0m22:38:28.156230 [info ] [Thread-1 (]: 6 of 7 START sql table model analytics.obv_apple_summary ....................... [RUN]
[0m22:38:28.156809 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_stock_summary, now model.build_fda.obv_apple_summary)
[0m22:38:28.157177 [debug] [Thread-1 (]: Began compiling node model.build_fda.obv_apple_summary
[0m22:38:28.160848 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.obv_apple_summary"
[0m22:38:28.161788 [debug] [Thread-1 (]: Began executing node model.build_fda.obv_apple_summary
[0m22:38:28.164228 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.obv_apple_summary"
[0m22:38:28.165941 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.obv_apple_summary"
[0m22:38:28.166287 [debug] [Thread-1 (]: On model.build_fda.obv_apple_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.obv_apple_summary"} */
create or replace transient table dev.analytics.obv_apple_summary
         as
        (WITH ordered_data AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM dev.raw_data.stock_data -- Referencing the raw data table in the dev database
    WHERE symbol = 'AAPL'  -- Filter for Apple symbol
),

obv_calculation AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        CASE
            WHEN close > LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN volume
            WHEN close < LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN -volume
            ELSE 0
        END AS volume_change
    FROM ordered_data
),

cumulative_obv AS (
    SELECT
        date,
        symbol,
        SUM(volume_change) OVER (PARTITION BY symbol ORDER BY date) AS obv
    FROM obv_calculation
)

SELECT
    date,
    symbol,
    obv
FROM cumulative_obv
ORDER BY date
        );
[0m22:38:28.166605 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:38:29.051823 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.885 seconds
[0m22:38:29.057108 [debug] [Thread-1 (]: On model.build_fda.obv_apple_summary: Close
[0m22:38:29.170217 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8a780917-d2e8-452e-8aa3-34092f22979b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10809f590>]}
[0m22:38:29.171110 [info ] [Thread-1 (]: 6 of 7 OK created sql table model analytics.obv_apple_summary .................. [[32mSUCCESS 1[0m in 1.01s]
[0m22:38:29.171799 [debug] [Thread-1 (]: Finished running node model.build_fda.obv_apple_summary
[0m22:38:29.172286 [debug] [Thread-1 (]: Began running node model.build_fda.obv_nvidia_summary
[0m22:38:29.172921 [info ] [Thread-1 (]: 7 of 7 START sql table model analytics.obv_nvidia_summary ...................... [RUN]
[0m22:38:29.173511 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.obv_apple_summary, now model.build_fda.obv_nvidia_summary)
[0m22:38:29.173891 [debug] [Thread-1 (]: Began compiling node model.build_fda.obv_nvidia_summary
[0m22:38:29.177566 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.obv_nvidia_summary"
[0m22:38:29.180155 [debug] [Thread-1 (]: Began executing node model.build_fda.obv_nvidia_summary
[0m22:38:29.184462 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.obv_nvidia_summary"
[0m22:38:29.185788 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.obv_nvidia_summary"
[0m22:38:29.186121 [debug] [Thread-1 (]: On model.build_fda.obv_nvidia_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.obv_nvidia_summary"} */
create or replace transient table dev.analytics.obv_nvidia_summary
         as
        (WITH ordered_data AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM dev.raw_data.stock_data -- Referencing the raw data table in the dev database
    WHERE symbol = 'NVDA'  -- Filter for Nvidia symbol
),

obv_calculation AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        CASE
            WHEN close > LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN volume
            WHEN close < LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN -volume
            ELSE 0
        END AS volume_change
    FROM ordered_data
),

cumulative_obv AS (
    SELECT
        date,
        symbol,
        SUM(volume_change) OVER (PARTITION BY symbol ORDER BY date) AS obv
    FROM obv_calculation
)

SELECT
    date,
    symbol,
    obv
FROM cumulative_obv
ORDER BY date
        );
[0m22:38:29.186440 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:38:30.510950 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.324 seconds
[0m22:38:30.518066 [debug] [Thread-1 (]: On model.build_fda.obv_nvidia_summary: Close
[0m22:38:30.677664 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8a780917-d2e8-452e-8aa3-34092f22979b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109bb82d0>]}
[0m22:38:30.679396 [info ] [Thread-1 (]: 7 of 7 OK created sql table model analytics.obv_nvidia_summary ................. [[32mSUCCESS 1[0m in 1.50s]
[0m22:38:30.680605 [debug] [Thread-1 (]: Finished running node model.build_fda.obv_nvidia_summary
[0m22:38:30.681338 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data
[0m22:38:30.682058 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.obv_nvidia_summary, now model.build_fda.stock_data)
[0m22:38:30.682639 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data
[0m22:38:30.686971 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data"
[0m22:38:30.688381 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data
[0m22:38:30.688834 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data_forecast
[0m22:38:30.689300 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.stock_data, now model.build_fda.stock_data_forecast)
[0m22:38:30.689669 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data_forecast
[0m22:38:30.692036 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data_forecast"
[0m22:38:30.692835 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data_forecast
[0m22:38:30.694128 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:38:30.694407 [debug] [MainThread]: Connection 'model.build_fda.stock_data_forecast' was properly closed.
[0m22:38:30.694777 [info ] [MainThread]: 
[0m22:38:30.695086 [info ] [MainThread]: Finished running 7 table models in 0 hours 0 minutes and 9.56 seconds (9.56s).
[0m22:38:30.696173 [debug] [MainThread]: Command end result
[0m22:38:30.718252 [info ] [MainThread]: 
[0m22:38:30.718579 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m22:38:30.718760 [info ] [MainThread]: 
[0m22:38:30.718997 [error] [MainThread]:   Database Error in model dmi_apple (models/output/dmi_apple.sql)
  000904 (42000): SQL compilation error: error line 5 at position 8
  invalid identifier 'TS'
  compiled code at target/run/build_fda/models/output/dmi_apple.sql
[0m22:38:30.719179 [info ] [MainThread]: 
[0m22:38:30.719377 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=1 SKIP=0 TOTAL=7
[0m22:38:30.721440 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 10.849579, "process_user_time": 2.653836, "process_kernel_time": 1.496964, "process_mem_max_rss": "203816960", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m22:38:30.721783 [debug] [MainThread]: Command `dbt run` failed at 22:38:30.721731 after 10.85 seconds
[0m22:38:30.722005 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10491c150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104966ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104966310>]}
[0m22:38:30.722196 [debug] [MainThread]: Flushing usage events
[0m23:01:07.377327 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1052f5910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105360a10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105360f10>]}


============================== 23:01:07.379257 | 85786613-c4c1-490c-92f5-f5d8f03eeb13 ==============================
[0m23:01:07.379257 [info ] [MainThread]: Running with dbt=1.8.7
[0m23:01:07.379578 [debug] [MainThread]: running dbt with arguments {'send_anonymous_usage_stats': 'True', 'warn_error': 'None', 'use_experimental_parser': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'quiet': 'False', 'write_json': 'True', 'invocation_command': 'dbt run', 'cache_selected_only': 'False', 'no_print': 'None', 'fail_fast': 'False', 'partial_parse': 'True', 'log_path': '/Users/shatayu/Downloads/DATA226_Lab2Prep/build_fda/logs', 'version_check': 'True', 'indirect_selection': 'eager', 'empty': 'False', 'log_format': 'default', 'log_cache_events': 'False', 'use_colors': 'True', 'debug': 'False', 'printer_width': '80', 'static_parser': 'True', 'introspect': 'True', 'profiles_dir': '/Users/shatayu/.dbt'}
[0m23:01:08.309501 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '85786613-c4c1-490c-92f5-f5d8f03eeb13', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x131233050>]}
[0m23:01:08.330170 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '85786613-c4c1-490c-92f5-f5d8f03eeb13', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104dad510>]}
[0m23:01:08.330847 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m23:01:08.342937 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m23:01:08.414988 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m23:01:08.415361 [debug] [MainThread]: Partial parsing: updated file: build_fda://models/output/dmi_apple.sql
[0m23:01:08.521633 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '85786613-c4c1-490c-92f5-f5d8f03eeb13', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1312c6dd0>]}
[0m23:01:08.581185 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '85786613-c4c1-490c-92f5-f5d8f03eeb13', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1316b7c50>]}
[0m23:01:08.581497 [info ] [MainThread]: Found 9 models, 6 sources, 459 macros
[0m23:01:08.581662 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '85786613-c4c1-490c-92f5-f5d8f03eeb13', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13170b6d0>]}
[0m23:01:08.582558 [info ] [MainThread]: 
[0m23:01:08.582844 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m23:01:08.584913 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m23:01:08.590517 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m23:01:08.590673 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m23:01:08.590798 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:01:09.142321 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.550 seconds
[0m23:01:09.145479 [debug] [ThreadPool]: On list_dev: Close
[0m23:01:09.285441 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_analytics)
[0m23:01:09.296170 [debug] [ThreadPool]: Using snowflake connection "list_dev_analytics"
[0m23:01:09.296558 [debug] [ThreadPool]: On list_dev_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev_analytics"} */
show objects in dev.analytics limit 10000
[0m23:01:09.296837 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:01:09.816302 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.519 seconds
[0m23:01:09.820341 [debug] [ThreadPool]: On list_dev_analytics: Close
[0m23:01:09.983251 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '85786613-c4c1-490c-92f5-f5d8f03eeb13', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1321b9d10>]}
[0m23:01:09.984313 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:01:09.984728 [info ] [MainThread]: 
[0m23:01:09.988492 [debug] [Thread-1 (]: Began running node model.build_fda.dmi_apple
[0m23:01:09.989182 [info ] [Thread-1 (]: 1 of 7 START sql table model analytics.dmi_apple ............................... [RUN]
[0m23:01:09.989710 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_analytics, now model.build_fda.dmi_apple)
[0m23:01:09.990071 [debug] [Thread-1 (]: Began compiling node model.build_fda.dmi_apple
[0m23:01:09.998201 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.dmi_apple"
[0m23:01:09.999429 [debug] [Thread-1 (]: Began executing node model.build_fda.dmi_apple
[0m23:01:10.020888 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.dmi_apple"
[0m23:01:10.022736 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.dmi_apple"
[0m23:01:10.023131 [debug] [Thread-1 (]: On model.build_fda.dmi_apple: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.dmi_apple"} */
create or replace transient table dev.analytics.dmi_apple
         as
        (WITH apple_prices AS (
    SELECT
        date,
        close,
        series
    FROM dev.raw_data.stock_data
    WHERE series = 'AAPL'
),

-- Calculate the 20-day SMA and 20-day standard deviation
sma_stddev AS (
    SELECT
        date,
        close,
        AVG(close) OVER (ORDER BY ts ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS middle_band,
        STDDEV(close) OVER (ORDER BY ts ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS stddev_20
    FROM apple_prices
),

-- Calculate the upper and lower bands
bands AS (
    SELECT
        date,
        close,
        middle_band,
        (middle_band + (2 * stddev_20)) AS upper_band,
        (middle_band - (2 * stddev_20)) AS lower_band
    FROM sma_stddev
),

-- Calculate +DI and -DI based on daily price movements
directional_indicators AS (
    SELECT
        date,
        close,
        middle_band,
        upper_band,
        lower_band,
        LAG(close, 1) OVER (ORDER BY ts) AS prev_close,
        -- +DI: Calculate positive movement
        CASE WHEN close > prev_close THEN close - prev_close ELSE 0 END AS plus_di,
        -- -DI: Calculate negative movement
        CASE WHEN close < prev_close THEN prev_close - close ELSE 0 END AS minus_di
    FROM bands
)

SELECT
    date as ts,
    close,
    middle_band,
    upper_band,
    lower_band,
    -- Summing up DI over the 20-day period for smoother trend analysis
    SUM(plus_di) OVER (ORDER BY ts ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS plus_di_twenty,
    SUM(minus_di) OVER (ORDER BY ts ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS minus_di_twenty
FROM directional_indicators
ORDER BY ts
        );
[0m23:01:10.023412 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:01:10.491891 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b85105-0004-26b4-0000-000255f33bd1
[0m23:01:10.492619 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 7 at position 8
invalid identifier 'SERIES'
[0m23:01:10.493142 [debug] [Thread-1 (]: On model.build_fda.dmi_apple: Close
[0m23:01:10.636783 [debug] [Thread-1 (]: Database Error in model dmi_apple (models/output/dmi_apple.sql)
  000904 (42000): SQL compilation error: error line 7 at position 8
  invalid identifier 'SERIES'
  compiled code at target/run/build_fda/models/output/dmi_apple.sql
[0m23:01:10.639115 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '85786613-c4c1-490c-92f5-f5d8f03eeb13', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13245f390>]}
[0m23:01:10.639974 [error] [Thread-1 (]: 1 of 7 ERROR creating sql table model analytics.dmi_apple ...................... [[31mERROR[0m in 0.65s]
[0m23:01:10.640667 [debug] [Thread-1 (]: Finished running node model.build_fda.dmi_apple
[0m23:01:10.641144 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_apple_summary
[0m23:01:10.641794 [info ] [Thread-1 (]: 2 of 7 START sql table model analytics.fsi_apple_summary ....................... [RUN]
[0m23:01:10.642297 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.dmi_apple, now model.build_fda.fsi_apple_summary)
[0m23:01:10.642633 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_apple_summary
[0m23:01:10.645749 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_apple_summary"
[0m23:01:10.646914 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_apple_summary
[0m23:01:10.649780 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_apple_summary"
[0m23:01:10.651324 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_apple_summary"
[0m23:01:10.651666 [debug] [Thread-1 (]: On model.build_fda.fsi_apple_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_apple_summary"} */
create or replace transient table dev.analytics.fsi_apple_summary
         as
        (WITH apple_interval_widths AS (
    SELECT
        ts,
        forecast,
        lower_bound,
        upper_bound,
        series,
        (upper_bound - lower_bound) AS interval_width
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
    WHERE series = 'AAPL'  -- Filter for Apple symbol
),

statistics AS (
    SELECT
        series,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM apple_interval_widths
    GROUP BY series
)

SELECT
    a.ts,
    a.series,
    a.forecast,
    a.lower_bound,
    a.upper_bound,
    a.interval_width,
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM apple_interval_widths a
JOIN statistics s
    ON a.series = s.series
ORDER BY a.ts
        );
[0m23:01:10.651986 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:01:12.363266 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.711 seconds
[0m23:01:12.387280 [debug] [Thread-1 (]: On model.build_fda.fsi_apple_summary: Close
[0m23:01:12.494552 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '85786613-c4c1-490c-92f5-f5d8f03eeb13', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1321b7650>]}
[0m23:01:12.495557 [info ] [Thread-1 (]: 2 of 7 OK created sql table model analytics.fsi_apple_summary .................. [[32mSUCCESS 1[0m in 1.85s]
[0m23:01:12.496276 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_apple_summary
[0m23:01:12.496752 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_integ_summary
[0m23:01:12.497334 [info ] [Thread-1 (]: 3 of 7 START sql table model analytics.fsi_integ_summary ....................... [RUN]
[0m23:01:12.497888 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_apple_summary, now model.build_fda.fsi_integ_summary)
[0m23:01:12.498277 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_integ_summary
[0m23:01:12.501726 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_integ_summary"
[0m23:01:12.502690 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_integ_summary
[0m23:01:12.507445 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_integ_summary"
[0m23:01:12.508855 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_integ_summary"
[0m23:01:12.509191 [debug] [Thread-1 (]: On model.build_fda.fsi_integ_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_integ_summary"} */
create or replace transient table dev.analytics.fsi_integ_summary
         as
        (WITH interval_widths AS (
    SELECT
        ts,
        forecast,
        lower_bound,
        upper_bound,
        series,
        (upper_bound - lower_bound) AS interval_width
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
),

statistics AS (
    SELECT
        series,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM interval_widths
    GROUP BY series
)

SELECT
    a.ts,
    a.series,
    a.forecast,
    a.lower_bound,
    a.upper_bound,
    a.interval_width,
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM interval_widths a
JOIN statistics s
    ON a.series = s.series
ORDER BY a.ts
        );
[0m23:01:12.582371 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:01:14.106235 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.596 seconds
[0m23:01:14.114333 [debug] [Thread-1 (]: On model.build_fda.fsi_integ_summary: Close
[0m23:01:14.242654 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '85786613-c4c1-490c-92f5-f5d8f03eeb13', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1022a1cd0>]}
[0m23:01:14.243821 [info ] [Thread-1 (]: 3 of 7 OK created sql table model analytics.fsi_integ_summary .................. [[32mSUCCESS 1[0m in 1.74s]
[0m23:01:14.245005 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_integ_summary
[0m23:01:14.245704 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_nvidia_summary
[0m23:01:14.246468 [info ] [Thread-1 (]: 4 of 7 START sql table model analytics.fsi_nvidia_summary ...................... [RUN]
[0m23:01:14.247222 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_integ_summary, now model.build_fda.fsi_nvidia_summary)
[0m23:01:14.247723 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_nvidia_summary
[0m23:01:14.251174 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_nvidia_summary"
[0m23:01:14.252255 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_nvidia_summary
[0m23:01:14.254749 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_nvidia_summary"
[0m23:01:14.256177 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_nvidia_summary"
[0m23:01:14.256562 [debug] [Thread-1 (]: On model.build_fda.fsi_nvidia_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_nvidia_summary"} */
create or replace transient table dev.analytics.fsi_nvidia_summary
         as
        (WITH nvidia_interval_widths AS (
    SELECT
        ts,
        forecast,
        lower_bound,
        upper_bound,
        series,
        (upper_bound - lower_bound) AS interval_width
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
    WHERE series = 'NVDA'  -- Filter for Nvidia symbol
),

statistics AS (
    SELECT
        series,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM nvidia_interval_widths
    GROUP BY series
)

SELECT
    n.ts,
    n.series,
    n.forecast,
    n.lower_bound,
    n.upper_bound,
    n.interval_width,
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM nvidia_interval_widths n
JOIN statistics s
    ON n.series = s.series
ORDER BY n.ts
        );
[0m23:01:14.256909 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:01:15.639948 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.382 seconds
[0m23:01:15.647817 [debug] [Thread-1 (]: On model.build_fda.fsi_nvidia_summary: Close
[0m23:01:15.764055 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '85786613-c4c1-490c-92f5-f5d8f03eeb13', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1314e1ad0>]}
[0m23:01:15.766458 [info ] [Thread-1 (]: 4 of 7 OK created sql table model analytics.fsi_nvidia_summary ................. [[32mSUCCESS 1[0m in 1.52s]
[0m23:01:15.767974 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_nvidia_summary
[0m23:01:15.768603 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_stock_summary
[0m23:01:15.769263 [info ] [Thread-1 (]: 5 of 7 START sql table model analytics.fsi_stock_summary ....................... [RUN]
[0m23:01:15.769819 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_nvidia_summary, now model.build_fda.fsi_stock_summary)
[0m23:01:15.770173 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_stock_summary
[0m23:01:15.773837 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_stock_summary"
[0m23:01:15.774818 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_stock_summary
[0m23:01:15.777151 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_stock_summary"
[0m23:01:15.778444 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_stock_summary"
[0m23:01:15.778779 [debug] [Thread-1 (]: On model.build_fda.fsi_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_stock_summary"} */
create or replace transient table dev.analytics.fsi_stock_summary
         as
        (WITH apple_interval_widths AS (
    SELECT
        ts,
        forecast,
        lower_bound,
        upper_bound,
        series,
        (upper_bound - lower_bound) AS interval_width
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
    WHERE series = 'AAPL'  -- Filter for Apple symbol
),

statistics AS (
    SELECT
        series,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM apple_interval_widths
    GROUP BY series
)

SELECT
    a.ts,
    a.series,
    a.forecast,
    a.lower_bound,
    a.upper_bound,
    a.interval_width,
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM apple_interval_widths a
JOIN statistics s
    ON a.series = s.series
ORDER BY a.ts
        );
[0m23:01:15.779103 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:01:16.965214 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.186 seconds
[0m23:01:16.969733 [debug] [Thread-1 (]: On model.build_fda.fsi_stock_summary: Close
[0m23:01:17.097714 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '85786613-c4c1-490c-92f5-f5d8f03eeb13', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x115cd5d50>]}
[0m23:01:17.098967 [info ] [Thread-1 (]: 5 of 7 OK created sql table model analytics.fsi_stock_summary .................. [[32mSUCCESS 1[0m in 1.33s]
[0m23:01:17.099789 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_stock_summary
[0m23:01:17.100370 [debug] [Thread-1 (]: Began running node model.build_fda.obv_apple_summary
[0m23:01:17.100922 [info ] [Thread-1 (]: 6 of 7 START sql table model analytics.obv_apple_summary ....................... [RUN]
[0m23:01:17.101624 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_stock_summary, now model.build_fda.obv_apple_summary)
[0m23:01:17.102216 [debug] [Thread-1 (]: Began compiling node model.build_fda.obv_apple_summary
[0m23:01:17.106448 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.obv_apple_summary"
[0m23:01:17.107546 [debug] [Thread-1 (]: Began executing node model.build_fda.obv_apple_summary
[0m23:01:17.110310 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.obv_apple_summary"
[0m23:01:17.111848 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.obv_apple_summary"
[0m23:01:17.112240 [debug] [Thread-1 (]: On model.build_fda.obv_apple_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.obv_apple_summary"} */
create or replace transient table dev.analytics.obv_apple_summary
         as
        (WITH ordered_data AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM dev.raw_data.stock_data -- Referencing the raw data table in the dev database
    WHERE symbol = 'AAPL'  -- Filter for Apple symbol
),

obv_calculation AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        CASE
            WHEN close > LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN volume
            WHEN close < LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN -volume
            ELSE 0
        END AS volume_change
    FROM ordered_data
),

cumulative_obv AS (
    SELECT
        date,
        symbol,
        SUM(volume_change) OVER (PARTITION BY symbol ORDER BY date) AS obv
    FROM obv_calculation
)

SELECT
    date,
    symbol,
    obv
FROM cumulative_obv
ORDER BY date
        );
[0m23:01:17.112599 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:01:18.609162 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.496 seconds
[0m23:01:18.613362 [debug] [Thread-1 (]: On model.build_fda.obv_apple_summary: Close
[0m23:01:18.722509 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '85786613-c4c1-490c-92f5-f5d8f03eeb13', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10593e810>]}
[0m23:01:18.724240 [info ] [Thread-1 (]: 6 of 7 OK created sql table model analytics.obv_apple_summary .................. [[32mSUCCESS 1[0m in 1.62s]
[0m23:01:18.725408 [debug] [Thread-1 (]: Finished running node model.build_fda.obv_apple_summary
[0m23:01:18.726077 [debug] [Thread-1 (]: Began running node model.build_fda.obv_nvidia_summary
[0m23:01:18.726639 [info ] [Thread-1 (]: 7 of 7 START sql table model analytics.obv_nvidia_summary ...................... [RUN]
[0m23:01:18.727260 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.obv_apple_summary, now model.build_fda.obv_nvidia_summary)
[0m23:01:18.727743 [debug] [Thread-1 (]: Began compiling node model.build_fda.obv_nvidia_summary
[0m23:01:18.731486 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.obv_nvidia_summary"
[0m23:01:18.733683 [debug] [Thread-1 (]: Began executing node model.build_fda.obv_nvidia_summary
[0m23:01:18.738424 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.obv_nvidia_summary"
[0m23:01:18.740157 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.obv_nvidia_summary"
[0m23:01:18.740502 [debug] [Thread-1 (]: On model.build_fda.obv_nvidia_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.obv_nvidia_summary"} */
create or replace transient table dev.analytics.obv_nvidia_summary
         as
        (WITH ordered_data AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM dev.raw_data.stock_data -- Referencing the raw data table in the dev database
    WHERE symbol = 'NVDA'  -- Filter for Nvidia symbol
),

obv_calculation AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        CASE
            WHEN close > LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN volume
            WHEN close < LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN -volume
            ELSE 0
        END AS volume_change
    FROM ordered_data
),

cumulative_obv AS (
    SELECT
        date,
        symbol,
        SUM(volume_change) OVER (PARTITION BY symbol ORDER BY date) AS obv
    FROM obv_calculation
)

SELECT
    date,
    symbol,
    obv
FROM cumulative_obv
ORDER BY date
        );
[0m23:01:18.740814 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:01:20.350305 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.609 seconds
[0m23:01:20.357380 [debug] [Thread-1 (]: On model.build_fda.obv_nvidia_summary: Close
[0m23:01:20.483704 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '85786613-c4c1-490c-92f5-f5d8f03eeb13', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103160850>]}
[0m23:01:20.484828 [info ] [Thread-1 (]: 7 of 7 OK created sql table model analytics.obv_nvidia_summary ................. [[32mSUCCESS 1[0m in 1.76s]
[0m23:01:20.485623 [debug] [Thread-1 (]: Finished running node model.build_fda.obv_nvidia_summary
[0m23:01:20.486213 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data
[0m23:01:20.486864 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.obv_nvidia_summary, now model.build_fda.stock_data)
[0m23:01:20.487397 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data
[0m23:01:20.491308 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data"
[0m23:01:20.492612 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data
[0m23:01:20.493037 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data_forecast
[0m23:01:20.493473 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.stock_data, now model.build_fda.stock_data_forecast)
[0m23:01:20.493824 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data_forecast
[0m23:01:20.496324 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data_forecast"
[0m23:01:20.497081 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data_forecast
[0m23:01:20.498347 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:01:20.498612 [debug] [MainThread]: Connection 'model.build_fda.stock_data_forecast' was properly closed.
[0m23:01:20.498958 [info ] [MainThread]: 
[0m23:01:20.499243 [info ] [MainThread]: Finished running 7 table models in 0 hours 0 minutes and 11.92 seconds (11.92s).
[0m23:01:20.500374 [debug] [MainThread]: Command end result
[0m23:01:20.522376 [info ] [MainThread]: 
[0m23:01:20.522666 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m23:01:20.522848 [info ] [MainThread]: 
[0m23:01:20.523061 [error] [MainThread]:   Database Error in model dmi_apple (models/output/dmi_apple.sql)
  000904 (42000): SQL compilation error: error line 7 at position 8
  invalid identifier 'SERIES'
  compiled code at target/run/build_fda/models/output/dmi_apple.sql
[0m23:01:20.523242 [info ] [MainThread]: 
[0m23:01:20.523531 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=1 SKIP=0 TOTAL=7
[0m23:01:20.526153 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 13.198078, "process_user_time": 2.501745, "process_kernel_time": 1.677987, "process_mem_max_rss": "205668352", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m23:01:20.526533 [debug] [MainThread]: Command `dbt run` failed at 23:01:20.526474 after 13.20 seconds
[0m23:01:20.526761 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1052ecf50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100f2c150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1041c5150>]}
[0m23:01:20.526964 [debug] [MainThread]: Flushing usage events
[0m23:01:41.176896 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109106650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10914df50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10915bbd0>]}


============================== 23:01:41.178284 | 096b6567-a3dc-4a40-86e0-50b4242b2fd7 ==============================
[0m23:01:41.178284 [info ] [MainThread]: Running with dbt=1.8.7
[0m23:01:41.178600 [debug] [MainThread]: running dbt with arguments {'log_cache_events': 'False', 'printer_width': '80', 'fail_fast': 'False', 'warn_error': 'None', 'use_experimental_parser': 'False', 'quiet': 'False', 'partial_parse': 'True', 'log_path': '/Users/shatayu/Downloads/DATA226_Lab2Prep/build_fda/logs', 'introspect': 'True', 'profiles_dir': '/Users/shatayu/.dbt', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'empty': 'False', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True', 'cache_selected_only': 'False', 'version_check': 'True', 'log_format': 'default', 'debug': 'False', 'use_colors': 'True', 'indirect_selection': 'eager', 'target_path': 'None', 'write_json': 'True', 'no_print': 'None', 'static_parser': 'True'}
[0m23:01:41.685064 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '096b6567-a3dc-4a40-86e0-50b4242b2fd7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x126004150>]}
[0m23:01:41.705070 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '096b6567-a3dc-4a40-86e0-50b4242b2fd7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108bc5790>]}
[0m23:01:41.705512 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m23:01:41.716833 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m23:01:41.779197 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m23:01:41.779582 [debug] [MainThread]: Partial parsing: updated file: build_fda://models/output/dmi_apple.sql
[0m23:01:41.878998 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '096b6567-a3dc-4a40-86e0-50b4242b2fd7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1353c5190>]}
[0m23:01:41.914790 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '096b6567-a3dc-4a40-86e0-50b4242b2fd7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1355a2fd0>]}
[0m23:01:41.915058 [info ] [MainThread]: Found 9 models, 6 sources, 459 macros
[0m23:01:41.915223 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '096b6567-a3dc-4a40-86e0-50b4242b2fd7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x134f145d0>]}
[0m23:01:41.916138 [info ] [MainThread]: 
[0m23:01:41.916423 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m23:01:41.918506 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m23:01:41.924087 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m23:01:41.924254 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m23:01:41.924379 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:01:42.717417 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.792 seconds
[0m23:01:42.721467 [debug] [ThreadPool]: On list_dev: Close
[0m23:01:42.830390 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_analytics)
[0m23:01:42.839748 [debug] [ThreadPool]: Using snowflake connection "list_dev_analytics"
[0m23:01:42.840082 [debug] [ThreadPool]: On list_dev_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev_analytics"} */
show objects in dev.analytics limit 10000
[0m23:01:42.840324 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:01:43.475032 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.635 seconds
[0m23:01:43.477510 [debug] [ThreadPool]: On list_dev_analytics: Close
[0m23:01:43.681487 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '096b6567-a3dc-4a40-86e0-50b4242b2fd7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10901b510>]}
[0m23:01:43.682661 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:01:43.683153 [info ] [MainThread]: 
[0m23:01:43.686446 [debug] [Thread-1 (]: Began running node model.build_fda.dmi_apple
[0m23:01:43.687294 [info ] [Thread-1 (]: 1 of 7 START sql table model analytics.dmi_apple ............................... [RUN]
[0m23:01:43.687900 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_analytics, now model.build_fda.dmi_apple)
[0m23:01:43.688269 [debug] [Thread-1 (]: Began compiling node model.build_fda.dmi_apple
[0m23:01:43.696730 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.dmi_apple"
[0m23:01:43.697834 [debug] [Thread-1 (]: Began executing node model.build_fda.dmi_apple
[0m23:01:43.717919 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.dmi_apple"
[0m23:01:43.719499 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.dmi_apple"
[0m23:01:43.719816 [debug] [Thread-1 (]: On model.build_fda.dmi_apple: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.dmi_apple"} */
create or replace transient table dev.analytics.dmi_apple
         as
        (WITH apple_prices AS (
    SELECT
        date,
        close,
        symbol as series
    FROM dev.raw_data.stock_data
    WHERE series = 'AAPL'
),

-- Calculate the 20-day SMA and 20-day standard deviation
sma_stddev AS (
    SELECT
        date,
        close,
        AVG(close) OVER (ORDER BY ts ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS middle_band,
        STDDEV(close) OVER (ORDER BY ts ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS stddev_20
    FROM apple_prices
),

-- Calculate the upper and lower bands
bands AS (
    SELECT
        date,
        close,
        middle_band,
        (middle_band + (2 * stddev_20)) AS upper_band,
        (middle_band - (2 * stddev_20)) AS lower_band
    FROM sma_stddev
),

-- Calculate +DI and -DI based on daily price movements
directional_indicators AS (
    SELECT
        date,
        close,
        middle_band,
        upper_band,
        lower_band,
        LAG(close, 1) OVER (ORDER BY ts) AS prev_close,
        -- +DI: Calculate positive movement
        CASE WHEN close > prev_close THEN close - prev_close ELSE 0 END AS plus_di,
        -- -DI: Calculate negative movement
        CASE WHEN close < prev_close THEN prev_close - close ELSE 0 END AS minus_di
    FROM bands
)

SELECT
    date as ts,
    close,
    middle_band,
    upper_band,
    lower_band,
    -- Summing up DI over the 20-day period for smoother trend analysis
    SUM(plus_di) OVER (ORDER BY ts ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS plus_di_twenty,
    SUM(minus_di) OVER (ORDER BY ts ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS minus_di_twenty
FROM directional_indicators
ORDER BY ts
        );
[0m23:01:43.720074 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:01:44.393238 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b85105-0004-2be6-0000-000255f3f0cd
[0m23:01:44.394046 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 17 at position 34
invalid identifier 'TS'
[0m23:01:44.394615 [debug] [Thread-1 (]: On model.build_fda.dmi_apple: Close
[0m23:01:44.517984 [debug] [Thread-1 (]: Database Error in model dmi_apple (models/output/dmi_apple.sql)
  000904 (42000): SQL compilation error: error line 17 at position 34
  invalid identifier 'TS'
  compiled code at target/run/build_fda/models/output/dmi_apple.sql
[0m23:01:44.520047 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '096b6567-a3dc-4a40-86e0-50b4242b2fd7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1360a8590>]}
[0m23:01:44.521078 [error] [Thread-1 (]: 1 of 7 ERROR creating sql table model analytics.dmi_apple ...................... [[31mERROR[0m in 0.83s]
[0m23:01:44.522098 [debug] [Thread-1 (]: Finished running node model.build_fda.dmi_apple
[0m23:01:44.522648 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_apple_summary
[0m23:01:44.523447 [info ] [Thread-1 (]: 2 of 7 START sql table model analytics.fsi_apple_summary ....................... [RUN]
[0m23:01:44.524076 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.dmi_apple, now model.build_fda.fsi_apple_summary)
[0m23:01:44.524435 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_apple_summary
[0m23:01:44.527612 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_apple_summary"
[0m23:01:44.528514 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_apple_summary
[0m23:01:44.531305 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_apple_summary"
[0m23:01:44.532713 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_apple_summary"
[0m23:01:44.533053 [debug] [Thread-1 (]: On model.build_fda.fsi_apple_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_apple_summary"} */
create or replace transient table dev.analytics.fsi_apple_summary
         as
        (WITH apple_interval_widths AS (
    SELECT
        ts,
        forecast,
        lower_bound,
        upper_bound,
        series,
        (upper_bound - lower_bound) AS interval_width
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
    WHERE series = 'AAPL'  -- Filter for Apple symbol
),

statistics AS (
    SELECT
        series,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM apple_interval_widths
    GROUP BY series
)

SELECT
    a.ts,
    a.series,
    a.forecast,
    a.lower_bound,
    a.upper_bound,
    a.interval_width,
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM apple_interval_widths a
JOIN statistics s
    ON a.series = s.series
ORDER BY a.ts
        );
[0m23:01:44.533373 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:01:45.945419 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.412 seconds
[0m23:01:45.962151 [debug] [Thread-1 (]: On model.build_fda.fsi_apple_summary: Close
[0m23:01:46.069567 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '096b6567-a3dc-4a40-86e0-50b4242b2fd7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x136156550>]}
[0m23:01:46.071649 [info ] [Thread-1 (]: 2 of 7 OK created sql table model analytics.fsi_apple_summary .................. [[32mSUCCESS 1[0m in 1.55s]
[0m23:01:46.072523 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_apple_summary
[0m23:01:46.073032 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_integ_summary
[0m23:01:46.073652 [info ] [Thread-1 (]: 3 of 7 START sql table model analytics.fsi_integ_summary ....................... [RUN]
[0m23:01:46.074269 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_apple_summary, now model.build_fda.fsi_integ_summary)
[0m23:01:46.074670 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_integ_summary
[0m23:01:46.077809 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_integ_summary"
[0m23:01:46.078594 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_integ_summary
[0m23:01:46.082686 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_integ_summary"
[0m23:01:46.084147 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_integ_summary"
[0m23:01:46.084534 [debug] [Thread-1 (]: On model.build_fda.fsi_integ_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_integ_summary"} */
create or replace transient table dev.analytics.fsi_integ_summary
         as
        (WITH interval_widths AS (
    SELECT
        ts,
        forecast,
        lower_bound,
        upper_bound,
        series,
        (upper_bound - lower_bound) AS interval_width
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
),

statistics AS (
    SELECT
        series,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM interval_widths
    GROUP BY series
)

SELECT
    a.ts,
    a.series,
    a.forecast,
    a.lower_bound,
    a.upper_bound,
    a.interval_width,
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM interval_widths a
JOIN statistics s
    ON a.series = s.series
ORDER BY a.ts
        );
[0m23:01:46.132397 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:01:47.355236 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.270 seconds
[0m23:01:47.362580 [debug] [Thread-1 (]: On model.build_fda.fsi_integ_summary: Close
[0m23:01:47.479850 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '096b6567-a3dc-4a40-86e0-50b4242b2fd7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x125ce1550>]}
[0m23:01:47.481679 [info ] [Thread-1 (]: 3 of 7 OK created sql table model analytics.fsi_integ_summary .................. [[32mSUCCESS 1[0m in 1.41s]
[0m23:01:47.482966 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_integ_summary
[0m23:01:47.483538 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_nvidia_summary
[0m23:01:47.484199 [info ] [Thread-1 (]: 4 of 7 START sql table model analytics.fsi_nvidia_summary ...................... [RUN]
[0m23:01:47.484735 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_integ_summary, now model.build_fda.fsi_nvidia_summary)
[0m23:01:47.485082 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_nvidia_summary
[0m23:01:47.488051 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_nvidia_summary"
[0m23:01:47.488799 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_nvidia_summary
[0m23:01:47.491061 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_nvidia_summary"
[0m23:01:47.492276 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_nvidia_summary"
[0m23:01:47.492601 [debug] [Thread-1 (]: On model.build_fda.fsi_nvidia_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_nvidia_summary"} */
create or replace transient table dev.analytics.fsi_nvidia_summary
         as
        (WITH nvidia_interval_widths AS (
    SELECT
        ts,
        forecast,
        lower_bound,
        upper_bound,
        series,
        (upper_bound - lower_bound) AS interval_width
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
    WHERE series = 'NVDA'  -- Filter for Nvidia symbol
),

statistics AS (
    SELECT
        series,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM nvidia_interval_widths
    GROUP BY series
)

SELECT
    n.ts,
    n.series,
    n.forecast,
    n.lower_bound,
    n.upper_bound,
    n.interval_width,
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM nvidia_interval_widths n
JOIN statistics s
    ON n.series = s.series
ORDER BY n.ts
        );
[0m23:01:47.492898 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:01:48.922379 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.429 seconds
[0m23:01:48.928752 [debug] [Thread-1 (]: On model.build_fda.fsi_nvidia_summary: Close
[0m23:01:49.053457 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '096b6567-a3dc-4a40-86e0-50b4242b2fd7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106a8b050>]}
[0m23:01:49.054628 [info ] [Thread-1 (]: 4 of 7 OK created sql table model analytics.fsi_nvidia_summary ................. [[32mSUCCESS 1[0m in 1.57s]
[0m23:01:49.055365 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_nvidia_summary
[0m23:01:49.055867 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_stock_summary
[0m23:01:49.056327 [info ] [Thread-1 (]: 5 of 7 START sql table model analytics.fsi_stock_summary ....................... [RUN]
[0m23:01:49.056923 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_nvidia_summary, now model.build_fda.fsi_stock_summary)
[0m23:01:49.057412 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_stock_summary
[0m23:01:49.061273 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_stock_summary"
[0m23:01:49.062260 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_stock_summary
[0m23:01:49.064879 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_stock_summary"
[0m23:01:49.066267 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_stock_summary"
[0m23:01:49.066613 [debug] [Thread-1 (]: On model.build_fda.fsi_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_stock_summary"} */
create or replace transient table dev.analytics.fsi_stock_summary
         as
        (WITH apple_interval_widths AS (
    SELECT
        ts,
        forecast,
        lower_bound,
        upper_bound,
        series,
        (upper_bound - lower_bound) AS interval_width
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
    WHERE series = 'AAPL'  -- Filter for Apple symbol
),

statistics AS (
    SELECT
        series,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM apple_interval_widths
    GROUP BY series
)

SELECT
    a.ts,
    a.series,
    a.forecast,
    a.lower_bound,
    a.upper_bound,
    a.interval_width,
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM apple_interval_widths a
JOIN statistics s
    ON a.series = s.series
ORDER BY a.ts
        );
[0m23:01:49.066928 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:01:50.225702 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.158 seconds
[0m23:01:50.232259 [debug] [Thread-1 (]: On model.build_fda.fsi_stock_summary: Close
[0m23:01:50.342807 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '096b6567-a3dc-4a40-86e0-50b4242b2fd7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106f53710>]}
[0m23:01:50.343677 [info ] [Thread-1 (]: 5 of 7 OK created sql table model analytics.fsi_stock_summary .................. [[32mSUCCESS 1[0m in 1.29s]
[0m23:01:50.344339 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_stock_summary
[0m23:01:50.344824 [debug] [Thread-1 (]: Began running node model.build_fda.obv_apple_summary
[0m23:01:50.345431 [info ] [Thread-1 (]: 6 of 7 START sql table model analytics.obv_apple_summary ....................... [RUN]
[0m23:01:50.345995 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_stock_summary, now model.build_fda.obv_apple_summary)
[0m23:01:50.346398 [debug] [Thread-1 (]: Began compiling node model.build_fda.obv_apple_summary
[0m23:01:50.350213 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.obv_apple_summary"
[0m23:01:50.351193 [debug] [Thread-1 (]: Began executing node model.build_fda.obv_apple_summary
[0m23:01:50.353790 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.obv_apple_summary"
[0m23:01:50.355293 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.obv_apple_summary"
[0m23:01:50.355625 [debug] [Thread-1 (]: On model.build_fda.obv_apple_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.obv_apple_summary"} */
create or replace transient table dev.analytics.obv_apple_summary
         as
        (WITH ordered_data AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM dev.raw_data.stock_data -- Referencing the raw data table in the dev database
    WHERE symbol = 'AAPL'  -- Filter for Apple symbol
),

obv_calculation AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        CASE
            WHEN close > LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN volume
            WHEN close < LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN -volume
            ELSE 0
        END AS volume_change
    FROM ordered_data
),

cumulative_obv AS (
    SELECT
        date,
        symbol,
        SUM(volume_change) OVER (PARTITION BY symbol ORDER BY date) AS obv
    FROM obv_calculation
)

SELECT
    date,
    symbol,
    obv
FROM cumulative_obv
ORDER BY date
        );
[0m23:01:50.355930 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:01:51.651061 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.295 seconds
[0m23:01:51.654786 [debug] [Thread-1 (]: On model.build_fda.obv_apple_summary: Close
[0m23:01:51.768327 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '096b6567-a3dc-4a40-86e0-50b4242b2fd7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x134fb5cd0>]}
[0m23:01:51.769437 [info ] [Thread-1 (]: 6 of 7 OK created sql table model analytics.obv_apple_summary .................. [[32mSUCCESS 1[0m in 1.42s]
[0m23:01:51.770258 [debug] [Thread-1 (]: Finished running node model.build_fda.obv_apple_summary
[0m23:01:51.770862 [debug] [Thread-1 (]: Began running node model.build_fda.obv_nvidia_summary
[0m23:01:51.771581 [info ] [Thread-1 (]: 7 of 7 START sql table model analytics.obv_nvidia_summary ...................... [RUN]
[0m23:01:51.772246 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.obv_apple_summary, now model.build_fda.obv_nvidia_summary)
[0m23:01:51.772729 [debug] [Thread-1 (]: Began compiling node model.build_fda.obv_nvidia_summary
[0m23:01:51.776737 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.obv_nvidia_summary"
[0m23:01:51.777824 [debug] [Thread-1 (]: Began executing node model.build_fda.obv_nvidia_summary
[0m23:01:51.782773 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.obv_nvidia_summary"
[0m23:01:51.784309 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.obv_nvidia_summary"
[0m23:01:51.784674 [debug] [Thread-1 (]: On model.build_fda.obv_nvidia_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.obv_nvidia_summary"} */
create or replace transient table dev.analytics.obv_nvidia_summary
         as
        (WITH ordered_data AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM dev.raw_data.stock_data -- Referencing the raw data table in the dev database
    WHERE symbol = 'NVDA'  -- Filter for Nvidia symbol
),

obv_calculation AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        CASE
            WHEN close > LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN volume
            WHEN close < LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN -volume
            ELSE 0
        END AS volume_change
    FROM ordered_data
),

cumulative_obv AS (
    SELECT
        date,
        symbol,
        SUM(volume_change) OVER (PARTITION BY symbol ORDER BY date) AS obv
    FROM obv_calculation
)

SELECT
    date,
    symbol,
    obv
FROM cumulative_obv
ORDER BY date
        );
[0m23:01:51.784977 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:01:53.117473 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.332 seconds
[0m23:01:53.121891 [debug] [Thread-1 (]: On model.build_fda.obv_nvidia_summary: Close
[0m23:01:53.263448 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '096b6567-a3dc-4a40-86e0-50b4242b2fd7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x134c737d0>]}
[0m23:01:53.264327 [info ] [Thread-1 (]: 7 of 7 OK created sql table model analytics.obv_nvidia_summary ................. [[32mSUCCESS 1[0m in 1.49s]
[0m23:01:53.265012 [debug] [Thread-1 (]: Finished running node model.build_fda.obv_nvidia_summary
[0m23:01:53.265511 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data
[0m23:01:53.266068 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.obv_nvidia_summary, now model.build_fda.stock_data)
[0m23:01:53.266531 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data
[0m23:01:53.270273 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data"
[0m23:01:53.271480 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data
[0m23:01:53.271849 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data_forecast
[0m23:01:53.272219 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.stock_data, now model.build_fda.stock_data_forecast)
[0m23:01:53.272519 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data_forecast
[0m23:01:53.274934 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data_forecast"
[0m23:01:53.275774 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data_forecast
[0m23:01:53.277018 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:01:53.277257 [debug] [MainThread]: Connection 'model.build_fda.stock_data_forecast' was properly closed.
[0m23:01:53.277578 [info ] [MainThread]: 
[0m23:01:53.277836 [info ] [MainThread]: Finished running 7 table models in 0 hours 0 minutes and 11.36 seconds (11.36s).
[0m23:01:53.278840 [debug] [MainThread]: Command end result
[0m23:01:53.299758 [info ] [MainThread]: 
[0m23:01:53.300045 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m23:01:53.300220 [info ] [MainThread]: 
[0m23:01:53.300410 [error] [MainThread]:   Database Error in model dmi_apple (models/output/dmi_apple.sql)
  000904 (42000): SQL compilation error: error line 17 at position 34
  invalid identifier 'TS'
  compiled code at target/run/build_fda/models/output/dmi_apple.sql
[0m23:01:53.300571 [info ] [MainThread]: 
[0m23:01:53.300738 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=1 SKIP=0 TOTAL=7
[0m23:01:53.302313 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 12.1702585, "process_user_time": 2.240073, "process_kernel_time": 1.882873, "process_mem_max_rss": "206274560", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m23:01:53.302651 [debug] [MainThread]: Command `dbt run` failed at 23:01:53.302600 after 12.17 seconds
[0m23:01:53.302916 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104d44150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1352588d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109ce2390>]}
[0m23:01:53.303179 [debug] [MainThread]: Flushing usage events
[0m23:04:58.226052 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104d77c50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104da3c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104dc4ad0>]}


============================== 23:04:58.227533 | e0eccba8-ef3c-41f1-9d0a-7e18e2fc6723 ==============================
[0m23:04:58.227533 [info ] [MainThread]: Running with dbt=1.8.7
[0m23:04:58.227861 [debug] [MainThread]: running dbt with arguments {'partial_parse': 'True', 'no_print': 'None', 'use_colors': 'True', 'cache_selected_only': 'False', 'printer_width': '80', 'log_path': '/Users/shatayu/Downloads/DATA226_Lab2Prep/build_fda/logs', 'log_format': 'default', 'quiet': 'False', 'warn_error': 'None', 'profiles_dir': '/Users/shatayu/.dbt', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'version_check': 'True', 'debug': 'False', 'use_experimental_parser': 'False', 'send_anonymous_usage_stats': 'True', 'static_parser': 'True', 'fail_fast': 'False', 'write_json': 'True', 'log_cache_events': 'False', 'indirect_selection': 'eager', 'introspect': 'True', 'empty': 'False', 'invocation_command': 'dbt run'}
[0m23:04:58.732622 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e0eccba8-ef3c-41f1-9d0a-7e18e2fc6723', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a134150>]}
[0m23:04:58.752816 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e0eccba8-ef3c-41f1-9d0a-7e18e2fc6723', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10480d6d0>]}
[0m23:04:58.753218 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m23:04:58.763818 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m23:04:58.824870 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m23:04:58.825253 [debug] [MainThread]: Partial parsing: updated file: build_fda://models/output/dmi_apple.sql
[0m23:04:58.924939 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e0eccba8-ef3c-41f1-9d0a-7e18e2fc6723', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ee5f090>]}
[0m23:04:58.960641 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e0eccba8-ef3c-41f1-9d0a-7e18e2fc6723', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ede3310>]}
[0m23:04:58.960911 [info ] [MainThread]: Found 9 models, 6 sources, 459 macros
[0m23:04:58.961080 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e0eccba8-ef3c-41f1-9d0a-7e18e2fc6723', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ee5d6d0>]}
[0m23:04:58.961977 [info ] [MainThread]: 
[0m23:04:58.962266 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m23:04:58.964292 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m23:04:58.969880 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m23:04:58.970036 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m23:04:58.970164 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:04:59.490225 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.519 seconds
[0m23:04:59.497004 [debug] [ThreadPool]: On list_dev: Close
[0m23:04:59.614412 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_analytics)
[0m23:04:59.623506 [debug] [ThreadPool]: Using snowflake connection "list_dev_analytics"
[0m23:04:59.623835 [debug] [ThreadPool]: On list_dev_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev_analytics"} */
show objects in dev.analytics limit 10000
[0m23:04:59.624073 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:05:00.146066 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.522 seconds
[0m23:05:00.150281 [debug] [ThreadPool]: On list_dev_analytics: Close
[0m23:05:00.293174 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e0eccba8-ef3c-41f1-9d0a-7e18e2fc6723', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ec41dd0>]}
[0m23:05:00.293974 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:05:00.294344 [info ] [MainThread]: 
[0m23:05:00.297329 [debug] [Thread-1 (]: Began running node model.build_fda.dmi_apple
[0m23:05:00.298079 [info ] [Thread-1 (]: 1 of 7 START sql table model analytics.dmi_apple ............................... [RUN]
[0m23:05:00.298635 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_analytics, now model.build_fda.dmi_apple)
[0m23:05:00.299022 [debug] [Thread-1 (]: Began compiling node model.build_fda.dmi_apple
[0m23:05:00.306971 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.dmi_apple"
[0m23:05:00.307949 [debug] [Thread-1 (]: Began executing node model.build_fda.dmi_apple
[0m23:05:00.327603 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.dmi_apple"
[0m23:05:00.328992 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.dmi_apple"
[0m23:05:00.329307 [debug] [Thread-1 (]: On model.build_fda.dmi_apple: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.dmi_apple"} */
create or replace transient table dev.analytics.dmi_apple
         as
        (WITH apple_prices AS (
    SELECT
        date,
        close,
        symbol as series
    FROM dev.raw_data.stock_data
    WHERE series = 'AAPL'
),

-- Calculate the 20-day SMA and 20-day standard deviation
sma_stddev AS (
    SELECT
        date,
        close,
        AVG(close) OVER (ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS middle_band,
        STDDEV(close) OVER (ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS stddev_20
    FROM apple_prices
),

-- Calculate the upper and lower bands
bands AS (
    SELECT
        date,
        close,
        middle_band,
        (middle_band + (2 * stddev_20)) AS upper_band,
        (middle_band - (2 * stddev_20)) AS lower_band
    FROM sma_stddev
),

-- Calculate +DI and -DI based on daily price movements
directional_indicators AS (
    SELECT
        date,
        close,
        middle_band,
        upper_band,
        lower_band,
        LAG(close, 1) OVER (ORDER BY date) AS prev_close,
        -- +DI: Calculate positive movement
        CASE WHEN close > prev_close THEN close - prev_close ELSE 0 END AS plus_di,
        -- -DI: Calculate negative movement
        CASE WHEN close < prev_close THEN prev_close - close ELSE 0 END AS minus_di
    FROM bands
)

SELECT
    date,
    close,
    middle_band,
    upper_band,
    lower_band,
    -- Summing up DI over the 20-day period for smoother trend analysis
    SUM(plus_di) OVER (ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS plus_di_twenty,
    SUM(minus_di) OVER (ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS minus_di_twenty
FROM directional_indicators
ORDER BY date
        );
[0m23:05:00.329568 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:05:01.628039 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.298 seconds
[0m23:05:01.649838 [debug] [Thread-1 (]: On model.build_fda.dmi_apple: Close
[0m23:05:01.812927 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e0eccba8-ef3c-41f1-9d0a-7e18e2fc6723', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ef24110>]}
[0m23:05:01.814379 [info ] [Thread-1 (]: 1 of 7 OK created sql table model analytics.dmi_apple .......................... [[32mSUCCESS 1[0m in 1.51s]
[0m23:05:01.815444 [debug] [Thread-1 (]: Finished running node model.build_fda.dmi_apple
[0m23:05:01.816019 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_apple_summary
[0m23:05:01.816814 [info ] [Thread-1 (]: 2 of 7 START sql table model analytics.fsi_apple_summary ....................... [RUN]
[0m23:05:01.817449 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.dmi_apple, now model.build_fda.fsi_apple_summary)
[0m23:05:01.817856 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_apple_summary
[0m23:05:01.821764 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_apple_summary"
[0m23:05:01.822736 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_apple_summary
[0m23:05:01.825486 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_apple_summary"
[0m23:05:01.827119 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_apple_summary"
[0m23:05:01.827777 [debug] [Thread-1 (]: On model.build_fda.fsi_apple_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_apple_summary"} */
create or replace transient table dev.analytics.fsi_apple_summary
         as
        (WITH apple_interval_widths AS (
    SELECT
        ts,
        forecast,
        lower_bound,
        upper_bound,
        series,
        (upper_bound - lower_bound) AS interval_width
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
    WHERE series = 'AAPL'  -- Filter for Apple symbol
),

statistics AS (
    SELECT
        series,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM apple_interval_widths
    GROUP BY series
)

SELECT
    a.ts,
    a.series,
    a.forecast,
    a.lower_bound,
    a.upper_bound,
    a.interval_width,
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM apple_interval_widths a
JOIN statistics s
    ON a.series = s.series
ORDER BY a.ts
        );
[0m23:05:01.828165 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:05:03.590959 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.762 seconds
[0m23:05:03.597941 [debug] [Thread-1 (]: On model.build_fda.fsi_apple_summary: Close
[0m23:05:03.708256 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e0eccba8-ef3c-41f1-9d0a-7e18e2fc6723', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f151a50>]}
[0m23:05:03.709387 [info ] [Thread-1 (]: 2 of 7 OK created sql table model analytics.fsi_apple_summary .................. [[32mSUCCESS 1[0m in 1.89s]
[0m23:05:03.710245 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_apple_summary
[0m23:05:03.710817 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_integ_summary
[0m23:05:03.711542 [info ] [Thread-1 (]: 3 of 7 START sql table model analytics.fsi_integ_summary ....................... [RUN]
[0m23:05:03.712229 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_apple_summary, now model.build_fda.fsi_integ_summary)
[0m23:05:03.712656 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_integ_summary
[0m23:05:03.718556 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_integ_summary"
[0m23:05:03.719545 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_integ_summary
[0m23:05:03.794937 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_integ_summary"
[0m23:05:03.795894 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_integ_summary"
[0m23:05:03.796090 [debug] [Thread-1 (]: On model.build_fda.fsi_integ_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_integ_summary"} */
create or replace transient table dev.analytics.fsi_integ_summary
         as
        (WITH interval_widths AS (
    SELECT
        ts,
        forecast,
        lower_bound,
        upper_bound,
        series,
        (upper_bound - lower_bound) AS interval_width
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
),

statistics AS (
    SELECT
        series,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM interval_widths
    GROUP BY series
)

SELECT
    a.ts,
    a.series,
    a.forecast,
    a.lower_bound,
    a.upper_bound,
    a.interval_width,
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM interval_widths a
JOIN statistics s
    ON a.series = s.series
ORDER BY a.ts
        );
[0m23:05:03.796262 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:05:05.314307 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.517 seconds
[0m23:05:05.318389 [debug] [Thread-1 (]: On model.build_fda.fsi_integ_summary: Close
[0m23:05:05.454518 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e0eccba8-ef3c-41f1-9d0a-7e18e2fc6723', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11f18cf50>]}
[0m23:05:05.456210 [info ] [Thread-1 (]: 3 of 7 OK created sql table model analytics.fsi_integ_summary .................. [[32mSUCCESS 1[0m in 1.74s]
[0m23:05:05.457069 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_integ_summary
[0m23:05:05.457605 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_nvidia_summary
[0m23:05:05.458176 [info ] [Thread-1 (]: 4 of 7 START sql table model analytics.fsi_nvidia_summary ...................... [RUN]
[0m23:05:05.458724 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_integ_summary, now model.build_fda.fsi_nvidia_summary)
[0m23:05:05.459089 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_nvidia_summary
[0m23:05:05.462724 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_nvidia_summary"
[0m23:05:05.463711 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_nvidia_summary
[0m23:05:05.466029 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_nvidia_summary"
[0m23:05:05.467363 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_nvidia_summary"
[0m23:05:05.467704 [debug] [Thread-1 (]: On model.build_fda.fsi_nvidia_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_nvidia_summary"} */
create or replace transient table dev.analytics.fsi_nvidia_summary
         as
        (WITH nvidia_interval_widths AS (
    SELECT
        ts,
        forecast,
        lower_bound,
        upper_bound,
        series,
        (upper_bound - lower_bound) AS interval_width
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
    WHERE series = 'NVDA'  -- Filter for Nvidia symbol
),

statistics AS (
    SELECT
        series,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM nvidia_interval_widths
    GROUP BY series
)

SELECT
    n.ts,
    n.series,
    n.forecast,
    n.lower_bound,
    n.upper_bound,
    n.interval_width,
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM nvidia_interval_widths n
JOIN statistics s
    ON n.series = s.series
ORDER BY n.ts
        );
[0m23:05:05.468013 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:05:06.748053 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.279 seconds
[0m23:05:06.754154 [debug] [Thread-1 (]: On model.build_fda.fsi_nvidia_summary: Close
[0m23:05:06.924713 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e0eccba8-ef3c-41f1-9d0a-7e18e2fc6723', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11eae0550>]}
[0m23:05:06.925701 [info ] [Thread-1 (]: 4 of 7 OK created sql table model analytics.fsi_nvidia_summary ................. [[32mSUCCESS 1[0m in 1.47s]
[0m23:05:06.926502 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_nvidia_summary
[0m23:05:06.927001 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_stock_summary
[0m23:05:06.927458 [info ] [Thread-1 (]: 5 of 7 START sql table model analytics.fsi_stock_summary ....................... [RUN]
[0m23:05:06.928054 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_nvidia_summary, now model.build_fda.fsi_stock_summary)
[0m23:05:06.928542 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_stock_summary
[0m23:05:06.932647 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_stock_summary"
[0m23:05:06.933622 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_stock_summary
[0m23:05:06.936238 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_stock_summary"
[0m23:05:06.937697 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_stock_summary"
[0m23:05:06.938087 [debug] [Thread-1 (]: On model.build_fda.fsi_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_stock_summary"} */
create or replace transient table dev.analytics.fsi_stock_summary
         as
        (WITH apple_interval_widths AS (
    SELECT
        ts,
        forecast,
        lower_bound,
        upper_bound,
        series,
        (upper_bound - lower_bound) AS interval_width
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
    WHERE series = 'AAPL'  -- Filter for Apple symbol
),

statistics AS (
    SELECT
        series,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM apple_interval_widths
    GROUP BY series
)

SELECT
    a.ts,
    a.series,
    a.forecast,
    a.lower_bound,
    a.upper_bound,
    a.interval_width,
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM apple_interval_widths a
JOIN statistics s
    ON a.series = s.series
ORDER BY a.ts
        );
[0m23:05:06.938435 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:05:08.068221 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.129 seconds
[0m23:05:08.072567 [debug] [Thread-1 (]: On model.build_fda.fsi_stock_summary: Close
[0m23:05:08.229385 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e0eccba8-ef3c-41f1-9d0a-7e18e2fc6723', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ee2e150>]}
[0m23:05:08.230786 [info ] [Thread-1 (]: 5 of 7 OK created sql table model analytics.fsi_stock_summary .................. [[32mSUCCESS 1[0m in 1.30s]
[0m23:05:08.231483 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_stock_summary
[0m23:05:08.232000 [debug] [Thread-1 (]: Began running node model.build_fda.obv_apple_summary
[0m23:05:08.232466 [info ] [Thread-1 (]: 6 of 7 START sql table model analytics.obv_apple_summary ....................... [RUN]
[0m23:05:08.233095 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_stock_summary, now model.build_fda.obv_apple_summary)
[0m23:05:08.233579 [debug] [Thread-1 (]: Began compiling node model.build_fda.obv_apple_summary
[0m23:05:08.237601 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.obv_apple_summary"
[0m23:05:08.238538 [debug] [Thread-1 (]: Began executing node model.build_fda.obv_apple_summary
[0m23:05:08.241199 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.obv_apple_summary"
[0m23:05:08.242697 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.obv_apple_summary"
[0m23:05:08.243057 [debug] [Thread-1 (]: On model.build_fda.obv_apple_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.obv_apple_summary"} */
create or replace transient table dev.analytics.obv_apple_summary
         as
        (WITH ordered_data AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM dev.raw_data.stock_data -- Referencing the raw data table in the dev database
    WHERE symbol = 'AAPL'  -- Filter for Apple symbol
),

obv_calculation AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        CASE
            WHEN close > LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN volume
            WHEN close < LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN -volume
            ELSE 0
        END AS volume_change
    FROM ordered_data
),

cumulative_obv AS (
    SELECT
        date,
        symbol,
        SUM(volume_change) OVER (PARTITION BY symbol ORDER BY date) AS obv
    FROM obv_calculation
)

SELECT
    date,
    symbol,
    obv
FROM cumulative_obv
ORDER BY date
        );
[0m23:05:08.243371 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:05:09.717169 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.473 seconds
[0m23:05:09.721229 [debug] [Thread-1 (]: On model.build_fda.obv_apple_summary: Close
[0m23:05:09.867538 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e0eccba8-ef3c-41f1-9d0a-7e18e2fc6723', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102e3f210>]}
[0m23:05:09.868612 [info ] [Thread-1 (]: 6 of 7 OK created sql table model analytics.obv_apple_summary .................. [[32mSUCCESS 1[0m in 1.63s]
[0m23:05:09.869439 [debug] [Thread-1 (]: Finished running node model.build_fda.obv_apple_summary
[0m23:05:09.870037 [debug] [Thread-1 (]: Began running node model.build_fda.obv_nvidia_summary
[0m23:05:09.870606 [info ] [Thread-1 (]: 7 of 7 START sql table model analytics.obv_nvidia_summary ...................... [RUN]
[0m23:05:09.871319 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.obv_apple_summary, now model.build_fda.obv_nvidia_summary)
[0m23:05:09.871817 [debug] [Thread-1 (]: Began compiling node model.build_fda.obv_nvidia_summary
[0m23:05:09.878167 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.obv_nvidia_summary"
[0m23:05:09.880472 [debug] [Thread-1 (]: Began executing node model.build_fda.obv_nvidia_summary
[0m23:05:09.883156 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.obv_nvidia_summary"
[0m23:05:09.884718 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.obv_nvidia_summary"
[0m23:05:09.885115 [debug] [Thread-1 (]: On model.build_fda.obv_nvidia_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.obv_nvidia_summary"} */
create or replace transient table dev.analytics.obv_nvidia_summary
         as
        (WITH ordered_data AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM dev.raw_data.stock_data -- Referencing the raw data table in the dev database
    WHERE symbol = 'NVDA'  -- Filter for Nvidia symbol
),

obv_calculation AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        CASE
            WHEN close > LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN volume
            WHEN close < LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN -volume
            ELSE 0
        END AS volume_change
    FROM ordered_data
),

cumulative_obv AS (
    SELECT
        date,
        symbol,
        SUM(volume_change) OVER (PARTITION BY symbol ORDER BY date) AS obv
    FROM obv_calculation
)

SELECT
    date,
    symbol,
    obv
FROM cumulative_obv
ORDER BY date
        );
[0m23:05:09.885431 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:05:11.150099 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.264 seconds
[0m23:05:11.156129 [debug] [Thread-1 (]: On model.build_fda.obv_nvidia_summary: Close
[0m23:05:11.272404 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e0eccba8-ef3c-41f1-9d0a-7e18e2fc6723', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1057ce810>]}
[0m23:05:11.273256 [info ] [Thread-1 (]: 7 of 7 OK created sql table model analytics.obv_nvidia_summary ................. [[32mSUCCESS 1[0m in 1.40s]
[0m23:05:11.273913 [debug] [Thread-1 (]: Finished running node model.build_fda.obv_nvidia_summary
[0m23:05:11.274383 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data
[0m23:05:11.274926 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.obv_nvidia_summary, now model.build_fda.stock_data)
[0m23:05:11.275391 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data
[0m23:05:11.278972 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data"
[0m23:05:11.280112 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data
[0m23:05:11.280480 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data_forecast
[0m23:05:11.280855 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.stock_data, now model.build_fda.stock_data_forecast)
[0m23:05:11.281156 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data_forecast
[0m23:05:11.283426 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data_forecast"
[0m23:05:11.284139 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data_forecast
[0m23:05:11.285265 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:05:11.285502 [debug] [MainThread]: Connection 'model.build_fda.stock_data_forecast' was properly closed.
[0m23:05:11.285813 [info ] [MainThread]: 
[0m23:05:11.286075 [info ] [MainThread]: Finished running 7 table models in 0 hours 0 minutes and 12.32 seconds (12.32s).
[0m23:05:11.287062 [debug] [MainThread]: Command end result
[0m23:05:11.308841 [info ] [MainThread]: 
[0m23:05:11.309124 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:05:11.309302 [info ] [MainThread]: 
[0m23:05:11.309624 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m23:05:11.311327 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 13.13068, "process_user_time": 2.271171, "process_kernel_time": 1.863365, "process_mem_max_rss": "205914112", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m23:05:11.311675 [debug] [MainThread]: Command `dbt run` succeeded at 23:05:11.311619 after 13.13 seconds
[0m23:05:11.311900 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104dc7ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10098c150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104d77950>]}
[0m23:05:11.312116 [debug] [MainThread]: Flushing usage events
[0m23:44:35.327682 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104a6c710>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105967bd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10595bb50>]}


============================== 23:44:35.329592 | 65ca8e44-3fd1-4bad-a4d4-e26651ebc8fa ==============================
[0m23:44:35.329592 [info ] [MainThread]: Running with dbt=1.8.7
[0m23:44:35.329915 [debug] [MainThread]: running dbt with arguments {'no_print': 'None', 'use_experimental_parser': 'False', 'log_path': '/Users/shatayu/Downloads/DATA226_Lab2Prep/build_fda/logs', 'warn_error': 'None', 'indirect_selection': 'eager', 'log_format': 'default', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'write_json': 'True', 'printer_width': '80', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True', 'log_cache_events': 'False', 'empty': 'False', 'fail_fast': 'False', 'static_parser': 'True', 'cache_selected_only': 'False', 'use_colors': 'True', 'debug': 'False', 'invocation_command': 'dbt run', 'version_check': 'True', 'quiet': 'False', 'partial_parse': 'True', 'profiles_dir': '/Users/shatayu/.dbt'}
[0m23:44:36.253175 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '65ca8e44-3fd1-4bad-a4d4-e26651ebc8fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a3d8150>]}
[0m23:44:36.273322 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '65ca8e44-3fd1-4bad-a4d4-e26651ebc8fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1053d1550>]}
[0m23:44:36.273901 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m23:44:36.290020 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m23:44:36.367710 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 1 files added, 0 files changed.
[0m23:44:36.368109 [debug] [MainThread]: Partial parsing: added file: build_fda://models/output/dmi_summary.sql
[0m23:44:36.368264 [debug] [MainThread]: Partial parsing: deleted file: build_fda://models/output/dmi_apple.sql
[0m23:44:36.468602 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '65ca8e44-3fd1-4bad-a4d4-e26651ebc8fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e98fd10>]}
[0m23:44:36.509615 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '65ca8e44-3fd1-4bad-a4d4-e26651ebc8fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e84bb10>]}
[0m23:44:36.509903 [info ] [MainThread]: Found 9 models, 6 sources, 459 macros
[0m23:44:36.510064 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '65ca8e44-3fd1-4bad-a4d4-e26651ebc8fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e986850>]}
[0m23:44:36.510973 [info ] [MainThread]: 
[0m23:44:36.511282 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m23:44:36.513318 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m23:44:36.518899 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m23:44:36.519061 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m23:44:36.519189 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:44:38.290848 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 1.771 seconds
[0m23:44:38.294422 [debug] [ThreadPool]: On list_dev: Close
[0m23:44:38.426091 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_analytics)
[0m23:44:38.436957 [debug] [ThreadPool]: Using snowflake connection "list_dev_analytics"
[0m23:44:38.437334 [debug] [ThreadPool]: On list_dev_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev_analytics"} */
show objects in dev.analytics limit 10000
[0m23:44:38.437620 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:44:38.982574 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.544 seconds
[0m23:44:38.988946 [debug] [ThreadPool]: On list_dev_analytics: Close
[0m23:44:39.096819 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '65ca8e44-3fd1-4bad-a4d4-e26651ebc8fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10284ef90>]}
[0m23:44:39.097640 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:44:39.098077 [info ] [MainThread]: 
[0m23:44:39.102351 [debug] [Thread-1 (]: Began running node model.build_fda.dmi_summary
[0m23:44:39.103008 [info ] [Thread-1 (]: 1 of 7 START sql table model analytics.dmi_summary ............................. [RUN]
[0m23:44:39.103521 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_analytics, now model.build_fda.dmi_summary)
[0m23:44:39.103897 [debug] [Thread-1 (]: Began compiling node model.build_fda.dmi_summary
[0m23:44:39.111865 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.dmi_summary"
[0m23:44:39.113020 [debug] [Thread-1 (]: Began executing node model.build_fda.dmi_summary
[0m23:44:39.132554 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.dmi_summary"
[0m23:44:39.134063 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.dmi_summary"
[0m23:44:39.134352 [debug] [Thread-1 (]: On model.build_fda.dmi_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.dmi_summary"} */
create or replace transient table dev.analytics.dmi_summary
         as
        (WITH stock_prices AS (
    SELECT
        date,
        close,
        symbol as series
    FROM dev.raw_data.stock_data
    WHERE series IN ('AAPL', 'NVDA')  -- Including both Apple and Nvidia
),

-- Calculate the 20-day SMA and 20-day standard deviation for both symbols
sma_stddev AS (
    SELECT
        date,
        series,
        close,
        AVG(close) OVER (PARTITION BY series ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS middle_band,
        STDDEV(close) OVER (PARTITION BY series ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS stddev_20
    FROM stock_prices
),

-- Calculate the upper and lower bands
bands AS (
    SELECT
        date,
        series,
        close,
        middle_band,
        (middle_band + (2 * stddev_20)) AS upper_band,
        (middle_band - (2 * stddev_20)) AS lower_band
    FROM sma_stddev
),

-- Calculate +DI and -DI based on daily price movements for each stock symbol
directional_indicators AS (
    SELECT
        date,
        series,
        close,
        middle_band,
        upper_band,
        lower_band,
        LAG(close, 1) OVER (PARTITION BY series ORDER BY date) AS prev_close,
        -- +DI: Calculate positive movement
        CASE WHEN close > prev_close THEN close - prev_close ELSE 0 END AS plus_di,
        -- -DI: Calculate negative movement
        CASE WHEN close < prev_close THEN prev_close - close ELSE 0 END AS minus_di
    FROM bands
)

SELECT
    date,
    series,  -- To differentiate between Apple and Nvidia
    close,
    middle_band,
    upper_band,
    lower_band,
    -- Summing up DI over the 20-day period for smoother trend analysis
    SUM(plus_di) OVER (PARTITION BY series ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS plus_di_twenty,
    SUM(minus_di) OVER (PARTITION BY series ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS minus_di_twenty
FROM directional_indicators
ORDER BY series, date
        );
[0m23:44:39.134725 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:44:40.859362 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.724 seconds
[0m23:44:40.884959 [debug] [Thread-1 (]: On model.build_fda.dmi_summary: Close
[0m23:44:40.999984 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '65ca8e44-3fd1-4bad-a4d4-e26651ebc8fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e6cbd90>]}
[0m23:44:41.001070 [info ] [Thread-1 (]: 1 of 7 OK created sql table model analytics.dmi_summary ........................ [[32mSUCCESS 1[0m in 1.89s]
[0m23:44:41.001909 [debug] [Thread-1 (]: Finished running node model.build_fda.dmi_summary
[0m23:44:41.002514 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_apple_summary
[0m23:44:41.003116 [info ] [Thread-1 (]: 2 of 7 START sql table model analytics.fsi_apple_summary ....................... [RUN]
[0m23:44:41.003717 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.dmi_summary, now model.build_fda.fsi_apple_summary)
[0m23:44:41.004124 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_apple_summary
[0m23:44:41.008021 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_apple_summary"
[0m23:44:41.009532 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_apple_summary
[0m23:44:41.012278 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_apple_summary"
[0m23:44:41.014030 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_apple_summary"
[0m23:44:41.014417 [debug] [Thread-1 (]: On model.build_fda.fsi_apple_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_apple_summary"} */
create or replace transient table dev.analytics.fsi_apple_summary
         as
        (WITH apple_interval_widths AS (
    SELECT
        ts,
        forecast,
        lower_bound,
        upper_bound,
        series,
        (upper_bound - lower_bound) AS interval_width
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
    WHERE series = 'AAPL'  -- Filter for Apple symbol
),

statistics AS (
    SELECT
        series,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM apple_interval_widths
    GROUP BY series
)

SELECT
    a.ts,
    a.series,
    a.forecast,
    a.lower_bound,
    a.upper_bound,
    a.interval_width,
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM apple_interval_widths a
JOIN statistics s
    ON a.series = s.series
ORDER BY a.ts
        );
[0m23:44:41.014774 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:44:42.698341 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.683 seconds
[0m23:44:42.703620 [debug] [Thread-1 (]: On model.build_fda.fsi_apple_summary: Close
[0m23:44:42.847260 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '65ca8e44-3fd1-4bad-a4d4-e26651ebc8fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e5e7ed0>]}
[0m23:44:42.850217 [info ] [Thread-1 (]: 2 of 7 OK created sql table model analytics.fsi_apple_summary .................. [[32mSUCCESS 1[0m in 1.84s]
[0m23:44:42.853185 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_apple_summary
[0m23:44:42.854224 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_integ_summary
[0m23:44:42.855135 [info ] [Thread-1 (]: 3 of 7 START sql table model analytics.fsi_integ_summary ....................... [RUN]
[0m23:44:42.856447 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_apple_summary, now model.build_fda.fsi_integ_summary)
[0m23:44:42.857076 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_integ_summary
[0m23:44:42.867859 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_integ_summary"
[0m23:44:42.869147 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_integ_summary
[0m23:44:42.962868 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_integ_summary"
[0m23:44:42.963819 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_integ_summary"
[0m23:44:42.964120 [debug] [Thread-1 (]: On model.build_fda.fsi_integ_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_integ_summary"} */
create or replace transient table dev.analytics.fsi_integ_summary
         as
        (WITH interval_widths AS (
    SELECT
        ts,
        forecast,
        lower_bound,
        upper_bound,
        series,
        (upper_bound - lower_bound) AS interval_width
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
),

statistics AS (
    SELECT
        series,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM interval_widths
    GROUP BY series
)

SELECT
    a.ts,
    a.series,
    a.forecast,
    a.lower_bound,
    a.upper_bound,
    a.interval_width,
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM interval_widths a
JOIN statistics s
    ON a.series = s.series
ORDER BY a.ts
        );
[0m23:44:42.964450 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:44:44.167922 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.203 seconds
[0m23:44:44.175587 [debug] [Thread-1 (]: On model.build_fda.fsi_integ_summary: Close
[0m23:44:44.295965 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '65ca8e44-3fd1-4bad-a4d4-e26651ebc8fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10197c690>]}
[0m23:44:44.299238 [info ] [Thread-1 (]: 3 of 7 OK created sql table model analytics.fsi_integ_summary .................. [[32mSUCCESS 1[0m in 1.44s]
[0m23:44:44.301014 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_integ_summary
[0m23:44:44.302011 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_nvidia_summary
[0m23:44:44.303154 [info ] [Thread-1 (]: 4 of 7 START sql table model analytics.fsi_nvidia_summary ...................... [RUN]
[0m23:44:44.304238 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_integ_summary, now model.build_fda.fsi_nvidia_summary)
[0m23:44:44.305214 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_nvidia_summary
[0m23:44:44.311545 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_nvidia_summary"
[0m23:44:44.314155 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_nvidia_summary
[0m23:44:44.318710 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_nvidia_summary"
[0m23:44:44.321231 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_nvidia_summary"
[0m23:44:44.321766 [debug] [Thread-1 (]: On model.build_fda.fsi_nvidia_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_nvidia_summary"} */
create or replace transient table dev.analytics.fsi_nvidia_summary
         as
        (WITH nvidia_interval_widths AS (
    SELECT
        ts,
        forecast,
        lower_bound,
        upper_bound,
        series,
        (upper_bound - lower_bound) AS interval_width
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
    WHERE series = 'NVDA'  -- Filter for Nvidia symbol
),

statistics AS (
    SELECT
        series,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM nvidia_interval_widths
    GROUP BY series
)

SELECT
    n.ts,
    n.series,
    n.forecast,
    n.lower_bound,
    n.upper_bound,
    n.interval_width,
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM nvidia_interval_widths n
JOIN statistics s
    ON n.series = s.series
ORDER BY n.ts
        );
[0m23:44:44.322191 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:44:45.568208 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.246 seconds
[0m23:44:45.575715 [debug] [Thread-1 (]: On model.build_fda.fsi_nvidia_summary: Close
[0m23:44:45.687944 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '65ca8e44-3fd1-4bad-a4d4-e26651ebc8fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a3c6150>]}
[0m23:44:45.690325 [info ] [Thread-1 (]: 4 of 7 OK created sql table model analytics.fsi_nvidia_summary ................. [[32mSUCCESS 1[0m in 1.38s]
[0m23:44:45.691395 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_nvidia_summary
[0m23:44:45.692125 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_stock_summary
[0m23:44:45.692914 [info ] [Thread-1 (]: 5 of 7 START sql table model analytics.fsi_stock_summary ....................... [RUN]
[0m23:44:45.693622 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_nvidia_summary, now model.build_fda.fsi_stock_summary)
[0m23:44:45.694121 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_stock_summary
[0m23:44:45.702400 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_stock_summary"
[0m23:44:45.704419 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_stock_summary
[0m23:44:45.709833 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_stock_summary"
[0m23:44:45.712332 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_stock_summary"
[0m23:44:45.712923 [debug] [Thread-1 (]: On model.build_fda.fsi_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_stock_summary"} */
create or replace transient table dev.analytics.fsi_stock_summary
         as
        (WITH apple_interval_widths AS (
    SELECT
        ts,
        forecast,
        lower_bound,
        upper_bound,
        series,
        (upper_bound - lower_bound) AS interval_width
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
    WHERE series = 'AAPL'  -- Filter for Apple symbol
),

statistics AS (
    SELECT
        series,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM apple_interval_widths
    GROUP BY series
)

SELECT
    a.ts,
    a.series,
    a.forecast,
    a.lower_bound,
    a.upper_bound,
    a.interval_width,
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM apple_interval_widths a
JOIN statistics s
    ON a.series = s.series
ORDER BY a.ts
        );
[0m23:44:45.713443 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:44:47.000727 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.287 seconds
[0m23:44:47.006220 [debug] [Thread-1 (]: On model.build_fda.fsi_stock_summary: Close
[0m23:44:47.119619 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '65ca8e44-3fd1-4bad-a4d4-e26651ebc8fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x101748410>]}
[0m23:44:47.121442 [info ] [Thread-1 (]: 5 of 7 OK created sql table model analytics.fsi_stock_summary .................. [[32mSUCCESS 1[0m in 1.43s]
[0m23:44:47.123021 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_stock_summary
[0m23:44:47.124142 [debug] [Thread-1 (]: Began running node model.build_fda.obv_apple_summary
[0m23:44:47.125120 [info ] [Thread-1 (]: 6 of 7 START sql table model analytics.obv_apple_summary ....................... [RUN]
[0m23:44:47.125920 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_stock_summary, now model.build_fda.obv_apple_summary)
[0m23:44:47.126571 [debug] [Thread-1 (]: Began compiling node model.build_fda.obv_apple_summary
[0m23:44:47.133007 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.obv_apple_summary"
[0m23:44:47.134483 [debug] [Thread-1 (]: Began executing node model.build_fda.obv_apple_summary
[0m23:44:47.137549 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.obv_apple_summary"
[0m23:44:47.138782 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.obv_apple_summary"
[0m23:44:47.139077 [debug] [Thread-1 (]: On model.build_fda.obv_apple_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.obv_apple_summary"} */
create or replace transient table dev.analytics.obv_apple_summary
         as
        (WITH ordered_data AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM dev.raw_data.stock_data -- Referencing the raw data table in the dev database
    WHERE symbol = 'AAPL'  -- Filter for Apple symbol
),

obv_calculation AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        CASE
            WHEN close > LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN volume
            WHEN close < LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN -volume
            ELSE 0
        END AS volume_change
    FROM ordered_data
),

cumulative_obv AS (
    SELECT
        date,
        symbol,
        SUM(volume_change) OVER (PARTITION BY symbol ORDER BY date) AS obv
    FROM obv_calculation
)

SELECT
    date,
    symbol,
    obv
FROM cumulative_obv
ORDER BY date
        );
[0m23:44:47.139328 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:44:48.121295 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.982 seconds
[0m23:44:48.127035 [debug] [Thread-1 (]: On model.build_fda.obv_apple_summary: Close
[0m23:44:48.232263 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '65ca8e44-3fd1-4bad-a4d4-e26651ebc8fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1052a0510>]}
[0m23:44:48.233498 [info ] [Thread-1 (]: 6 of 7 OK created sql table model analytics.obv_apple_summary .................. [[32mSUCCESS 1[0m in 1.11s]
[0m23:44:48.234320 [debug] [Thread-1 (]: Finished running node model.build_fda.obv_apple_summary
[0m23:44:48.234980 [debug] [Thread-1 (]: Began running node model.build_fda.obv_nvidia_summary
[0m23:44:48.236189 [info ] [Thread-1 (]: 7 of 7 START sql table model analytics.obv_nvidia_summary ...................... [RUN]
[0m23:44:48.237360 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.obv_apple_summary, now model.build_fda.obv_nvidia_summary)
[0m23:44:48.238282 [debug] [Thread-1 (]: Began compiling node model.build_fda.obv_nvidia_summary
[0m23:44:48.248159 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.obv_nvidia_summary"
[0m23:44:48.249986 [debug] [Thread-1 (]: Began executing node model.build_fda.obv_nvidia_summary
[0m23:44:48.253523 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.obv_nvidia_summary"
[0m23:44:48.255384 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.obv_nvidia_summary"
[0m23:44:48.255976 [debug] [Thread-1 (]: On model.build_fda.obv_nvidia_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.obv_nvidia_summary"} */
create or replace transient table dev.analytics.obv_nvidia_summary
         as
        (WITH ordered_data AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM dev.raw_data.stock_data -- Referencing the raw data table in the dev database
    WHERE symbol = 'NVDA'  -- Filter for Nvidia symbol
),

obv_calculation AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        CASE
            WHEN close > LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN volume
            WHEN close < LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN -volume
            ELSE 0
        END AS volume_change
    FROM ordered_data
),

cumulative_obv AS (
    SELECT
        date,
        symbol,
        SUM(volume_change) OVER (PARTITION BY symbol ORDER BY date) AS obv
    FROM obv_calculation
)

SELECT
    date,
    symbol,
    obv
FROM cumulative_obv
ORDER BY date
        );
[0m23:44:48.256490 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:44:49.665259 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.408 seconds
[0m23:44:49.671576 [debug] [Thread-1 (]: On model.build_fda.obv_nvidia_summary: Close
[0m23:44:49.785783 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '65ca8e44-3fd1-4bad-a4d4-e26651ebc8fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103bb6b50>]}
[0m23:44:49.788403 [info ] [Thread-1 (]: 7 of 7 OK created sql table model analytics.obv_nvidia_summary ................. [[32mSUCCESS 1[0m in 1.55s]
[0m23:44:49.790211 [debug] [Thread-1 (]: Finished running node model.build_fda.obv_nvidia_summary
[0m23:44:49.791215 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data
[0m23:44:49.792227 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.obv_nvidia_summary, now model.build_fda.stock_data)
[0m23:44:49.792937 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data
[0m23:44:49.800744 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data"
[0m23:44:49.803223 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data
[0m23:44:49.803806 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data_forecast
[0m23:44:49.804320 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.stock_data, now model.build_fda.stock_data_forecast)
[0m23:44:49.804738 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data_forecast
[0m23:44:49.808236 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data_forecast"
[0m23:44:49.809391 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data_forecast
[0m23:44:49.810902 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:44:49.811389 [debug] [MainThread]: Connection 'model.build_fda.stock_data_forecast' was properly closed.
[0m23:44:49.811931 [info ] [MainThread]: 
[0m23:44:49.812374 [info ] [MainThread]: Finished running 7 table models in 0 hours 0 minutes and 13.30 seconds (13.30s).
[0m23:44:49.814020 [debug] [MainThread]: Command end result
[0m23:44:49.842605 [info ] [MainThread]: 
[0m23:44:49.842982 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:44:49.843205 [info ] [MainThread]: 
[0m23:44:49.843428 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m23:44:49.845790 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 14.569035, "process_user_time": 2.571991, "process_kernel_time": 1.767215, "process_mem_max_rss": "203702272", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m23:44:49.846146 [debug] [MainThread]: Command `dbt run` succeeded at 23:44:49.846089 after 14.57 seconds
[0m23:44:49.846387 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x101550150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10159b450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10159b4d0>]}
[0m23:44:49.846624 [debug] [MainThread]: Flushing usage events
[0m11:29:46.238536 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1070f9e90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107ddbbd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107ddbc10>]}


============================== 11:29:46.240564 | 1abf6835-ddc4-45a6-8a2c-cce8f7e51f60 ==============================
[0m11:29:46.240564 [info ] [MainThread]: Running with dbt=1.8.7
[0m11:29:46.240911 [debug] [MainThread]: running dbt with arguments {'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'use_experimental_parser': 'False', 'printer_width': '80', 'empty': 'False', 'introspect': 'True', 'version_check': 'True', 'quiet': 'False', 'fail_fast': 'False', 'log_cache_events': 'False', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'profiles_dir': '/Users/shatayu/.dbt', 'warn_error': 'None', 'write_json': 'True', 'target_path': 'None', 'use_colors': 'True', 'log_path': '/Users/shatayu/Downloads/DATA226_Lab2Prep/build_fda/logs', 'no_print': 'None', 'log_format': 'default', 'debug': 'False', 'partial_parse': 'True', 'invocation_command': 'dbt run', 'cache_selected_only': 'False', 'indirect_selection': 'eager'}
[0m11:29:47.179023 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1abf6835-ddc4-45a6-8a2c-cce8f7e51f60', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107dfffd0>]}
[0m11:29:47.199336 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1abf6835-ddc4-45a6-8a2c-cce8f7e51f60', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107745890>]}
[0m11:29:47.199931 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m11:29:47.213062 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m11:29:47.284771 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m11:29:47.285145 [debug] [MainThread]: Partial parsing: updated file: build_fda://models/output/fsi_integ_summary.sql
[0m11:29:47.386953 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1abf6835-ddc4-45a6-8a2c-cce8f7e51f60', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14ba23190>]}
[0m11:29:47.429228 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1abf6835-ddc4-45a6-8a2c-cce8f7e51f60', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14baae610>]}
[0m11:29:47.429513 [info ] [MainThread]: Found 9 models, 6 sources, 459 macros
[0m11:29:47.429675 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1abf6835-ddc4-45a6-8a2c-cce8f7e51f60', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b819350>]}
[0m11:29:47.430612 [info ] [MainThread]: 
[0m11:29:47.430900 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m11:29:47.432919 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m11:29:47.438479 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m11:29:47.438635 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m11:29:47.438762 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:29:48.011298 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.572 seconds
[0m11:29:48.016947 [debug] [ThreadPool]: On list_dev: Close
[0m11:29:48.140546 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_analytics)
[0m11:29:48.151692 [debug] [ThreadPool]: Using snowflake connection "list_dev_analytics"
[0m11:29:48.152102 [debug] [ThreadPool]: On list_dev_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev_analytics"} */
show objects in dev.analytics limit 10000
[0m11:29:48.152366 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:29:48.658104 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.505 seconds
[0m11:29:48.662009 [debug] [ThreadPool]: On list_dev_analytics: Close
[0m11:29:48.789257 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1abf6835-ddc4-45a6-8a2c-cce8f7e51f60', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b9cd890>]}
[0m11:29:48.790264 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m11:29:48.790759 [info ] [MainThread]: 
[0m11:29:48.795178 [debug] [Thread-1 (]: Began running node model.build_fda.dmi_summary
[0m11:29:48.795827 [info ] [Thread-1 (]: 1 of 7 START sql table model analytics.dmi_summary ............................. [RUN]
[0m11:29:48.796336 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_analytics, now model.build_fda.dmi_summary)
[0m11:29:48.796716 [debug] [Thread-1 (]: Began compiling node model.build_fda.dmi_summary
[0m11:29:48.805113 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.dmi_summary"
[0m11:29:48.806403 [debug] [Thread-1 (]: Began executing node model.build_fda.dmi_summary
[0m11:29:48.825803 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.dmi_summary"
[0m11:29:48.827653 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.dmi_summary"
[0m11:29:48.828005 [debug] [Thread-1 (]: On model.build_fda.dmi_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.dmi_summary"} */
create or replace transient table dev.analytics.dmi_summary
         as
        (WITH stock_prices AS (
    SELECT
        date,
        close,
        symbol as series
    FROM dev.raw_data.stock_data
    WHERE series IN ('AAPL', 'NVDA')  -- Including both Apple and Nvidia
),

-- Calculate the 20-day SMA and 20-day standard deviation for both symbols
sma_stddev AS (
    SELECT
        date,
        series,
        close,
        AVG(close) OVER (PARTITION BY series ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS middle_band,
        STDDEV(close) OVER (PARTITION BY series ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS stddev_20
    FROM stock_prices
),

-- Calculate the upper and lower bands
bands AS (
    SELECT
        date,
        series,
        close,
        middle_band,
        (middle_band + (2 * stddev_20)) AS upper_band,
        (middle_band - (2 * stddev_20)) AS lower_band
    FROM sma_stddev
),

-- Calculate +DI and -DI based on daily price movements for each stock symbol
directional_indicators AS (
    SELECT
        date,
        series,
        close,
        middle_band,
        upper_band,
        lower_band,
        LAG(close, 1) OVER (PARTITION BY series ORDER BY date) AS prev_close,
        -- +DI: Calculate positive movement
        CASE WHEN close > prev_close THEN close - prev_close ELSE 0 END AS plus_di,
        -- -DI: Calculate negative movement
        CASE WHEN close < prev_close THEN prev_close - close ELSE 0 END AS minus_di
    FROM bands
)

SELECT
    date,
    series,  -- To differentiate between Apple and Nvidia
    close,
    middle_band,
    upper_band,
    lower_band,
    -- Summing up DI over the 20-day period for smoother trend analysis
    SUM(plus_di) OVER (PARTITION BY series ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS plus_di_twenty,
    SUM(minus_di) OVER (PARTITION BY series ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS minus_di_twenty
FROM directional_indicators
ORDER BY series, date
        );
[0m11:29:48.828295 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:29:51.002660 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.174 seconds
[0m11:29:51.029683 [debug] [Thread-1 (]: On model.build_fda.dmi_summary: Close
[0m11:29:51.161057 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1abf6835-ddc4-45a6-8a2c-cce8f7e51f60', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14bd4bdd0>]}
[0m11:29:51.162139 [info ] [Thread-1 (]: 1 of 7 OK created sql table model analytics.dmi_summary ........................ [[32mSUCCESS 1[0m in 2.36s]
[0m11:29:51.162864 [debug] [Thread-1 (]: Finished running node model.build_fda.dmi_summary
[0m11:29:51.163355 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_apple_summary
[0m11:29:51.163981 [info ] [Thread-1 (]: 2 of 7 START sql table model analytics.fsi_apple_summary ....................... [RUN]
[0m11:29:51.164567 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.dmi_summary, now model.build_fda.fsi_apple_summary)
[0m11:29:51.164987 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_apple_summary
[0m11:29:51.168326 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_apple_summary"
[0m11:29:51.169606 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_apple_summary
[0m11:29:51.172455 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_apple_summary"
[0m11:29:51.174130 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_apple_summary"
[0m11:29:51.174467 [debug] [Thread-1 (]: On model.build_fda.fsi_apple_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_apple_summary"} */
create or replace transient table dev.analytics.fsi_apple_summary
         as
        (WITH apple_interval_widths AS (
    SELECT
        ts,
        forecast,
        lower_bound,
        upper_bound,
        series,
        (upper_bound - lower_bound) AS interval_width
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
    WHERE series = 'AAPL'  -- Filter for Apple symbol
),

statistics AS (
    SELECT
        series,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM apple_interval_widths
    GROUP BY series
)

SELECT
    a.ts,
    a.series,
    a.forecast,
    a.lower_bound,
    a.upper_bound,
    a.interval_width,
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM apple_interval_widths a
JOIN statistics s
    ON a.series = s.series
ORDER BY a.ts
        );
[0m11:29:51.174787 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:29:54.687461 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 3.512 seconds
[0m11:29:54.692314 [debug] [Thread-1 (]: On model.build_fda.fsi_apple_summary: Close
[0m11:29:54.816806 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1abf6835-ddc4-45a6-8a2c-cce8f7e51f60', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14baf0110>]}
[0m11:29:54.818044 [info ] [Thread-1 (]: 2 of 7 OK created sql table model analytics.fsi_apple_summary .................. [[32mSUCCESS 1[0m in 3.65s]
[0m11:29:54.818915 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_apple_summary
[0m11:29:54.819494 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_integ_summary
[0m11:29:54.819997 [info ] [Thread-1 (]: 3 of 7 START sql table model analytics.fsi_integ_summary ....................... [RUN]
[0m11:29:54.820408 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_apple_summary, now model.build_fda.fsi_integ_summary)
[0m11:29:54.820839 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_integ_summary
[0m11:29:54.826179 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_integ_summary"
[0m11:29:54.827292 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_integ_summary
[0m11:29:54.902951 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_integ_summary"
[0m11:29:54.903933 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_integ_summary"
[0m11:29:54.904124 [debug] [Thread-1 (]: On model.build_fda.fsi_integ_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_integ_summary"} */
create or replace transient table dev.analytics.fsi_integ_summary
         as
        (WITH interval_widths AS (
    SELECT
        ts,
        forecast,
        lower_bound,
        upper_bound,
        series,
        (upper_bound - lower_bound) AS interval_width
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
),

statistics AS (
    SELECT
        series,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM interval_widths
    GROUP BY series
)

SELECT
    distinct(a.series),
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM interval_widths a
JOIN statistics s
    ON a.series = s.series
        );
[0m11:29:54.904294 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:29:56.222304 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.317 seconds
[0m11:29:56.227623 [debug] [Thread-1 (]: On model.build_fda.fsi_integ_summary: Close
[0m11:29:56.374731 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1abf6835-ddc4-45a6-8a2c-cce8f7e51f60', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14bc63310>]}
[0m11:29:56.375773 [info ] [Thread-1 (]: 3 of 7 OK created sql table model analytics.fsi_integ_summary .................. [[32mSUCCESS 1[0m in 1.55s]
[0m11:29:56.376575 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_integ_summary
[0m11:29:56.377185 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_nvidia_summary
[0m11:29:56.377867 [info ] [Thread-1 (]: 4 of 7 START sql table model analytics.fsi_nvidia_summary ...................... [RUN]
[0m11:29:56.378440 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_integ_summary, now model.build_fda.fsi_nvidia_summary)
[0m11:29:56.378849 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_nvidia_summary
[0m11:29:56.382902 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_nvidia_summary"
[0m11:29:56.383929 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_nvidia_summary
[0m11:29:56.386508 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_nvidia_summary"
[0m11:29:56.388019 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_nvidia_summary"
[0m11:29:56.388409 [debug] [Thread-1 (]: On model.build_fda.fsi_nvidia_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_nvidia_summary"} */
create or replace transient table dev.analytics.fsi_nvidia_summary
         as
        (WITH nvidia_interval_widths AS (
    SELECT
        ts,
        forecast,
        lower_bound,
        upper_bound,
        series,
        (upper_bound - lower_bound) AS interval_width
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
    WHERE series = 'NVDA'  -- Filter for Nvidia symbol
),

statistics AS (
    SELECT
        series,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM nvidia_interval_widths
    GROUP BY series
)

SELECT
    n.ts,
    n.series,
    n.forecast,
    n.lower_bound,
    n.upper_bound,
    n.interval_width,
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM nvidia_interval_widths n
JOIN statistics s
    ON n.series = s.series
ORDER BY n.ts
        );
[0m11:29:56.388760 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:29:57.759348 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.370 seconds
[0m11:29:57.763421 [debug] [Thread-1 (]: On model.build_fda.fsi_nvidia_summary: Close
[0m11:29:57.892537 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1abf6835-ddc4-45a6-8a2c-cce8f7e51f60', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b98a6d0>]}
[0m11:29:57.893824 [info ] [Thread-1 (]: 4 of 7 OK created sql table model analytics.fsi_nvidia_summary ................. [[32mSUCCESS 1[0m in 1.51s]
[0m11:29:57.894713 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_nvidia_summary
[0m11:29:57.895310 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_stock_summary
[0m11:29:57.896067 [info ] [Thread-1 (]: 5 of 7 START sql table model analytics.fsi_stock_summary ....................... [RUN]
[0m11:29:57.896778 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_nvidia_summary, now model.build_fda.fsi_stock_summary)
[0m11:29:57.897180 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_stock_summary
[0m11:29:57.901256 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_stock_summary"
[0m11:29:57.902350 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_stock_summary
[0m11:29:57.905051 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_stock_summary"
[0m11:29:57.906573 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_stock_summary"
[0m11:29:57.906962 [debug] [Thread-1 (]: On model.build_fda.fsi_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_stock_summary"} */
create or replace transient table dev.analytics.fsi_stock_summary
         as
        (WITH apple_interval_widths AS (
    SELECT
        ts,
        forecast,
        lower_bound,
        upper_bound,
        series,
        (upper_bound - lower_bound) AS interval_width
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
    WHERE series = 'AAPL'  -- Filter for Apple symbol
),

statistics AS (
    SELECT
        series,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM apple_interval_widths
    GROUP BY series
)

SELECT
    a.ts,
    a.series,
    a.forecast,
    a.lower_bound,
    a.upper_bound,
    a.interval_width,
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM apple_interval_widths a
JOIN statistics s
    ON a.series = s.series
ORDER BY a.ts
        );
[0m11:29:57.907313 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:29:59.330214 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.422 seconds
[0m11:29:59.335502 [debug] [Thread-1 (]: On model.build_fda.fsi_stock_summary: Close
[0m11:29:59.476254 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1abf6835-ddc4-45a6-8a2c-cce8f7e51f60', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14bd52950>]}
[0m11:29:59.477919 [info ] [Thread-1 (]: 5 of 7 OK created sql table model analytics.fsi_stock_summary .................. [[32mSUCCESS 1[0m in 1.58s]
[0m11:29:59.478642 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_stock_summary
[0m11:29:59.479121 [debug] [Thread-1 (]: Began running node model.build_fda.obv_apple_summary
[0m11:29:59.479711 [info ] [Thread-1 (]: 6 of 7 START sql table model analytics.obv_apple_summary ....................... [RUN]
[0m11:29:59.480307 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_stock_summary, now model.build_fda.obv_apple_summary)
[0m11:29:59.480649 [debug] [Thread-1 (]: Began compiling node model.build_fda.obv_apple_summary
[0m11:29:59.483385 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.obv_apple_summary"
[0m11:29:59.484389 [debug] [Thread-1 (]: Began executing node model.build_fda.obv_apple_summary
[0m11:29:59.486690 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.obv_apple_summary"
[0m11:29:59.487922 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.obv_apple_summary"
[0m11:29:59.488237 [debug] [Thread-1 (]: On model.build_fda.obv_apple_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.obv_apple_summary"} */
create or replace transient table dev.analytics.obv_apple_summary
         as
        (WITH ordered_data AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM dev.raw_data.stock_data -- Referencing the raw data table in the dev database
    WHERE symbol = 'AAPL'  -- Filter for Apple symbol
),

obv_calculation AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        CASE
            WHEN close > LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN volume
            WHEN close < LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN -volume
            ELSE 0
        END AS volume_change
    FROM ordered_data
),

cumulative_obv AS (
    SELECT
        date,
        symbol,
        SUM(volume_change) OVER (PARTITION BY symbol ORDER BY date) AS obv
    FROM obv_calculation
)

SELECT
    date,
    symbol,
    obv
FROM cumulative_obv
ORDER BY date
        );
[0m11:29:59.488576 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:30:00.727150 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.238 seconds
[0m11:30:00.733170 [debug] [Thread-1 (]: On model.build_fda.obv_apple_summary: Close
[0m11:30:00.843291 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1abf6835-ddc4-45a6-8a2c-cce8f7e51f60', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b8ad7d0>]}
[0m11:30:00.846064 [info ] [Thread-1 (]: 6 of 7 OK created sql table model analytics.obv_apple_summary .................. [[32mSUCCESS 1[0m in 1.36s]
[0m11:30:00.847791 [debug] [Thread-1 (]: Finished running node model.build_fda.obv_apple_summary
[0m11:30:00.848897 [debug] [Thread-1 (]: Began running node model.build_fda.obv_nvidia_summary
[0m11:30:00.850086 [info ] [Thread-1 (]: 7 of 7 START sql table model analytics.obv_nvidia_summary ...................... [RUN]
[0m11:30:00.851501 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.obv_apple_summary, now model.build_fda.obv_nvidia_summary)
[0m11:30:00.852257 [debug] [Thread-1 (]: Began compiling node model.build_fda.obv_nvidia_summary
[0m11:30:00.863666 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.obv_nvidia_summary"
[0m11:30:00.866449 [debug] [Thread-1 (]: Began executing node model.build_fda.obv_nvidia_summary
[0m11:30:00.869959 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.obv_nvidia_summary"
[0m11:30:00.871689 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.obv_nvidia_summary"
[0m11:30:00.872175 [debug] [Thread-1 (]: On model.build_fda.obv_nvidia_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.obv_nvidia_summary"} */
create or replace transient table dev.analytics.obv_nvidia_summary
         as
        (WITH ordered_data AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM dev.raw_data.stock_data -- Referencing the raw data table in the dev database
    WHERE symbol = 'NVDA'  -- Filter for Nvidia symbol
),

obv_calculation AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        CASE
            WHEN close > LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN volume
            WHEN close < LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN -volume
            ELSE 0
        END AS volume_change
    FROM ordered_data
),

cumulative_obv AS (
    SELECT
        date,
        symbol,
        SUM(volume_change) OVER (PARTITION BY symbol ORDER BY date) AS obv
    FROM obv_calculation
)

SELECT
    date,
    symbol,
    obv
FROM cumulative_obv
ORDER BY date
        );
[0m11:30:00.872592 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:30:02.364578 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.491 seconds
[0m11:30:02.371052 [debug] [Thread-1 (]: On model.build_fda.obv_nvidia_summary: Close
[0m11:30:02.502478 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1abf6835-ddc4-45a6-8a2c-cce8f7e51f60', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107c4e090>]}
[0m11:30:02.504749 [info ] [Thread-1 (]: 7 of 7 OK created sql table model analytics.obv_nvidia_summary ................. [[32mSUCCESS 1[0m in 1.65s]
[0m11:30:02.505991 [debug] [Thread-1 (]: Finished running node model.build_fda.obv_nvidia_summary
[0m11:30:02.506728 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data
[0m11:30:02.507567 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.obv_nvidia_summary, now model.build_fda.stock_data)
[0m11:30:02.508129 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data
[0m11:30:02.515863 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data"
[0m11:30:02.518775 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data
[0m11:30:02.519962 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data_forecast
[0m11:30:02.520927 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.stock_data, now model.build_fda.stock_data_forecast)
[0m11:30:02.521492 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data_forecast
[0m11:30:02.525211 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data_forecast"
[0m11:30:02.526575 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data_forecast
[0m11:30:02.528179 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:30:02.528513 [debug] [MainThread]: Connection 'model.build_fda.stock_data_forecast' was properly closed.
[0m11:30:02.528732 [info ] [MainThread]: 
[0m11:30:02.528914 [info ] [MainThread]: Finished running 7 table models in 0 hours 0 minutes and 15.10 seconds (15.10s).
[0m11:30:02.529797 [debug] [MainThread]: Command end result
[0m11:30:02.551064 [info ] [MainThread]: 
[0m11:30:02.551397 [info ] [MainThread]: [32mCompleted successfully[0m
[0m11:30:02.551623 [info ] [MainThread]: 
[0m11:30:02.551858 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m11:30:02.554272 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 16.368559, "process_user_time": 2.622816, "process_kernel_time": 1.604348, "process_mem_max_rss": "202817536", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m11:30:02.554675 [debug] [MainThread]: Command `dbt run` succeeded at 11:30:02.554607 after 16.37 seconds
[0m11:30:02.554939 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100e1c150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14b57c110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100e67450>]}
[0m11:30:02.555182 [debug] [MainThread]: Flushing usage events
[0m11:40:58.417737 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1092ba4d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1092c7bd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1092b9f90>]}


============================== 11:40:58.419864 | 8a7da7c5-75a8-4ce4-97da-19ec747794f7 ==============================
[0m11:40:58.419864 [info ] [MainThread]: Running with dbt=1.8.7
[0m11:40:58.420204 [debug] [MainThread]: running dbt with arguments {'version_check': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'write_json': 'True', 'fail_fast': 'False', 'warn_error': 'None', 'log_format': 'default', 'use_experimental_parser': 'False', 'no_print': 'None', 'send_anonymous_usage_stats': 'True', 'log_cache_events': 'False', 'printer_width': '80', 'profiles_dir': '/Users/shatayu/.dbt', 'static_parser': 'True', 'introspect': 'True', 'partial_parse': 'True', 'empty': 'False', 'cache_selected_only': 'False', 'invocation_command': 'dbt run', 'debug': 'False', 'quiet': 'False', 'log_path': '/Users/shatayu/Downloads/DATA226_Lab2Prep/build_fda/logs', 'use_colors': 'True', 'target_path': 'None', 'indirect_selection': 'eager'}
[0m11:40:59.379307 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8a7da7c5-75a8-4ce4-97da-19ec747794f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a2c0150>]}
[0m11:40:59.400427 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8a7da7c5-75a8-4ce4-97da-19ec747794f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108d2d890>]}
[0m11:40:59.401034 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m11:40:59.413834 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m11:40:59.485616 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m11:40:59.485973 [debug] [MainThread]: Partial parsing: updated file: build_fda://models/output/fsi_integ_summary.sql
[0m11:40:59.588231 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8a7da7c5-75a8-4ce4-97da-19ec747794f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14f7a3a10>]}
[0m11:40:59.629215 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8a7da7c5-75a8-4ce4-97da-19ec747794f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14fba0d90>]}
[0m11:40:59.629508 [info ] [MainThread]: Found 9 models, 6 sources, 459 macros
[0m11:40:59.629682 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8a7da7c5-75a8-4ce4-97da-19ec747794f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14f7df610>]}
[0m11:40:59.630599 [info ] [MainThread]: 
[0m11:40:59.630891 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m11:40:59.632917 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m11:40:59.638590 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m11:40:59.638753 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m11:40:59.638886 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:41:00.222983 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.583 seconds
[0m11:41:00.229366 [debug] [ThreadPool]: On list_dev: Close
[0m11:41:00.356319 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_analytics)
[0m11:41:00.374058 [debug] [ThreadPool]: Using snowflake connection "list_dev_analytics"
[0m11:41:00.374571 [debug] [ThreadPool]: On list_dev_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev_analytics"} */
show objects in dev.analytics limit 10000
[0m11:41:00.374814 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:41:01.039156 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.664 seconds
[0m11:41:01.045097 [debug] [ThreadPool]: On list_dev_analytics: Close
[0m11:41:01.193011 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8a7da7c5-75a8-4ce4-97da-19ec747794f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14f5f1910>]}
[0m11:41:01.195155 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m11:41:01.195841 [info ] [MainThread]: 
[0m11:41:01.205252 [debug] [Thread-1 (]: Began running node model.build_fda.dmi_summary
[0m11:41:01.206670 [info ] [Thread-1 (]: 1 of 7 START sql table model analytics.dmi_summary ............................. [RUN]
[0m11:41:01.207714 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_analytics, now model.build_fda.dmi_summary)
[0m11:41:01.208255 [debug] [Thread-1 (]: Began compiling node model.build_fda.dmi_summary
[0m11:41:01.219299 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.dmi_summary"
[0m11:41:01.220688 [debug] [Thread-1 (]: Began executing node model.build_fda.dmi_summary
[0m11:41:01.246091 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.dmi_summary"
[0m11:41:01.248341 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.dmi_summary"
[0m11:41:01.248724 [debug] [Thread-1 (]: On model.build_fda.dmi_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.dmi_summary"} */
create or replace transient table dev.analytics.dmi_summary
         as
        (WITH stock_prices AS (
    SELECT
        date,
        close,
        symbol as series
    FROM dev.raw_data.stock_data
    WHERE series IN ('AAPL', 'NVDA')  -- Including both Apple and Nvidia
),

-- Calculate the 20-day SMA and 20-day standard deviation for both symbols
sma_stddev AS (
    SELECT
        date,
        series,
        close,
        AVG(close) OVER (PARTITION BY series ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS middle_band,
        STDDEV(close) OVER (PARTITION BY series ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS stddev_20
    FROM stock_prices
),

-- Calculate the upper and lower bands
bands AS (
    SELECT
        date,
        series,
        close,
        middle_band,
        (middle_band + (2 * stddev_20)) AS upper_band,
        (middle_band - (2 * stddev_20)) AS lower_band
    FROM sma_stddev
),

-- Calculate +DI and -DI based on daily price movements for each stock symbol
directional_indicators AS (
    SELECT
        date,
        series,
        close,
        middle_band,
        upper_band,
        lower_band,
        LAG(close, 1) OVER (PARTITION BY series ORDER BY date) AS prev_close,
        -- +DI: Calculate positive movement
        CASE WHEN close > prev_close THEN close - prev_close ELSE 0 END AS plus_di,
        -- -DI: Calculate negative movement
        CASE WHEN close < prev_close THEN prev_close - close ELSE 0 END AS minus_di
    FROM bands
)

SELECT
    date,
    series,  -- To differentiate between Apple and Nvidia
    close,
    middle_band,
    upper_band,
    lower_band,
    -- Summing up DI over the 20-day period for smoother trend analysis
    SUM(plus_di) OVER (PARTITION BY series ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS plus_di_twenty,
    SUM(minus_di) OVER (PARTITION BY series ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS minus_di_twenty
FROM directional_indicators
ORDER BY series, date
        );
[0m11:41:01.249051 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:41:03.863452 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.614 seconds
[0m11:41:03.899995 [debug] [Thread-1 (]: On model.build_fda.dmi_summary: Close
[0m11:41:04.096870 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8a7da7c5-75a8-4ce4-97da-19ec747794f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14fb25590>]}
[0m11:41:04.100387 [info ] [Thread-1 (]: 1 of 7 OK created sql table model analytics.dmi_summary ........................ [[32mSUCCESS 1[0m in 2.88s]
[0m11:41:04.101826 [debug] [Thread-1 (]: Finished running node model.build_fda.dmi_summary
[0m11:41:04.104028 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_apple_summary
[0m11:41:04.105269 [info ] [Thread-1 (]: 2 of 7 START sql table model analytics.fsi_apple_summary ....................... [RUN]
[0m11:41:04.106497 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.dmi_summary, now model.build_fda.fsi_apple_summary)
[0m11:41:04.107334 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_apple_summary
[0m11:41:04.110110 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_apple_summary"
[0m11:41:04.112641 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_apple_summary
[0m11:41:04.115411 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_apple_summary"
[0m11:41:04.116794 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_apple_summary"
[0m11:41:04.117085 [debug] [Thread-1 (]: On model.build_fda.fsi_apple_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_apple_summary"} */
create or replace transient table dev.analytics.fsi_apple_summary
         as
        (WITH apple_interval_widths AS (
    SELECT
        ts,
        forecast,
        lower_bound,
        upper_bound,
        series,
        (upper_bound - lower_bound) AS interval_width
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
    WHERE series = 'AAPL'  -- Filter for Apple symbol
),

statistics AS (
    SELECT
        series,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM apple_interval_widths
    GROUP BY series
)

SELECT
    a.ts,
    a.series,
    a.forecast,
    a.lower_bound,
    a.upper_bound,
    a.interval_width,
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM apple_interval_widths a
JOIN statistics s
    ON a.series = s.series
ORDER BY a.ts
        );
[0m11:41:04.117350 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:41:05.875841 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.758 seconds
[0m11:41:05.884914 [debug] [Thread-1 (]: On model.build_fda.fsi_apple_summary: Close
[0m11:41:06.019647 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8a7da7c5-75a8-4ce4-97da-19ec747794f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14f84d890>]}
[0m11:41:06.022580 [info ] [Thread-1 (]: 2 of 7 OK created sql table model analytics.fsi_apple_summary .................. [[32mSUCCESS 1[0m in 1.91s]
[0m11:41:06.025884 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_apple_summary
[0m11:41:06.028301 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_integ_summary
[0m11:41:06.029366 [info ] [Thread-1 (]: 3 of 7 START sql table model analytics.fsi_integ_summary ....................... [RUN]
[0m11:41:06.030184 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_apple_summary, now model.build_fda.fsi_integ_summary)
[0m11:41:06.030776 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_integ_summary
[0m11:41:06.037643 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_integ_summary"
[0m11:41:06.038814 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_integ_summary
[0m11:41:06.112013 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_integ_summary"
[0m11:41:06.112948 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_integ_summary"
[0m11:41:06.113142 [debug] [Thread-1 (]: On model.build_fda.fsi_integ_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_integ_summary"} */
create or replace transient table dev.analytics.fsi_integ_summary
         as
        (WITH interval_widths AS (
    SELECT
        ts,
        forecast,
        lower_bound,
        upper_bound,
        REPLACE(series, '"', '') AS series,
        (upper_bound - lower_bound) AS interval_width
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
),

statistics AS (
    SELECT
        series,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM interval_widths
    GROUP BY series
)

SELECT
    distinct(a.series),
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM interval_widths a
JOIN statistics s
    ON a.series = s.series
        );
[0m11:41:06.113309 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:41:07.958783 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.845 seconds
[0m11:41:07.966800 [debug] [Thread-1 (]: On model.build_fda.fsi_integ_summary: Close
[0m11:41:08.106502 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8a7da7c5-75a8-4ce4-97da-19ec747794f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109258b10>]}
[0m11:41:08.110112 [info ] [Thread-1 (]: 3 of 7 OK created sql table model analytics.fsi_integ_summary .................. [[32mSUCCESS 1[0m in 2.08s]
[0m11:41:08.111698 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_integ_summary
[0m11:41:08.113052 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_nvidia_summary
[0m11:41:08.114439 [info ] [Thread-1 (]: 4 of 7 START sql table model analytics.fsi_nvidia_summary ...................... [RUN]
[0m11:41:08.115518 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_integ_summary, now model.build_fda.fsi_nvidia_summary)
[0m11:41:08.116328 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_nvidia_summary
[0m11:41:08.124135 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_nvidia_summary"
[0m11:41:08.125187 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_nvidia_summary
[0m11:41:08.127067 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_nvidia_summary"
[0m11:41:08.128081 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_nvidia_summary"
[0m11:41:08.128325 [debug] [Thread-1 (]: On model.build_fda.fsi_nvidia_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_nvidia_summary"} */
create or replace transient table dev.analytics.fsi_nvidia_summary
         as
        (WITH nvidia_interval_widths AS (
    SELECT
        ts,
        forecast,
        lower_bound,
        upper_bound,
        series,
        (upper_bound - lower_bound) AS interval_width
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
    WHERE series = 'NVDA'  -- Filter for Nvidia symbol
),

statistics AS (
    SELECT
        series,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM nvidia_interval_widths
    GROUP BY series
)

SELECT
    n.ts,
    n.series,
    n.forecast,
    n.lower_bound,
    n.upper_bound,
    n.interval_width,
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM nvidia_interval_widths n
JOIN statistics s
    ON n.series = s.series
ORDER BY n.ts
        );
[0m11:41:08.128537 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:41:10.008190 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.879 seconds
[0m11:41:10.016724 [debug] [Thread-1 (]: On model.build_fda.fsi_nvidia_summary: Close
[0m11:41:10.156608 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8a7da7c5-75a8-4ce4-97da-19ec747794f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14f84fc50>]}
[0m11:41:10.159677 [info ] [Thread-1 (]: 4 of 7 OK created sql table model analytics.fsi_nvidia_summary ................. [[32mSUCCESS 1[0m in 2.04s]
[0m11:41:10.162753 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_nvidia_summary
[0m11:41:10.165064 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_stock_summary
[0m11:41:10.166957 [info ] [Thread-1 (]: 5 of 7 START sql table model analytics.fsi_stock_summary ....................... [RUN]
[0m11:41:10.168202 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_nvidia_summary, now model.build_fda.fsi_stock_summary)
[0m11:41:10.169559 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_stock_summary
[0m11:41:10.173452 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_stock_summary"
[0m11:41:10.174485 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_stock_summary
[0m11:41:10.176590 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_stock_summary"
[0m11:41:10.177923 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_stock_summary"
[0m11:41:10.178242 [debug] [Thread-1 (]: On model.build_fda.fsi_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_stock_summary"} */
create or replace transient table dev.analytics.fsi_stock_summary
         as
        (WITH apple_interval_widths AS (
    SELECT
        ts,
        forecast,
        lower_bound,
        upper_bound,
        series,
        (upper_bound - lower_bound) AS interval_width
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
    WHERE series = 'AAPL'  -- Filter for Apple symbol
),

statistics AS (
    SELECT
        series,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM apple_interval_widths
    GROUP BY series
)

SELECT
    a.ts,
    a.series,
    a.forecast,
    a.lower_bound,
    a.upper_bound,
    a.interval_width,
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM apple_interval_widths a
JOIN statistics s
    ON a.series = s.series
ORDER BY a.ts
        );
[0m11:41:10.178517 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:41:12.058716 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.879 seconds
[0m11:41:12.067990 [debug] [Thread-1 (]: On model.build_fda.fsi_stock_summary: Close
[0m11:41:12.241967 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8a7da7c5-75a8-4ce4-97da-19ec747794f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1050dc3d0>]}
[0m11:41:12.244874 [info ] [Thread-1 (]: 5 of 7 OK created sql table model analytics.fsi_stock_summary .................. [[32mSUCCESS 1[0m in 2.07s]
[0m11:41:12.246542 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_stock_summary
[0m11:41:12.248918 [debug] [Thread-1 (]: Began running node model.build_fda.obv_apple_summary
[0m11:41:12.251209 [info ] [Thread-1 (]: 6 of 7 START sql table model analytics.obv_apple_summary ....................... [RUN]
[0m11:41:12.256600 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_stock_summary, now model.build_fda.obv_apple_summary)
[0m11:41:12.259234 [debug] [Thread-1 (]: Began compiling node model.build_fda.obv_apple_summary
[0m11:41:12.267523 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.obv_apple_summary"
[0m11:41:12.269055 [debug] [Thread-1 (]: Began executing node model.build_fda.obv_apple_summary
[0m11:41:12.272022 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.obv_apple_summary"
[0m11:41:12.273776 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.obv_apple_summary"
[0m11:41:12.274262 [debug] [Thread-1 (]: On model.build_fda.obv_apple_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.obv_apple_summary"} */
create or replace transient table dev.analytics.obv_apple_summary
         as
        (WITH ordered_data AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM dev.raw_data.stock_data -- Referencing the raw data table in the dev database
    WHERE symbol = 'AAPL'  -- Filter for Apple symbol
),

obv_calculation AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        CASE
            WHEN close > LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN volume
            WHEN close < LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN -volume
            ELSE 0
        END AS volume_change
    FROM ordered_data
),

cumulative_obv AS (
    SELECT
        date,
        symbol,
        SUM(volume_change) OVER (PARTITION BY symbol ORDER BY date) AS obv
    FROM obv_calculation
)

SELECT
    date,
    symbol,
    obv
FROM cumulative_obv
ORDER BY date
        );
[0m11:41:12.274686 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:41:13.529248 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.254 seconds
[0m11:41:13.533621 [debug] [Thread-1 (]: On model.build_fda.obv_apple_summary: Close
[0m11:41:13.684026 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8a7da7c5-75a8-4ce4-97da-19ec747794f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109258b10>]}
[0m11:41:13.686343 [info ] [Thread-1 (]: 6 of 7 OK created sql table model analytics.obv_apple_summary .................. [[32mSUCCESS 1[0m in 1.43s]
[0m11:41:13.688380 [debug] [Thread-1 (]: Finished running node model.build_fda.obv_apple_summary
[0m11:41:13.689399 [debug] [Thread-1 (]: Began running node model.build_fda.obv_nvidia_summary
[0m11:41:13.690403 [info ] [Thread-1 (]: 7 of 7 START sql table model analytics.obv_nvidia_summary ...................... [RUN]
[0m11:41:13.691569 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.obv_apple_summary, now model.build_fda.obv_nvidia_summary)
[0m11:41:13.692418 [debug] [Thread-1 (]: Began compiling node model.build_fda.obv_nvidia_summary
[0m11:41:13.702834 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.obv_nvidia_summary"
[0m11:41:13.704258 [debug] [Thread-1 (]: Began executing node model.build_fda.obv_nvidia_summary
[0m11:41:13.706428 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.obv_nvidia_summary"
[0m11:41:13.707646 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.obv_nvidia_summary"
[0m11:41:13.708227 [debug] [Thread-1 (]: On model.build_fda.obv_nvidia_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.obv_nvidia_summary"} */
create or replace transient table dev.analytics.obv_nvidia_summary
         as
        (WITH ordered_data AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM dev.raw_data.stock_data -- Referencing the raw data table in the dev database
    WHERE symbol = 'NVDA'  -- Filter for Nvidia symbol
),

obv_calculation AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        CASE
            WHEN close > LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN volume
            WHEN close < LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN -volume
            ELSE 0
        END AS volume_change
    FROM ordered_data
),

cumulative_obv AS (
    SELECT
        date,
        symbol,
        SUM(volume_change) OVER (PARTITION BY symbol ORDER BY date) AS obv
    FROM obv_calculation
)

SELECT
    date,
    symbol,
    obv
FROM cumulative_obv
ORDER BY date
        );
[0m11:41:13.708735 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:41:15.540212 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.831 seconds
[0m11:41:15.548706 [debug] [Thread-1 (]: On model.build_fda.obv_nvidia_summary: Close
[0m11:41:15.684571 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8a7da7c5-75a8-4ce4-97da-19ec747794f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1075167d0>]}
[0m11:41:15.687868 [info ] [Thread-1 (]: 7 of 7 OK created sql table model analytics.obv_nvidia_summary ................. [[32mSUCCESS 1[0m in 1.99s]
[0m11:41:15.690469 [debug] [Thread-1 (]: Finished running node model.build_fda.obv_nvidia_summary
[0m11:41:15.691671 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data
[0m11:41:15.693016 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.obv_nvidia_summary, now model.build_fda.stock_data)
[0m11:41:15.695450 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data
[0m11:41:15.700009 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data"
[0m11:41:15.701267 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data
[0m11:41:15.701660 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data_forecast
[0m11:41:15.702093 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.stock_data, now model.build_fda.stock_data_forecast)
[0m11:41:15.702360 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data_forecast
[0m11:41:15.704430 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data_forecast"
[0m11:41:15.705134 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data_forecast
[0m11:41:15.706292 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:41:15.706518 [debug] [MainThread]: Connection 'model.build_fda.stock_data_forecast' was properly closed.
[0m11:41:15.706825 [info ] [MainThread]: 
[0m11:41:15.707077 [info ] [MainThread]: Finished running 7 table models in 0 hours 0 minutes and 16.08 seconds (16.08s).
[0m11:41:15.707992 [debug] [MainThread]: Command end result
[0m11:41:15.731348 [info ] [MainThread]: 
[0m11:41:15.731767 [info ] [MainThread]: [32mCompleted successfully[0m
[0m11:41:15.732019 [info ] [MainThread]: 
[0m11:41:15.732271 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m11:41:15.735003 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 17.37253, "process_user_time": 2.912168, "process_kernel_time": 1.594936, "process_mem_max_rss": "203407360", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m11:41:15.735468 [debug] [MainThread]: Command `dbt run` succeeded at 11:41:15.735399 after 17.37 seconds
[0m11:41:15.735774 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104eb0150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1092bb110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10788ce10>]}
[0m11:41:15.736035 [debug] [MainThread]: Flushing usage events
[0m11:50:57.271581 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10758ab50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107600810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107600d50>]}


============================== 11:50:57.273606 | 250ee561-91d6-4729-bd88-4153e7ed1e25 ==============================
[0m11:50:57.273606 [info ] [MainThread]: Running with dbt=1.8.7
[0m11:50:57.273921 [debug] [MainThread]: running dbt with arguments {'no_print': 'None', 'use_colors': 'True', 'fail_fast': 'False', 'cache_selected_only': 'False', 'empty': 'False', 'warn_error': 'None', 'use_experimental_parser': 'False', 'indirect_selection': 'eager', 'introspect': 'True', 'profiles_dir': '/Users/shatayu/.dbt', 'version_check': 'True', 'log_cache_events': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'log_format': 'default', 'debug': 'False', 'write_json': 'True', 'log_path': '/Users/shatayu/Downloads/DATA226_Lab2Prep/build_fda/logs', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'invocation_command': 'dbt run', 'partial_parse': 'True', 'quiet': 'False', 'target_path': 'None', 'printer_width': '80'}
[0m11:50:58.207576 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '250ee561-91d6-4729-bd88-4153e7ed1e25', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120375610>]}
[0m11:50:58.227918 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '250ee561-91d6-4729-bd88-4153e7ed1e25', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107049490>]}
[0m11:50:58.228519 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m11:50:58.240496 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m11:50:58.310381 [debug] [MainThread]: Partial parsing enabled: 4 files deleted, 1 files added, 2 files changed.
[0m11:50:58.310708 [debug] [MainThread]: Partial parsing: added file: build_fda://models/output/dmi_stock_summary.sql
[0m11:50:58.310922 [debug] [MainThread]: Partial parsing: updated file: build_fda://models/source.yml
[0m11:50:58.311042 [debug] [MainThread]: Partial parsing: deleted file: build_fda://models/output/fsi_integ_summary.sql
[0m11:50:58.311149 [debug] [MainThread]: Partial parsing: deleted file: build_fda://models/output/fsi_nvidia_summary.sql
[0m11:50:58.311252 [debug] [MainThread]: Partial parsing: deleted file: build_fda://models/output/dmi_summary.sql
[0m11:50:58.311354 [debug] [MainThread]: Partial parsing: deleted file: build_fda://models/output/fsi_apple_summary.sql
[0m11:50:58.311496 [debug] [MainThread]: Partial parsing: updated file: build_fda://models/output/fsi_stock_summary.sql
[0m11:50:58.450576 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '250ee561-91d6-4729-bd88-4153e7ed1e25', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12076fd90>]}
[0m11:50:58.493749 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '250ee561-91d6-4729-bd88-4153e7ed1e25', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120926010>]}
[0m11:50:58.494063 [info ] [MainThread]: Found 6 models, 6 sources, 459 macros
[0m11:50:58.494229 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '250ee561-91d6-4729-bd88-4153e7ed1e25', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1208097d0>]}
[0m11:50:58.495107 [info ] [MainThread]: 
[0m11:50:58.495402 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m11:50:58.497338 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m11:50:58.503353 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m11:50:58.503536 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m11:50:58.503664 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:50:59.098381 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.593 seconds
[0m11:50:59.101099 [debug] [ThreadPool]: On list_dev: Close
[0m11:50:59.223335 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_analytics)
[0m11:50:59.234298 [debug] [ThreadPool]: Using snowflake connection "list_dev_analytics"
[0m11:50:59.234763 [debug] [ThreadPool]: On list_dev_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev_analytics"} */
show objects in dev.analytics limit 10000
[0m11:50:59.235042 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:50:59.733085 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.498 seconds
[0m11:50:59.738304 [debug] [ThreadPool]: On list_dev_analytics: Close
[0m11:50:59.863510 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '250ee561-91d6-4729-bd88-4153e7ed1e25', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120406dd0>]}
[0m11:50:59.864599 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m11:50:59.865066 [info ] [MainThread]: 
[0m11:50:59.869725 [debug] [Thread-1 (]: Began running node model.build_fda.dmi_stock_summary
[0m11:50:59.870376 [info ] [Thread-1 (]: 1 of 4 START sql table model analytics.dmi_stock_summary ....................... [RUN]
[0m11:50:59.870879 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_analytics, now model.build_fda.dmi_stock_summary)
[0m11:50:59.871239 [debug] [Thread-1 (]: Began compiling node model.build_fda.dmi_stock_summary
[0m11:50:59.952367 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.dmi_stock_summary"
[0m11:50:59.953820 [debug] [Thread-1 (]: Began executing node model.build_fda.dmi_stock_summary
[0m11:50:59.965716 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.dmi_stock_summary"
[0m11:50:59.966742 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.dmi_stock_summary"
[0m11:50:59.966984 [debug] [Thread-1 (]: On model.build_fda.dmi_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.dmi_stock_summary"} */
create or replace transient table dev.analytics.dmi_stock_summary
         as
        (WITH stock_prices AS (
    SELECT
        date,
        close,
        symbol as series
    FROM dev.raw_data.stock_data
    WHERE series IN ('AAPL', 'NVDA')  -- Including both Apple and Nvidia
),

-- Calculate the 20-day SMA and 20-day standard deviation for both symbols
sma_stddev AS (
    SELECT
        date,
        series,
        close,
        AVG(close) OVER (PARTITION BY series ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS middle_band,
        STDDEV(close) OVER (PARTITION BY series ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS stddev_20
    FROM stock_prices
),

-- Calculate the upper and lower bands
bands AS (
    SELECT
        date,
        series,
        close,
        middle_band,
        (middle_band + (2 * stddev_20)) AS upper_band,
        (middle_band - (2 * stddev_20)) AS lower_band
    FROM sma_stddev
),

-- Calculate +DI and -DI based on daily price movements for each stock symbol
directional_indicators AS (
    SELECT
        date,
        series,
        close,
        middle_band,
        upper_band,
        lower_band,
        LAG(close, 1) OVER (PARTITION BY series ORDER BY date) AS prev_close,
        -- +DI: Calculate positive movement
        CASE WHEN close > prev_close THEN close - prev_close ELSE 0 END AS plus_di,
        -- -DI: Calculate negative movement
        CASE WHEN close < prev_close THEN prev_close - close ELSE 0 END AS minus_di
    FROM bands
)

SELECT
    date,
    series,  -- To differentiate between Apple and Nvidia
    close,
    middle_band,
    upper_band,
    lower_band,
    -- Summing up DI over the 20-day period for smoother trend analysis
    SUM(plus_di) OVER (PARTITION BY series ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS plus_di_twenty,
    SUM(minus_di) OVER (PARTITION BY series ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS minus_di_twenty
FROM directional_indicators
ORDER BY series, date
        );
[0m11:50:59.967184 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:51:01.520759 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.553 seconds
[0m11:51:01.543349 [debug] [Thread-1 (]: On model.build_fda.dmi_stock_summary: Close
[0m11:51:01.661819 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '250ee561-91d6-4729-bd88-4153e7ed1e25', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120969210>]}
[0m11:51:01.662877 [info ] [Thread-1 (]: 1 of 4 OK created sql table model analytics.dmi_stock_summary .................. [[32mSUCCESS 1[0m in 1.79s]
[0m11:51:01.663757 [debug] [Thread-1 (]: Finished running node model.build_fda.dmi_stock_summary
[0m11:51:01.664343 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_stock_summary
[0m11:51:01.664994 [info ] [Thread-1 (]: 2 of 4 START sql table model analytics.fsi_stock_summary ....................... [RUN]
[0m11:51:01.665589 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.dmi_stock_summary, now model.build_fda.fsi_stock_summary)
[0m11:51:01.666002 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_stock_summary
[0m11:51:01.669745 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_stock_summary"
[0m11:51:01.671093 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_stock_summary
[0m11:51:01.673673 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_stock_summary"
[0m11:51:01.675075 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_stock_summary"
[0m11:51:01.675448 [debug] [Thread-1 (]: On model.build_fda.fsi_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_stock_summary"} */
create or replace transient table dev.analytics.fsi_stock_summary
         as
        (WITH interval_widths AS (
    SELECT
        ts,
        forecast,
        lower_bound,
        upper_bound,
        REPLACE(series, '"', '') AS series,
        (upper_bound - lower_bound) AS interval_width
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
),

statistics AS (
    SELECT
        series,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM interval_widths
    GROUP BY series
)

SELECT
    distinct(a.series),
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM interval_widths a
JOIN statistics s
    ON a.series = s.series
        );
[0m11:51:01.675792 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:51:03.007601 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.331 seconds
[0m11:51:03.014983 [debug] [Thread-1 (]: On model.build_fda.fsi_stock_summary: Close
[0m11:51:03.142982 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '250ee561-91d6-4729-bd88-4153e7ed1e25', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1206f0490>]}
[0m11:51:03.144848 [info ] [Thread-1 (]: 2 of 4 OK created sql table model analytics.fsi_stock_summary .................. [[32mSUCCESS 1[0m in 1.48s]
[0m11:51:03.145835 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_stock_summary
[0m11:51:03.146450 [debug] [Thread-1 (]: Began running node model.build_fda.obv_apple_summary
[0m11:51:03.147172 [info ] [Thread-1 (]: 3 of 4 START sql table model analytics.obv_apple_summary ....................... [RUN]
[0m11:51:03.147871 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_stock_summary, now model.build_fda.obv_apple_summary)
[0m11:51:03.148286 [debug] [Thread-1 (]: Began compiling node model.build_fda.obv_apple_summary
[0m11:51:03.152440 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.obv_apple_summary"
[0m11:51:03.153477 [debug] [Thread-1 (]: Began executing node model.build_fda.obv_apple_summary
[0m11:51:03.156089 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.obv_apple_summary"
[0m11:51:03.157641 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.obv_apple_summary"
[0m11:51:03.158029 [debug] [Thread-1 (]: On model.build_fda.obv_apple_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.obv_apple_summary"} */
create or replace transient table dev.analytics.obv_apple_summary
         as
        (WITH ordered_data AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM dev.raw_data.stock_data -- Referencing the raw data table in the dev database
    WHERE symbol = 'AAPL'  -- Filter for Apple symbol
),

obv_calculation AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        CASE
            WHEN close > LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN volume
            WHEN close < LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN -volume
            ELSE 0
        END AS volume_change
    FROM ordered_data
),

cumulative_obv AS (
    SELECT
        date,
        symbol,
        SUM(volume_change) OVER (PARTITION BY symbol ORDER BY date) AS obv
    FROM obv_calculation
)

SELECT
    date,
    symbol,
    obv
FROM cumulative_obv
ORDER BY date
        );
[0m11:51:03.158387 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:51:04.540259 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.381 seconds
[0m11:51:04.547656 [debug] [Thread-1 (]: On model.build_fda.obv_apple_summary: Close
[0m11:51:04.663440 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '250ee561-91d6-4729-bd88-4153e7ed1e25', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1206dd0d0>]}
[0m11:51:04.664512 [info ] [Thread-1 (]: 3 of 4 OK created sql table model analytics.obv_apple_summary .................. [[32mSUCCESS 1[0m in 1.52s]
[0m11:51:04.665334 [debug] [Thread-1 (]: Finished running node model.build_fda.obv_apple_summary
[0m11:51:04.665926 [debug] [Thread-1 (]: Began running node model.build_fda.obv_nvidia_summary
[0m11:51:04.666638 [info ] [Thread-1 (]: 4 of 4 START sql table model analytics.obv_nvidia_summary ...................... [RUN]
[0m11:51:04.667317 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.obv_apple_summary, now model.build_fda.obv_nvidia_summary)
[0m11:51:04.667815 [debug] [Thread-1 (]: Began compiling node model.build_fda.obv_nvidia_summary
[0m11:51:04.671591 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.obv_nvidia_summary"
[0m11:51:04.674503 [debug] [Thread-1 (]: Began executing node model.build_fda.obv_nvidia_summary
[0m11:51:04.679427 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.obv_nvidia_summary"
[0m11:51:04.681024 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.obv_nvidia_summary"
[0m11:51:04.681350 [debug] [Thread-1 (]: On model.build_fda.obv_nvidia_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.obv_nvidia_summary"} */
create or replace transient table dev.analytics.obv_nvidia_summary
         as
        (WITH ordered_data AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM dev.raw_data.stock_data -- Referencing the raw data table in the dev database
    WHERE symbol = 'NVDA'  -- Filter for Nvidia symbol
),

obv_calculation AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        CASE
            WHEN close > LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN volume
            WHEN close < LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN -volume
            ELSE 0
        END AS volume_change
    FROM ordered_data
),

cumulative_obv AS (
    SELECT
        date,
        symbol,
        SUM(volume_change) OVER (PARTITION BY symbol ORDER BY date) AS obv
    FROM obv_calculation
)

SELECT
    date,
    symbol,
    obv
FROM cumulative_obv
ORDER BY date
        );
[0m11:51:04.681658 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:51:06.486931 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.805 seconds
[0m11:51:06.493381 [debug] [Thread-1 (]: On model.build_fda.obv_nvidia_summary: Close
[0m11:51:06.621304 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '250ee561-91d6-4729-bd88-4153e7ed1e25', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108138950>]}
[0m11:51:06.622582 [info ] [Thread-1 (]: 4 of 4 OK created sql table model analytics.obv_nvidia_summary ................. [[32mSUCCESS 1[0m in 1.95s]
[0m11:51:06.623448 [debug] [Thread-1 (]: Finished running node model.build_fda.obv_nvidia_summary
[0m11:51:06.624044 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data
[0m11:51:06.624721 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.obv_nvidia_summary, now model.build_fda.stock_data)
[0m11:51:06.625273 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data
[0m11:51:06.629279 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data"
[0m11:51:06.630582 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data
[0m11:51:06.631017 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data_forecast
[0m11:51:06.631459 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.stock_data, now model.build_fda.stock_data_forecast)
[0m11:51:06.631819 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data_forecast
[0m11:51:06.634198 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data_forecast"
[0m11:51:06.635312 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data_forecast
[0m11:51:06.636516 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:51:06.636776 [debug] [MainThread]: Connection 'model.build_fda.stock_data_forecast' was properly closed.
[0m11:51:06.637107 [info ] [MainThread]: 
[0m11:51:06.637390 [info ] [MainThread]: Finished running 4 table models in 0 hours 0 minutes and 8.14 seconds (8.14s).
[0m11:51:06.638228 [debug] [MainThread]: Command end result
[0m11:51:06.660151 [info ] [MainThread]: 
[0m11:51:06.660482 [info ] [MainThread]: [32mCompleted successfully[0m
[0m11:51:06.660683 [info ] [MainThread]: 
[0m11:51:06.661146 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m11:51:06.663632 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 9.443952, "process_user_time": 2.297898, "process_kernel_time": 1.660992, "process_mem_max_rss": "203849728", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m11:51:06.663973 [debug] [MainThread]: Command `dbt run` succeeded at 11:51:06.663926 after 9.44 seconds
[0m11:51:06.664189 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1031c8150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103212310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103212ed0>]}
[0m11:51:06.664373 [debug] [MainThread]: Flushing usage events
[0m12:30:29.150500 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a13fd50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a19ff10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a1c0d50>]}


============================== 12:30:29.152792 | 634bfbf3-67ab-4861-a978-d4b9e57a5462 ==============================
[0m12:30:29.152792 [info ] [MainThread]: Running with dbt=1.8.7
[0m12:30:29.153113 [debug] [MainThread]: running dbt with arguments {'invocation_command': 'dbt run', 'target_path': 'None', 'cache_selected_only': 'False', 'quiet': 'False', 'static_parser': 'True', 'debug': 'False', 'use_colors': 'True', 'log_format': 'default', 'empty': 'False', 'indirect_selection': 'eager', 'write_json': 'True', 'profiles_dir': '/Users/shatayu/.dbt', 'partial_parse': 'True', 'warn_error': 'None', 'send_anonymous_usage_stats': 'True', 'log_path': '/Users/shatayu/Downloads/DATA226_Lab2Prep/build_fda/logs', 'no_print': 'None', 'use_experimental_parser': 'False', 'version_check': 'True', 'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'printer_width': '80', 'log_cache_events': 'False'}
[0m12:30:30.089338 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '634bfbf3-67ab-4861-a978-d4b9e57a5462', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a1c0b10>]}
[0m12:30:30.113108 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '634bfbf3-67ab-4861-a978-d4b9e57a5462', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109a49410>]}
[0m12:30:30.113916 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m12:30:30.127459 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m12:30:30.200009 [debug] [MainThread]: Partial parsing enabled: 2 files deleted, 1 files added, 3 files changed.
[0m12:30:30.200379 [debug] [MainThread]: Partial parsing: added file: build_fda://models/output/obv_stock_summary.sql
[0m12:30:30.200612 [debug] [MainThread]: Partial parsing: updated file: build_fda://models/source.yml
[0m12:30:30.200744 [debug] [MainThread]: Partial parsing: deleted file: build_fda://models/output/obv_apple_summary.sql
[0m12:30:30.200866 [debug] [MainThread]: Partial parsing: deleted file: build_fda://models/output/obv_nvidia_summary.sql
[0m12:30:30.201128 [debug] [MainThread]: Partial parsing: updated file: build_fda://models/output/fsi_stock_summary.sql
[0m12:30:30.201326 [debug] [MainThread]: Partial parsing: updated file: build_fda://models/output/dmi_stock_summary.sql
[0m12:30:30.344538 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '634bfbf3-67ab-4861-a978-d4b9e57a5462', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14547d4d0>]}
[0m12:30:30.388404 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '634bfbf3-67ab-4861-a978-d4b9e57a5462', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1474b3950>]}
[0m12:30:30.388731 [info ] [MainThread]: Found 5 models, 5 sources, 459 macros
[0m12:30:30.388900 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '634bfbf3-67ab-4861-a978-d4b9e57a5462', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x145638410>]}
[0m12:30:30.389792 [info ] [MainThread]: 
[0m12:30:30.390073 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m12:30:30.392086 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m12:30:30.398425 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m12:30:30.398626 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m12:30:30.398772 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:30:30.955084 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.556 seconds
[0m12:30:30.960680 [debug] [ThreadPool]: On list_dev: Close
[0m12:30:31.104206 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_analytics)
[0m12:30:31.124991 [debug] [ThreadPool]: Using snowflake connection "list_dev_analytics"
[0m12:30:31.125696 [debug] [ThreadPool]: On list_dev_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev_analytics"} */
show objects in dev.analytics limit 10000
[0m12:30:31.125988 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:30:31.649771 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.524 seconds
[0m12:30:31.655094 [debug] [ThreadPool]: On list_dev_analytics: Close
[0m12:30:31.795648 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '634bfbf3-67ab-4861-a978-d4b9e57a5462', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1474bb050>]}
[0m12:30:31.797583 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m12:30:31.798990 [info ] [MainThread]: 
[0m12:30:31.806767 [debug] [Thread-1 (]: Began running node model.build_fda.dmi_stock_summary
[0m12:30:31.808539 [info ] [Thread-1 (]: 1 of 3 START sql table model analytics.dmi_stock_summary ....................... [RUN]
[0m12:30:31.809548 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_analytics, now model.build_fda.dmi_stock_summary)
[0m12:30:31.810184 [debug] [Thread-1 (]: Began compiling node model.build_fda.dmi_stock_summary
[0m12:30:31.883734 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.dmi_stock_summary"
[0m12:30:31.884477 [debug] [Thread-1 (]: Began executing node model.build_fda.dmi_stock_summary
[0m12:30:31.897308 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.dmi_stock_summary"
[0m12:30:31.898612 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.dmi_stock_summary"
[0m12:30:31.898852 [debug] [Thread-1 (]: On model.build_fda.dmi_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.dmi_stock_summary"} */
create or replace transient table dev.analytics.dmi_stock_summary
         as
        (WITH stock_prices AS (
    SELECT
        date,
        close,
        symbol
    FROM dev.raw_data.stock_data
    WHERE symbol IN ('AAPL', 'NVDA')  -- Including both Apple and Nvidia
),

-- Calculate the 20-day SMA and 20-day standard deviation for both symbols
sma_stddev AS (
    SELECT
        date,
        symbol,
        close,
        AVG(close) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS middle_band,
        STDDEV(close) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS stddev_20
    FROM stock_prices
),

-- Calculate the upper and lower bands
bands AS (
    SELECT
        date,
        symbol,
        close,
        middle_band,
        (middle_band + (2 * stddev_20)) AS upper_band,
        (middle_band - (2 * stddev_20)) AS lower_band
    FROM sma_stddev
),

-- Calculate +DI and -DI based on daily price movements for each stock symbol
directional_indicators AS (
    SELECT
        date,
        symbol,
        close,
        middle_band,
        upper_band,
        lower_band,
        LAG(close, 1) OVER (PARTITION BY symbol ORDER BY date) AS prev_close,
        -- +DI: Calculate positive movement
        CASE WHEN close > prev_close THEN close - prev_close ELSE 0 END AS plus_di,
        -- -DI: Calculate negative movement
        CASE WHEN close < prev_close THEN prev_close - close ELSE 0 END AS minus_di
    FROM bands
)

SELECT
    date,
    symbol,  -- To differentiate between Apple and Nvidia
    close,
    middle_band,
    upper_band,
    lower_band,
    -- Summing up DI over the 20-day period for smoother trend analysis
    SUM(plus_di) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS plus_di_twenty,
    SUM(minus_di) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS minus_di_twenty
FROM directional_indicators
ORDER BY symbol, date
        );
[0m12:30:31.899061 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:30:37.677009 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 5.777 seconds
[0m12:30:37.703551 [debug] [Thread-1 (]: On model.build_fda.dmi_stock_summary: Close
[0m12:30:37.823947 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '634bfbf3-67ab-4861-a978-d4b9e57a5462', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x145882010>]}
[0m12:30:37.825293 [info ] [Thread-1 (]: 1 of 3 OK created sql table model analytics.dmi_stock_summary .................. [[32mSUCCESS 1[0m in 6.01s]
[0m12:30:37.826159 [debug] [Thread-1 (]: Finished running node model.build_fda.dmi_stock_summary
[0m12:30:37.826683 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_stock_summary
[0m12:30:37.827329 [info ] [Thread-1 (]: 2 of 3 START sql table model analytics.fsi_stock_summary ....................... [RUN]
[0m12:30:37.827933 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.dmi_stock_summary, now model.build_fda.fsi_stock_summary)
[0m12:30:37.828350 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_stock_summary
[0m12:30:37.831814 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_stock_summary"
[0m12:30:37.834147 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_stock_summary
[0m12:30:37.837033 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_stock_summary"
[0m12:30:37.838532 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_stock_summary"
[0m12:30:37.838919 [debug] [Thread-1 (]: On model.build_fda.fsi_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_stock_summary"} */
create or replace transient table dev.analytics.fsi_stock_summary
         as
        (WITH interval_widths AS (
    SELECT
        ts,
        forecast,
        lower_bound,
        upper_bound,
        REPLACE(series, '"', '') AS symbol,
        (upper_bound - lower_bound) AS interval_width
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
),

statistics AS (
    SELECT
        symbol,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM interval_widths
    GROUP BY symbol
)

SELECT
    distinct(a.symbol),
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM interval_widths a
JOIN statistics s
    ON a.symbol = s.symbol
        );
[0m12:30:37.839273 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:30:39.316590 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.477 seconds
[0m12:30:39.320204 [debug] [Thread-1 (]: On model.build_fda.fsi_stock_summary: Close
[0m12:30:39.449932 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '634bfbf3-67ab-4861-a978-d4b9e57a5462', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14751b210>]}
[0m12:30:39.452778 [info ] [Thread-1 (]: 2 of 3 OK created sql table model analytics.fsi_stock_summary .................. [[32mSUCCESS 1[0m in 1.62s]
[0m12:30:39.453431 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_stock_summary
[0m12:30:39.453794 [debug] [Thread-1 (]: Began running node model.build_fda.obv_stock_summary
[0m12:30:39.454271 [info ] [Thread-1 (]: 3 of 3 START sql table model analytics.obv_stock_summary ....................... [RUN]
[0m12:30:39.454705 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_stock_summary, now model.build_fda.obv_stock_summary)
[0m12:30:39.454998 [debug] [Thread-1 (]: Began compiling node model.build_fda.obv_stock_summary
[0m12:30:39.458036 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.obv_stock_summary"
[0m12:30:39.458892 [debug] [Thread-1 (]: Began executing node model.build_fda.obv_stock_summary
[0m12:30:39.460799 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.obv_stock_summary"
[0m12:30:39.461929 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.obv_stock_summary"
[0m12:30:39.462211 [debug] [Thread-1 (]: On model.build_fda.obv_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.obv_stock_summary"} */
create or replace transient table dev.analytics.obv_stock_summary
         as
        (WITH ordered_data AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM dev.raw_data.stock_data -- Referencing the raw data table in the dev database
    WHERE symbol IN ('AAPL', 'NVDA')  -- Include both AAPL and NVDA symbols
),

obv_calculation AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        CASE
            WHEN close > LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN volume
            WHEN close < LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN -volume
            ELSE 0
        END AS volume_change
    FROM ordered_data
),

cumulative_obv AS (
    SELECT
        date,
        symbol,
        SUM(volume_change) OVER (PARTITION BY symbol ORDER BY date) AS obv
    FROM obv_calculation
)

SELECT
    date,
    symbol,
    obv
FROM cumulative_obv
ORDER BY symbol, date
        );
[0m12:30:39.462463 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:30:40.952949 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.490 seconds
[0m12:30:40.958477 [debug] [Thread-1 (]: On model.build_fda.obv_stock_summary: Close
[0m12:30:41.100081 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '634bfbf3-67ab-4861-a978-d4b9e57a5462', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14561e850>]}
[0m12:30:41.101269 [info ] [Thread-1 (]: 3 of 3 OK created sql table model analytics.obv_stock_summary .................. [[32mSUCCESS 1[0m in 1.65s]
[0m12:30:41.102089 [debug] [Thread-1 (]: Finished running node model.build_fda.obv_stock_summary
[0m12:30:41.102664 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data
[0m12:30:41.103233 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.obv_stock_summary, now model.build_fda.stock_data)
[0m12:30:41.103727 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data
[0m12:30:41.109636 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data"
[0m12:30:41.110982 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data
[0m12:30:41.111336 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data_forecast
[0m12:30:41.111705 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.stock_data, now model.build_fda.stock_data_forecast)
[0m12:30:41.112003 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data_forecast
[0m12:30:41.114295 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data_forecast"
[0m12:30:41.115429 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data_forecast
[0m12:30:41.116639 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:30:41.116869 [debug] [MainThread]: Connection 'model.build_fda.stock_data_forecast' was properly closed.
[0m12:30:41.117166 [info ] [MainThread]: 
[0m12:30:41.117423 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 10.73 seconds (10.73s).
[0m12:30:41.118060 [debug] [MainThread]: Command end result
[0m12:30:41.138331 [info ] [MainThread]: 
[0m12:30:41.138634 [info ] [MainThread]: [32mCompleted successfully[0m
[0m12:30:41.138821 [info ] [MainThread]: 
[0m12:30:41.139014 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m12:30:41.141248 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 12.046327, "process_user_time": 2.428643, "process_kernel_time": 1.478467, "process_mem_max_rss": "205209600", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m12:30:41.141552 [debug] [MainThread]: Command `dbt run` succeeded at 12:30:41.141504 after 12.05 seconds
[0m12:30:41.141765 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104cd4150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104dad410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104d1f4d0>]}
[0m12:30:41.141960 [debug] [MainThread]: Flushing usage events
[0m12:36:48.997498 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a17bf90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a1dbbd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a1fc750>]}


============================== 12:36:48.999439 | 66a084ad-4e1d-4ed2-9e10-485d430b6d73 ==============================
[0m12:36:48.999439 [info ] [MainThread]: Running with dbt=1.8.7
[0m12:36:48.999767 [debug] [MainThread]: running dbt with arguments {'target_path': 'None', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'static_parser': 'True', 'log_path': '/Users/shatayu/Downloads/DATA226_Lab2Prep/build_fda/logs', 'no_print': 'None', 'use_experimental_parser': 'False', 'warn_error': 'None', 'empty': 'False', 'write_json': 'True', 'debug': 'False', 'quiet': 'False', 'partial_parse': 'True', 'log_format': 'default', 'use_colors': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'log_cache_events': 'False', 'introspect': 'True', 'invocation_command': 'dbt run', 'profiles_dir': '/Users/shatayu/.dbt', 'version_check': 'True', 'printer_width': '80'}
[0m12:36:49.944890 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '66a084ad-4e1d-4ed2-9e10-485d430b6d73', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10dd84150>]}
[0m12:36:49.964901 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '66a084ad-4e1d-4ed2-9e10-485d430b6d73', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109b45590>]}
[0m12:36:49.965470 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m12:36:49.977517 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m12:36:50.048345 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m12:36:50.048899 [debug] [MainThread]: Partial parsing: updated file: build_fda://models/source.yml
[0m12:36:50.189662 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '66a084ad-4e1d-4ed2-9e10-485d430b6d73', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13dd34dd0>]}
[0m12:36:50.229551 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '66a084ad-4e1d-4ed2-9e10-485d430b6d73', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13ebe6d50>]}
[0m12:36:50.229828 [info ] [MainThread]: Found 5 models, 5 sources, 459 macros
[0m12:36:50.229997 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '66a084ad-4e1d-4ed2-9e10-485d430b6d73', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13eab5790>]}
[0m12:36:50.230858 [info ] [MainThread]: 
[0m12:36:50.231122 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m12:36:50.233057 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m12:36:50.238827 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m12:36:50.238985 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m12:36:50.239109 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:36:50.830436 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.591 seconds
[0m12:36:50.835278 [debug] [ThreadPool]: On list_dev: Close
[0m12:36:50.967669 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_analytics)
[0m12:36:50.980628 [debug] [ThreadPool]: Using snowflake connection "list_dev_analytics"
[0m12:36:50.981106 [debug] [ThreadPool]: On list_dev_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev_analytics"} */
show objects in dev.analytics limit 10000
[0m12:36:50.981436 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:36:51.539486 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.557 seconds
[0m12:36:51.547460 [debug] [ThreadPool]: On list_dev_analytics: Close
[0m12:36:51.672401 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '66a084ad-4e1d-4ed2-9e10-485d430b6d73', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13eb50150>]}
[0m12:36:51.673366 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m12:36:51.673817 [info ] [MainThread]: 
[0m12:36:51.677295 [debug] [Thread-1 (]: Began running node model.build_fda.dmi_stock_summary
[0m12:36:51.678007 [info ] [Thread-1 (]: 1 of 3 START sql table model analytics.dmi_stock_summary ....................... [RUN]
[0m12:36:51.678559 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_analytics, now model.build_fda.dmi_stock_summary)
[0m12:36:51.678937 [debug] [Thread-1 (]: Began compiling node model.build_fda.dmi_stock_summary
[0m12:36:51.688420 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.dmi_stock_summary"
[0m12:36:51.689606 [debug] [Thread-1 (]: Began executing node model.build_fda.dmi_stock_summary
[0m12:36:51.710241 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.dmi_stock_summary"
[0m12:36:51.711933 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.dmi_stock_summary"
[0m12:36:51.712273 [debug] [Thread-1 (]: On model.build_fda.dmi_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.dmi_stock_summary"} */
create or replace transient table dev.analytics.dmi_stock_summary
         as
        (WITH stock_prices AS (
    SELECT
        date,
        close,
        symbol
    FROM dev.raw_data.stock_data
    WHERE symbol IN ('AAPL', 'NVDA')  -- Including both Apple and Nvidia
),

-- Calculate the 20-day SMA and 20-day standard deviation for both symbols
sma_stddev AS (
    SELECT
        date,
        symbol,
        close,
        AVG(close) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS middle_band,
        STDDEV(close) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS stddev_20
    FROM stock_prices
),

-- Calculate the upper and lower bands
bands AS (
    SELECT
        date,
        symbol,
        close,
        middle_band,
        (middle_band + (2 * stddev_20)) AS upper_band,
        (middle_band - (2 * stddev_20)) AS lower_band
    FROM sma_stddev
),

-- Calculate +DI and -DI based on daily price movements for each stock symbol
directional_indicators AS (
    SELECT
        date,
        symbol,
        close,
        middle_band,
        upper_band,
        lower_band,
        LAG(close, 1) OVER (PARTITION BY symbol ORDER BY date) AS prev_close,
        -- +DI: Calculate positive movement
        CASE WHEN close > prev_close THEN close - prev_close ELSE 0 END AS plus_di,
        -- -DI: Calculate negative movement
        CASE WHEN close < prev_close THEN prev_close - close ELSE 0 END AS minus_di
    FROM bands
)

SELECT
    date,
    symbol,  -- To differentiate between Apple and Nvidia
    close,
    middle_band,
    upper_band,
    lower_band,
    -- Summing up DI over the 20-day period for smoother trend analysis
    SUM(plus_di) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS plus_di_twenty,
    SUM(minus_di) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS minus_di_twenty
FROM directional_indicators
ORDER BY symbol, date
        );
[0m12:36:51.712564 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:36:53.383999 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.671 seconds
[0m12:36:53.396448 [debug] [Thread-1 (]: On model.build_fda.dmi_stock_summary: Close
[0m12:36:53.505190 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '66a084ad-4e1d-4ed2-9e10-485d430b6d73', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13ea36510>]}
[0m12:36:53.506282 [info ] [Thread-1 (]: 1 of 3 OK created sql table model analytics.dmi_stock_summary .................. [[32mSUCCESS 1[0m in 1.83s]
[0m12:36:53.506912 [debug] [Thread-1 (]: Finished running node model.build_fda.dmi_stock_summary
[0m12:36:53.507363 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_stock_summary
[0m12:36:53.507765 [info ] [Thread-1 (]: 2 of 3 START sql table model analytics.fsi_stock_summary ....................... [RUN]
[0m12:36:53.508179 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.dmi_stock_summary, now model.build_fda.fsi_stock_summary)
[0m12:36:53.508515 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_stock_summary
[0m12:36:53.512206 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_stock_summary"
[0m12:36:53.514358 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_stock_summary
[0m12:36:53.517386 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_stock_summary"
[0m12:36:53.518854 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_stock_summary"
[0m12:36:53.519229 [debug] [Thread-1 (]: On model.build_fda.fsi_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_stock_summary"} */
create or replace transient table dev.analytics.fsi_stock_summary
         as
        (WITH interval_widths AS (
    SELECT
        ts,
        forecast,
        lower_bound,
        upper_bound,
        REPLACE(series, '"', '') AS symbol,
        (upper_bound - lower_bound) AS interval_width
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
),

statistics AS (
    SELECT
        symbol,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM interval_widths
    GROUP BY symbol
)

SELECT
    distinct(a.symbol),
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM interval_widths a
JOIN statistics s
    ON a.symbol = s.symbol
        );
[0m12:36:53.519588 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:36:54.716706 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.195 seconds
[0m12:36:54.723441 [debug] [Thread-1 (]: On model.build_fda.fsi_stock_summary: Close
[0m12:36:54.842024 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '66a084ad-4e1d-4ed2-9e10-485d430b6d73', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13ee86390>]}
[0m12:36:54.843126 [info ] [Thread-1 (]: 2 of 3 OK created sql table model analytics.fsi_stock_summary .................. [[32mSUCCESS 1[0m in 1.33s]
[0m12:36:54.843882 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_stock_summary
[0m12:36:54.844886 [debug] [Thread-1 (]: Began running node model.build_fda.obv_stock_summary
[0m12:36:54.846222 [info ] [Thread-1 (]: 3 of 3 START sql table model analytics.obv_stock_summary ....................... [RUN]
[0m12:36:54.847365 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_stock_summary, now model.build_fda.obv_stock_summary)
[0m12:36:54.848291 [debug] [Thread-1 (]: Began compiling node model.build_fda.obv_stock_summary
[0m12:36:54.853708 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.obv_stock_summary"
[0m12:36:54.856541 [debug] [Thread-1 (]: Began executing node model.build_fda.obv_stock_summary
[0m12:36:54.860804 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.obv_stock_summary"
[0m12:36:54.863127 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.obv_stock_summary"
[0m12:36:54.863704 [debug] [Thread-1 (]: On model.build_fda.obv_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.obv_stock_summary"} */
create or replace transient table dev.analytics.obv_stock_summary
         as
        (WITH ordered_data AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM dev.raw_data.stock_data -- Referencing the raw data table in the dev database
    WHERE symbol IN ('AAPL', 'NVDA')  -- Include both AAPL and NVDA symbols
),

obv_calculation AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        CASE
            WHEN close > LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN volume
            WHEN close < LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN -volume
            ELSE 0
        END AS volume_change
    FROM ordered_data
),

cumulative_obv AS (
    SELECT
        date,
        symbol,
        SUM(volume_change) OVER (PARTITION BY symbol ORDER BY date) AS obv
    FROM obv_calculation
)

SELECT
    date,
    symbol,
    obv
FROM cumulative_obv
ORDER BY symbol, date
        );
[0m12:36:54.864082 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:36:56.125332 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.260 seconds
[0m12:36:56.133475 [debug] [Thread-1 (]: On model.build_fda.obv_stock_summary: Close
[0m12:36:56.264421 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '66a084ad-4e1d-4ed2-9e10-485d430b6d73', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13dd8f890>]}
[0m12:36:56.267261 [info ] [Thread-1 (]: 3 of 3 OK created sql table model analytics.obv_stock_summary .................. [[32mSUCCESS 1[0m in 1.42s]
[0m12:36:56.269267 [debug] [Thread-1 (]: Finished running node model.build_fda.obv_stock_summary
[0m12:36:56.270220 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data
[0m12:36:56.271354 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.obv_stock_summary, now model.build_fda.stock_data)
[0m12:36:56.272078 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data
[0m12:36:56.280071 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data"
[0m12:36:56.282336 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data
[0m12:36:56.282993 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data_forecast
[0m12:36:56.283660 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.stock_data, now model.build_fda.stock_data_forecast)
[0m12:36:56.284211 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data_forecast
[0m12:36:56.287989 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data_forecast"
[0m12:36:56.289510 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data_forecast
[0m12:36:56.291170 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:36:56.291573 [debug] [MainThread]: Connection 'model.build_fda.stock_data_forecast' was properly closed.
[0m12:36:56.292048 [info ] [MainThread]: 
[0m12:36:56.292465 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 6.06 seconds (6.06s).
[0m12:36:56.293355 [debug] [MainThread]: Command end result
[0m12:36:56.319413 [info ] [MainThread]: 
[0m12:36:56.319783 [info ] [MainThread]: [32mCompleted successfully[0m
[0m12:36:56.319999 [info ] [MainThread]: 
[0m12:36:56.320223 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m12:36:56.322619 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 7.3739514, "process_user_time": 2.235955, "process_kernel_time": 1.64846, "process_mem_max_rss": "204800000", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m12:36:56.322998 [debug] [MainThread]: Command `dbt run` succeeded at 12:36:56.322936 after 7.37 seconds
[0m12:36:56.323250 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f1c150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104ff5410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f674d0>]}
[0m12:36:56.323477 [debug] [MainThread]: Flushing usage events
[0m16:13:42.944054 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1075cc5d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107983c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1079a4c90>]}


============================== 16:13:42.946115 | 5ecc6467-aca4-4173-ab9a-fa5b21ebea87 ==============================
[0m16:13:42.946115 [info ] [MainThread]: Running with dbt=1.8.7
[0m16:13:42.946440 [debug] [MainThread]: running dbt with arguments {'use_colors': 'True', 'partial_parse': 'True', 'profiles_dir': '/Users/shatayu/.dbt', 'empty': 'False', 'cache_selected_only': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'log_format': 'default', 'warn_error': 'None', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'invocation_command': 'dbt run', 'version_check': 'True', 'introspect': 'True', 'quiet': 'False', 'printer_width': '80', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'use_experimental_parser': 'False', 'debug': 'False', 'target_path': 'None', 'no_print': 'None', 'log_path': '/Users/shatayu/Downloads/DATA226_Lab2Prep/build_fda/logs', 'write_json': 'True', 'fail_fast': 'False'}
[0m16:13:43.911233 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5ecc6467-aca4-4173-ab9a-fa5b21ebea87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1079b4690>]}
[0m16:13:43.931604 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5ecc6467-aca4-4173-ab9a-fa5b21ebea87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1073ed690>]}
[0m16:13:43.932199 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m16:13:43.944498 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m16:13:44.014061 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m16:13:44.014402 [debug] [MainThread]: Partial parsing: updated file: build_fda://models/output/fsi_stock_summary.sql
[0m16:13:44.116423 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5ecc6467-aca4-4173-ab9a-fa5b21ebea87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1207e0d10>]}
[0m16:13:44.159265 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5ecc6467-aca4-4173-ab9a-fa5b21ebea87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120a4f410>]}
[0m16:13:44.159563 [info ] [MainThread]: Found 5 models, 5 sources, 459 macros
[0m16:13:44.159733 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5ecc6467-aca4-4173-ab9a-fa5b21ebea87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120adb950>]}
[0m16:13:44.160581 [info ] [MainThread]: 
[0m16:13:44.160871 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m16:13:44.162780 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m16:13:44.168561 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m16:13:44.168727 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m16:13:44.168851 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:13:44.834497 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.665 seconds
[0m16:13:44.837059 [debug] [ThreadPool]: On list_dev: Close
[0m16:13:44.954345 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_analytics)
[0m16:13:44.965392 [debug] [ThreadPool]: Using snowflake connection "list_dev_analytics"
[0m16:13:44.965749 [debug] [ThreadPool]: On list_dev_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev_analytics"} */
show objects in dev.analytics limit 10000
[0m16:13:44.966021 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:13:45.451188 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.485 seconds
[0m16:13:45.454491 [debug] [ThreadPool]: On list_dev_analytics: Close
[0m16:13:45.669529 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5ecc6467-aca4-4173-ab9a-fa5b21ebea87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12071c050>]}
[0m16:13:45.670520 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m16:13:45.671004 [info ] [MainThread]: 
[0m16:13:45.675739 [debug] [Thread-1 (]: Began running node model.build_fda.dmi_stock_summary
[0m16:13:45.676375 [info ] [Thread-1 (]: 1 of 3 START sql table model analytics.dmi_stock_summary ....................... [RUN]
[0m16:13:45.676853 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_analytics, now model.build_fda.dmi_stock_summary)
[0m16:13:45.677206 [debug] [Thread-1 (]: Began compiling node model.build_fda.dmi_stock_summary
[0m16:13:45.685529 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.dmi_stock_summary"
[0m16:13:45.686997 [debug] [Thread-1 (]: Began executing node model.build_fda.dmi_stock_summary
[0m16:13:45.706618 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.dmi_stock_summary"
[0m16:13:45.708195 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.dmi_stock_summary"
[0m16:13:45.708606 [debug] [Thread-1 (]: On model.build_fda.dmi_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.dmi_stock_summary"} */
create or replace transient table dev.analytics.dmi_stock_summary
         as
        (WITH stock_prices AS (
    SELECT
        date,
        close,
        symbol
    FROM dev.raw_data.stock_data
    WHERE symbol IN ('AAPL', 'NVDA')  -- Including both Apple and Nvidia
),

-- Calculate the 20-day SMA and 20-day standard deviation for both symbols
sma_stddev AS (
    SELECT
        date,
        symbol,
        close,
        AVG(close) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS middle_band,
        STDDEV(close) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS stddev_20
    FROM stock_prices
),

-- Calculate the upper and lower bands
bands AS (
    SELECT
        date,
        symbol,
        close,
        middle_band,
        (middle_band + (2 * stddev_20)) AS upper_band,
        (middle_band - (2 * stddev_20)) AS lower_band
    FROM sma_stddev
),

-- Calculate +DI and -DI based on daily price movements for each stock symbol
directional_indicators AS (
    SELECT
        date,
        symbol,
        close,
        middle_band,
        upper_band,
        lower_band,
        LAG(close, 1) OVER (PARTITION BY symbol ORDER BY date) AS prev_close,
        -- +DI: Calculate positive movement
        CASE WHEN close > prev_close THEN close - prev_close ELSE 0 END AS plus_di,
        -- -DI: Calculate negative movement
        CASE WHEN close < prev_close THEN prev_close - close ELSE 0 END AS minus_di
    FROM bands
)

SELECT
    date,
    symbol,  -- To differentiate between Apple and Nvidia
    close,
    middle_band,
    upper_band,
    lower_band,
    -- Summing up DI over the 20-day period for smoother trend analysis
    SUM(plus_di) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS plus_di_twenty,
    SUM(minus_di) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS minus_di_twenty
FROM directional_indicators
ORDER BY symbol, date
        );
[0m16:13:45.708937 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:13:47.703336 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.994 seconds
[0m16:13:47.727684 [debug] [Thread-1 (]: On model.build_fda.dmi_stock_summary: Close
[0m16:13:47.848288 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5ecc6467-aca4-4173-ab9a-fa5b21ebea87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120d16590>]}
[0m16:13:47.850351 [info ] [Thread-1 (]: 1 of 3 OK created sql table model analytics.dmi_stock_summary .................. [[32mSUCCESS 1[0m in 2.17s]
[0m16:13:47.851614 [debug] [Thread-1 (]: Finished running node model.build_fda.dmi_stock_summary
[0m16:13:47.852300 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_stock_summary
[0m16:13:47.853026 [info ] [Thread-1 (]: 2 of 3 START sql table model analytics.fsi_stock_summary ....................... [RUN]
[0m16:13:47.853590 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.dmi_stock_summary, now model.build_fda.fsi_stock_summary)
[0m16:13:47.854001 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_stock_summary
[0m16:13:47.857458 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_stock_summary"
[0m16:13:47.859791 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_stock_summary
[0m16:13:47.862627 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_stock_summary"
[0m16:13:47.864188 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_stock_summary"
[0m16:13:47.864575 [debug] [Thread-1 (]: On model.build_fda.fsi_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_stock_summary"} */
create or replace transient table dev.analytics.fsi_stock_summary
         as
        (WITH interval_widths AS (
    SELECT
        ts,
        forecast,
        lower_bound,
        upper_bound,
        REPLACE(series, '"', '') AS symbol,
        (upper_bound - lower_bound) AS interval_width
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
),

statistics AS (
    SELECT
        symbol,
        forecast,
        lower_bound,
        upper_bound,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM interval_widths
    GROUP BY symbol
)

SELECT
    a.symbol,
    forecast,
    lower_bound,
    upper_bound,
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM interval_widths a
JOIN statistics s
    ON a.symbol = s.symbol
        );
[0m16:13:47.864938 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:13:48.351911 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b8550d-0004-26af-0000-000255f3adc1
[0m16:13:48.352472 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 002028 (42601): SQL compilation error:
ambiguous column name 'FORECAST'
[0m16:13:48.352935 [debug] [Thread-1 (]: On model.build_fda.fsi_stock_summary: Close
[0m16:13:48.500534 [debug] [Thread-1 (]: Database Error in model fsi_stock_summary (models/output/fsi_stock_summary.sql)
  002028 (42601): SQL compilation error:
  ambiguous column name 'FORECAST'
  compiled code at target/run/build_fda/models/output/fsi_stock_summary.sql
[0m16:13:48.501260 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5ecc6467-aca4-4173-ab9a-fa5b21ebea87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120c486d0>]}
[0m16:13:48.502024 [error] [Thread-1 (]: 2 of 3 ERROR creating sql table model analytics.fsi_stock_summary .............. [[31mERROR[0m in 0.65s]
[0m16:13:48.502668 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_stock_summary
[0m16:13:48.503125 [debug] [Thread-1 (]: Began running node model.build_fda.obv_stock_summary
[0m16:13:48.504036 [info ] [Thread-1 (]: 3 of 3 START sql table model analytics.obv_stock_summary ....................... [RUN]
[0m16:13:48.504873 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_stock_summary, now model.build_fda.obv_stock_summary)
[0m16:13:48.505292 [debug] [Thread-1 (]: Began compiling node model.build_fda.obv_stock_summary
[0m16:13:48.508720 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.obv_stock_summary"
[0m16:13:48.510204 [debug] [Thread-1 (]: Began executing node model.build_fda.obv_stock_summary
[0m16:13:48.575084 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.obv_stock_summary"
[0m16:13:48.576114 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.obv_stock_summary"
[0m16:13:48.576319 [debug] [Thread-1 (]: On model.build_fda.obv_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.obv_stock_summary"} */
create or replace transient table dev.analytics.obv_stock_summary
         as
        (WITH ordered_data AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM dev.raw_data.stock_data -- Referencing the raw data table in the dev database
    WHERE symbol IN ('AAPL', 'NVDA')  -- Include both AAPL and NVDA symbols
),

obv_calculation AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        CASE
            WHEN close > LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN volume
            WHEN close < LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN -volume
            ELSE 0
        END AS volume_change
    FROM ordered_data
),

cumulative_obv AS (
    SELECT
        date,
        symbol,
        SUM(volume_change) OVER (PARTITION BY symbol ORDER BY date) AS obv
    FROM obv_calculation
)

SELECT
    date,
    symbol,
    obv
FROM cumulative_obv
ORDER BY symbol, date
        );
[0m16:13:48.576498 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:13:50.158541 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.581 seconds
[0m16:13:50.162422 [debug] [Thread-1 (]: On model.build_fda.obv_stock_summary: Close
[0m16:13:50.295438 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5ecc6467-aca4-4173-ab9a-fa5b21ebea87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120d1c690>]}
[0m16:13:50.296432 [info ] [Thread-1 (]: 3 of 3 OK created sql table model analytics.obv_stock_summary .................. [[32mSUCCESS 1[0m in 1.79s]
[0m16:13:50.297224 [debug] [Thread-1 (]: Finished running node model.build_fda.obv_stock_summary
[0m16:13:50.297770 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data
[0m16:13:50.298389 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.obv_stock_summary, now model.build_fda.stock_data)
[0m16:13:50.298941 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data
[0m16:13:50.303002 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data"
[0m16:13:50.304556 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data
[0m16:13:50.304951 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data_forecast
[0m16:13:50.305388 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.stock_data, now model.build_fda.stock_data_forecast)
[0m16:13:50.305771 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data_forecast
[0m16:13:50.308124 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data_forecast"
[0m16:13:50.309316 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data_forecast
[0m16:13:50.310482 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:13:50.310782 [debug] [MainThread]: Connection 'model.build_fda.stock_data_forecast' was properly closed.
[0m16:13:50.311136 [info ] [MainThread]: 
[0m16:13:50.311464 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 6.15 seconds (6.15s).
[0m16:13:50.312194 [debug] [MainThread]: Command end result
[0m16:13:50.334003 [info ] [MainThread]: 
[0m16:13:50.334317 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m16:13:50.334499 [info ] [MainThread]: 
[0m16:13:50.334746 [error] [MainThread]:   Database Error in model fsi_stock_summary (models/output/fsi_stock_summary.sql)
  002028 (42601): SQL compilation error:
  ambiguous column name 'FORECAST'
  compiled code at target/run/build_fda/models/output/fsi_stock_summary.sql
[0m16:13:50.334925 [info ] [MainThread]: 
[0m16:13:50.335119 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
[0m16:13:50.337249 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 7.4451065, "process_user_time": 2.352486, "process_kernel_time": 1.520678, "process_mem_max_rss": "203554816", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m16:13:50.337547 [debug] [MainThread]: Command `dbt run` failed at 16:13:50.337501 after 7.45 seconds
[0m16:13:50.337758 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10356c150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1052b26d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12075ddd0>]}
[0m16:13:50.337952 [debug] [MainThread]: Flushing usage events
[0m16:15:46.604866 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10920d850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10925bbd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10925bc10>]}


============================== 16:15:46.606849 | d562dcf7-6644-466e-aa6a-ed710b051672 ==============================
[0m16:15:46.606849 [info ] [MainThread]: Running with dbt=1.8.7
[0m16:15:46.607189 [debug] [MainThread]: running dbt with arguments {'debug': 'False', 'target_path': 'None', 'warn_error': 'None', 'invocation_command': 'dbt run', 'log_path': '/Users/shatayu/Downloads/DATA226_Lab2Prep/build_fda/logs', 'empty': 'False', 'quiet': 'False', 'write_json': 'True', 'version_check': 'True', 'log_cache_events': 'False', 'cache_selected_only': 'False', 'partial_parse': 'True', 'printer_width': '80', 'static_parser': 'True', 'fail_fast': 'False', 'log_format': 'default', 'no_print': 'None', 'send_anonymous_usage_stats': 'True', 'introspect': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'indirect_selection': 'eager', 'profiles_dir': '/Users/shatayu/.dbt', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])'}
[0m16:15:47.430195 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd562dcf7-6644-466e-aa6a-ed710b051672', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f7a6b50>]}
[0m16:15:47.450569 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd562dcf7-6644-466e-aa6a-ed710b051672', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108cc55d0>]}
[0m16:15:47.451155 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m16:15:47.463196 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m16:15:47.530168 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m16:15:47.530531 [debug] [MainThread]: Partial parsing: updated file: build_fda://models/output/fsi_stock_summary.sql
[0m16:15:47.632932 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd562dcf7-6644-466e-aa6a-ed710b051672', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f7a7a50>]}
[0m16:15:47.673122 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd562dcf7-6644-466e-aa6a-ed710b051672', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13c49f510>]}
[0m16:15:47.673430 [info ] [MainThread]: Found 5 models, 5 sources, 459 macros
[0m16:15:47.673601 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd562dcf7-6644-466e-aa6a-ed710b051672', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13c4682d0>]}
[0m16:15:47.674475 [info ] [MainThread]: 
[0m16:15:47.674796 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m16:15:47.676748 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m16:15:47.682625 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m16:15:47.682794 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m16:15:47.682927 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:15:48.266901 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.583 seconds
[0m16:15:48.270318 [debug] [ThreadPool]: On list_dev: Close
[0m16:15:48.381371 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_analytics)
[0m16:15:48.392497 [debug] [ThreadPool]: Using snowflake connection "list_dev_analytics"
[0m16:15:48.392895 [debug] [ThreadPool]: On list_dev_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev_analytics"} */
show objects in dev.analytics limit 10000
[0m16:15:48.393130 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:15:48.908459 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.515 seconds
[0m16:15:48.912424 [debug] [ThreadPool]: On list_dev_analytics: Close
[0m16:15:49.023589 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd562dcf7-6644-466e-aa6a-ed710b051672', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108ea4110>]}
[0m16:15:49.024457 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m16:15:49.024901 [info ] [MainThread]: 
[0m16:15:49.028306 [debug] [Thread-1 (]: Began running node model.build_fda.dmi_stock_summary
[0m16:15:49.028992 [info ] [Thread-1 (]: 1 of 3 START sql table model analytics.dmi_stock_summary ....................... [RUN]
[0m16:15:49.029513 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_analytics, now model.build_fda.dmi_stock_summary)
[0m16:15:49.029903 [debug] [Thread-1 (]: Began compiling node model.build_fda.dmi_stock_summary
[0m16:15:49.038179 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.dmi_stock_summary"
[0m16:15:49.039020 [debug] [Thread-1 (]: Began executing node model.build_fda.dmi_stock_summary
[0m16:15:49.059051 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.dmi_stock_summary"
[0m16:15:49.060636 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.dmi_stock_summary"
[0m16:15:49.060968 [debug] [Thread-1 (]: On model.build_fda.dmi_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.dmi_stock_summary"} */
create or replace transient table dev.analytics.dmi_stock_summary
         as
        (WITH stock_prices AS (
    SELECT
        date,
        close,
        symbol
    FROM dev.raw_data.stock_data
    WHERE symbol IN ('AAPL', 'NVDA')  -- Including both Apple and Nvidia
),

-- Calculate the 20-day SMA and 20-day standard deviation for both symbols
sma_stddev AS (
    SELECT
        date,
        symbol,
        close,
        AVG(close) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS middle_band,
        STDDEV(close) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS stddev_20
    FROM stock_prices
),

-- Calculate the upper and lower bands
bands AS (
    SELECT
        date,
        symbol,
        close,
        middle_band,
        (middle_band + (2 * stddev_20)) AS upper_band,
        (middle_band - (2 * stddev_20)) AS lower_band
    FROM sma_stddev
),

-- Calculate +DI and -DI based on daily price movements for each stock symbol
directional_indicators AS (
    SELECT
        date,
        symbol,
        close,
        middle_band,
        upper_band,
        lower_band,
        LAG(close, 1) OVER (PARTITION BY symbol ORDER BY date) AS prev_close,
        -- +DI: Calculate positive movement
        CASE WHEN close > prev_close THEN close - prev_close ELSE 0 END AS plus_di,
        -- -DI: Calculate negative movement
        CASE WHEN close < prev_close THEN prev_close - close ELSE 0 END AS minus_di
    FROM bands
)

SELECT
    date,
    symbol,  -- To differentiate between Apple and Nvidia
    close,
    middle_band,
    upper_band,
    lower_band,
    -- Summing up DI over the 20-day period for smoother trend analysis
    SUM(plus_di) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS plus_di_twenty,
    SUM(minus_di) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS minus_di_twenty
FROM directional_indicators
ORDER BY symbol, date
        );
[0m16:15:49.061347 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:15:50.977165 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.915 seconds
[0m16:15:51.002973 [debug] [Thread-1 (]: On model.build_fda.dmi_stock_summary: Close
[0m16:15:51.111618 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd562dcf7-6644-466e-aa6a-ed710b051672', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13c409410>]}
[0m16:15:51.112736 [info ] [Thread-1 (]: 1 of 3 OK created sql table model analytics.dmi_stock_summary .................. [[32mSUCCESS 1[0m in 2.08s]
[0m16:15:51.113589 [debug] [Thread-1 (]: Finished running node model.build_fda.dmi_stock_summary
[0m16:15:51.114186 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_stock_summary
[0m16:15:51.114971 [info ] [Thread-1 (]: 2 of 3 START sql table model analytics.fsi_stock_summary ....................... [RUN]
[0m16:15:51.115689 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.dmi_stock_summary, now model.build_fda.fsi_stock_summary)
[0m16:15:51.116139 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_stock_summary
[0m16:15:51.119543 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_stock_summary"
[0m16:15:51.120613 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_stock_summary
[0m16:15:51.123584 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_stock_summary"
[0m16:15:51.125476 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_stock_summary"
[0m16:15:51.125865 [debug] [Thread-1 (]: On model.build_fda.fsi_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_stock_summary"} */
create or replace transient table dev.analytics.fsi_stock_summary
         as
        (WITH interval_widths AS (
    SELECT
        ts,
        forecast,
        lower_bound,
        upper_bound,
        REPLACE(series, '"', '') AS symbol,
        (upper_bound - lower_bound) AS interval_width
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
),

statistics AS (
    SELECT
        symbol,
        forecast,
        lower_bound,
        upper_bound,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM interval_widths
    GROUP BY symbol
)

SELECT
    a.symbol,
    a.forecast,
    a.lower_bound,
    a.upper_bound,
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM interval_widths a
JOIN statistics s
    ON a.symbol = s.symbol
        );
[0m16:15:51.126220 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:15:51.686423 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b8550f-0004-26af-0000-000255f3adc5
[0m16:15:51.687108 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 001104 (42601): SQL compilation error: error line 17 at position 8
'INTERVAL_WIDTHS.FORECAST' in select clause is neither an aggregate nor in the group by clause.
[0m16:15:51.687590 [debug] [Thread-1 (]: On model.build_fda.fsi_stock_summary: Close
[0m16:15:51.862023 [debug] [Thread-1 (]: Database Error in model fsi_stock_summary (models/output/fsi_stock_summary.sql)
  001104 (42601): SQL compilation error: error line 17 at position 8
  'INTERVAL_WIDTHS.FORECAST' in select clause is neither an aggregate nor in the group by clause.
  compiled code at target/run/build_fda/models/output/fsi_stock_summary.sql
[0m16:15:51.863122 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd562dcf7-6644-466e-aa6a-ed710b051672', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13d863dd0>]}
[0m16:15:51.863942 [error] [Thread-1 (]: 2 of 3 ERROR creating sql table model analytics.fsi_stock_summary .............. [[31mERROR[0m in 0.75s]
[0m16:15:51.864607 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_stock_summary
[0m16:15:51.865084 [debug] [Thread-1 (]: Began running node model.build_fda.obv_stock_summary
[0m16:15:51.865743 [info ] [Thread-1 (]: 3 of 3 START sql table model analytics.obv_stock_summary ....................... [RUN]
[0m16:15:51.866336 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_stock_summary, now model.build_fda.obv_stock_summary)
[0m16:15:51.866746 [debug] [Thread-1 (]: Began compiling node model.build_fda.obv_stock_summary
[0m16:15:51.870163 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.obv_stock_summary"
[0m16:15:51.871264 [debug] [Thread-1 (]: Began executing node model.build_fda.obv_stock_summary
[0m16:15:51.874148 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.obv_stock_summary"
[0m16:15:51.875792 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.obv_stock_summary"
[0m16:15:51.877543 [debug] [Thread-1 (]: On model.build_fda.obv_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.obv_stock_summary"} */
create or replace transient table dev.analytics.obv_stock_summary
         as
        (WITH ordered_data AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM dev.raw_data.stock_data -- Referencing the raw data table in the dev database
    WHERE symbol IN ('AAPL', 'NVDA')  -- Include both AAPL and NVDA symbols
),

obv_calculation AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        CASE
            WHEN close > LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN volume
            WHEN close < LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN -volume
            ELSE 0
        END AS volume_change
    FROM ordered_data
),

cumulative_obv AS (
    SELECT
        date,
        symbol,
        SUM(volume_change) OVER (PARTITION BY symbol ORDER BY date) AS obv
    FROM obv_calculation
)

SELECT
    date,
    symbol,
    obv
FROM cumulative_obv
ORDER BY symbol, date
        );
[0m16:15:51.877884 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:15:53.536610 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.658 seconds
[0m16:15:53.541903 [debug] [Thread-1 (]: On model.build_fda.obv_stock_summary: Close
[0m16:15:53.666106 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd562dcf7-6644-466e-aa6a-ed710b051672', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10503c410>]}
[0m16:15:53.667347 [info ] [Thread-1 (]: 3 of 3 OK created sql table model analytics.obv_stock_summary .................. [[32mSUCCESS 1[0m in 1.80s]
[0m16:15:53.668187 [debug] [Thread-1 (]: Finished running node model.build_fda.obv_stock_summary
[0m16:15:53.668762 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data
[0m16:15:53.669278 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.obv_stock_summary, now model.build_fda.stock_data)
[0m16:15:53.669895 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data
[0m16:15:53.674006 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data"
[0m16:15:53.675323 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data
[0m16:15:53.675752 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data_forecast
[0m16:15:53.676205 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.stock_data, now model.build_fda.stock_data_forecast)
[0m16:15:53.676499 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data_forecast
[0m16:15:53.679002 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data_forecast"
[0m16:15:53.679823 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data_forecast
[0m16:15:53.681003 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:15:53.681259 [debug] [MainThread]: Connection 'model.build_fda.stock_data_forecast' was properly closed.
[0m16:15:53.681600 [info ] [MainThread]: 
[0m16:15:53.681895 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 6.01 seconds (6.01s).
[0m16:15:53.682571 [debug] [MainThread]: Command end result
[0m16:15:53.703358 [info ] [MainThread]: 
[0m16:15:53.703640 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m16:15:53.703822 [info ] [MainThread]: 
[0m16:15:53.704067 [error] [MainThread]:   Database Error in model fsi_stock_summary (models/output/fsi_stock_summary.sql)
  001104 (42601): SQL compilation error: error line 17 at position 8
  'INTERVAL_WIDTHS.FORECAST' in select clause is neither an aggregate nor in the group by clause.
  compiled code at target/run/build_fda/models/output/fsi_stock_summary.sql
[0m16:15:53.704252 [info ] [MainThread]: 
[0m16:15:53.704442 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
[0m16:15:53.706855 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 7.1527696, "process_user_time": 2.172884, "process_kernel_time": 1.646128, "process_mem_max_rss": "204046336", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m16:15:53.707184 [debug] [MainThread]: Command `dbt run` failed at 16:15:53.707137 after 7.15 seconds
[0m16:15:53.707407 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104e44150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13c073050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13c073510>]}
[0m16:15:53.707603 [debug] [MainThread]: Flushing usage events
[0m16:19:43.832431 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111986890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1119dbc10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1119fc9d0>]}


============================== 16:19:43.834249 | c4a09d77-2c54-43dd-a5fc-7f436932688c ==============================
[0m16:19:43.834249 [info ] [MainThread]: Running with dbt=1.8.7
[0m16:19:43.834575 [debug] [MainThread]: running dbt with arguments {'warn_error': 'None', 'indirect_selection': 'eager', 'partial_parse': 'True', 'version_check': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'cache_selected_only': 'False', 'debug': 'False', 'quiet': 'False', 'log_path': '/Users/shatayu/Downloads/DATA226_Lab2Prep/build_fda/logs', 'introspect': 'True', 'log_cache_events': 'False', 'empty': 'False', 'printer_width': '80', 'use_experimental_parser': 'False', 'profiles_dir': '/Users/shatayu/.dbt', 'invocation_command': 'dbt run', 'no_print': 'None', 'log_format': 'default', 'use_colors': 'True', 'write_json': 'True', 'fail_fast': 'False', 'static_parser': 'True'}
[0m16:19:44.683718 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c4a09d77-2c54-43dd-a5fc-7f436932688c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1264c4150>]}
[0m16:19:44.703891 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c4a09d77-2c54-43dd-a5fc-7f436932688c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111345850>]}
[0m16:19:44.704481 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m16:19:44.716934 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m16:19:44.785495 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m16:19:44.785835 [debug] [MainThread]: Partial parsing: updated file: build_fda://models/output/fsi_stock_summary.sql
[0m16:19:44.885273 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c4a09d77-2c54-43dd-a5fc-7f436932688c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1469143d0>]}
[0m16:19:44.925355 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c4a09d77-2c54-43dd-a5fc-7f436932688c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146f5ff90>]}
[0m16:19:44.925695 [info ] [MainThread]: Found 5 models, 5 sources, 459 macros
[0m16:19:44.925875 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c4a09d77-2c54-43dd-a5fc-7f436932688c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146dafb10>]}
[0m16:19:44.926776 [info ] [MainThread]: 
[0m16:19:44.927067 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m16:19:44.929030 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m16:19:44.934937 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m16:19:44.935114 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m16:19:44.935250 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:19:45.529633 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.594 seconds
[0m16:19:45.533519 [debug] [ThreadPool]: On list_dev: Close
[0m16:19:45.728689 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_analytics)
[0m16:19:45.740538 [debug] [ThreadPool]: Using snowflake connection "list_dev_analytics"
[0m16:19:45.740934 [debug] [ThreadPool]: On list_dev_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev_analytics"} */
show objects in dev.analytics limit 10000
[0m16:19:45.741083 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:19:46.317294 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.576 seconds
[0m16:19:46.320279 [debug] [ThreadPool]: On list_dev_analytics: Close
[0m16:19:46.438326 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c4a09d77-2c54-43dd-a5fc-7f436932688c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146e378d0>]}
[0m16:19:46.439223 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m16:19:46.439666 [info ] [MainThread]: 
[0m16:19:46.443848 [debug] [Thread-1 (]: Began running node model.build_fda.dmi_stock_summary
[0m16:19:46.444522 [info ] [Thread-1 (]: 1 of 3 START sql table model analytics.dmi_stock_summary ....................... [RUN]
[0m16:19:46.445052 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_analytics, now model.build_fda.dmi_stock_summary)
[0m16:19:46.445422 [debug] [Thread-1 (]: Began compiling node model.build_fda.dmi_stock_summary
[0m16:19:46.453555 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.dmi_stock_summary"
[0m16:19:46.454681 [debug] [Thread-1 (]: Began executing node model.build_fda.dmi_stock_summary
[0m16:19:46.474399 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.dmi_stock_summary"
[0m16:19:46.475954 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.dmi_stock_summary"
[0m16:19:46.476313 [debug] [Thread-1 (]: On model.build_fda.dmi_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.dmi_stock_summary"} */
create or replace transient table dev.analytics.dmi_stock_summary
         as
        (WITH stock_prices AS (
    SELECT
        date,
        close,
        symbol
    FROM dev.raw_data.stock_data
    WHERE symbol IN ('AAPL', 'NVDA')  -- Including both Apple and Nvidia
),

-- Calculate the 20-day SMA and 20-day standard deviation for both symbols
sma_stddev AS (
    SELECT
        date,
        symbol,
        close,
        AVG(close) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS middle_band,
        STDDEV(close) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS stddev_20
    FROM stock_prices
),

-- Calculate the upper and lower bands
bands AS (
    SELECT
        date,
        symbol,
        close,
        middle_band,
        (middle_band + (2 * stddev_20)) AS upper_band,
        (middle_band - (2 * stddev_20)) AS lower_band
    FROM sma_stddev
),

-- Calculate +DI and -DI based on daily price movements for each stock symbol
directional_indicators AS (
    SELECT
        date,
        symbol,
        close,
        middle_band,
        upper_band,
        lower_band,
        LAG(close, 1) OVER (PARTITION BY symbol ORDER BY date) AS prev_close,
        -- +DI: Calculate positive movement
        CASE WHEN close > prev_close THEN close - prev_close ELSE 0 END AS plus_di,
        -- -DI: Calculate negative movement
        CASE WHEN close < prev_close THEN prev_close - close ELSE 0 END AS minus_di
    FROM bands
)

SELECT
    date,
    symbol,  -- To differentiate between Apple and Nvidia
    close,
    middle_band,
    upper_band,
    lower_band,
    -- Summing up DI over the 20-day period for smoother trend analysis
    SUM(plus_di) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS plus_di_twenty,
    SUM(minus_di) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS minus_di_twenty
FROM directional_indicators
ORDER BY symbol, date
        );
[0m16:19:46.476612 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:19:47.828690 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.351 seconds
[0m16:19:47.851860 [debug] [Thread-1 (]: On model.build_fda.dmi_stock_summary: Close
[0m16:19:47.974499 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c4a09d77-2c54-43dd-a5fc-7f436932688c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146fbc290>]}
[0m16:19:47.975613 [info ] [Thread-1 (]: 1 of 3 OK created sql table model analytics.dmi_stock_summary .................. [[32mSUCCESS 1[0m in 1.53s]
[0m16:19:47.976466 [debug] [Thread-1 (]: Finished running node model.build_fda.dmi_stock_summary
[0m16:19:47.977020 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_stock_summary
[0m16:19:47.977504 [info ] [Thread-1 (]: 2 of 3 START sql table model analytics.fsi_stock_summary ....................... [RUN]
[0m16:19:47.978104 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.dmi_stock_summary, now model.build_fda.fsi_stock_summary)
[0m16:19:47.978566 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_stock_summary
[0m16:19:47.981943 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_stock_summary"
[0m16:19:47.983025 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_stock_summary
[0m16:19:47.986016 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_stock_summary"
[0m16:19:47.987482 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_stock_summary"
[0m16:19:47.987860 [debug] [Thread-1 (]: On model.build_fda.fsi_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_stock_summary"} */
create or replace transient table dev.analytics.fsi_stock_summary
         as
        (WITH interval_widths AS (
    SELECT
        ts,
        forecast,
        lower_bound,
        upper_bound,
        REPLACE(series, '"', '') AS symbol,
        (upper_bound - lower_bound) AS interval_width
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
),

statistics AS (
    SELECT
        symbol,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM interval_widths
    GROUP BY symbol
)

SELECT
    a.symbol,
    a.forecast,
    a.lower_bound,
    a.upper_bound,
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM interval_widths a
JOIN statistics s
    ON a.symbol = s.symbol
        );
[0m16:19:47.988241 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:19:49.982396 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.993 seconds
[0m16:19:49.988807 [debug] [Thread-1 (]: On model.build_fda.fsi_stock_summary: Close
[0m16:19:50.109795 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c4a09d77-2c54-43dd-a5fc-7f436932688c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146fb94d0>]}
[0m16:19:50.110775 [info ] [Thread-1 (]: 2 of 3 OK created sql table model analytics.fsi_stock_summary .................. [[32mSUCCESS 1[0m in 2.13s]
[0m16:19:50.111598 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_stock_summary
[0m16:19:50.112161 [debug] [Thread-1 (]: Began running node model.build_fda.obv_stock_summary
[0m16:19:50.112872 [info ] [Thread-1 (]: 3 of 3 START sql table model analytics.obv_stock_summary ....................... [RUN]
[0m16:19:50.113549 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_stock_summary, now model.build_fda.obv_stock_summary)
[0m16:19:50.113951 [debug] [Thread-1 (]: Began compiling node model.build_fda.obv_stock_summary
[0m16:19:50.117883 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.obv_stock_summary"
[0m16:19:50.119034 [debug] [Thread-1 (]: Began executing node model.build_fda.obv_stock_summary
[0m16:19:50.123014 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.obv_stock_summary"
[0m16:19:50.124541 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.obv_stock_summary"
[0m16:19:50.124928 [debug] [Thread-1 (]: On model.build_fda.obv_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.obv_stock_summary"} */
create or replace transient table dev.analytics.obv_stock_summary
         as
        (WITH ordered_data AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM dev.raw_data.stock_data -- Referencing the raw data table in the dev database
    WHERE symbol IN ('AAPL', 'NVDA')  -- Include both AAPL and NVDA symbols
),

obv_calculation AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        CASE
            WHEN close > LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN volume
            WHEN close < LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN -volume
            ELSE 0
        END AS volume_change
    FROM ordered_data
),

cumulative_obv AS (
    SELECT
        date,
        symbol,
        SUM(volume_change) OVER (PARTITION BY symbol ORDER BY date) AS obv
    FROM obv_calculation
)

SELECT
    date,
    symbol,
    obv
FROM cumulative_obv
ORDER BY symbol, date
        );
[0m16:19:50.125309 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:19:51.515175 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.389 seconds
[0m16:19:51.521334 [debug] [Thread-1 (]: On model.build_fda.obv_stock_summary: Close
[0m16:19:51.659179 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c4a09d77-2c54-43dd-a5fc-7f436932688c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146f8fed0>]}
[0m16:19:51.661724 [info ] [Thread-1 (]: 3 of 3 OK created sql table model analytics.obv_stock_summary .................. [[32mSUCCESS 1[0m in 1.55s]
[0m16:19:51.663734 [debug] [Thread-1 (]: Finished running node model.build_fda.obv_stock_summary
[0m16:19:51.665044 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data
[0m16:19:51.666113 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.obv_stock_summary, now model.build_fda.stock_data)
[0m16:19:51.666742 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data
[0m16:19:51.672054 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data"
[0m16:19:51.673638 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data
[0m16:19:51.674106 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data_forecast
[0m16:19:51.674592 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.stock_data, now model.build_fda.stock_data_forecast)
[0m16:19:51.675046 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data_forecast
[0m16:19:51.678092 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data_forecast"
[0m16:19:51.679255 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data_forecast
[0m16:19:51.680499 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:19:51.680777 [debug] [MainThread]: Connection 'model.build_fda.stock_data_forecast' was properly closed.
[0m16:19:51.681110 [info ] [MainThread]: 
[0m16:19:51.681409 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 6.75 seconds (6.75s).
[0m16:19:51.682156 [debug] [MainThread]: Command end result
[0m16:19:51.704062 [info ] [MainThread]: 
[0m16:19:51.704415 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:19:51.704614 [info ] [MainThread]: 
[0m16:19:51.704820 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m16:19:51.707202 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 7.9227557, "process_user_time": 2.110511, "process_kernel_time": 1.660353, "process_mem_max_rss": "202702848", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m16:19:51.707565 [debug] [MainThread]: Command `dbt run` succeeded at 16:19:51.707507 after 7.92 seconds
[0m16:19:51.707821 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104a6c150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104a5bfd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146e99750>]}
[0m16:19:51.708012 [debug] [MainThread]: Flushing usage events
[0m16:28:41.242039 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10797bb90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1079dbf10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1079fcbd0>]}


============================== 16:28:41.244237 | 72f56e60-ced9-486d-b2c0-b6c6d800c556 ==============================
[0m16:28:41.244237 [info ] [MainThread]: Running with dbt=1.8.7
[0m16:28:41.244574 [debug] [MainThread]: running dbt with arguments {'cache_selected_only': 'False', 'no_print': 'None', 'log_cache_events': 'False', 'use_experimental_parser': 'False', 'quiet': 'False', 'version_check': 'True', 'write_json': 'True', 'empty': 'False', 'log_path': '/Users/shatayu/Downloads/DATA226_Lab2Prep/build_fda/logs', 'printer_width': '80', 'static_parser': 'True', 'log_format': 'default', 'indirect_selection': 'eager', 'warn_error': 'None', 'debug': 'False', 'partial_parse': 'True', 'target_path': 'None', 'fail_fast': 'False', 'profiles_dir': '/Users/shatayu/.dbt', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True', 'invocation_command': 'dbt run', 'use_colors': 'True', 'introspect': 'True'}
[0m16:28:42.243426 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '72f56e60-ced9-486d-b2c0-b6c6d800c556', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13caddd10>]}
[0m16:28:42.263873 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '72f56e60-ced9-486d-b2c0-b6c6d800c556', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107309490>]}
[0m16:28:42.264415 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m16:28:42.277849 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m16:28:42.348178 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m16:28:42.348558 [debug] [MainThread]: Partial parsing: updated file: build_fda://models/output/fsi_stock_summary.sql
[0m16:28:42.452094 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '72f56e60-ced9-486d-b2c0-b6c6d800c556', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13cd84dd0>]}
[0m16:28:42.500504 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '72f56e60-ced9-486d-b2c0-b6c6d800c556', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13d85f3d0>]}
[0m16:28:42.500867 [info ] [MainThread]: Found 5 models, 5 sources, 459 macros
[0m16:28:42.501066 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '72f56e60-ced9-486d-b2c0-b6c6d800c556', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13cf1fcd0>]}
[0m16:28:42.502153 [info ] [MainThread]: 
[0m16:28:42.502482 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m16:28:42.504517 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m16:28:42.511103 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m16:28:42.511301 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m16:28:42.511430 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:28:43.120339 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.606 seconds
[0m16:28:43.126495 [debug] [ThreadPool]: On list_dev: Close
[0m16:28:43.258344 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_analytics)
[0m16:28:43.281343 [debug] [ThreadPool]: Using snowflake connection "list_dev_analytics"
[0m16:28:43.282009 [debug] [ThreadPool]: On list_dev_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev_analytics"} */
show objects in dev.analytics limit 10000
[0m16:28:43.282351 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:28:43.814468 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.531 seconds
[0m16:28:43.821417 [debug] [ThreadPool]: On list_dev_analytics: Close
[0m16:28:43.944310 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '72f56e60-ced9-486d-b2c0-b6c6d800c556', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1056bcc10>]}
[0m16:28:43.946736 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m16:28:43.947607 [info ] [MainThread]: 
[0m16:28:43.956635 [debug] [Thread-1 (]: Began running node model.build_fda.dmi_stock_summary
[0m16:28:43.958102 [info ] [Thread-1 (]: 1 of 3 START sql table model analytics.dmi_stock_summary ....................... [RUN]
[0m16:28:43.959039 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_analytics, now model.build_fda.dmi_stock_summary)
[0m16:28:43.959853 [debug] [Thread-1 (]: Began compiling node model.build_fda.dmi_stock_summary
[0m16:28:43.970918 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.dmi_stock_summary"
[0m16:28:43.972674 [debug] [Thread-1 (]: Began executing node model.build_fda.dmi_stock_summary
[0m16:28:43.997753 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.dmi_stock_summary"
[0m16:28:43.999618 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.dmi_stock_summary"
[0m16:28:43.999985 [debug] [Thread-1 (]: On model.build_fda.dmi_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.dmi_stock_summary"} */
create or replace transient table dev.analytics.dmi_stock_summary
         as
        (WITH stock_prices AS (
    SELECT
        date,
        close,
        symbol
    FROM dev.raw_data.stock_data
    WHERE symbol IN ('AAPL', 'NVDA')  -- Including both Apple and Nvidia
),

-- Calculate the 20-day SMA and 20-day standard deviation for both symbols
sma_stddev AS (
    SELECT
        date,
        symbol,
        close,
        AVG(close) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS middle_band,
        STDDEV(close) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS stddev_20
    FROM stock_prices
),

-- Calculate the upper and lower bands
bands AS (
    SELECT
        date,
        symbol,
        close,
        middle_band,
        (middle_band + (2 * stddev_20)) AS upper_band,
        (middle_band - (2 * stddev_20)) AS lower_band
    FROM sma_stddev
),

-- Calculate +DI and -DI based on daily price movements for each stock symbol
directional_indicators AS (
    SELECT
        date,
        symbol,
        close,
        middle_band,
        upper_band,
        lower_band,
        LAG(close, 1) OVER (PARTITION BY symbol ORDER BY date) AS prev_close,
        -- +DI: Calculate positive movement
        CASE WHEN close > prev_close THEN close - prev_close ELSE 0 END AS plus_di,
        -- -DI: Calculate negative movement
        CASE WHEN close < prev_close THEN prev_close - close ELSE 0 END AS minus_di
    FROM bands
)

SELECT
    date,
    symbol,  -- To differentiate between Apple and Nvidia
    close,
    middle_band,
    upper_band,
    lower_band,
    -- Summing up DI over the 20-day period for smoother trend analysis
    SUM(plus_di) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS plus_di_twenty,
    SUM(minus_di) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS minus_di_twenty
FROM directional_indicators
ORDER BY symbol, date
        );
[0m16:28:44.000322 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:28:45.509405 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.509 seconds
[0m16:28:45.555641 [debug] [Thread-1 (]: On model.build_fda.dmi_stock_summary: Close
[0m16:28:45.711049 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '72f56e60-ced9-486d-b2c0-b6c6d800c556', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a2bcd0>]}
[0m16:28:45.712360 [info ] [Thread-1 (]: 1 of 3 OK created sql table model analytics.dmi_stock_summary .................. [[32mSUCCESS 1[0m in 1.75s]
[0m16:28:45.713260 [debug] [Thread-1 (]: Finished running node model.build_fda.dmi_stock_summary
[0m16:28:45.713906 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_stock_summary
[0m16:28:45.714562 [info ] [Thread-1 (]: 2 of 3 START sql table model analytics.fsi_stock_summary ....................... [RUN]
[0m16:28:45.715347 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.dmi_stock_summary, now model.build_fda.fsi_stock_summary)
[0m16:28:45.715902 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_stock_summary
[0m16:28:45.720769 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_stock_summary"
[0m16:28:45.723040 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_stock_summary
[0m16:28:45.728294 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_stock_summary"
[0m16:28:45.729998 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_stock_summary"
[0m16:28:45.730335 [debug] [Thread-1 (]: On model.build_fda.fsi_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_stock_summary"} */
create or replace transient table dev.analytics.fsi_stock_summary
         as
        (WITH interval_widths AS (
    SELECT
        ts,
        forecast,
        lower_bound,
        upper_bound,
        REPLACE(series, '"', '') AS symbol,
        (upper_bound - lower_bound) AS interval_width
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
),

statistics AS (
    SELECT
        symbol,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM interval_widths
    GROUP BY symbol
)

SELECT
    a.symbol,
    a.ts,
    a.forecast,
    a.lower_bound,
    a.upper_bound,
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM interval_widths a
JOIN statistics s
    ON a.symbol = s.symbol
        );
[0m16:28:45.730592 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:28:47.043989 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.313 seconds
[0m16:28:47.051003 [debug] [Thread-1 (]: On model.build_fda.fsi_stock_summary: Close
[0m16:28:47.186513 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '72f56e60-ced9-486d-b2c0-b6c6d800c556', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a2bcd0>]}
[0m16:28:47.188998 [info ] [Thread-1 (]: 2 of 3 OK created sql table model analytics.fsi_stock_summary .................. [[32mSUCCESS 1[0m in 1.47s]
[0m16:28:47.190684 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_stock_summary
[0m16:28:47.191957 [debug] [Thread-1 (]: Began running node model.build_fda.obv_stock_summary
[0m16:28:47.193350 [info ] [Thread-1 (]: 3 of 3 START sql table model analytics.obv_stock_summary ....................... [RUN]
[0m16:28:47.194400 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_stock_summary, now model.build_fda.obv_stock_summary)
[0m16:28:47.195153 [debug] [Thread-1 (]: Began compiling node model.build_fda.obv_stock_summary
[0m16:28:47.203601 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.obv_stock_summary"
[0m16:28:47.205521 [debug] [Thread-1 (]: Began executing node model.build_fda.obv_stock_summary
[0m16:28:47.209411 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.obv_stock_summary"
[0m16:28:47.210929 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.obv_stock_summary"
[0m16:28:47.211289 [debug] [Thread-1 (]: On model.build_fda.obv_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.obv_stock_summary"} */
create or replace transient table dev.analytics.obv_stock_summary
         as
        (WITH ordered_data AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM dev.raw_data.stock_data -- Referencing the raw data table in the dev database
    WHERE symbol IN ('AAPL', 'NVDA')  -- Include both AAPL and NVDA symbols
),

obv_calculation AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        CASE
            WHEN close > LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN volume
            WHEN close < LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN -volume
            ELSE 0
        END AS volume_change
    FROM ordered_data
),

cumulative_obv AS (
    SELECT
        date,
        symbol,
        SUM(volume_change) OVER (PARTITION BY symbol ORDER BY date) AS obv
    FROM obv_calculation
)

SELECT
    date,
    symbol,
    obv
FROM cumulative_obv
ORDER BY symbol, date
        );
[0m16:28:47.211619 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:28:48.698408 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.486 seconds
[0m16:28:48.705857 [debug] [Thread-1 (]: On model.build_fda.obv_stock_summary: Close
[0m16:28:48.828807 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '72f56e60-ced9-486d-b2c0-b6c6d800c556', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13d9b8490>]}
[0m16:28:48.831648 [info ] [Thread-1 (]: 3 of 3 OK created sql table model analytics.obv_stock_summary .................. [[32mSUCCESS 1[0m in 1.63s]
[0m16:28:48.833010 [debug] [Thread-1 (]: Finished running node model.build_fda.obv_stock_summary
[0m16:28:48.834128 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data
[0m16:28:48.835587 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.obv_stock_summary, now model.build_fda.stock_data)
[0m16:28:48.836990 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data
[0m16:28:48.848331 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data"
[0m16:28:48.850170 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data
[0m16:28:48.850663 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data_forecast
[0m16:28:48.851094 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.stock_data, now model.build_fda.stock_data_forecast)
[0m16:28:48.851338 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data_forecast
[0m16:28:48.853654 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data_forecast"
[0m16:28:48.854817 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data_forecast
[0m16:28:48.855922 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:28:48.856157 [debug] [MainThread]: Connection 'model.build_fda.stock_data_forecast' was properly closed.
[0m16:28:48.856457 [info ] [MainThread]: 
[0m16:28:48.856719 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 6.35 seconds (6.35s).
[0m16:28:48.857341 [debug] [MainThread]: Command end result
[0m16:28:48.880995 [info ] [MainThread]: 
[0m16:28:48.881406 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:28:48.881632 [info ] [MainThread]: 
[0m16:28:48.881870 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m16:28:48.884285 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 7.695772, "process_user_time": 2.540493, "process_kernel_time": 1.463251, "process_mem_max_rss": "203784192", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m16:28:48.884700 [debug] [MainThread]: Command `dbt run` succeeded at 16:28:48.884632 after 7.70 seconds
[0m16:28:48.884975 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103488150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13cb40dd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1034d34d0>]}
[0m16:28:48.885229 [debug] [MainThread]: Flushing usage events
[0m16:29:34.171070 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1070a1610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1070ef990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10710cb10>]}


============================== 16:29:34.172824 | 42d8cda4-f41b-4fe8-ad7a-395e0a1c5fe1 ==============================
[0m16:29:34.172824 [info ] [MainThread]: Running with dbt=1.8.7
[0m16:29:34.173156 [debug] [MainThread]: running dbt with arguments {'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'log_cache_events': 'False', 'indirect_selection': 'eager', 'printer_width': '80', 'debug': 'False', 'log_format': 'default', 'partial_parse': 'True', 'send_anonymous_usage_stats': 'True', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'version_check': 'True', 'invocation_command': 'dbt run', 'write_json': 'True', 'target_path': 'None', 'cache_selected_only': 'False', 'quiet': 'False', 'log_path': '/Users/shatayu/Downloads/DATA226_Lab2Prep/build_fda/logs', 'static_parser': 'True', 'introspect': 'True', 'no_print': 'None', 'empty': 'False', 'profiles_dir': '/Users/shatayu/.dbt'}
[0m16:29:34.949448 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '42d8cda4-f41b-4fe8-ad7a-395e0a1c5fe1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x129709f90>]}
[0m16:29:34.971240 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '42d8cda4-f41b-4fe8-ad7a-395e0a1c5fe1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106b55690>]}
[0m16:29:34.971893 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m16:29:34.984799 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m16:29:35.054012 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m16:29:35.054384 [debug] [MainThread]: Partial parsing: updated file: build_fda://models/output/fsi_stock_summary.sql
[0m16:29:35.158646 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '42d8cda4-f41b-4fe8-ad7a-395e0a1c5fe1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12cda2550>]}
[0m16:29:35.199878 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '42d8cda4-f41b-4fe8-ad7a-395e0a1c5fe1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12cdcd4d0>]}
[0m16:29:35.200189 [info ] [MainThread]: Found 5 models, 5 sources, 459 macros
[0m16:29:35.200359 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '42d8cda4-f41b-4fe8-ad7a-395e0a1c5fe1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12cbb1810>]}
[0m16:29:35.201258 [info ] [MainThread]: 
[0m16:29:35.201553 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m16:29:35.203534 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m16:29:35.209580 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m16:29:35.209763 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m16:29:35.209927 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:29:36.815725 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 1.603 seconds
[0m16:29:36.818911 [debug] [ThreadPool]: On list_dev: Close
[0m16:29:36.942331 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_analytics)
[0m16:29:36.954542 [debug] [ThreadPool]: Using snowflake connection "list_dev_analytics"
[0m16:29:36.954920 [debug] [ThreadPool]: On list_dev_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev_analytics"} */
show objects in dev.analytics limit 10000
[0m16:29:36.955192 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:29:37.392907 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.437 seconds
[0m16:29:37.397009 [debug] [ThreadPool]: On list_dev_analytics: Close
[0m16:29:37.523701 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '42d8cda4-f41b-4fe8-ad7a-395e0a1c5fe1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f0cc50>]}
[0m16:29:37.524663 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m16:29:37.525099 [info ] [MainThread]: 
[0m16:29:37.529515 [debug] [Thread-1 (]: Began running node model.build_fda.dmi_stock_summary
[0m16:29:37.530202 [info ] [Thread-1 (]: 1 of 3 START sql table model analytics.dmi_stock_summary ....................... [RUN]
[0m16:29:37.530735 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_analytics, now model.build_fda.dmi_stock_summary)
[0m16:29:37.531053 [debug] [Thread-1 (]: Began compiling node model.build_fda.dmi_stock_summary
[0m16:29:37.539091 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.dmi_stock_summary"
[0m16:29:37.539852 [debug] [Thread-1 (]: Began executing node model.build_fda.dmi_stock_summary
[0m16:29:37.559253 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.dmi_stock_summary"
[0m16:29:37.560752 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.dmi_stock_summary"
[0m16:29:37.561076 [debug] [Thread-1 (]: On model.build_fda.dmi_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.dmi_stock_summary"} */
create or replace transient table dev.analytics.dmi_stock_summary
         as
        (WITH stock_prices AS (
    SELECT
        date,
        close,
        symbol
    FROM dev.raw_data.stock_data
    WHERE symbol IN ('AAPL', 'NVDA')  -- Including both Apple and Nvidia
),

-- Calculate the 20-day SMA and 20-day standard deviation for both symbols
sma_stddev AS (
    SELECT
        date,
        symbol,
        close,
        AVG(close) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS middle_band,
        STDDEV(close) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS stddev_20
    FROM stock_prices
),

-- Calculate the upper and lower bands
bands AS (
    SELECT
        date,
        symbol,
        close,
        middle_band,
        (middle_band + (2 * stddev_20)) AS upper_band,
        (middle_band - (2 * stddev_20)) AS lower_band
    FROM sma_stddev
),

-- Calculate +DI and -DI based on daily price movements for each stock symbol
directional_indicators AS (
    SELECT
        date,
        symbol,
        close,
        middle_band,
        upper_band,
        lower_band,
        LAG(close, 1) OVER (PARTITION BY symbol ORDER BY date) AS prev_close,
        -- +DI: Calculate positive movement
        CASE WHEN close > prev_close THEN close - prev_close ELSE 0 END AS plus_di,
        -- -DI: Calculate negative movement
        CASE WHEN close < prev_close THEN prev_close - close ELSE 0 END AS minus_di
    FROM bands
)

SELECT
    date,
    symbol,  -- To differentiate between Apple and Nvidia
    close,
    middle_band,
    upper_band,
    lower_band,
    -- Summing up DI over the 20-day period for smoother trend analysis
    SUM(plus_di) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS plus_di_twenty,
    SUM(minus_di) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS minus_di_twenty
FROM directional_indicators
ORDER BY symbol, date
        );
[0m16:29:37.561420 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:29:38.859224 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.297 seconds
[0m16:29:38.882946 [debug] [Thread-1 (]: On model.build_fda.dmi_stock_summary: Close
[0m16:29:38.998249 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '42d8cda4-f41b-4fe8-ad7a-395e0a1c5fe1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12cef4d50>]}
[0m16:29:38.999342 [info ] [Thread-1 (]: 1 of 3 OK created sql table model analytics.dmi_stock_summary .................. [[32mSUCCESS 1[0m in 1.47s]
[0m16:29:39.000203 [debug] [Thread-1 (]: Finished running node model.build_fda.dmi_stock_summary
[0m16:29:39.000744 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_stock_summary
[0m16:29:39.001381 [info ] [Thread-1 (]: 2 of 3 START sql table model analytics.fsi_stock_summary ....................... [RUN]
[0m16:29:39.001985 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.dmi_stock_summary, now model.build_fda.fsi_stock_summary)
[0m16:29:39.002395 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_stock_summary
[0m16:29:39.005750 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_stock_summary"
[0m16:29:39.006711 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_stock_summary
[0m16:29:39.009452 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_stock_summary"
[0m16:29:39.011017 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_stock_summary"
[0m16:29:39.011401 [debug] [Thread-1 (]: On model.build_fda.fsi_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_stock_summary"} */
create or replace transient table dev.analytics.fsi_stock_summary
         as
        (WITH interval_widths AS (
    SELECT
        ts,
        forecast,
        lower_bound,
        upper_bound,
        REPLACE(series, '"', '') AS symbol,
        (upper_bound - lower_bound) AS interval_width
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
),

statistics AS (
    SELECT
        symbol,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM interval_widths
    GROUP BY symbol
)

SELECT
    a.symbol,
    a.ts as date,
    a.forecast,
    a.lower_bound,
    a.upper_bound,
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM interval_widths a
JOIN statistics s
    ON a.symbol = s.symbol
        );
[0m16:29:39.011748 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:29:40.394830 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.383 seconds
[0m16:29:40.398483 [debug] [Thread-1 (]: On model.build_fda.fsi_stock_summary: Close
[0m16:29:40.519473 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '42d8cda4-f41b-4fe8-ad7a-395e0a1c5fe1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12cf66fd0>]}
[0m16:29:40.520458 [info ] [Thread-1 (]: 2 of 3 OK created sql table model analytics.fsi_stock_summary .................. [[32mSUCCESS 1[0m in 1.52s]
[0m16:29:40.521261 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_stock_summary
[0m16:29:40.521813 [debug] [Thread-1 (]: Began running node model.build_fda.obv_stock_summary
[0m16:29:40.522502 [info ] [Thread-1 (]: 3 of 3 START sql table model analytics.obv_stock_summary ....................... [RUN]
[0m16:29:40.523135 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_stock_summary, now model.build_fda.obv_stock_summary)
[0m16:29:40.523522 [debug] [Thread-1 (]: Began compiling node model.build_fda.obv_stock_summary
[0m16:29:40.527290 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.obv_stock_summary"
[0m16:29:40.528237 [debug] [Thread-1 (]: Began executing node model.build_fda.obv_stock_summary
[0m16:29:40.532204 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.obv_stock_summary"
[0m16:29:40.533770 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.obv_stock_summary"
[0m16:29:40.534154 [debug] [Thread-1 (]: On model.build_fda.obv_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.obv_stock_summary"} */
create or replace transient table dev.analytics.obv_stock_summary
         as
        (WITH ordered_data AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM dev.raw_data.stock_data -- Referencing the raw data table in the dev database
    WHERE symbol IN ('AAPL', 'NVDA')  -- Include both AAPL and NVDA symbols
),

obv_calculation AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        CASE
            WHEN close > LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN volume
            WHEN close < LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN -volume
            ELSE 0
        END AS volume_change
    FROM ordered_data
),

cumulative_obv AS (
    SELECT
        date,
        symbol,
        SUM(volume_change) OVER (PARTITION BY symbol ORDER BY date) AS obv
    FROM obv_calculation
)

SELECT
    date,
    symbol,
    obv
FROM cumulative_obv
ORDER BY symbol, date
        );
[0m16:29:40.534512 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:29:41.701851 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.167 seconds
[0m16:29:41.707109 [debug] [Thread-1 (]: On model.build_fda.obv_stock_summary: Close
[0m16:29:41.890038 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '42d8cda4-f41b-4fe8-ad7a-395e0a1c5fe1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12da7e8d0>]}
[0m16:29:41.892277 [info ] [Thread-1 (]: 3 of 3 OK created sql table model analytics.obv_stock_summary .................. [[32mSUCCESS 1[0m in 1.37s]
[0m16:29:41.893560 [debug] [Thread-1 (]: Finished running node model.build_fda.obv_stock_summary
[0m16:29:41.894342 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data
[0m16:29:41.894973 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.obv_stock_summary, now model.build_fda.stock_data)
[0m16:29:41.895393 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data
[0m16:29:41.899405 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data"
[0m16:29:41.900823 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data
[0m16:29:41.901264 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data_forecast
[0m16:29:41.901642 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.stock_data, now model.build_fda.stock_data_forecast)
[0m16:29:41.901989 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data_forecast
[0m16:29:41.904700 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data_forecast"
[0m16:29:41.905566 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data_forecast
[0m16:29:41.906922 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:29:41.907267 [debug] [MainThread]: Connection 'model.build_fda.stock_data_forecast' was properly closed.
[0m16:29:41.907646 [info ] [MainThread]: 
[0m16:29:41.907970 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 6.71 seconds (6.71s).
[0m16:29:41.908721 [debug] [MainThread]: Command end result
[0m16:29:41.930395 [info ] [MainThread]: 
[0m16:29:41.930741 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:29:41.930939 [info ] [MainThread]: 
[0m16:29:41.931144 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m16:29:41.933266 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 7.811316, "process_user_time": 2.398002, "process_kernel_time": 1.417144, "process_mem_max_rss": "203046912", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m16:29:41.933588 [debug] [MainThread]: Command `dbt run` succeeded at 16:29:41.933535 after 7.81 seconds
[0m16:29:41.933801 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102cd8150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102db1410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102d234d0>]}
[0m16:29:41.933996 [debug] [MainThread]: Flushing usage events
[0m16:57:19.430621 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108a45410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108e87c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108ea8bd0>]}


============================== 16:57:19.432633 | a89c3e7f-49c5-438c-87ba-fe7d78ad5f54 ==============================
[0m16:57:19.432633 [info ] [MainThread]: Running with dbt=1.8.7
[0m16:57:19.432963 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'fail_fast': 'False', 'version_check': 'True', 'cache_selected_only': 'False', 'debug': 'False', 'indirect_selection': 'eager', 'quiet': 'False', 'profiles_dir': '/Users/shatayu/.dbt', 'introspect': 'True', 'log_cache_events': 'False', 'log_path': '/Users/shatayu/Downloads/DATA226_Lab2Prep/build_fda/logs', 'partial_parse': 'True', 'no_print': 'None', 'static_parser': 'True', 'empty': 'False', 'send_anonymous_usage_stats': 'True', 'invocation_command': 'dbt run', 'write_json': 'True', 'use_experimental_parser': 'False', 'warn_error': 'None', 'log_format': 'default', 'target_path': 'None', 'use_colors': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])'}
[0m16:57:20.370207 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a89c3e7f-49c5-438c-87ba-fe7d78ad5f54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108e3b1d0>]}
[0m16:57:20.390457 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a89c3e7f-49c5-438c-87ba-fe7d78ad5f54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1088f18d0>]}
[0m16:57:20.391034 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m16:57:20.405135 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m16:57:20.475799 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m16:57:20.476193 [debug] [MainThread]: Partial parsing: updated file: build_fda://models/output/fsi_stock_summary.sql
[0m16:57:20.578849 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a89c3e7f-49c5-438c-87ba-fe7d78ad5f54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121c5c210>]}
[0m16:57:20.619273 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a89c3e7f-49c5-438c-87ba-fe7d78ad5f54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121fe53d0>]}
[0m16:57:20.619552 [info ] [MainThread]: Found 5 models, 5 sources, 459 macros
[0m16:57:20.619714 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a89c3e7f-49c5-438c-87ba-fe7d78ad5f54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121ee1f50>]}
[0m16:57:20.620576 [info ] [MainThread]: 
[0m16:57:20.620859 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m16:57:20.622811 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m16:57:20.628597 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m16:57:20.628767 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m16:57:20.628898 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:57:21.219903 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.589 seconds
[0m16:57:21.222497 [debug] [ThreadPool]: On list_dev: Close
[0m16:57:21.356101 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_analytics)
[0m16:57:21.367110 [debug] [ThreadPool]: Using snowflake connection "list_dev_analytics"
[0m16:57:21.367459 [debug] [ThreadPool]: On list_dev_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev_analytics"} */
show objects in dev.analytics limit 10000
[0m16:57:21.367708 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:57:22.472281 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 1.104 seconds
[0m16:57:22.476007 [debug] [ThreadPool]: On list_dev_analytics: Close
[0m16:57:22.657487 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a89c3e7f-49c5-438c-87ba-fe7d78ad5f54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108d47350>]}
[0m16:57:22.658330 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m16:57:22.658687 [info ] [MainThread]: 
[0m16:57:22.661801 [debug] [Thread-1 (]: Began running node model.build_fda.dmi_stock_summary
[0m16:57:22.662292 [info ] [Thread-1 (]: 1 of 3 START sql table model analytics.dmi_stock_summary ....................... [RUN]
[0m16:57:22.662697 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_analytics, now model.build_fda.dmi_stock_summary)
[0m16:57:22.662998 [debug] [Thread-1 (]: Began compiling node model.build_fda.dmi_stock_summary
[0m16:57:22.671070 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.dmi_stock_summary"
[0m16:57:22.672308 [debug] [Thread-1 (]: Began executing node model.build_fda.dmi_stock_summary
[0m16:57:22.692967 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.dmi_stock_summary"
[0m16:57:22.694464 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.dmi_stock_summary"
[0m16:57:22.694792 [debug] [Thread-1 (]: On model.build_fda.dmi_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.dmi_stock_summary"} */
create or replace transient table dev.analytics.dmi_stock_summary
         as
        (WITH stock_prices AS (
    SELECT
        date,
        close,
        symbol
    FROM dev.raw_data.stock_data
    WHERE symbol IN ('AAPL', 'NVDA')  -- Including both Apple and Nvidia
),

-- Calculate the 20-day SMA and 20-day standard deviation for both symbols
sma_stddev AS (
    SELECT
        date,
        symbol,
        close,
        AVG(close) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS middle_band,
        STDDEV(close) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS stddev_20
    FROM stock_prices
),

-- Calculate the upper and lower bands
bands AS (
    SELECT
        date,
        symbol,
        close,
        middle_band,
        (middle_band + (2 * stddev_20)) AS upper_band,
        (middle_band - (2 * stddev_20)) AS lower_band
    FROM sma_stddev
),

-- Calculate +DI and -DI based on daily price movements for each stock symbol
directional_indicators AS (
    SELECT
        date,
        symbol,
        close,
        middle_band,
        upper_band,
        lower_band,
        LAG(close, 1) OVER (PARTITION BY symbol ORDER BY date) AS prev_close,
        -- +DI: Calculate positive movement
        CASE WHEN close > prev_close THEN close - prev_close ELSE 0 END AS plus_di,
        -- -DI: Calculate negative movement
        CASE WHEN close < prev_close THEN prev_close - close ELSE 0 END AS minus_di
    FROM bands
)

SELECT
    date,
    symbol,  -- To differentiate between Apple and Nvidia
    close,
    middle_band,
    upper_band,
    lower_band,
    -- Summing up DI over the 20-day period for smoother trend analysis
    SUM(plus_di) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS plus_di_twenty,
    SUM(minus_di) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS minus_di_twenty
FROM directional_indicators
ORDER BY symbol, date
        );
[0m16:57:22.695182 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:57:24.263619 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.568 seconds
[0m16:57:24.289027 [debug] [Thread-1 (]: On model.build_fda.dmi_stock_summary: Close
[0m16:57:24.422237 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a89c3e7f-49c5-438c-87ba-fe7d78ad5f54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121c63590>]}
[0m16:57:24.423525 [info ] [Thread-1 (]: 1 of 3 OK created sql table model analytics.dmi_stock_summary .................. [[32mSUCCESS 1[0m in 1.76s]
[0m16:57:24.424089 [debug] [Thread-1 (]: Finished running node model.build_fda.dmi_stock_summary
[0m16:57:24.424434 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_stock_summary
[0m16:57:24.424805 [info ] [Thread-1 (]: 2 of 3 START sql table model analytics.fsi_stock_summary ....................... [RUN]
[0m16:57:24.425173 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.dmi_stock_summary, now model.build_fda.fsi_stock_summary)
[0m16:57:24.425502 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_stock_summary
[0m16:57:24.428748 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_stock_summary"
[0m16:57:24.430151 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_stock_summary
[0m16:57:24.432327 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_stock_summary"
[0m16:57:24.433676 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_stock_summary"
[0m16:57:24.433938 [debug] [Thread-1 (]: On model.build_fda.fsi_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_stock_summary"} */
create or replace transient table dev.analytics.fsi_stock_summary
         as
        (WITH interval_widths AS (
    SELECT
        ts as date,
        forecast,
        lower_bound,
        upper_bound,
        REPLACE(series, '"', '') AS symbol,
        (upper_bound - lower_bound) AS interval_width,
        'FORECASTED' as record_type
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
),

statistics AS (
    SELECT
        symbol,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM interval_widths
    GROUP BY symbol
)

WITH recent_data AS (
    SELECT
        date,
        close,
        symbol,
        'HISTORICAL' as record_type
    FROM dev.raw_data.stock_data
    WHERE date >= DATEADD(week, -3, MAX(date)) OVER ()  -- Fetch data from the last 3 weeks
      AND symbol IN ('AAPL', 'NVDA')                     -- Filter for specific symbols
)

SELECT
    a.symbol,
    a.date,
    a.forecast as close,
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM interval_widths a
JOIN statistics s
    ON a.symbol = s.symbol

UNION ALL

SELECT
    r.symbol,
    r.date,
    r.close,
    NULL AS avg_interval_width,  -- NULL for non-forecasted data
    NULL AS stddev_interval_width,  -- NULL for non-forecasted data
    NULL AS fsi,  -- NULL for non-forecasted data
    r.record_type
FROM recent_data r
ORDER BY date, symbol
        );
[0m16:57:24.434182 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:57:25.439220 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b85539-0004-26ad-0000-000255f3dcc9
[0m16:57:25.439986 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 24 at position 0 unexpected 'WITH'.
syntax error line 31 at position 45 unexpected ')'.
[0m16:57:25.440535 [debug] [Thread-1 (]: On model.build_fda.fsi_stock_summary: Close
[0m16:57:25.576747 [debug] [Thread-1 (]: Database Error in model fsi_stock_summary (models/output/fsi_stock_summary.sql)
  001003 (42000): SQL compilation error:
  syntax error line 24 at position 0 unexpected 'WITH'.
  syntax error line 31 at position 45 unexpected ')'.
  compiled code at target/run/build_fda/models/output/fsi_stock_summary.sql
[0m16:57:25.577727 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a89c3e7f-49c5-438c-87ba-fe7d78ad5f54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121be9090>]}
[0m16:57:25.578564 [error] [Thread-1 (]: 2 of 3 ERROR creating sql table model analytics.fsi_stock_summary .............. [[31mERROR[0m in 1.15s]
[0m16:57:25.579226 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_stock_summary
[0m16:57:25.579685 [debug] [Thread-1 (]: Began running node model.build_fda.obv_stock_summary
[0m16:57:25.580355 [info ] [Thread-1 (]: 3 of 3 START sql table model analytics.obv_stock_summary ....................... [RUN]
[0m16:57:25.580961 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_stock_summary, now model.build_fda.obv_stock_summary)
[0m16:57:25.581350 [debug] [Thread-1 (]: Began compiling node model.build_fda.obv_stock_summary
[0m16:57:25.584632 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.obv_stock_summary"
[0m16:57:25.585903 [debug] [Thread-1 (]: Began executing node model.build_fda.obv_stock_summary
[0m16:57:25.588614 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.obv_stock_summary"
[0m16:57:25.590055 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.obv_stock_summary"
[0m16:57:25.591842 [debug] [Thread-1 (]: On model.build_fda.obv_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.obv_stock_summary"} */
create or replace transient table dev.analytics.obv_stock_summary
         as
        (WITH ordered_data AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM dev.raw_data.stock_data -- Referencing the raw data table in the dev database
    WHERE symbol IN ('AAPL', 'NVDA')  -- Include both AAPL and NVDA symbols
),

obv_calculation AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        CASE
            WHEN close > LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN volume
            WHEN close < LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN -volume
            ELSE 0
        END AS volume_change
    FROM ordered_data
),

cumulative_obv AS (
    SELECT
        date,
        symbol,
        SUM(volume_change) OVER (PARTITION BY symbol ORDER BY date) AS obv
    FROM obv_calculation
)

SELECT
    date,
    symbol,
    obv
FROM cumulative_obv
ORDER BY symbol, date
        );
[0m16:57:25.592188 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:57:27.235683 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.643 seconds
[0m16:57:27.240603 [debug] [Thread-1 (]: On model.build_fda.obv_stock_summary: Close
[0m16:57:27.358378 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a89c3e7f-49c5-438c-87ba-fe7d78ad5f54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x122258310>]}
[0m16:57:27.360051 [info ] [Thread-1 (]: 3 of 3 OK created sql table model analytics.obv_stock_summary .................. [[32mSUCCESS 1[0m in 1.78s]
[0m16:57:27.361012 [debug] [Thread-1 (]: Finished running node model.build_fda.obv_stock_summary
[0m16:57:27.361626 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data
[0m16:57:27.362335 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.obv_stock_summary, now model.build_fda.stock_data)
[0m16:57:27.362887 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data
[0m16:57:27.366940 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data"
[0m16:57:27.368388 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data
[0m16:57:27.368816 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data_forecast
[0m16:57:27.369209 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.stock_data, now model.build_fda.stock_data_forecast)
[0m16:57:27.369512 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data_forecast
[0m16:57:27.372052 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data_forecast"
[0m16:57:27.373197 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data_forecast
[0m16:57:27.374388 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:57:27.374638 [debug] [MainThread]: Connection 'model.build_fda.stock_data_forecast' was properly closed.
[0m16:57:27.374945 [info ] [MainThread]: 
[0m16:57:27.375205 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 6.75 seconds (6.75s).
[0m16:57:27.375859 [debug] [MainThread]: Command end result
[0m16:57:27.396424 [info ] [MainThread]: 
[0m16:57:27.396708 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m16:57:27.397001 [info ] [MainThread]: 
[0m16:57:27.397259 [error] [MainThread]:   Database Error in model fsi_stock_summary (models/output/fsi_stock_summary.sql)
  001003 (42000): SQL compilation error:
  syntax error line 24 at position 0 unexpected 'WITH'.
  syntax error line 31 at position 45 unexpected ')'.
  compiled code at target/run/build_fda/models/output/fsi_stock_summary.sql
[0m16:57:27.397461 [info ] [MainThread]: 
[0m16:57:27.397660 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
[0m16:57:27.400131 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 8.019894, "process_user_time": 2.171277, "process_kernel_time": 1.64957, "process_mem_max_rss": "202915840", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m16:57:27.400462 [debug] [MainThread]: Command `dbt run` failed at 16:57:27.400411 after 8.02 seconds
[0m16:57:27.400679 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104a70150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106f395d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121c55490>]}
[0m16:57:27.400881 [debug] [MainThread]: Flushing usage events
[0m16:57:56.854779 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a81750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107acfbd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107acfc10>]}


============================== 16:57:56.856479 | 4f0cbdab-2d88-41c9-8d86-123524c28a43 ==============================
[0m16:57:56.856479 [info ] [MainThread]: Running with dbt=1.8.7
[0m16:57:56.856809 [debug] [MainThread]: running dbt with arguments {'log_path': '/Users/shatayu/Downloads/DATA226_Lab2Prep/build_fda/logs', 'quiet': 'False', 'profiles_dir': '/Users/shatayu/.dbt', 'log_cache_events': 'False', 'send_anonymous_usage_stats': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run', 'indirect_selection': 'eager', 'log_format': 'default', 'empty': 'False', 'introspect': 'True', 'debug': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'target_path': 'None', 'partial_parse': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'printer_width': '80', 'write_json': 'True', 'use_experimental_parser': 'False', 'use_colors': 'True', 'no_print': 'None', 'version_check': 'True', 'cache_selected_only': 'False'}
[0m16:57:57.492745 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4f0cbdab-2d88-41c9-8d86-123524c28a43', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a80590>]}
[0m16:57:57.512586 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4f0cbdab-2d88-41c9-8d86-123524c28a43', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1075395d0>]}
[0m16:57:57.513904 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m16:57:57.526473 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m16:57:57.593620 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m16:57:57.593974 [debug] [MainThread]: Partial parsing: updated file: build_fda://models/output/fsi_stock_summary.sql
[0m16:57:57.690772 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4f0cbdab-2d88-41c9-8d86-123524c28a43', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12b1f5e50>]}
[0m16:57:57.729525 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4f0cbdab-2d88-41c9-8d86-123524c28a43', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12b455450>]}
[0m16:57:57.729795 [info ] [MainThread]: Found 5 models, 5 sources, 459 macros
[0m16:57:57.729958 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4f0cbdab-2d88-41c9-8d86-123524c28a43', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12b470110>]}
[0m16:57:57.730822 [info ] [MainThread]: 
[0m16:57:57.731109 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m16:57:57.733008 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m16:57:57.738777 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m16:57:57.738941 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m16:57:57.739067 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:57:58.333350 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.594 seconds
[0m16:57:58.338165 [debug] [ThreadPool]: On list_dev: Close
[0m16:57:58.477210 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_analytics)
[0m16:57:58.489127 [debug] [ThreadPool]: Using snowflake connection "list_dev_analytics"
[0m16:57:58.489504 [debug] [ThreadPool]: On list_dev_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev_analytics"} */
show objects in dev.analytics limit 10000
[0m16:57:58.489770 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:57:58.963902 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.474 seconds
[0m16:57:58.967902 [debug] [ThreadPool]: On list_dev_analytics: Close
[0m16:57:59.088712 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4f0cbdab-2d88-41c9-8d86-123524c28a43', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12b10ee50>]}
[0m16:57:59.089607 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m16:57:59.090053 [info ] [MainThread]: 
[0m16:57:59.094355 [debug] [Thread-1 (]: Began running node model.build_fda.dmi_stock_summary
[0m16:57:59.094980 [info ] [Thread-1 (]: 1 of 3 START sql table model analytics.dmi_stock_summary ....................... [RUN]
[0m16:57:59.095462 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_analytics, now model.build_fda.dmi_stock_summary)
[0m16:57:59.095813 [debug] [Thread-1 (]: Began compiling node model.build_fda.dmi_stock_summary
[0m16:57:59.104294 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.dmi_stock_summary"
[0m16:57:59.105157 [debug] [Thread-1 (]: Began executing node model.build_fda.dmi_stock_summary
[0m16:57:59.125256 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.dmi_stock_summary"
[0m16:57:59.126790 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.dmi_stock_summary"
[0m16:57:59.127118 [debug] [Thread-1 (]: On model.build_fda.dmi_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.dmi_stock_summary"} */
create or replace transient table dev.analytics.dmi_stock_summary
         as
        (WITH stock_prices AS (
    SELECT
        date,
        close,
        symbol
    FROM dev.raw_data.stock_data
    WHERE symbol IN ('AAPL', 'NVDA')  -- Including both Apple and Nvidia
),

-- Calculate the 20-day SMA and 20-day standard deviation for both symbols
sma_stddev AS (
    SELECT
        date,
        symbol,
        close,
        AVG(close) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS middle_band,
        STDDEV(close) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS stddev_20
    FROM stock_prices
),

-- Calculate the upper and lower bands
bands AS (
    SELECT
        date,
        symbol,
        close,
        middle_band,
        (middle_band + (2 * stddev_20)) AS upper_band,
        (middle_band - (2 * stddev_20)) AS lower_band
    FROM sma_stddev
),

-- Calculate +DI and -DI based on daily price movements for each stock symbol
directional_indicators AS (
    SELECT
        date,
        symbol,
        close,
        middle_band,
        upper_band,
        lower_band,
        LAG(close, 1) OVER (PARTITION BY symbol ORDER BY date) AS prev_close,
        -- +DI: Calculate positive movement
        CASE WHEN close > prev_close THEN close - prev_close ELSE 0 END AS plus_di,
        -- -DI: Calculate negative movement
        CASE WHEN close < prev_close THEN prev_close - close ELSE 0 END AS minus_di
    FROM bands
)

SELECT
    date,
    symbol,  -- To differentiate between Apple and Nvidia
    close,
    middle_band,
    upper_band,
    lower_band,
    -- Summing up DI over the 20-day period for smoother trend analysis
    SUM(plus_di) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS plus_di_twenty,
    SUM(minus_di) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS minus_di_twenty
FROM directional_indicators
ORDER BY symbol, date
        );
[0m16:57:59.127408 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:58:00.514801 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.386 seconds
[0m16:58:00.540519 [debug] [Thread-1 (]: On model.build_fda.dmi_stock_summary: Close
[0m16:58:00.650023 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4f0cbdab-2d88-41c9-8d86-123524c28a43', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12b5095d0>]}
[0m16:58:00.651813 [info ] [Thread-1 (]: 1 of 3 OK created sql table model analytics.dmi_stock_summary .................. [[32mSUCCESS 1[0m in 1.55s]
[0m16:58:00.652923 [debug] [Thread-1 (]: Finished running node model.build_fda.dmi_stock_summary
[0m16:58:00.653522 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_stock_summary
[0m16:58:00.654242 [info ] [Thread-1 (]: 2 of 3 START sql table model analytics.fsi_stock_summary ....................... [RUN]
[0m16:58:00.654837 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.dmi_stock_summary, now model.build_fda.fsi_stock_summary)
[0m16:58:00.655254 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_stock_summary
[0m16:58:00.659054 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_stock_summary"
[0m16:58:00.660014 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_stock_summary
[0m16:58:00.662815 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_stock_summary"
[0m16:58:00.664706 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_stock_summary"
[0m16:58:00.665126 [debug] [Thread-1 (]: On model.build_fda.fsi_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_stock_summary"} */
create or replace transient table dev.analytics.fsi_stock_summary
         as
        (WITH interval_widths AS (
    SELECT
        ts as date,
        forecast,
        lower_bound,
        upper_bound,
        REPLACE(series, '"', '') AS symbol,
        (upper_bound - lower_bound) AS interval_width,
        'FORECASTED' as record_type
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
),

statistics AS (
    SELECT
        symbol,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM interval_widths
    GROUP BY symbol
),

WITH recent_data AS (
    SELECT
        date,
        close,
        symbol,
        'HISTORICAL' as record_type
    FROM dev.raw_data.stock_data
    WHERE date >= DATEADD(week, -3, MAX(date)) OVER ()  -- Fetch data from the last 3 weeks
      AND symbol IN ('AAPL', 'NVDA')                     -- Filter for specific symbols
)

SELECT
    a.symbol,
    a.date,
    a.forecast as close,
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM interval_widths a
JOIN statistics s
    ON a.symbol = s.symbol

UNION ALL

SELECT
    r.symbol,
    r.date,
    r.close,
    NULL AS avg_interval_width,  -- NULL for non-forecasted data
    NULL AS stddev_interval_width,  -- NULL for non-forecasted data
    NULL AS fsi,  -- NULL for non-forecasted data
    r.record_type
FROM recent_data r
ORDER BY date, symbol
        );
[0m16:58:00.665509 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:58:01.141249 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b8553a-0004-26ad-0000-000255f3dcd1
[0m16:58:01.141977 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 24 at position 0 unexpected 'WITH'.
[0m16:58:01.142515 [debug] [Thread-1 (]: On model.build_fda.fsi_stock_summary: Close
[0m16:58:01.274703 [debug] [Thread-1 (]: Database Error in model fsi_stock_summary (models/output/fsi_stock_summary.sql)
  001003 (42000): SQL compilation error:
  syntax error line 24 at position 0 unexpected 'WITH'.
  compiled code at target/run/build_fda/models/output/fsi_stock_summary.sql
[0m16:58:01.275587 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4f0cbdab-2d88-41c9-8d86-123524c28a43', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12b0a0a50>]}
[0m16:58:01.276417 [error] [Thread-1 (]: 2 of 3 ERROR creating sql table model analytics.fsi_stock_summary .............. [[31mERROR[0m in 0.62s]
[0m16:58:01.277074 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_stock_summary
[0m16:58:01.277543 [debug] [Thread-1 (]: Began running node model.build_fda.obv_stock_summary
[0m16:58:01.278212 [info ] [Thread-1 (]: 3 of 3 START sql table model analytics.obv_stock_summary ....................... [RUN]
[0m16:58:01.278755 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_stock_summary, now model.build_fda.obv_stock_summary)
[0m16:58:01.279133 [debug] [Thread-1 (]: Began compiling node model.build_fda.obv_stock_summary
[0m16:58:01.282469 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.obv_stock_summary"
[0m16:58:01.283362 [debug] [Thread-1 (]: Began executing node model.build_fda.obv_stock_summary
[0m16:58:01.286221 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.obv_stock_summary"
[0m16:58:01.287632 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.obv_stock_summary"
[0m16:58:01.289391 [debug] [Thread-1 (]: On model.build_fda.obv_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.obv_stock_summary"} */
create or replace transient table dev.analytics.obv_stock_summary
         as
        (WITH ordered_data AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM dev.raw_data.stock_data -- Referencing the raw data table in the dev database
    WHERE symbol IN ('AAPL', 'NVDA')  -- Include both AAPL and NVDA symbols
),

obv_calculation AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        CASE
            WHEN close > LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN volume
            WHEN close < LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN -volume
            ELSE 0
        END AS volume_change
    FROM ordered_data
),

cumulative_obv AS (
    SELECT
        date,
        symbol,
        SUM(volume_change) OVER (PARTITION BY symbol ORDER BY date) AS obv
    FROM obv_calculation
)

SELECT
    date,
    symbol,
    obv
FROM cumulative_obv
ORDER BY symbol, date
        );
[0m16:58:01.289736 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:58:02.664683 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.374 seconds
[0m16:58:02.669158 [debug] [Thread-1 (]: On model.build_fda.obv_stock_summary: Close
[0m16:58:02.785926 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4f0cbdab-2d88-41c9-8d86-123524c28a43', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12b96b050>]}
[0m16:58:02.788232 [info ] [Thread-1 (]: 3 of 3 OK created sql table model analytics.obv_stock_summary .................. [[32mSUCCESS 1[0m in 1.51s]
[0m16:58:02.789099 [debug] [Thread-1 (]: Finished running node model.build_fda.obv_stock_summary
[0m16:58:02.789680 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data
[0m16:58:02.790371 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.obv_stock_summary, now model.build_fda.stock_data)
[0m16:58:02.790871 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data
[0m16:58:02.794804 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data"
[0m16:58:02.796121 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data
[0m16:58:02.796549 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data_forecast
[0m16:58:02.797006 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.stock_data, now model.build_fda.stock_data_forecast)
[0m16:58:02.797358 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data_forecast
[0m16:58:02.800021 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data_forecast"
[0m16:58:02.800827 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data_forecast
[0m16:58:02.802006 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:58:02.802267 [debug] [MainThread]: Connection 'model.build_fda.stock_data_forecast' was properly closed.
[0m16:58:02.802605 [info ] [MainThread]: 
[0m16:58:02.802894 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 5.07 seconds (5.07s).
[0m16:58:02.804147 [debug] [MainThread]: Command end result
[0m16:58:02.827000 [info ] [MainThread]: 
[0m16:58:02.827369 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m16:58:02.827593 [info ] [MainThread]: 
[0m16:58:02.827891 [error] [MainThread]:   Database Error in model fsi_stock_summary (models/output/fsi_stock_summary.sql)
  001003 (42000): SQL compilation error:
  syntax error line 24 at position 0 unexpected 'WITH'.
  compiled code at target/run/build_fda/models/output/fsi_stock_summary.sql
[0m16:58:02.828077 [info ] [MainThread]: 
[0m16:58:02.828279 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
[0m16:58:02.830478 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 6.0227127, "process_user_time": 2.136952, "process_kernel_time": 1.490223, "process_mem_max_rss": "204161024", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m16:58:02.830798 [debug] [MainThread]: Command `dbt run` failed at 16:58:02.830746 after 6.02 seconds
[0m16:58:02.831019 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1036b8150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x128a10890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12873e190>]}
[0m16:58:02.831221 [debug] [MainThread]: Flushing usage events
[0m16:58:23.992348 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1096e0050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b9d45d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b9d4b10>]}


============================== 16:58:23.993828 | 14bddbf2-fad0-464b-850c-3268dac99ae3 ==============================
[0m16:58:23.993828 [info ] [MainThread]: Running with dbt=1.8.7
[0m16:58:23.994144 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'quiet': 'False', 'cache_selected_only': 'False', 'use_colors': 'True', 'log_path': '/Users/shatayu/Downloads/DATA226_Lab2Prep/build_fda/logs', 'no_print': 'None', 'version_check': 'True', 'static_parser': 'True', 'debug': 'False', 'invocation_command': 'dbt run', 'empty': 'False', 'introspect': 'True', 'send_anonymous_usage_stats': 'True', 'profiles_dir': '/Users/shatayu/.dbt', 'fail_fast': 'False', 'log_format': 'default', 'warn_error': 'None', 'log_cache_events': 'False', 'partial_parse': 'True', 'write_json': 'True', 'use_experimental_parser': 'False', 'indirect_selection': 'eager'}
[0m16:58:24.501420 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '14bddbf2-fad0-464b-850c-3268dac99ae3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b9e7b50>]}
[0m16:58:24.521884 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '14bddbf2-fad0-464b-850c-3268dac99ae3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10aa45750>]}
[0m16:58:24.522289 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m16:58:24.534257 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m16:58:24.592681 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m16:58:24.593021 [debug] [MainThread]: Partial parsing: updated file: build_fda://models/output/fsi_stock_summary.sql
[0m16:58:24.693391 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '14bddbf2-fad0-464b-850c-3268dac99ae3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14fbb8d10>]}
[0m16:58:24.728288 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '14bddbf2-fad0-464b-850c-3268dac99ae3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14fe57b90>]}
[0m16:58:24.728577 [info ] [MainThread]: Found 5 models, 5 sources, 459 macros
[0m16:58:24.728760 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '14bddbf2-fad0-464b-850c-3268dac99ae3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fea4090>]}
[0m16:58:24.729666 [info ] [MainThread]: 
[0m16:58:24.729964 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m16:58:24.731906 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m16:58:24.737789 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m16:58:24.737962 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m16:58:24.738091 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:58:25.241430 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.503 seconds
[0m16:58:25.245358 [debug] [ThreadPool]: On list_dev: Close
[0m16:58:25.384727 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_analytics)
[0m16:58:25.396512 [debug] [ThreadPool]: Using snowflake connection "list_dev_analytics"
[0m16:58:25.396876 [debug] [ThreadPool]: On list_dev_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev_analytics"} */
show objects in dev.analytics limit 10000
[0m16:58:25.397139 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:58:25.931827 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.534 seconds
[0m16:58:25.935445 [debug] [ThreadPool]: On list_dev_analytics: Close
[0m16:58:26.054214 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '14bddbf2-fad0-464b-850c-3268dac99ae3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14fc8aed0>]}
[0m16:58:26.055192 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m16:58:26.055602 [info ] [MainThread]: 
[0m16:58:26.076838 [debug] [Thread-1 (]: Began running node model.build_fda.dmi_stock_summary
[0m16:58:26.077317 [info ] [Thread-1 (]: 1 of 3 START sql table model analytics.dmi_stock_summary ....................... [RUN]
[0m16:58:26.077626 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_analytics, now model.build_fda.dmi_stock_summary)
[0m16:58:26.077820 [debug] [Thread-1 (]: Began compiling node model.build_fda.dmi_stock_summary
[0m16:58:26.082233 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.dmi_stock_summary"
[0m16:58:26.082773 [debug] [Thread-1 (]: Began executing node model.build_fda.dmi_stock_summary
[0m16:58:26.099573 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.dmi_stock_summary"
[0m16:58:26.101290 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.dmi_stock_summary"
[0m16:58:26.101631 [debug] [Thread-1 (]: On model.build_fda.dmi_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.dmi_stock_summary"} */
create or replace transient table dev.analytics.dmi_stock_summary
         as
        (WITH stock_prices AS (
    SELECT
        date,
        close,
        symbol
    FROM dev.raw_data.stock_data
    WHERE symbol IN ('AAPL', 'NVDA')  -- Including both Apple and Nvidia
),

-- Calculate the 20-day SMA and 20-day standard deviation for both symbols
sma_stddev AS (
    SELECT
        date,
        symbol,
        close,
        AVG(close) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS middle_band,
        STDDEV(close) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS stddev_20
    FROM stock_prices
),

-- Calculate the upper and lower bands
bands AS (
    SELECT
        date,
        symbol,
        close,
        middle_band,
        (middle_band + (2 * stddev_20)) AS upper_band,
        (middle_band - (2 * stddev_20)) AS lower_band
    FROM sma_stddev
),

-- Calculate +DI and -DI based on daily price movements for each stock symbol
directional_indicators AS (
    SELECT
        date,
        symbol,
        close,
        middle_band,
        upper_band,
        lower_band,
        LAG(close, 1) OVER (PARTITION BY symbol ORDER BY date) AS prev_close,
        -- +DI: Calculate positive movement
        CASE WHEN close > prev_close THEN close - prev_close ELSE 0 END AS plus_di,
        -- -DI: Calculate negative movement
        CASE WHEN close < prev_close THEN prev_close - close ELSE 0 END AS minus_di
    FROM bands
)

SELECT
    date,
    symbol,  -- To differentiate between Apple and Nvidia
    close,
    middle_band,
    upper_band,
    lower_band,
    -- Summing up DI over the 20-day period for smoother trend analysis
    SUM(plus_di) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS plus_di_twenty,
    SUM(minus_di) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS minus_di_twenty
FROM directional_indicators
ORDER BY symbol, date
        );
[0m16:58:26.101934 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:58:27.445388 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.343 seconds
[0m16:58:27.473705 [debug] [Thread-1 (]: On model.build_fda.dmi_stock_summary: Close
[0m16:58:27.635003 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '14bddbf2-fad0-464b-850c-3268dac99ae3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fe73890>]}
[0m16:58:27.635961 [info ] [Thread-1 (]: 1 of 3 OK created sql table model analytics.dmi_stock_summary .................. [[32mSUCCESS 1[0m in 1.56s]
[0m16:58:27.636665 [debug] [Thread-1 (]: Finished running node model.build_fda.dmi_stock_summary
[0m16:58:27.637124 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_stock_summary
[0m16:58:27.637663 [info ] [Thread-1 (]: 2 of 3 START sql table model analytics.fsi_stock_summary ....................... [RUN]
[0m16:58:27.638138 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.dmi_stock_summary, now model.build_fda.fsi_stock_summary)
[0m16:58:27.638473 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_stock_summary
[0m16:58:27.641707 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_stock_summary"
[0m16:58:27.642675 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_stock_summary
[0m16:58:27.645123 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_stock_summary"
[0m16:58:27.646798 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_stock_summary"
[0m16:58:27.647171 [debug] [Thread-1 (]: On model.build_fda.fsi_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_stock_summary"} */
create or replace transient table dev.analytics.fsi_stock_summary
         as
        (WITH interval_widths AS (
    SELECT
        ts as date,
        forecast,
        lower_bound,
        upper_bound,
        REPLACE(series, '"', '') AS symbol,
        (upper_bound - lower_bound) AS interval_width,
        'FORECASTED' as record_type
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
),

statistics AS (
    SELECT
        symbol,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM interval_widths
    GROUP BY symbol
),

recent_data AS (
    SELECT
        date,
        close,
        symbol,
        'HISTORICAL' as record_type
    FROM dev.raw_data.stock_data
    WHERE date >= DATEADD(week, -3, MAX(date)) OVER ()  -- Fetch data from the last 3 weeks
      AND symbol IN ('AAPL', 'NVDA')                     -- Filter for specific symbols
)

SELECT
    a.symbol,
    a.date,
    a.forecast as close,
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM interval_widths a
JOIN statistics s
    ON a.symbol = s.symbol

UNION ALL

SELECT
    r.symbol,
    r.date,
    r.close,
    NULL AS avg_interval_width,  -- NULL for non-forecasted data
    NULL AS stddev_interval_width,  -- NULL for non-forecasted data
    NULL AS fsi,  -- NULL for non-forecasted data
    r.record_type
FROM recent_data r
ORDER BY date, symbol
        );
[0m16:58:27.647522 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:58:28.121508 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b8553a-0004-26b5-0000-000255f3ca29
[0m16:58:28.122185 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 002060 (42601): SQL compilation error:
Invalid function type [DATEADD] for window function.
[0m16:58:28.122660 [debug] [Thread-1 (]: On model.build_fda.fsi_stock_summary: Close
[0m16:58:28.271665 [debug] [Thread-1 (]: Database Error in model fsi_stock_summary (models/output/fsi_stock_summary.sql)
  002060 (42601): SQL compilation error:
  Invalid function type [DATEADD] for window function.
  compiled code at target/run/build_fda/models/output/fsi_stock_summary.sql
[0m16:58:28.272438 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '14bddbf2-fad0-464b-850c-3268dac99ae3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14ff64050>]}
[0m16:58:28.273219 [error] [Thread-1 (]: 2 of 3 ERROR creating sql table model analytics.fsi_stock_summary .............. [[31mERROR[0m in 0.63s]
[0m16:58:28.273854 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_stock_summary
[0m16:58:28.274319 [debug] [Thread-1 (]: Began running node model.build_fda.obv_stock_summary
[0m16:58:28.274975 [info ] [Thread-1 (]: 3 of 3 START sql table model analytics.obv_stock_summary ....................... [RUN]
[0m16:58:28.275539 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_stock_summary, now model.build_fda.obv_stock_summary)
[0m16:58:28.275937 [debug] [Thread-1 (]: Began compiling node model.build_fda.obv_stock_summary
[0m16:58:28.279254 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.obv_stock_summary"
[0m16:58:28.280128 [debug] [Thread-1 (]: Began executing node model.build_fda.obv_stock_summary
[0m16:58:28.282936 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.obv_stock_summary"
[0m16:58:28.284482 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.obv_stock_summary"
[0m16:58:28.286202 [debug] [Thread-1 (]: On model.build_fda.obv_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.obv_stock_summary"} */
create or replace transient table dev.analytics.obv_stock_summary
         as
        (WITH ordered_data AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM dev.raw_data.stock_data -- Referencing the raw data table in the dev database
    WHERE symbol IN ('AAPL', 'NVDA')  -- Include both AAPL and NVDA symbols
),

obv_calculation AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        CASE
            WHEN close > LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN volume
            WHEN close < LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN -volume
            ELSE 0
        END AS volume_change
    FROM ordered_data
),

cumulative_obv AS (
    SELECT
        date,
        symbol,
        SUM(volume_change) OVER (PARTITION BY symbol ORDER BY date) AS obv
    FROM obv_calculation
)

SELECT
    date,
    symbol,
    obv
FROM cumulative_obv
ORDER BY symbol, date
        );
[0m16:58:28.286545 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:58:29.594595 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.307 seconds
[0m16:58:29.600433 [debug] [Thread-1 (]: On model.build_fda.obv_stock_summary: Close
[0m16:58:29.717587 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '14bddbf2-fad0-464b-850c-3268dac99ae3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x160980890>]}
[0m16:58:29.718563 [info ] [Thread-1 (]: 3 of 3 OK created sql table model analytics.obv_stock_summary .................. [[32mSUCCESS 1[0m in 1.44s]
[0m16:58:29.719371 [debug] [Thread-1 (]: Finished running node model.build_fda.obv_stock_summary
[0m16:58:29.719927 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data
[0m16:58:29.720577 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.obv_stock_summary, now model.build_fda.stock_data)
[0m16:58:29.721125 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data
[0m16:58:29.724998 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data"
[0m16:58:29.726322 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data
[0m16:58:29.726744 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data_forecast
[0m16:58:29.727186 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.stock_data, now model.build_fda.stock_data_forecast)
[0m16:58:29.727528 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data_forecast
[0m16:58:29.730268 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data_forecast"
[0m16:58:29.731105 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data_forecast
[0m16:58:29.732436 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:58:29.732772 [debug] [MainThread]: Connection 'model.build_fda.stock_data_forecast' was properly closed.
[0m16:58:29.733138 [info ] [MainThread]: 
[0m16:58:29.733452 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 5.00 seconds (5.00s).
[0m16:58:29.734233 [debug] [MainThread]: Command end result
[0m16:58:29.755333 [info ] [MainThread]: 
[0m16:58:29.755658 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m16:58:29.755864 [info ] [MainThread]: 
[0m16:58:29.756103 [error] [MainThread]:   Database Error in model fsi_stock_summary (models/output/fsi_stock_summary.sql)
  002060 (42601): SQL compilation error:
  Invalid function type [DATEADD] for window function.
  compiled code at target/run/build_fda/models/output/fsi_stock_summary.sql
[0m16:58:29.756290 [info ] [MainThread]: 
[0m16:58:29.756483 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
[0m16:58:29.758137 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 5.811994, "process_user_time": 1.888112, "process_kernel_time": 1.836287, "process_mem_max_rss": "209731584", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m16:58:29.758459 [debug] [MainThread]: Command `dbt run` failed at 16:58:29.758405 after 5.81 seconds
[0m16:58:29.758686 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1050fc150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fe70a90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1083f93d0>]}
[0m16:58:29.758876 [debug] [MainThread]: Flushing usage events
[0m16:59:30.336593 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f269d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f7b4d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f7bc10>]}


============================== 16:59:30.338477 | 6ac6830b-d5b8-4bf4-9683-f918027e1292 ==============================
[0m16:59:30.338477 [info ] [MainThread]: Running with dbt=1.8.7
[0m16:59:30.338795 [debug] [MainThread]: running dbt with arguments {'use_experimental_parser': 'False', 'log_format': 'default', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'write_json': 'True', 'empty': 'False', 'version_check': 'True', 'introspect': 'True', 'quiet': 'False', 'fail_fast': 'False', 'profiles_dir': '/Users/shatayu/.dbt', 'warn_error': 'None', 'use_colors': 'True', 'invocation_command': 'dbt run', 'no_print': 'None', 'indirect_selection': 'eager', 'partial_parse': 'True', 'debug': 'False', 'log_path': '/Users/shatayu/Downloads/DATA226_Lab2Prep/build_fda/logs', 'printer_width': '80', 'send_anonymous_usage_stats': 'True', 'cache_selected_only': 'False', 'target_path': 'None', 'log_cache_events': 'False', 'static_parser': 'True'}
[0m16:59:31.104413 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6ac6830b-d5b8-4bf4-9683-f918027e1292', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11dc94150>]}
[0m16:59:31.124674 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6ac6830b-d5b8-4bf4-9683-f918027e1292', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103e004d0>]}
[0m16:59:31.125254 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m16:59:31.137810 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m16:59:31.204102 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m16:59:31.204456 [debug] [MainThread]: Partial parsing: updated file: build_fda://models/output/fsi_stock_summary.sql
[0m16:59:31.304660 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6ac6830b-d5b8-4bf4-9683-f918027e1292', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12d806b90>]}
[0m16:59:31.343776 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6ac6830b-d5b8-4bf4-9683-f918027e1292', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12d89d9d0>]}
[0m16:59:31.344045 [info ] [MainThread]: Found 5 models, 5 sources, 459 macros
[0m16:59:31.344215 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6ac6830b-d5b8-4bf4-9683-f918027e1292', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12d8fbf50>]}
[0m16:59:31.345073 [info ] [MainThread]: 
[0m16:59:31.345371 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m16:59:31.347304 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m16:59:31.353110 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m16:59:31.353272 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m16:59:31.353396 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:59:31.924717 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.570 seconds
[0m16:59:31.927550 [debug] [ThreadPool]: On list_dev: Close
[0m16:59:32.066427 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_analytics)
[0m16:59:32.077857 [debug] [ThreadPool]: Using snowflake connection "list_dev_analytics"
[0m16:59:32.078497 [debug] [ThreadPool]: On list_dev_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev_analytics"} */
show objects in dev.analytics limit 10000
[0m16:59:32.078755 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:59:32.617148 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.538 seconds
[0m16:59:32.622447 [debug] [ThreadPool]: On list_dev_analytics: Close
[0m16:59:32.780246 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6ac6830b-d5b8-4bf4-9683-f918027e1292', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12d83b050>]}
[0m16:59:32.781263 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m16:59:32.781787 [info ] [MainThread]: 
[0m16:59:32.786508 [debug] [Thread-1 (]: Began running node model.build_fda.dmi_stock_summary
[0m16:59:32.787202 [info ] [Thread-1 (]: 1 of 3 START sql table model analytics.dmi_stock_summary ....................... [RUN]
[0m16:59:32.787778 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_analytics, now model.build_fda.dmi_stock_summary)
[0m16:59:32.788151 [debug] [Thread-1 (]: Began compiling node model.build_fda.dmi_stock_summary
[0m16:59:32.796560 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.dmi_stock_summary"
[0m16:59:32.797498 [debug] [Thread-1 (]: Began executing node model.build_fda.dmi_stock_summary
[0m16:59:32.817208 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.dmi_stock_summary"
[0m16:59:32.818812 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.dmi_stock_summary"
[0m16:59:32.819202 [debug] [Thread-1 (]: On model.build_fda.dmi_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.dmi_stock_summary"} */
create or replace transient table dev.analytics.dmi_stock_summary
         as
        (WITH stock_prices AS (
    SELECT
        date,
        close,
        symbol
    FROM dev.raw_data.stock_data
    WHERE symbol IN ('AAPL', 'NVDA')  -- Including both Apple and Nvidia
),

-- Calculate the 20-day SMA and 20-day standard deviation for both symbols
sma_stddev AS (
    SELECT
        date,
        symbol,
        close,
        AVG(close) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS middle_band,
        STDDEV(close) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS stddev_20
    FROM stock_prices
),

-- Calculate the upper and lower bands
bands AS (
    SELECT
        date,
        symbol,
        close,
        middle_band,
        (middle_band + (2 * stddev_20)) AS upper_band,
        (middle_band - (2 * stddev_20)) AS lower_band
    FROM sma_stddev
),

-- Calculate +DI and -DI based on daily price movements for each stock symbol
directional_indicators AS (
    SELECT
        date,
        symbol,
        close,
        middle_band,
        upper_band,
        lower_band,
        LAG(close, 1) OVER (PARTITION BY symbol ORDER BY date) AS prev_close,
        -- +DI: Calculate positive movement
        CASE WHEN close > prev_close THEN close - prev_close ELSE 0 END AS plus_di,
        -- -DI: Calculate negative movement
        CASE WHEN close < prev_close THEN prev_close - close ELSE 0 END AS minus_di
    FROM bands
)

SELECT
    date,
    symbol,  -- To differentiate between Apple and Nvidia
    close,
    middle_band,
    upper_band,
    lower_band,
    -- Summing up DI over the 20-day period for smoother trend analysis
    SUM(plus_di) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS plus_di_twenty,
    SUM(minus_di) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS minus_di_twenty
FROM directional_indicators
ORDER BY symbol, date
        );
[0m16:59:32.819540 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:59:34.720362 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.901 seconds
[0m16:59:34.744961 [debug] [Thread-1 (]: On model.build_fda.dmi_stock_summary: Close
[0m16:59:34.862343 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6ac6830b-d5b8-4bf4-9683-f918027e1292', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12dab8290>]}
[0m16:59:34.863727 [info ] [Thread-1 (]: 1 of 3 OK created sql table model analytics.dmi_stock_summary .................. [[32mSUCCESS 1[0m in 2.07s]
[0m16:59:34.864505 [debug] [Thread-1 (]: Finished running node model.build_fda.dmi_stock_summary
[0m16:59:34.865007 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_stock_summary
[0m16:59:34.865630 [info ] [Thread-1 (]: 2 of 3 START sql table model analytics.fsi_stock_summary ....................... [RUN]
[0m16:59:34.866217 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.dmi_stock_summary, now model.build_fda.fsi_stock_summary)
[0m16:59:34.866656 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_stock_summary
[0m16:59:34.870736 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_stock_summary"
[0m16:59:34.871711 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_stock_summary
[0m16:59:34.874536 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_stock_summary"
[0m16:59:34.876479 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_stock_summary"
[0m16:59:34.876877 [debug] [Thread-1 (]: On model.build_fda.fsi_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_stock_summary"} */
create or replace transient table dev.analytics.fsi_stock_summary
         as
        (WITH interval_widths AS (
    SELECT
        ts as date,
        forecast,
        lower_bound,
        upper_bound,
        REPLACE(series, '"', '') AS symbol,
        (upper_bound - lower_bound) AS interval_width,
        'FORECASTED' as record_type
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
),

statistics AS (
    SELECT
        symbol,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM interval_widths
    GROUP BY symbol
),

recent_data AS (
    SELECT
        date,
        close,
        symbol,
        'HISTORICAL' as record_type
    FROM dev.raw_data.stock_data
    WHERE date >= CURRENT_DATE() - INTERVAL '21 DAY'  -- Fetch data from the last 21 days (3 weeks)
      AND symbol IN ('AAPL', 'NVDA')                    -- Filter for specific symbols
)

SELECT
    a.symbol,
    a.date,
    a.forecast as close,
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM interval_widths a
JOIN statistics s
    ON a.symbol = s.symbol

UNION ALL

SELECT
    r.symbol,
    r.date,
    r.close,
    NULL AS avg_interval_width,  -- NULL for non-forecasted data
    NULL AS stddev_interval_width,  -- NULL for non-forecasted data
    NULL AS fsi,  -- NULL for non-forecasted data
    r.record_type
FROM recent_data r
ORDER BY date, symbol
        );
[0m16:59:34.877220 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:59:35.493637 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b8553b-0004-2cb8-0002-55f300010286
[0m16:59:35.494449 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 001789 (42601): SQL compilation error:
invalid number of result columns for set operator input branches, expected 6, got 7 in branch 2
[0m16:59:35.494992 [debug] [Thread-1 (]: On model.build_fda.fsi_stock_summary: Close
[0m16:59:35.622941 [debug] [Thread-1 (]: Database Error in model fsi_stock_summary (models/output/fsi_stock_summary.sql)
  001789 (42601): SQL compilation error:
  invalid number of result columns for set operator input branches, expected 6, got 7 in branch 2
  compiled code at target/run/build_fda/models/output/fsi_stock_summary.sql
[0m16:59:35.623616 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6ac6830b-d5b8-4bf4-9683-f918027e1292', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103df93d0>]}
[0m16:59:35.624366 [error] [Thread-1 (]: 2 of 3 ERROR creating sql table model analytics.fsi_stock_summary .............. [[31mERROR[0m in 0.76s]
[0m16:59:35.625035 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_stock_summary
[0m16:59:35.625502 [debug] [Thread-1 (]: Began running node model.build_fda.obv_stock_summary
[0m16:59:35.626146 [info ] [Thread-1 (]: 3 of 3 START sql table model analytics.obv_stock_summary ....................... [RUN]
[0m16:59:35.626663 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_stock_summary, now model.build_fda.obv_stock_summary)
[0m16:59:35.627036 [debug] [Thread-1 (]: Began compiling node model.build_fda.obv_stock_summary
[0m16:59:35.630299 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.obv_stock_summary"
[0m16:59:35.631097 [debug] [Thread-1 (]: Began executing node model.build_fda.obv_stock_summary
[0m16:59:35.633831 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.obv_stock_summary"
[0m16:59:35.635342 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.obv_stock_summary"
[0m16:59:35.637127 [debug] [Thread-1 (]: On model.build_fda.obv_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.obv_stock_summary"} */
create or replace transient table dev.analytics.obv_stock_summary
         as
        (WITH ordered_data AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM dev.raw_data.stock_data -- Referencing the raw data table in the dev database
    WHERE symbol IN ('AAPL', 'NVDA')  -- Include both AAPL and NVDA symbols
),

obv_calculation AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        CASE
            WHEN close > LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN volume
            WHEN close < LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN -volume
            ELSE 0
        END AS volume_change
    FROM ordered_data
),

cumulative_obv AS (
    SELECT
        date,
        symbol,
        SUM(volume_change) OVER (PARTITION BY symbol ORDER BY date) AS obv
    FROM obv_calculation
)

SELECT
    date,
    symbol,
    obv
FROM cumulative_obv
ORDER BY symbol, date
        );
[0m16:59:35.637471 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:59:37.382856 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.745 seconds
[0m16:59:37.389477 [debug] [Thread-1 (]: On model.build_fda.obv_stock_summary: Close
[0m16:59:37.520871 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6ac6830b-d5b8-4bf4-9683-f918027e1292', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12db55910>]}
[0m16:59:37.521962 [info ] [Thread-1 (]: 3 of 3 OK created sql table model analytics.obv_stock_summary .................. [[32mSUCCESS 1[0m in 1.89s]
[0m16:59:37.522777 [debug] [Thread-1 (]: Finished running node model.build_fda.obv_stock_summary
[0m16:59:37.523327 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data
[0m16:59:37.523982 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.obv_stock_summary, now model.build_fda.stock_data)
[0m16:59:37.524537 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data
[0m16:59:37.528783 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data"
[0m16:59:37.530102 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data
[0m16:59:37.530527 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data_forecast
[0m16:59:37.530978 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.stock_data, now model.build_fda.stock_data_forecast)
[0m16:59:37.531328 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data_forecast
[0m16:59:37.534005 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data_forecast"
[0m16:59:37.535152 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data_forecast
[0m16:59:37.536352 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:59:37.536628 [debug] [MainThread]: Connection 'model.build_fda.stock_data_forecast' was properly closed.
[0m16:59:37.536967 [info ] [MainThread]: 
[0m16:59:37.537256 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 6.19 seconds (6.19s).
[0m16:59:37.538005 [debug] [MainThread]: Command end result
[0m16:59:37.558720 [info ] [MainThread]: 
[0m16:59:37.559054 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m16:59:37.559256 [info ] [MainThread]: 
[0m16:59:37.559492 [error] [MainThread]:   Database Error in model fsi_stock_summary (models/output/fsi_stock_summary.sql)
  001789 (42601): SQL compilation error:
  invalid number of result columns for set operator input branches, expected 6, got 7 in branch 2
  compiled code at target/run/build_fda/models/output/fsi_stock_summary.sql
[0m16:59:37.559687 [info ] [MainThread]: 
[0m16:59:37.559882 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
[0m16:59:37.561954 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 7.2745214, "process_user_time": 2.258741, "process_kernel_time": 1.530284, "process_mem_max_rss": "203505664", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m16:59:37.562306 [debug] [MainThread]: Command `dbt run` failed at 16:59:37.562248 after 7.27 seconds
[0m16:59:37.562547 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100b64150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102d72a10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102d71c10>]}
[0m16:59:37.562765 [debug] [MainThread]: Flushing usage events
[0m17:00:59.104061 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1052c2ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1053174d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105334c90>]}


============================== 17:00:59.105882 | e9923d13-2d03-4523-8c01-af22355d1876 ==============================
[0m17:00:59.105882 [info ] [MainThread]: Running with dbt=1.8.7
[0m17:00:59.106212 [debug] [MainThread]: running dbt with arguments {'fail_fast': 'False', 'introspect': 'True', 'use_colors': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'indirect_selection': 'eager', 'static_parser': 'True', 'log_path': '/Users/shatayu/Downloads/DATA226_Lab2Prep/build_fda/logs', 'log_format': 'default', 'version_check': 'True', 'log_cache_events': 'False', 'invocation_command': 'dbt run', 'profiles_dir': '/Users/shatayu/.dbt', 'printer_width': '80', 'send_anonymous_usage_stats': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'target_path': 'None', 'warn_error': 'None', 'quiet': 'False', 'write_json': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'no_print': 'None', 'debug': 'False'}
[0m17:00:59.924727 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e9923d13-2d03-4523-8c01-af22355d1876', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113d60150>]}
[0m17:00:59.945002 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e9923d13-2d03-4523-8c01-af22355d1876', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104d81510>]}
[0m17:00:59.945594 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m17:00:59.958307 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m17:01:00.025099 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m17:01:00.025623 [debug] [MainThread]: Partial parsing: updated file: build_fda://models/output/fsi_stock_summary.sql
[0m17:01:00.128802 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e9923d13-2d03-4523-8c01-af22355d1876', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x131ba3e90>]}
[0m17:01:00.168545 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e9923d13-2d03-4523-8c01-af22355d1876', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x132868cd0>]}
[0m17:01:00.168807 [info ] [MainThread]: Found 5 models, 5 sources, 459 macros
[0m17:01:00.168985 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e9923d13-2d03-4523-8c01-af22355d1876', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13288e950>]}
[0m17:01:00.169862 [info ] [MainThread]: 
[0m17:01:00.170155 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m17:01:00.172073 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m17:01:00.177882 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m17:01:00.178045 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m17:01:00.178173 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:01:00.980441 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.802 seconds
[0m17:01:00.984228 [debug] [ThreadPool]: On list_dev: Close
[0m17:01:01.127841 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_analytics)
[0m17:01:01.139864 [debug] [ThreadPool]: Using snowflake connection "list_dev_analytics"
[0m17:01:01.140305 [debug] [ThreadPool]: On list_dev_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev_analytics"} */
show objects in dev.analytics limit 10000
[0m17:01:01.140583 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:01:01.714458 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.573 seconds
[0m17:01:01.718917 [debug] [ThreadPool]: On list_dev_analytics: Close
[0m17:01:01.881448 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e9923d13-2d03-4523-8c01-af22355d1876', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13288d950>]}
[0m17:01:01.881865 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m17:01:01.882040 [info ] [MainThread]: 
[0m17:01:01.884370 [debug] [Thread-1 (]: Began running node model.build_fda.dmi_stock_summary
[0m17:01:01.884677 [info ] [Thread-1 (]: 1 of 3 START sql table model analytics.dmi_stock_summary ....................... [RUN]
[0m17:01:01.884919 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_analytics, now model.build_fda.dmi_stock_summary)
[0m17:01:01.885095 [debug] [Thread-1 (]: Began compiling node model.build_fda.dmi_stock_summary
[0m17:01:01.889344 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.dmi_stock_summary"
[0m17:01:01.889812 [debug] [Thread-1 (]: Began executing node model.build_fda.dmi_stock_summary
[0m17:01:01.911664 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.dmi_stock_summary"
[0m17:01:01.913331 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.dmi_stock_summary"
[0m17:01:01.913685 [debug] [Thread-1 (]: On model.build_fda.dmi_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.dmi_stock_summary"} */
create or replace transient table dev.analytics.dmi_stock_summary
         as
        (WITH stock_prices AS (
    SELECT
        date,
        close,
        symbol
    FROM dev.raw_data.stock_data
    WHERE symbol IN ('AAPL', 'NVDA')  -- Including both Apple and Nvidia
),

-- Calculate the 20-day SMA and 20-day standard deviation for both symbols
sma_stddev AS (
    SELECT
        date,
        symbol,
        close,
        AVG(close) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS middle_band,
        STDDEV(close) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS stddev_20
    FROM stock_prices
),

-- Calculate the upper and lower bands
bands AS (
    SELECT
        date,
        symbol,
        close,
        middle_band,
        (middle_band + (2 * stddev_20)) AS upper_band,
        (middle_band - (2 * stddev_20)) AS lower_band
    FROM sma_stddev
),

-- Calculate +DI and -DI based on daily price movements for each stock symbol
directional_indicators AS (
    SELECT
        date,
        symbol,
        close,
        middle_band,
        upper_band,
        lower_band,
        LAG(close, 1) OVER (PARTITION BY symbol ORDER BY date) AS prev_close,
        -- +DI: Calculate positive movement
        CASE WHEN close > prev_close THEN close - prev_close ELSE 0 END AS plus_di,
        -- -DI: Calculate negative movement
        CASE WHEN close < prev_close THEN prev_close - close ELSE 0 END AS minus_di
    FROM bands
)

SELECT
    date,
    symbol,  -- To differentiate between Apple and Nvidia
    close,
    middle_band,
    upper_band,
    lower_band,
    -- Summing up DI over the 20-day period for smoother trend analysis
    SUM(plus_di) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS plus_di_twenty,
    SUM(minus_di) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS minus_di_twenty
FROM directional_indicators
ORDER BY symbol, date
        );
[0m17:01:01.914002 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:01:03.604353 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.690 seconds
[0m17:01:03.628291 [debug] [Thread-1 (]: On model.build_fda.dmi_stock_summary: Close
[0m17:01:03.776312 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e9923d13-2d03-4523-8c01-af22355d1876', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x132a58510>]}
[0m17:01:03.777523 [info ] [Thread-1 (]: 1 of 3 OK created sql table model analytics.dmi_stock_summary .................. [[32mSUCCESS 1[0m in 1.89s]
[0m17:01:03.778354 [debug] [Thread-1 (]: Finished running node model.build_fda.dmi_stock_summary
[0m17:01:03.778990 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_stock_summary
[0m17:01:03.779710 [info ] [Thread-1 (]: 2 of 3 START sql table model analytics.fsi_stock_summary ....................... [RUN]
[0m17:01:03.780394 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.dmi_stock_summary, now model.build_fda.fsi_stock_summary)
[0m17:01:03.780800 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_stock_summary
[0m17:01:03.784672 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_stock_summary"
[0m17:01:03.785719 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_stock_summary
[0m17:01:03.788593 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_stock_summary"
[0m17:01:03.790563 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_stock_summary"
[0m17:01:03.790987 [debug] [Thread-1 (]: On model.build_fda.fsi_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_stock_summary"} */
create or replace transient table dev.analytics.fsi_stock_summary
         as
        (WITH interval_widths AS (
    SELECT
        ts as date,
        forecast,
        lower_bound,
        upper_bound,
        REPLACE(series, '"', '') AS symbol,
        (upper_bound - lower_bound) AS interval_width,
        'FORECASTED' as record_type
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
),

statistics AS (
    SELECT
        symbol,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM interval_widths
    GROUP BY symbol
),

recent_data AS (
    SELECT
        date,
        close,
        symbol,
        'HISTORICAL' as record_type
    FROM dev.raw_data.stock_data
    WHERE date >= CURRENT_DATE() - INTERVAL '21 DAY'  -- Fetch data from the last 21 days (3 weeks)
      AND symbol IN ('AAPL', 'NVDA')                    -- Filter for specific symbols
)

SELECT
    a.record_type,
    a.symbol,
    a.date,
    a.forecast as close,
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM interval_widths a
JOIN statistics s
    ON a.symbol = s.symbol

UNION ALL

SELECT
    r.symbol,
    r.date,
    r.close,
    NULL AS avg_interval_width,  -- NULL for non-forecasted data
    NULL AS stddev_interval_width,  -- NULL for non-forecasted data
    NULL AS fsi,  -- NULL for non-forecasted data
    r.record_type
FROM recent_data r
ORDER BY date, symbol
        );
[0m17:01:03.791379 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:01:04.306966 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b8553d-0004-26ba-0000-000255f35ed5
[0m17:01:04.307656 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 001790 (42601): SQL compilation error:
inconsistent data type for result columns for set operator input branches, expected FLOAT, got TIMESTAMP_NTZ(9)
[0m17:01:04.308116 [debug] [Thread-1 (]: On model.build_fda.fsi_stock_summary: Close
[0m17:01:04.459007 [debug] [Thread-1 (]: Database Error in model fsi_stock_summary (models/output/fsi_stock_summary.sql)
  001790 (42601): SQL compilation error:
  inconsistent data type for result columns for set operator input branches, expected FLOAT, got TIMESTAMP_NTZ(9)
  compiled code at target/run/build_fda/models/output/fsi_stock_summary.sql
[0m17:01:04.459450 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e9923d13-2d03-4523-8c01-af22355d1876', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x132904710>]}
[0m17:01:04.459797 [error] [Thread-1 (]: 2 of 3 ERROR creating sql table model analytics.fsi_stock_summary .............. [[31mERROR[0m in 0.68s]
[0m17:01:04.460092 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_stock_summary
[0m17:01:04.460296 [debug] [Thread-1 (]: Began running node model.build_fda.obv_stock_summary
[0m17:01:04.460506 [info ] [Thread-1 (]: 3 of 3 START sql table model analytics.obv_stock_summary ....................... [RUN]
[0m17:01:04.460739 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_stock_summary, now model.build_fda.obv_stock_summary)
[0m17:01:04.461056 [debug] [Thread-1 (]: Began compiling node model.build_fda.obv_stock_summary
[0m17:01:04.462814 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.obv_stock_summary"
[0m17:01:04.463261 [debug] [Thread-1 (]: Began executing node model.build_fda.obv_stock_summary
[0m17:01:04.464743 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.obv_stock_summary"
[0m17:01:04.465589 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.obv_stock_summary"
[0m17:01:04.467058 [debug] [Thread-1 (]: On model.build_fda.obv_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.obv_stock_summary"} */
create or replace transient table dev.analytics.obv_stock_summary
         as
        (WITH ordered_data AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM dev.raw_data.stock_data -- Referencing the raw data table in the dev database
    WHERE symbol IN ('AAPL', 'NVDA')  -- Include both AAPL and NVDA symbols
),

obv_calculation AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        CASE
            WHEN close > LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN volume
            WHEN close < LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN -volume
            ELSE 0
        END AS volume_change
    FROM ordered_data
),

cumulative_obv AS (
    SELECT
        date,
        symbol,
        SUM(volume_change) OVER (PARTITION BY symbol ORDER BY date) AS obv
    FROM obv_calculation
)

SELECT
    date,
    symbol,
    obv
FROM cumulative_obv
ORDER BY symbol, date
        );
[0m17:01:04.467337 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:01:05.875717 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.407 seconds
[0m17:01:05.880457 [debug] [Thread-1 (]: On model.build_fda.obv_stock_summary: Close
[0m17:01:05.996520 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e9923d13-2d03-4523-8c01-af22355d1876', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x132c54910>]}
[0m17:01:05.997585 [info ] [Thread-1 (]: 3 of 3 OK created sql table model analytics.obv_stock_summary .................. [[32mSUCCESS 1[0m in 1.54s]
[0m17:01:05.998385 [debug] [Thread-1 (]: Finished running node model.build_fda.obv_stock_summary
[0m17:01:05.998935 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data
[0m17:01:05.999573 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.obv_stock_summary, now model.build_fda.stock_data)
[0m17:01:06.000134 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data
[0m17:01:06.003934 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data"
[0m17:01:06.005181 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data
[0m17:01:06.005636 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data_forecast
[0m17:01:06.006091 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.stock_data, now model.build_fda.stock_data_forecast)
[0m17:01:06.006459 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data_forecast
[0m17:01:06.009231 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data_forecast"
[0m17:01:06.010147 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data_forecast
[0m17:01:06.011480 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:01:06.011829 [debug] [MainThread]: Connection 'model.build_fda.stock_data_forecast' was properly closed.
[0m17:01:06.012215 [info ] [MainThread]: 
[0m17:01:06.012542 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 5.84 seconds (5.84s).
[0m17:01:06.013338 [debug] [MainThread]: Command end result
[0m17:01:06.035282 [info ] [MainThread]: 
[0m17:01:06.035580 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m17:01:06.035819 [info ] [MainThread]: 
[0m17:01:06.036102 [error] [MainThread]:   Database Error in model fsi_stock_summary (models/output/fsi_stock_summary.sql)
  001790 (42601): SQL compilation error:
  inconsistent data type for result columns for set operator input branches, expected FLOAT, got TIMESTAMP_NTZ(9)
  compiled code at target/run/build_fda/models/output/fsi_stock_summary.sql
[0m17:01:06.036368 [info ] [MainThread]: 
[0m17:01:06.036609 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
[0m17:01:06.038831 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 6.980888, "process_user_time": 2.225711, "process_kernel_time": 1.536122, "process_mem_max_rss": "202833920", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m17:01:06.039170 [debug] [MainThread]: Command `dbt run` failed at 17:01:06.039114 after 6.98 seconds
[0m17:01:06.039400 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100f00150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x131fd7650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x131e3d510>]}
[0m17:01:06.039604 [debug] [MainThread]: Flushing usage events
[0m17:06:30.687317 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103c25ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10569fc10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1056c0c50>]}


============================== 17:06:30.689324 | a9f672fe-f07a-435f-94c1-61a4baa92d1b ==============================
[0m17:06:30.689324 [info ] [MainThread]: Running with dbt=1.8.7
[0m17:06:30.689654 [debug] [MainThread]: running dbt with arguments {'indirect_selection': 'eager', 'partial_parse': 'True', 'cache_selected_only': 'False', 'introspect': 'True', 'write_json': 'True', 'use_experimental_parser': 'False', 'warn_error': 'None', 'log_format': 'default', 'static_parser': 'True', 'fail_fast': 'False', 'quiet': 'False', 'send_anonymous_usage_stats': 'True', 'log_cache_events': 'False', 'use_colors': 'True', 'invocation_command': 'dbt run', 'printer_width': '80', 'profiles_dir': '/Users/shatayu/.dbt', 'debug': 'False', 'empty': 'False', 'no_print': 'None', 'target_path': 'None', 'version_check': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'log_path': '/Users/shatayu/Downloads/DATA226_Lab2Prep/build_fda/logs'}
[0m17:06:31.622105 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a9f672fe-f07a-435f-94c1-61a4baa92d1b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105650750>]}
[0m17:06:31.642108 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a9f672fe-f07a-435f-94c1-61a4baa92d1b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105109490>]}
[0m17:06:31.642649 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m17:06:31.654858 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m17:06:31.725452 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m17:06:31.725797 [debug] [MainThread]: Partial parsing: updated file: build_fda://models/output/fsi_stock_summary.sql
[0m17:06:31.824777 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a9f672fe-f07a-435f-94c1-61a4baa92d1b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e7163d0>]}
[0m17:06:31.865220 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a9f672fe-f07a-435f-94c1-61a4baa92d1b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e85f350>]}
[0m17:06:31.865484 [info ] [MainThread]: Found 5 models, 5 sources, 459 macros
[0m17:06:31.865655 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a9f672fe-f07a-435f-94c1-61a4baa92d1b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e4354d0>]}
[0m17:06:31.866499 [info ] [MainThread]: 
[0m17:06:31.866785 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m17:06:31.868652 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m17:06:31.874495 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m17:06:31.874656 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m17:06:31.874784 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:06:32.409526 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.532 seconds
[0m17:06:32.412113 [debug] [ThreadPool]: On list_dev: Close
[0m17:06:32.531340 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_analytics)
[0m17:06:32.543508 [debug] [ThreadPool]: Using snowflake connection "list_dev_analytics"
[0m17:06:32.543875 [debug] [ThreadPool]: On list_dev_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev_analytics"} */
show objects in dev.analytics limit 10000
[0m17:06:32.544148 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:06:33.159040 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.614 seconds
[0m17:06:33.163785 [debug] [ThreadPool]: On list_dev_analytics: Close
[0m17:06:33.277706 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a9f672fe-f07a-435f-94c1-61a4baa92d1b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e7f5310>]}
[0m17:06:33.278573 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m17:06:33.279007 [info ] [MainThread]: 
[0m17:06:33.282614 [debug] [Thread-1 (]: Began running node model.build_fda.dmi_stock_summary
[0m17:06:33.283236 [info ] [Thread-1 (]: 1 of 3 START sql table model analytics.dmi_stock_summary ....................... [RUN]
[0m17:06:33.283724 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_analytics, now model.build_fda.dmi_stock_summary)
[0m17:06:33.284005 [debug] [Thread-1 (]: Began compiling node model.build_fda.dmi_stock_summary
[0m17:06:33.291394 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.dmi_stock_summary"
[0m17:06:33.292540 [debug] [Thread-1 (]: Began executing node model.build_fda.dmi_stock_summary
[0m17:06:33.314190 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.dmi_stock_summary"
[0m17:06:33.316082 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.dmi_stock_summary"
[0m17:06:33.316428 [debug] [Thread-1 (]: On model.build_fda.dmi_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.dmi_stock_summary"} */
create or replace transient table dev.analytics.dmi_stock_summary
         as
        (WITH stock_prices AS (
    SELECT
        date,
        close,
        symbol
    FROM dev.raw_data.stock_data
    WHERE symbol IN ('AAPL', 'NVDA')  -- Including both Apple and Nvidia
),

-- Calculate the 20-day SMA and 20-day standard deviation for both symbols
sma_stddev AS (
    SELECT
        date,
        symbol,
        close,
        AVG(close) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS middle_band,
        STDDEV(close) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS stddev_20
    FROM stock_prices
),

-- Calculate the upper and lower bands
bands AS (
    SELECT
        date,
        symbol,
        close,
        middle_band,
        (middle_band + (2 * stddev_20)) AS upper_band,
        (middle_band - (2 * stddev_20)) AS lower_band
    FROM sma_stddev
),

-- Calculate +DI and -DI based on daily price movements for each stock symbol
directional_indicators AS (
    SELECT
        date,
        symbol,
        close,
        middle_band,
        upper_band,
        lower_band,
        LAG(close, 1) OVER (PARTITION BY symbol ORDER BY date) AS prev_close,
        -- +DI: Calculate positive movement
        CASE WHEN close > prev_close THEN close - prev_close ELSE 0 END AS plus_di,
        -- -DI: Calculate negative movement
        CASE WHEN close < prev_close THEN prev_close - close ELSE 0 END AS minus_di
    FROM bands
)

SELECT
    date,
    symbol,  -- To differentiate between Apple and Nvidia
    close,
    middle_band,
    upper_band,
    lower_band,
    -- Summing up DI over the 20-day period for smoother trend analysis
    SUM(plus_di) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS plus_di_twenty,
    SUM(minus_di) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS minus_di_twenty
FROM directional_indicators
ORDER BY symbol, date
        );
[0m17:06:33.316720 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:06:34.760641 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.443 seconds
[0m17:06:34.784137 [debug] [Thread-1 (]: On model.build_fda.dmi_stock_summary: Close
[0m17:06:34.900915 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a9f672fe-f07a-435f-94c1-61a4baa92d1b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1067308d0>]}
[0m17:06:34.902224 [info ] [Thread-1 (]: 1 of 3 OK created sql table model analytics.dmi_stock_summary .................. [[32mSUCCESS 1[0m in 1.62s]
[0m17:06:34.902966 [debug] [Thread-1 (]: Finished running node model.build_fda.dmi_stock_summary
[0m17:06:34.903481 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_stock_summary
[0m17:06:34.904135 [info ] [Thread-1 (]: 2 of 3 START sql table model analytics.fsi_stock_summary ....................... [RUN]
[0m17:06:34.904749 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.dmi_stock_summary, now model.build_fda.fsi_stock_summary)
[0m17:06:34.905174 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_stock_summary
[0m17:06:34.909207 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_stock_summary"
[0m17:06:34.911457 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_stock_summary
[0m17:06:34.914262 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_stock_summary"
[0m17:06:34.916154 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_stock_summary"
[0m17:06:34.916548 [debug] [Thread-1 (]: On model.build_fda.fsi_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_stock_summary"} */
create or replace transient table dev.analytics.fsi_stock_summary
         as
        (WITH interval_widths AS (
    SELECT
        ts as date,
        forecast,
        lower_bound,
        upper_bound,
        REPLACE(series, '"', '') AS symbol,
        (upper_bound - lower_bound) AS interval_width,
        'FORECASTED' as record_type
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
),

statistics AS (
    SELECT
        symbol,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM interval_widths
    GROUP BY symbol
),

recent_data AS (
    SELECT
        date::TIMESTAMP_NTZ(9) as date,
        close,
        symbol,
        'HISTORICAL' as record_type
    FROM dev.raw_data.stock_data
    WHERE date >= CURRENT_DATE() - INTERVAL '21 DAY'  -- Fetch data from the last 21 days (3 weeks)
      AND symbol IN ('AAPL', 'NVDA')                    -- Filter for specific symbols
)

SELECT
    a.record_type,
    a.symbol,
    a.date,
    a.forecast as close,
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM interval_widths a
JOIN statistics s
    ON a.symbol = s.symbol

UNION ALL

SELECT
    r.symbol,
    r.date,
    r.close,
    NULL AS avg_interval_width,  -- NULL for non-forecasted data
    NULL AS stddev_interval_width,  -- NULL for non-forecasted data
    NULL AS fsi,  -- NULL for non-forecasted data
    r.record_type
FROM recent_data r
ORDER BY date, symbol
        );
[0m17:06:34.916895 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:06:35.429336 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b85542-0004-26ad-0000-000255f3dcd9
[0m17:06:35.429917 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 001790 (42601): SQL compilation error:
inconsistent data type for result columns for set operator input branches, expected FLOAT, got TIMESTAMP_NTZ(9)
[0m17:06:35.430319 [debug] [Thread-1 (]: On model.build_fda.fsi_stock_summary: Close
[0m17:06:35.558237 [debug] [Thread-1 (]: Database Error in model fsi_stock_summary (models/output/fsi_stock_summary.sql)
  001790 (42601): SQL compilation error:
  inconsistent data type for result columns for set operator input branches, expected FLOAT, got TIMESTAMP_NTZ(9)
  compiled code at target/run/build_fda/models/output/fsi_stock_summary.sql
[0m17:06:35.559175 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a9f672fe-f07a-435f-94c1-61a4baa92d1b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10565fe50>]}
[0m17:06:35.560001 [error] [Thread-1 (]: 2 of 3 ERROR creating sql table model analytics.fsi_stock_summary .............. [[31mERROR[0m in 0.65s]
[0m17:06:35.560672 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_stock_summary
[0m17:06:35.561133 [debug] [Thread-1 (]: Began running node model.build_fda.obv_stock_summary
[0m17:06:35.561587 [info ] [Thread-1 (]: 3 of 3 START sql table model analytics.obv_stock_summary ....................... [RUN]
[0m17:06:35.562302 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_stock_summary, now model.build_fda.obv_stock_summary)
[0m17:06:35.562807 [debug] [Thread-1 (]: Began compiling node model.build_fda.obv_stock_summary
[0m17:06:35.566291 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.obv_stock_summary"
[0m17:06:35.567380 [debug] [Thread-1 (]: Began executing node model.build_fda.obv_stock_summary
[0m17:06:35.570268 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.obv_stock_summary"
[0m17:06:35.571701 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.obv_stock_summary"
[0m17:06:35.573541 [debug] [Thread-1 (]: On model.build_fda.obv_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.obv_stock_summary"} */
create or replace transient table dev.analytics.obv_stock_summary
         as
        (WITH ordered_data AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM dev.raw_data.stock_data -- Referencing the raw data table in the dev database
    WHERE symbol IN ('AAPL', 'NVDA')  -- Include both AAPL and NVDA symbols
),

obv_calculation AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        CASE
            WHEN close > LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN volume
            WHEN close < LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN -volume
            ELSE 0
        END AS volume_change
    FROM ordered_data
),

cumulative_obv AS (
    SELECT
        date,
        symbol,
        SUM(volume_change) OVER (PARTITION BY symbol ORDER BY date) AS obv
    FROM obv_calculation
)

SELECT
    date,
    symbol,
    obv
FROM cumulative_obv
ORDER BY symbol, date
        );
[0m17:06:35.573874 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:06:36.910868 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.336 seconds
[0m17:06:36.914839 [debug] [Thread-1 (]: On model.build_fda.obv_stock_summary: Close
[0m17:06:37.061770 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a9f672fe-f07a-435f-94c1-61a4baa92d1b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ea551d0>]}
[0m17:06:37.062851 [info ] [Thread-1 (]: 3 of 3 OK created sql table model analytics.obv_stock_summary .................. [[32mSUCCESS 1[0m in 1.50s]
[0m17:06:37.063855 [debug] [Thread-1 (]: Finished running node model.build_fda.obv_stock_summary
[0m17:06:37.064323 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data
[0m17:06:37.064926 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.obv_stock_summary, now model.build_fda.stock_data)
[0m17:06:37.065263 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data
[0m17:06:37.068525 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data"
[0m17:06:37.069580 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data
[0m17:06:37.069886 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data_forecast
[0m17:06:37.070165 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.stock_data, now model.build_fda.stock_data_forecast)
[0m17:06:37.070690 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data_forecast
[0m17:06:37.073593 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data_forecast"
[0m17:06:37.074995 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data_forecast
[0m17:06:37.076167 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:06:37.076419 [debug] [MainThread]: Connection 'model.build_fda.stock_data_forecast' was properly closed.
[0m17:06:37.076743 [info ] [MainThread]: 
[0m17:06:37.077018 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 5.21 seconds (5.21s).
[0m17:06:37.077703 [debug] [MainThread]: Command end result
[0m17:06:37.099537 [info ] [MainThread]: 
[0m17:06:37.099894 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m17:06:37.100084 [info ] [MainThread]: 
[0m17:06:37.100326 [error] [MainThread]:   Database Error in model fsi_stock_summary (models/output/fsi_stock_summary.sql)
  001790 (42601): SQL compilation error:
  inconsistent data type for result columns for set operator input branches, expected FLOAT, got TIMESTAMP_NTZ(9)
  compiled code at target/run/build_fda/models/output/fsi_stock_summary.sql
[0m17:06:37.100511 [info ] [MainThread]: 
[0m17:06:37.100714 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
[0m17:06:37.103016 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 6.4672966, "process_user_time": 2.258343, "process_kernel_time": 1.541819, "process_mem_max_rss": "205635584", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m17:06:37.103378 [debug] [MainThread]: Command `dbt run` failed at 17:06:37.103323 after 6.47 seconds
[0m17:06:37.103604 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x101288150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e3cce90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e3f9350>]}
[0m17:06:37.103803 [debug] [MainThread]: Flushing usage events
[0m17:07:26.502341 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120051710>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1200c0610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1200c0b50>]}


============================== 17:07:26.504151 | 6b9a9561-24d0-4908-ad79-260048552c3e ==============================
[0m17:07:26.504151 [info ] [MainThread]: Running with dbt=1.8.7
[0m17:07:26.504494 [debug] [MainThread]: running dbt with arguments {'introspect': 'True', 'invocation_command': 'dbt run', 'partial_parse': 'True', 'warn_error': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'printer_width': '80', 'empty': 'False', 'debug': 'False', 'log_path': '/Users/shatayu/Downloads/DATA226_Lab2Prep/build_fda/logs', 'static_parser': 'True', 'fail_fast': 'False', 'target_path': 'None', 'use_colors': 'True', 'no_print': 'None', 'use_experimental_parser': 'False', 'quiet': 'False', 'cache_selected_only': 'False', 'log_format': 'default', 'write_json': 'True', 'profiles_dir': '/Users/shatayu/.dbt', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'version_check': 'True', 'send_anonymous_usage_stats': 'True'}
[0m17:07:27.297889 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6b9a9561-24d0-4908-ad79-260048552c3e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x127104150>]}
[0m17:07:27.318114 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6b9a9561-24d0-4908-ad79-260048552c3e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107945790>]}
[0m17:07:27.318696 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m17:07:27.331896 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m17:07:27.398835 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m17:07:27.399209 [debug] [MainThread]: Partial parsing: updated file: build_fda://models/output/fsi_stock_summary.sql
[0m17:07:27.499442 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6b9a9561-24d0-4908-ad79-260048552c3e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x154b40d10>]}
[0m17:07:27.539795 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6b9a9561-24d0-4908-ad79-260048552c3e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x154e68350>]}
[0m17:07:27.540076 [info ] [MainThread]: Found 5 models, 5 sources, 459 macros
[0m17:07:27.540249 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6b9a9561-24d0-4908-ad79-260048552c3e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x154ef7b50>]}
[0m17:07:27.541129 [info ] [MainThread]: 
[0m17:07:27.541418 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m17:07:27.543424 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m17:07:27.549251 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m17:07:27.549415 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m17:07:27.549546 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:07:28.070825 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.521 seconds
[0m17:07:28.073381 [debug] [ThreadPool]: On list_dev: Close
[0m17:07:28.191775 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_analytics)
[0m17:07:28.203071 [debug] [ThreadPool]: Using snowflake connection "list_dev_analytics"
[0m17:07:28.203455 [debug] [ThreadPool]: On list_dev_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev_analytics"} */
show objects in dev.analytics limit 10000
[0m17:07:28.203725 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:07:28.677513 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.473 seconds
[0m17:07:28.683888 [debug] [ThreadPool]: On list_dev_analytics: Close
[0m17:07:28.831774 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6b9a9561-24d0-4908-ad79-260048552c3e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103300b10>]}
[0m17:07:28.832587 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m17:07:28.833026 [info ] [MainThread]: 
[0m17:07:28.838218 [debug] [Thread-1 (]: Began running node model.build_fda.dmi_stock_summary
[0m17:07:28.838861 [info ] [Thread-1 (]: 1 of 3 START sql table model analytics.dmi_stock_summary ....................... [RUN]
[0m17:07:28.839385 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_analytics, now model.build_fda.dmi_stock_summary)
[0m17:07:28.839759 [debug] [Thread-1 (]: Began compiling node model.build_fda.dmi_stock_summary
[0m17:07:28.848128 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.dmi_stock_summary"
[0m17:07:28.849251 [debug] [Thread-1 (]: Began executing node model.build_fda.dmi_stock_summary
[0m17:07:28.869292 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.dmi_stock_summary"
[0m17:07:28.871028 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.dmi_stock_summary"
[0m17:07:28.871403 [debug] [Thread-1 (]: On model.build_fda.dmi_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.dmi_stock_summary"} */
create or replace transient table dev.analytics.dmi_stock_summary
         as
        (WITH stock_prices AS (
    SELECT
        date,
        close,
        symbol
    FROM dev.raw_data.stock_data
    WHERE symbol IN ('AAPL', 'NVDA')  -- Including both Apple and Nvidia
),

-- Calculate the 20-day SMA and 20-day standard deviation for both symbols
sma_stddev AS (
    SELECT
        date,
        symbol,
        close,
        AVG(close) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS middle_band,
        STDDEV(close) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS stddev_20
    FROM stock_prices
),

-- Calculate the upper and lower bands
bands AS (
    SELECT
        date,
        symbol,
        close,
        middle_band,
        (middle_band + (2 * stddev_20)) AS upper_band,
        (middle_band - (2 * stddev_20)) AS lower_band
    FROM sma_stddev
),

-- Calculate +DI and -DI based on daily price movements for each stock symbol
directional_indicators AS (
    SELECT
        date,
        symbol,
        close,
        middle_band,
        upper_band,
        lower_band,
        LAG(close, 1) OVER (PARTITION BY symbol ORDER BY date) AS prev_close,
        -- +DI: Calculate positive movement
        CASE WHEN close > prev_close THEN close - prev_close ELSE 0 END AS plus_di,
        -- -DI: Calculate negative movement
        CASE WHEN close < prev_close THEN prev_close - close ELSE 0 END AS minus_di
    FROM bands
)

SELECT
    date,
    symbol,  -- To differentiate between Apple and Nvidia
    close,
    middle_band,
    upper_band,
    lower_band,
    -- Summing up DI over the 20-day period for smoother trend analysis
    SUM(plus_di) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS plus_di_twenty,
    SUM(minus_di) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS minus_di_twenty
FROM directional_indicators
ORDER BY symbol, date
        );
[0m17:07:28.871680 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:07:30.143049 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.271 seconds
[0m17:07:30.167869 [debug] [Thread-1 (]: On model.build_fda.dmi_stock_summary: Close
[0m17:07:30.291789 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6b9a9561-24d0-4908-ad79-260048552c3e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x154f0e550>]}
[0m17:07:30.292881 [info ] [Thread-1 (]: 1 of 3 OK created sql table model analytics.dmi_stock_summary .................. [[32mSUCCESS 1[0m in 1.45s]
[0m17:07:30.293748 [debug] [Thread-1 (]: Finished running node model.build_fda.dmi_stock_summary
[0m17:07:30.294346 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_stock_summary
[0m17:07:30.294997 [info ] [Thread-1 (]: 2 of 3 START sql table model analytics.fsi_stock_summary ....................... [RUN]
[0m17:07:30.295567 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.dmi_stock_summary, now model.build_fda.fsi_stock_summary)
[0m17:07:30.295966 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_stock_summary
[0m17:07:30.299731 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_stock_summary"
[0m17:07:30.300756 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_stock_summary
[0m17:07:30.303485 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_stock_summary"
[0m17:07:30.305446 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_stock_summary"
[0m17:07:30.305873 [debug] [Thread-1 (]: On model.build_fda.fsi_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_stock_summary"} */
create or replace transient table dev.analytics.fsi_stock_summary
         as
        (WITH interval_widths AS (
    SELECT
        ts as date,
        forecast,
        lower_bound,
        upper_bound,
        REPLACE(series, '"', '') AS symbol,
        (upper_bound - lower_bound) AS interval_width,
        'FORECASTED' as record_type
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
),

statistics AS (
    SELECT
        symbol,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM interval_widths
    GROUP BY symbol
),

recent_data AS (
    SELECT
        date::TIMESTAMP_NTZ(9) as date,
        close,
        symbol,
        'HISTORICAL' as record_type
    FROM dev.raw_data.stock_data
    WHERE date >= CURRENT_DATE() - INTERVAL '21 DAY'  -- Fetch data from the last 21 days (3 weeks)
      AND symbol IN ('AAPL', 'NVDA')                    -- Filter for specific symbols
)

SELECT
    a.record_type,
    a.symbol,
    a.date::TIMESTAMP_NTZ(9) as date,
    a.forecast as close,
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM interval_widths a
JOIN statistics s
    ON a.symbol = s.symbol

UNION ALL

SELECT
    r.symbol,
    r.date,
    r.close,
    NULL AS avg_interval_width,  -- NULL for non-forecasted data
    NULL AS stddev_interval_width,  -- NULL for non-forecasted data
    NULL AS fsi,  -- NULL for non-forecasted data
    r.record_type
FROM recent_data r
ORDER BY date, symbol
        );
[0m17:07:30.306271 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:07:30.762167 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b85543-0004-26ad-0000-000255f3dcdd
[0m17:07:30.762886 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 001790 (42601): SQL compilation error:
inconsistent data type for result columns for set operator input branches, expected FLOAT, got TIMESTAMP_NTZ(9)
[0m17:07:30.763423 [debug] [Thread-1 (]: On model.build_fda.fsi_stock_summary: Close
[0m17:07:30.934223 [debug] [Thread-1 (]: Database Error in model fsi_stock_summary (models/output/fsi_stock_summary.sql)
  001790 (42601): SQL compilation error:
  inconsistent data type for result columns for set operator input branches, expected FLOAT, got TIMESTAMP_NTZ(9)
  compiled code at target/run/build_fda/models/output/fsi_stock_summary.sql
[0m17:07:30.935156 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6b9a9561-24d0-4908-ad79-260048552c3e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15513b590>]}
[0m17:07:30.935965 [error] [Thread-1 (]: 2 of 3 ERROR creating sql table model analytics.fsi_stock_summary .............. [[31mERROR[0m in 0.64s]
[0m17:07:30.936632 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_stock_summary
[0m17:07:30.937103 [debug] [Thread-1 (]: Began running node model.build_fda.obv_stock_summary
[0m17:07:30.937785 [info ] [Thread-1 (]: 3 of 3 START sql table model analytics.obv_stock_summary ....................... [RUN]
[0m17:07:30.938390 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_stock_summary, now model.build_fda.obv_stock_summary)
[0m17:07:30.938788 [debug] [Thread-1 (]: Began compiling node model.build_fda.obv_stock_summary
[0m17:07:30.941990 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.obv_stock_summary"
[0m17:07:30.942830 [debug] [Thread-1 (]: Began executing node model.build_fda.obv_stock_summary
[0m17:07:30.945586 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.obv_stock_summary"
[0m17:07:30.946980 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.obv_stock_summary"
[0m17:07:30.948743 [debug] [Thread-1 (]: On model.build_fda.obv_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.obv_stock_summary"} */
create or replace transient table dev.analytics.obv_stock_summary
         as
        (WITH ordered_data AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM dev.raw_data.stock_data -- Referencing the raw data table in the dev database
    WHERE symbol IN ('AAPL', 'NVDA')  -- Include both AAPL and NVDA symbols
),

obv_calculation AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        CASE
            WHEN close > LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN volume
            WHEN close < LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN -volume
            ELSE 0
        END AS volume_change
    FROM ordered_data
),

cumulative_obv AS (
    SELECT
        date,
        symbol,
        SUM(volume_change) OVER (PARTITION BY symbol ORDER BY date) AS obv
    FROM obv_calculation
)

SELECT
    date,
    symbol,
    obv
FROM cumulative_obv
ORDER BY symbol, date
        );
[0m17:07:30.949090 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:07:32.102581 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.153 seconds
[0m17:07:32.107259 [debug] [Thread-1 (]: On model.build_fda.obv_stock_summary: Close
[0m17:07:32.239108 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6b9a9561-24d0-4908-ad79-260048552c3e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x155156210>]}
[0m17:07:32.240272 [info ] [Thread-1 (]: 3 of 3 OK created sql table model analytics.obv_stock_summary .................. [[32mSUCCESS 1[0m in 1.30s]
[0m17:07:32.241018 [debug] [Thread-1 (]: Finished running node model.build_fda.obv_stock_summary
[0m17:07:32.241528 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data
[0m17:07:32.242124 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.obv_stock_summary, now model.build_fda.stock_data)
[0m17:07:32.242617 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data
[0m17:07:32.246322 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data"
[0m17:07:32.247635 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data
[0m17:07:32.248020 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data_forecast
[0m17:07:32.248425 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.stock_data, now model.build_fda.stock_data_forecast)
[0m17:07:32.248754 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data_forecast
[0m17:07:32.251260 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data_forecast"
[0m17:07:32.252219 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data_forecast
[0m17:07:32.253419 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:07:32.253666 [debug] [MainThread]: Connection 'model.build_fda.stock_data_forecast' was properly closed.
[0m17:07:32.253977 [info ] [MainThread]: 
[0m17:07:32.254248 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 4.71 seconds (4.71s).
[0m17:07:32.254915 [debug] [MainThread]: Command end result
[0m17:07:32.276022 [info ] [MainThread]: 
[0m17:07:32.276314 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m17:07:32.276500 [info ] [MainThread]: 
[0m17:07:32.276724 [error] [MainThread]:   Database Error in model fsi_stock_summary (models/output/fsi_stock_summary.sql)
  001790 (42601): SQL compilation error:
  inconsistent data type for result columns for set operator input branches, expected FLOAT, got TIMESTAMP_NTZ(9)
  compiled code at target/run/build_fda/models/output/fsi_stock_summary.sql
[0m17:07:32.276971 [info ] [MainThread]: 
[0m17:07:32.277227 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
[0m17:07:32.279599 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 5.8269625, "process_user_time": 2.526228, "process_kernel_time": 1.157761, "process_mem_max_rss": "203653120", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m17:07:32.279980 [debug] [MainThread]: Command `dbt run` failed at 17:07:32.279919 after 5.83 seconds
[0m17:07:32.280228 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1010cc150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1549cf690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x101116310>]}
[0m17:07:32.280454 [debug] [MainThread]: Flushing usage events
[0m17:11:04.043145 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10558d710>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1055dbbd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1055dbc10>]}


============================== 17:11:04.045193 | d3ab8eac-0178-4c8d-b604-1c84844b78bb ==============================
[0m17:11:04.045193 [info ] [MainThread]: Running with dbt=1.8.7
[0m17:11:04.045521 [debug] [MainThread]: running dbt with arguments {'use_colors': 'True', 'partial_parse': 'True', 'introspect': 'True', 'target_path': 'None', 'fail_fast': 'False', 'warn_error': 'None', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'quiet': 'False', 'log_format': 'default', 'indirect_selection': 'eager', 'printer_width': '80', 'cache_selected_only': 'False', 'use_experimental_parser': 'False', 'profiles_dir': '/Users/shatayu/.dbt', 'log_cache_events': 'False', 'debug': 'False', 'version_check': 'True', 'send_anonymous_usage_stats': 'True', 'empty': 'False', 'static_parser': 'True', 'write_json': 'True', 'invocation_command': 'dbt run', 'log_path': '/Users/shatayu/Downloads/DATA226_Lab2Prep/build_fda/logs'}
[0m17:11:05.010416 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd3ab8eac-0178-4c8d-b604-1c84844b78bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a05c150>]}
[0m17:11:05.031016 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd3ab8eac-0178-4c8d-b604-1c84844b78bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105045710>]}
[0m17:11:05.031585 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m17:11:05.043541 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m17:11:05.111916 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m17:11:05.112256 [debug] [MainThread]: Partial parsing: updated file: build_fda://models/output/fsi_stock_summary.sql
[0m17:11:05.212311 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd3ab8eac-0178-4c8d-b604-1c84844b78bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e35b0d0>]}
[0m17:11:05.254912 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd3ab8eac-0178-4c8d-b604-1c84844b78bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e82fa90>]}
[0m17:11:05.255239 [info ] [MainThread]: Found 5 models, 5 sources, 459 macros
[0m17:11:05.255404 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd3ab8eac-0178-4c8d-b604-1c84844b78bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e5cd6d0>]}
[0m17:11:05.256271 [info ] [MainThread]: 
[0m17:11:05.256562 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m17:11:05.258516 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m17:11:05.264347 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m17:11:05.264507 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m17:11:05.264627 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:11:06.021622 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.756 seconds
[0m17:11:06.024405 [debug] [ThreadPool]: On list_dev: Close
[0m17:11:06.158079 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_analytics)
[0m17:11:06.170023 [debug] [ThreadPool]: Using snowflake connection "list_dev_analytics"
[0m17:11:06.170406 [debug] [ThreadPool]: On list_dev_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev_analytics"} */
show objects in dev.analytics limit 10000
[0m17:11:06.170673 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:11:06.691194 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.520 seconds
[0m17:11:06.695623 [debug] [ThreadPool]: On list_dev_analytics: Close
[0m17:11:06.823819 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd3ab8eac-0178-4c8d-b604-1c84844b78bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1024c72d0>]}
[0m17:11:06.825064 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m17:11:06.825531 [info ] [MainThread]: 
[0m17:11:06.829548 [debug] [Thread-1 (]: Began running node model.build_fda.dmi_stock_summary
[0m17:11:06.830181 [info ] [Thread-1 (]: 1 of 3 START sql table model analytics.dmi_stock_summary ....................... [RUN]
[0m17:11:06.830681 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_analytics, now model.build_fda.dmi_stock_summary)
[0m17:11:06.831048 [debug] [Thread-1 (]: Began compiling node model.build_fda.dmi_stock_summary
[0m17:11:06.839546 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.dmi_stock_summary"
[0m17:11:06.840614 [debug] [Thread-1 (]: Began executing node model.build_fda.dmi_stock_summary
[0m17:11:06.860542 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.dmi_stock_summary"
[0m17:11:06.862294 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.dmi_stock_summary"
[0m17:11:06.862668 [debug] [Thread-1 (]: On model.build_fda.dmi_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.dmi_stock_summary"} */
create or replace transient table dev.analytics.dmi_stock_summary
         as
        (WITH stock_prices AS (
    SELECT
        date,
        close,
        symbol
    FROM dev.raw_data.stock_data
    WHERE symbol IN ('AAPL', 'NVDA')  -- Including both Apple and Nvidia
),

-- Calculate the 20-day SMA and 20-day standard deviation for both symbols
sma_stddev AS (
    SELECT
        date,
        symbol,
        close,
        AVG(close) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS middle_band,
        STDDEV(close) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS stddev_20
    FROM stock_prices
),

-- Calculate the upper and lower bands
bands AS (
    SELECT
        date,
        symbol,
        close,
        middle_band,
        (middle_band + (2 * stddev_20)) AS upper_band,
        (middle_band - (2 * stddev_20)) AS lower_band
    FROM sma_stddev
),

-- Calculate +DI and -DI based on daily price movements for each stock symbol
directional_indicators AS (
    SELECT
        date,
        symbol,
        close,
        middle_band,
        upper_band,
        lower_band,
        LAG(close, 1) OVER (PARTITION BY symbol ORDER BY date) AS prev_close,
        -- +DI: Calculate positive movement
        CASE WHEN close > prev_close THEN close - prev_close ELSE 0 END AS plus_di,
        -- -DI: Calculate negative movement
        CASE WHEN close < prev_close THEN prev_close - close ELSE 0 END AS minus_di
    FROM bands
)

SELECT
    date,
    symbol,  -- To differentiate between Apple and Nvidia
    close,
    middle_band,
    upper_band,
    lower_band,
    -- Summing up DI over the 20-day period for smoother trend analysis
    SUM(plus_di) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS plus_di_twenty,
    SUM(minus_di) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS minus_di_twenty
FROM directional_indicators
ORDER BY symbol, date
        );
[0m17:11:06.862975 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:11:08.573621 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.710 seconds
[0m17:11:08.593525 [debug] [Thread-1 (]: On model.build_fda.dmi_stock_summary: Close
[0m17:11:08.703530 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd3ab8eac-0178-4c8d-b604-1c84844b78bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e92f190>]}
[0m17:11:08.704490 [info ] [Thread-1 (]: 1 of 3 OK created sql table model analytics.dmi_stock_summary .................. [[32mSUCCESS 1[0m in 1.87s]
[0m17:11:08.705065 [debug] [Thread-1 (]: Finished running node model.build_fda.dmi_stock_summary
[0m17:11:08.705474 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_stock_summary
[0m17:11:08.705988 [info ] [Thread-1 (]: 2 of 3 START sql table model analytics.fsi_stock_summary ....................... [RUN]
[0m17:11:08.706479 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.dmi_stock_summary, now model.build_fda.fsi_stock_summary)
[0m17:11:08.706816 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_stock_summary
[0m17:11:08.709866 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_stock_summary"
[0m17:11:08.711902 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_stock_summary
[0m17:11:08.714289 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_stock_summary"
[0m17:11:08.715856 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_stock_summary"
[0m17:11:08.716219 [debug] [Thread-1 (]: On model.build_fda.fsi_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_stock_summary"} */
create or replace transient table dev.analytics.fsi_stock_summary
         as
        (WITH interval_widths AS (
    SELECT
        ts as date,
        forecast,
        lower_bound,
        upper_bound,
        REPLACE(series, '"', '') AS symbol,
        (upper_bound - lower_bound) AS interval_width,
        'FORECASTED' as record_type
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
),

statistics AS (
    SELECT
        symbol,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM interval_widths
    GROUP BY symbol
),

recent_data AS (
    SELECT
        date,
        close,
        symbol,
        'HISTORICAL' as record_type
    FROM dev.raw_data.stock_data
    WHERE date >= CURRENT_DATE() - INTERVAL '21 DAY'  -- Fetch data from the last 21 days (3 weeks)
      AND symbol IN ('AAPL', 'NVDA')                    -- Filter for specific symbols
)

SELECT
    a.record_type,
    a.symbol,
    a.date,
    a.forecast::FLOAT as close,
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM interval_widths a
JOIN statistics s
    ON a.symbol = s.symbol

UNION ALL

SELECT
    r.symbol,
    r.date,
    r.close,
    NULL AS avg_interval_width,  -- NULL for non-forecasted data
    NULL AS stddev_interval_width,  -- NULL for non-forecasted data
    NULL AS fsi,  -- NULL for non-forecasted data
    r.record_type
FROM recent_data r
ORDER BY date, symbol
        );
[0m17:11:08.716556 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:11:09.259273 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b85547-0004-26b9-0000-000255f39eb1
[0m17:11:09.260015 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 001790 (42601): SQL compilation error:
inconsistent data type for result columns for set operator input branches, expected FLOAT, got TIMESTAMP_NTZ(9)
[0m17:11:09.260545 [debug] [Thread-1 (]: On model.build_fda.fsi_stock_summary: Close
[0m17:11:09.404201 [debug] [Thread-1 (]: Database Error in model fsi_stock_summary (models/output/fsi_stock_summary.sql)
  001790 (42601): SQL compilation error:
  inconsistent data type for result columns for set operator input branches, expected FLOAT, got TIMESTAMP_NTZ(9)
  compiled code at target/run/build_fda/models/output/fsi_stock_summary.sql
[0m17:11:09.405164 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd3ab8eac-0178-4c8d-b604-1c84844b78bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e706550>]}
[0m17:11:09.406085 [error] [Thread-1 (]: 2 of 3 ERROR creating sql table model analytics.fsi_stock_summary .............. [[31mERROR[0m in 0.70s]
[0m17:11:09.406801 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_stock_summary
[0m17:11:09.407263 [debug] [Thread-1 (]: Began running node model.build_fda.obv_stock_summary
[0m17:11:09.407740 [info ] [Thread-1 (]: 3 of 3 START sql table model analytics.obv_stock_summary ....................... [RUN]
[0m17:11:09.408465 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_stock_summary, now model.build_fda.obv_stock_summary)
[0m17:11:09.408918 [debug] [Thread-1 (]: Began compiling node model.build_fda.obv_stock_summary
[0m17:11:09.412367 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.obv_stock_summary"
[0m17:11:09.413423 [debug] [Thread-1 (]: Began executing node model.build_fda.obv_stock_summary
[0m17:11:09.416245 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.obv_stock_summary"
[0m17:11:09.417689 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.obv_stock_summary"
[0m17:11:09.419473 [debug] [Thread-1 (]: On model.build_fda.obv_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.obv_stock_summary"} */
create or replace transient table dev.analytics.obv_stock_summary
         as
        (WITH ordered_data AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM dev.raw_data.stock_data -- Referencing the raw data table in the dev database
    WHERE symbol IN ('AAPL', 'NVDA')  -- Include both AAPL and NVDA symbols
),

obv_calculation AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        CASE
            WHEN close > LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN volume
            WHEN close < LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN -volume
            ELSE 0
        END AS volume_change
    FROM ordered_data
),

cumulative_obv AS (
    SELECT
        date,
        symbol,
        SUM(volume_change) OVER (PARTITION BY symbol ORDER BY date) AS obv
    FROM obv_calculation
)

SELECT
    date,
    symbol,
    obv
FROM cumulative_obv
ORDER BY symbol, date
        );
[0m17:11:09.419816 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:11:10.929782 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.509 seconds
[0m17:11:10.934557 [debug] [Thread-1 (]: On model.build_fda.obv_stock_summary: Close
[0m17:11:11.096520 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd3ab8eac-0178-4c8d-b604-1c84844b78bb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e92ca10>]}
[0m17:11:11.097497 [info ] [Thread-1 (]: 3 of 3 OK created sql table model analytics.obv_stock_summary .................. [[32mSUCCESS 1[0m in 1.69s]
[0m17:11:11.098273 [debug] [Thread-1 (]: Finished running node model.build_fda.obv_stock_summary
[0m17:11:11.098823 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data
[0m17:11:11.099454 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.obv_stock_summary, now model.build_fda.stock_data)
[0m17:11:11.099990 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data
[0m17:11:11.104142 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data"
[0m17:11:11.106659 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data
[0m17:11:11.107061 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data_forecast
[0m17:11:11.107420 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.stock_data, now model.build_fda.stock_data_forecast)
[0m17:11:11.107749 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data_forecast
[0m17:11:11.110217 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data_forecast"
[0m17:11:11.111200 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data_forecast
[0m17:11:11.112455 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:11:11.112736 [debug] [MainThread]: Connection 'model.build_fda.stock_data_forecast' was properly closed.
[0m17:11:11.113080 [info ] [MainThread]: 
[0m17:11:11.113373 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 5.86 seconds (5.86s).
[0m17:11:11.114125 [debug] [MainThread]: Command end result
[0m17:11:11.135733 [info ] [MainThread]: 
[0m17:11:11.136057 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m17:11:11.136241 [info ] [MainThread]: 
[0m17:11:11.136469 [error] [MainThread]:   Database Error in model fsi_stock_summary (models/output/fsi_stock_summary.sql)
  001790 (42601): SQL compilation error:
  inconsistent data type for result columns for set operator input branches, expected FLOAT, got TIMESTAMP_NTZ(9)
  compiled code at target/run/build_fda/models/output/fsi_stock_summary.sql
[0m17:11:11.136651 [info ] [MainThread]: 
[0m17:11:11.136839 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
[0m17:11:11.139075 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 7.1452045, "process_user_time": 2.411433, "process_kernel_time": 1.408277, "process_mem_max_rss": "202293248", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m17:11:11.139400 [debug] [MainThread]: Command `dbt run` failed at 17:11:11.139347 after 7.15 seconds
[0m17:11:11.139636 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1011c4150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e443750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11e431e10>]}
[0m17:11:11.139828 [debug] [MainThread]: Flushing usage events
[0m17:12:08.277401 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112685d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11245bcd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1126dbc10>]}


============================== 17:12:08.279011 | da43c212-d14c-4c67-b0f1-e46405a6f8e2 ==============================
[0m17:12:08.279011 [info ] [MainThread]: Running with dbt=1.8.7
[0m17:12:08.279331 [debug] [MainThread]: running dbt with arguments {'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'quiet': 'False', 'cache_selected_only': 'False', 'send_anonymous_usage_stats': 'True', 'target_path': 'None', 'indirect_selection': 'eager', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'partial_parse': 'True', 'profiles_dir': '/Users/shatayu/.dbt', 'printer_width': '80', 'use_experimental_parser': 'False', 'static_parser': 'True', 'use_colors': 'True', 'no_print': 'None', 'log_cache_events': 'False', 'version_check': 'True', 'log_path': '/Users/shatayu/Downloads/DATA226_Lab2Prep/build_fda/logs', 'empty': 'False', 'write_json': 'True', 'invocation_command': 'dbt run'}
[0m17:12:08.906620 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'da43c212-d14c-4c67-b0f1-e46405a6f8e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x147094c10>]}
[0m17:12:08.926740 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'da43c212-d14c-4c67-b0f1-e46405a6f8e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112049350>]}
[0m17:12:08.927361 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m17:12:08.940193 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m17:12:09.006883 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m17:12:09.007236 [debug] [MainThread]: Partial parsing: updated file: build_fda://models/output/fsi_stock_summary.sql
[0m17:12:09.107326 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'da43c212-d14c-4c67-b0f1-e46405a6f8e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1474cd850>]}
[0m17:12:09.146474 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'da43c212-d14c-4c67-b0f1-e46405a6f8e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14775f9d0>]}
[0m17:12:09.146764 [info ] [MainThread]: Found 5 models, 5 sources, 459 macros
[0m17:12:09.146927 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'da43c212-d14c-4c67-b0f1-e46405a6f8e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x147655090>]}
[0m17:12:09.147798 [info ] [MainThread]: 
[0m17:12:09.148080 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m17:12:09.150033 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m17:12:09.155857 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m17:12:09.156024 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m17:12:09.156150 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:12:09.730860 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.574 seconds
[0m17:12:09.735774 [debug] [ThreadPool]: On list_dev: Close
[0m17:12:09.857767 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_analytics)
[0m17:12:09.870094 [debug] [ThreadPool]: Using snowflake connection "list_dev_analytics"
[0m17:12:09.870486 [debug] [ThreadPool]: On list_dev_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev_analytics"} */
show objects in dev.analytics limit 10000
[0m17:12:09.870759 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:12:10.430827 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.560 seconds
[0m17:12:10.436221 [debug] [ThreadPool]: On list_dev_analytics: Close
[0m17:12:10.553679 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'da43c212-d14c-4c67-b0f1-e46405a6f8e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x147586ad0>]}
[0m17:12:10.554563 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m17:12:10.555011 [info ] [MainThread]: 
[0m17:12:10.559203 [debug] [Thread-1 (]: Began running node model.build_fda.dmi_stock_summary
[0m17:12:10.559872 [info ] [Thread-1 (]: 1 of 3 START sql table model analytics.dmi_stock_summary ....................... [RUN]
[0m17:12:10.560388 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_analytics, now model.build_fda.dmi_stock_summary)
[0m17:12:10.560753 [debug] [Thread-1 (]: Began compiling node model.build_fda.dmi_stock_summary
[0m17:12:10.569156 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.dmi_stock_summary"
[0m17:12:10.570033 [debug] [Thread-1 (]: Began executing node model.build_fda.dmi_stock_summary
[0m17:12:10.589854 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.dmi_stock_summary"
[0m17:12:10.591394 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.dmi_stock_summary"
[0m17:12:10.591735 [debug] [Thread-1 (]: On model.build_fda.dmi_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.dmi_stock_summary"} */
create or replace transient table dev.analytics.dmi_stock_summary
         as
        (WITH stock_prices AS (
    SELECT
        date,
        close,
        symbol
    FROM dev.raw_data.stock_data
    WHERE symbol IN ('AAPL', 'NVDA')  -- Including both Apple and Nvidia
),

-- Calculate the 20-day SMA and 20-day standard deviation for both symbols
sma_stddev AS (
    SELECT
        date,
        symbol,
        close,
        AVG(close) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS middle_band,
        STDDEV(close) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS stddev_20
    FROM stock_prices
),

-- Calculate the upper and lower bands
bands AS (
    SELECT
        date,
        symbol,
        close,
        middle_band,
        (middle_band + (2 * stddev_20)) AS upper_band,
        (middle_band - (2 * stddev_20)) AS lower_band
    FROM sma_stddev
),

-- Calculate +DI and -DI based on daily price movements for each stock symbol
directional_indicators AS (
    SELECT
        date,
        symbol,
        close,
        middle_band,
        upper_band,
        lower_band,
        LAG(close, 1) OVER (PARTITION BY symbol ORDER BY date) AS prev_close,
        -- +DI: Calculate positive movement
        CASE WHEN close > prev_close THEN close - prev_close ELSE 0 END AS plus_di,
        -- -DI: Calculate negative movement
        CASE WHEN close < prev_close THEN prev_close - close ELSE 0 END AS minus_di
    FROM bands
)

SELECT
    date,
    symbol,  -- To differentiate between Apple and Nvidia
    close,
    middle_band,
    upper_band,
    lower_band,
    -- Summing up DI over the 20-day period for smoother trend analysis
    SUM(plus_di) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS plus_di_twenty,
    SUM(minus_di) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS minus_di_twenty
FROM directional_indicators
ORDER BY symbol, date
        );
[0m17:12:10.592031 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:12:11.960625 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.368 seconds
[0m17:12:11.986865 [debug] [Thread-1 (]: On model.build_fda.dmi_stock_summary: Close
[0m17:12:12.105341 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'da43c212-d14c-4c67-b0f1-e46405a6f8e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14768eb50>]}
[0m17:12:12.105968 [info ] [Thread-1 (]: 1 of 3 OK created sql table model analytics.dmi_stock_summary .................. [[32mSUCCESS 1[0m in 1.54s]
[0m17:12:12.106281 [debug] [Thread-1 (]: Finished running node model.build_fda.dmi_stock_summary
[0m17:12:12.106498 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_stock_summary
[0m17:12:12.106892 [info ] [Thread-1 (]: 2 of 3 START sql table model analytics.fsi_stock_summary ....................... [RUN]
[0m17:12:12.107228 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.dmi_stock_summary, now model.build_fda.fsi_stock_summary)
[0m17:12:12.107393 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_stock_summary
[0m17:12:12.109110 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_stock_summary"
[0m17:12:12.109532 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_stock_summary
[0m17:12:12.110934 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_stock_summary"
[0m17:12:12.111883 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_stock_summary"
[0m17:12:12.112095 [debug] [Thread-1 (]: On model.build_fda.fsi_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_stock_summary"} */
create or replace transient table dev.analytics.fsi_stock_summary
         as
        (WITH interval_widths AS (
    SELECT
        ts as date,
        forecast,
        lower_bound,
        upper_bound,
        REPLACE(series, '"', '') AS symbol,
        (upper_bound - lower_bound) AS interval_width,
        'FORECASTED' as record_type
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
),

statistics AS (
    SELECT
        symbol,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM interval_widths
    GROUP BY symbol
),

recent_data AS (
    SELECT
        date,
        close,
        symbol,
        'HISTORICAL' as record_type
    FROM dev.raw_data.stock_data
    WHERE date >= CURRENT_DATE() - INTERVAL '21 DAY'  -- Fetch data from the last 21 days (3 weeks)
      AND symbol IN ('AAPL', 'NVDA')                    -- Filter for specific symbols
)

SELECT
    a.record_type,
    a.symbol,
    a.date,
    a.forecast as close,
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM interval_widths a
JOIN statistics s
    ON a.symbol = s.symbol

UNION ALL

SELECT
    r.record_type
    r.symbol,
    r.date,
    r.close,
    NULL AS avg_interval_width,  -- NULL for non-forecasted data
    NULL AS stddev_interval_width,  -- NULL for non-forecasted data
    NULL AS fsi,  -- NULL for non-forecasted data
FROM recent_data r
ORDER BY date, symbol
        );
[0m17:12:12.112290 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:12:12.604111 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b85548-0004-2be6-0000-000255f3f3a9
[0m17:12:12.604752 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 52 at position 5 unexpected '.'.
syntax error line 60 at position 8 unexpected ')'.
[0m17:12:12.605220 [debug] [Thread-1 (]: On model.build_fda.fsi_stock_summary: Close
[0m17:12:12.727094 [debug] [Thread-1 (]: Database Error in model fsi_stock_summary (models/output/fsi_stock_summary.sql)
  001003 (42000): SQL compilation error:
  syntax error line 52 at position 5 unexpected '.'.
  syntax error line 60 at position 8 unexpected ')'.
  compiled code at target/run/build_fda/models/output/fsi_stock_summary.sql
[0m17:12:12.727672 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'da43c212-d14c-4c67-b0f1-e46405a6f8e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1580b4390>]}
[0m17:12:12.728281 [error] [Thread-1 (]: 2 of 3 ERROR creating sql table model analytics.fsi_stock_summary .............. [[31mERROR[0m in 0.62s]
[0m17:12:12.728751 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_stock_summary
[0m17:12:12.729100 [debug] [Thread-1 (]: Began running node model.build_fda.obv_stock_summary
[0m17:12:12.729596 [info ] [Thread-1 (]: 3 of 3 START sql table model analytics.obv_stock_summary ....................... [RUN]
[0m17:12:12.729981 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_stock_summary, now model.build_fda.obv_stock_summary)
[0m17:12:12.730226 [debug] [Thread-1 (]: Began compiling node model.build_fda.obv_stock_summary
[0m17:12:12.732812 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.obv_stock_summary"
[0m17:12:12.733491 [debug] [Thread-1 (]: Began executing node model.build_fda.obv_stock_summary
[0m17:12:12.735507 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.obv_stock_summary"
[0m17:12:12.736582 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.obv_stock_summary"
[0m17:12:12.737786 [debug] [Thread-1 (]: On model.build_fda.obv_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.obv_stock_summary"} */
create or replace transient table dev.analytics.obv_stock_summary
         as
        (WITH ordered_data AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM dev.raw_data.stock_data -- Referencing the raw data table in the dev database
    WHERE symbol IN ('AAPL', 'NVDA')  -- Include both AAPL and NVDA symbols
),

obv_calculation AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        CASE
            WHEN close > LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN volume
            WHEN close < LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN -volume
            ELSE 0
        END AS volume_change
    FROM ordered_data
),

cumulative_obv AS (
    SELECT
        date,
        symbol,
        SUM(volume_change) OVER (PARTITION BY symbol ORDER BY date) AS obv
    FROM obv_calculation
)

SELECT
    date,
    symbol,
    obv
FROM cumulative_obv
ORDER BY symbol, date
        );
[0m17:12:12.738053 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:12:14.317979 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.579 seconds
[0m17:12:14.321586 [debug] [Thread-1 (]: On model.build_fda.obv_stock_summary: Close
[0m17:12:14.446931 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'da43c212-d14c-4c67-b0f1-e46405a6f8e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15817e310>]}
[0m17:12:14.448552 [info ] [Thread-1 (]: 3 of 3 OK created sql table model analytics.obv_stock_summary .................. [[32mSUCCESS 1[0m in 1.72s]
[0m17:12:14.449461 [debug] [Thread-1 (]: Finished running node model.build_fda.obv_stock_summary
[0m17:12:14.450048 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data
[0m17:12:14.450758 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.obv_stock_summary, now model.build_fda.stock_data)
[0m17:12:14.451314 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data
[0m17:12:14.455544 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data"
[0m17:12:14.456880 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data
[0m17:12:14.457311 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data_forecast
[0m17:12:14.457698 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.stock_data, now model.build_fda.stock_data_forecast)
[0m17:12:14.458030 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data_forecast
[0m17:12:14.460749 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data_forecast"
[0m17:12:14.461603 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data_forecast
[0m17:12:14.462806 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:12:14.463063 [debug] [MainThread]: Connection 'model.build_fda.stock_data_forecast' was properly closed.
[0m17:12:14.463388 [info ] [MainThread]: 
[0m17:12:14.463673 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 5.32 seconds (5.32s).
[0m17:12:14.464406 [debug] [MainThread]: Command end result
[0m17:12:14.485547 [info ] [MainThread]: 
[0m17:12:14.485911 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m17:12:14.486172 [info ] [MainThread]: 
[0m17:12:14.486431 [error] [MainThread]:   Database Error in model fsi_stock_summary (models/output/fsi_stock_summary.sql)
  001003 (42000): SQL compilation error:
  syntax error line 52 at position 5 unexpected '.'.
  syntax error line 60 at position 8 unexpected ')'.
  compiled code at target/run/build_fda/models/output/fsi_stock_summary.sql
[0m17:12:14.486632 [info ] [MainThread]: 
[0m17:12:14.486833 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
[0m17:12:14.489284 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 6.259068, "process_user_time": 2.086991, "process_kernel_time": 1.638796, "process_mem_max_rss": "204636160", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m17:12:14.489608 [debug] [MainThread]: Command `dbt run` failed at 17:12:14.489558 after 6.26 seconds
[0m17:12:14.489822 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1049ac150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1470d0590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1470d06d0>]}
[0m17:12:14.490020 [debug] [MainThread]: Flushing usage events
[0m17:13:10.862634 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10710e990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107163bd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1071337d0>]}


============================== 17:13:10.864447 | ded901ce-a089-4585-bedd-225598216210 ==============================
[0m17:13:10.864447 [info ] [MainThread]: Running with dbt=1.8.7
[0m17:13:10.864801 [debug] [MainThread]: running dbt with arguments {'target_path': 'None', 'introspect': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'log_cache_events': 'False', 'invocation_command': 'dbt run', 'write_json': 'True', 'use_experimental_parser': 'False', 'quiet': 'False', 'log_path': '/Users/shatayu/Downloads/DATA226_Lab2Prep/build_fda/logs', 'log_format': 'default', 'profiles_dir': '/Users/shatayu/.dbt', 'partial_parse': 'True', 'cache_selected_only': 'False', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'printer_width': '80', 'static_parser': 'True', 'no_print': 'None'}
[0m17:13:11.611301 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ded901ce-a089-4585-bedd-225598216210', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107181010>]}
[0m17:13:11.631309 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ded901ce-a089-4585-bedd-225598216210', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106bc9910>]}
[0m17:13:11.631870 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m17:13:11.644455 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m17:13:11.711339 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m17:13:11.711704 [debug] [MainThread]: Partial parsing: updated file: build_fda://models/output/fsi_stock_summary.sql
[0m17:13:11.813689 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ded901ce-a089-4585-bedd-225598216210', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x131dab490>]}
[0m17:13:11.854630 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ded901ce-a089-4585-bedd-225598216210', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13589cf50>]}
[0m17:13:11.854925 [info ] [MainThread]: Found 5 models, 5 sources, 459 macros
[0m17:13:11.855098 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ded901ce-a089-4585-bedd-225598216210', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x131b99b90>]}
[0m17:13:11.855953 [info ] [MainThread]: 
[0m17:13:11.856259 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m17:13:11.858215 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m17:13:11.864111 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m17:13:11.864275 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m17:13:11.864404 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:13:12.631054 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.766 seconds
[0m17:13:12.634837 [debug] [ThreadPool]: On list_dev: Close
[0m17:13:12.754076 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_analytics)
[0m17:13:12.765893 [debug] [ThreadPool]: Using snowflake connection "list_dev_analytics"
[0m17:13:12.766336 [debug] [ThreadPool]: On list_dev_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev_analytics"} */
show objects in dev.analytics limit 10000
[0m17:13:12.766612 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:13:13.407030 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.640 seconds
[0m17:13:13.412868 [debug] [ThreadPool]: On list_dev_analytics: Close
[0m17:13:13.532696 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ded901ce-a089-4585-bedd-225598216210', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x135806c90>]}
[0m17:13:13.533498 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m17:13:13.533933 [info ] [MainThread]: 
[0m17:13:13.538227 [debug] [Thread-1 (]: Began running node model.build_fda.dmi_stock_summary
[0m17:13:13.538846 [info ] [Thread-1 (]: 1 of 3 START sql table model analytics.dmi_stock_summary ....................... [RUN]
[0m17:13:13.539329 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_analytics, now model.build_fda.dmi_stock_summary)
[0m17:13:13.539690 [debug] [Thread-1 (]: Began compiling node model.build_fda.dmi_stock_summary
[0m17:13:13.547988 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.dmi_stock_summary"
[0m17:13:13.548852 [debug] [Thread-1 (]: Began executing node model.build_fda.dmi_stock_summary
[0m17:13:13.568683 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.dmi_stock_summary"
[0m17:13:13.570257 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.dmi_stock_summary"
[0m17:13:13.570631 [debug] [Thread-1 (]: On model.build_fda.dmi_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.dmi_stock_summary"} */
create or replace transient table dev.analytics.dmi_stock_summary
         as
        (WITH stock_prices AS (
    SELECT
        date,
        close,
        symbol
    FROM dev.raw_data.stock_data
    WHERE symbol IN ('AAPL', 'NVDA')  -- Including both Apple and Nvidia
),

-- Calculate the 20-day SMA and 20-day standard deviation for both symbols
sma_stddev AS (
    SELECT
        date,
        symbol,
        close,
        AVG(close) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS middle_band,
        STDDEV(close) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS stddev_20
    FROM stock_prices
),

-- Calculate the upper and lower bands
bands AS (
    SELECT
        date,
        symbol,
        close,
        middle_band,
        (middle_band + (2 * stddev_20)) AS upper_band,
        (middle_band - (2 * stddev_20)) AS lower_band
    FROM sma_stddev
),

-- Calculate +DI and -DI based on daily price movements for each stock symbol
directional_indicators AS (
    SELECT
        date,
        symbol,
        close,
        middle_band,
        upper_band,
        lower_band,
        LAG(close, 1) OVER (PARTITION BY symbol ORDER BY date) AS prev_close,
        -- +DI: Calculate positive movement
        CASE WHEN close > prev_close THEN close - prev_close ELSE 0 END AS plus_di,
        -- -DI: Calculate negative movement
        CASE WHEN close < prev_close THEN prev_close - close ELSE 0 END AS minus_di
    FROM bands
)

SELECT
    date,
    symbol,  -- To differentiate between Apple and Nvidia
    close,
    middle_band,
    upper_band,
    lower_band,
    -- Summing up DI over the 20-day period for smoother trend analysis
    SUM(plus_di) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS plus_di_twenty,
    SUM(minus_di) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS minus_di_twenty
FROM directional_indicators
ORDER BY symbol, date
        );
[0m17:13:13.570934 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:13:15.055294 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.484 seconds
[0m17:13:15.079676 [debug] [Thread-1 (]: On model.build_fda.dmi_stock_summary: Close
[0m17:13:15.212903 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ded901ce-a089-4585-bedd-225598216210', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x131b22290>]}
[0m17:13:15.214013 [info ] [Thread-1 (]: 1 of 3 OK created sql table model analytics.dmi_stock_summary .................. [[32mSUCCESS 1[0m in 1.67s]
[0m17:13:15.214801 [debug] [Thread-1 (]: Finished running node model.build_fda.dmi_stock_summary
[0m17:13:15.215295 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_stock_summary
[0m17:13:15.215770 [info ] [Thread-1 (]: 2 of 3 START sql table model analytics.fsi_stock_summary ....................... [RUN]
[0m17:13:15.216234 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.dmi_stock_summary, now model.build_fda.fsi_stock_summary)
[0m17:13:15.216743 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_stock_summary
[0m17:13:15.220644 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_stock_summary"
[0m17:13:15.221797 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_stock_summary
[0m17:13:15.224629 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_stock_summary"
[0m17:13:15.226560 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_stock_summary"
[0m17:13:15.226998 [debug] [Thread-1 (]: On model.build_fda.fsi_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_stock_summary"} */
create or replace transient table dev.analytics.fsi_stock_summary
         as
        (WITH interval_widths AS (
    SELECT
        ts as date,
        forecast,
        lower_bound,
        upper_bound,
        REPLACE(series, '"', '') AS symbol,
        (upper_bound - lower_bound) AS interval_width,
        'FORECASTED' as record_type
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
),

statistics AS (
    SELECT
        symbol,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM interval_widths
    GROUP BY symbol
),

recent_data AS (
    SELECT
        date,
        close,
        symbol,
        'HISTORICAL' as record_type
    FROM dev.raw_data.stock_data
    WHERE date >= CURRENT_DATE() - INTERVAL '21 DAY'  -- Fetch data from the last 21 days (3 weeks)
      AND symbol IN ('AAPL', 'NVDA')                    -- Filter for specific symbols
)

SELECT
    a.record_type,
    a.symbol,
    a.date,
    a.forecast as close,
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM interval_widths a
JOIN statistics s
    ON a.symbol = s.symbol

UNION ALL

SELECT
    r.record_type,
    r.symbol,
    r.date,
    r.close,
    NULL AS avg_interval_width,  -- NULL for non-forecasted data
    NULL AS stddev_interval_width,  -- NULL for non-forecasted data
    NULL AS fsi,  -- NULL for non-forecasted data
FROM recent_data r
ORDER BY date, symbol
        );
[0m17:13:15.227396 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:13:16.698227 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.471 seconds
[0m17:13:16.700882 [debug] [Thread-1 (]: On model.build_fda.fsi_stock_summary: Close
[0m17:13:16.817225 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ded901ce-a089-4585-bedd-225598216210', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105fea6d0>]}
[0m17:13:16.818340 [info ] [Thread-1 (]: 2 of 3 OK created sql table model analytics.fsi_stock_summary .................. [[32mSUCCESS 1[0m in 1.60s]
[0m17:13:16.818737 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_stock_summary
[0m17:13:16.818996 [debug] [Thread-1 (]: Began running node model.build_fda.obv_stock_summary
[0m17:13:16.819322 [info ] [Thread-1 (]: 3 of 3 START sql table model analytics.obv_stock_summary ....................... [RUN]
[0m17:13:16.819648 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_stock_summary, now model.build_fda.obv_stock_summary)
[0m17:13:16.819858 [debug] [Thread-1 (]: Began compiling node model.build_fda.obv_stock_summary
[0m17:13:16.821757 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.obv_stock_summary"
[0m17:13:16.822263 [debug] [Thread-1 (]: Began executing node model.build_fda.obv_stock_summary
[0m17:13:16.824520 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.obv_stock_summary"
[0m17:13:16.825443 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.obv_stock_summary"
[0m17:13:16.825741 [debug] [Thread-1 (]: On model.build_fda.obv_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.obv_stock_summary"} */
create or replace transient table dev.analytics.obv_stock_summary
         as
        (WITH ordered_data AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM dev.raw_data.stock_data -- Referencing the raw data table in the dev database
    WHERE symbol IN ('AAPL', 'NVDA')  -- Include both AAPL and NVDA symbols
),

obv_calculation AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        CASE
            WHEN close > LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN volume
            WHEN close < LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN -volume
            ELSE 0
        END AS volume_change
    FROM ordered_data
),

cumulative_obv AS (
    SELECT
        date,
        symbol,
        SUM(volume_change) OVER (PARTITION BY symbol ORDER BY date) AS obv
    FROM obv_calculation
)

SELECT
    date,
    symbol,
    obv
FROM cumulative_obv
ORDER BY symbol, date
        );
[0m17:13:16.826082 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:13:17.904699 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.078 seconds
[0m17:13:17.909834 [debug] [Thread-1 (]: On model.build_fda.obv_stock_summary: Close
[0m17:13:18.057884 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ded901ce-a089-4585-bedd-225598216210', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x135e7d890>]}
[0m17:13:18.059022 [info ] [Thread-1 (]: 3 of 3 OK created sql table model analytics.obv_stock_summary .................. [[32mSUCCESS 1[0m in 1.24s]
[0m17:13:18.059548 [debug] [Thread-1 (]: Finished running node model.build_fda.obv_stock_summary
[0m17:13:18.059911 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data
[0m17:13:18.060230 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.obv_stock_summary, now model.build_fda.stock_data)
[0m17:13:18.060485 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data
[0m17:13:18.063314 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data"
[0m17:13:18.064183 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data
[0m17:13:18.064476 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data_forecast
[0m17:13:18.064960 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.stock_data, now model.build_fda.stock_data_forecast)
[0m17:13:18.065337 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data_forecast
[0m17:13:18.067354 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data_forecast"
[0m17:13:18.068015 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data_forecast
[0m17:13:18.068875 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:13:18.069131 [debug] [MainThread]: Connection 'model.build_fda.stock_data_forecast' was properly closed.
[0m17:13:18.069363 [info ] [MainThread]: 
[0m17:13:18.069560 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 6.21 seconds (6.21s).
[0m17:13:18.070064 [debug] [MainThread]: Command end result
[0m17:13:18.089201 [info ] [MainThread]: 
[0m17:13:18.089549 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:13:18.089734 [info ] [MainThread]: 
[0m17:13:18.089925 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m17:13:18.092023 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 7.276003, "process_user_time": 2.213194, "process_kernel_time": 1.545483, "process_mem_max_rss": "203046912", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m17:13:18.092338 [debug] [MainThread]: Command `dbt run` succeeded at 17:13:18.092287 after 7.28 seconds
[0m17:13:18.092545 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102d4c150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102d96310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105215490>]}
[0m17:13:18.092746 [debug] [MainThread]: Flushing usage events
[0m20:48:13.733249 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107b37090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107b8bbd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107bacb10>]}


============================== 20:48:13.735380 | 203cdb76-21b6-452c-b3d0-eaf29752e108 ==============================
[0m20:48:13.735380 [info ] [MainThread]: Running with dbt=1.8.7
[0m20:48:13.735707 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'use_experimental_parser': 'False', 'version_check': 'True', 'warn_error': 'None', 'log_format': 'default', 'invocation_command': 'dbt run', 'log_path': '/Users/shatayu/Downloads/DATA226_Lab2Prep/build_fda/logs', 'no_print': 'None', 'cache_selected_only': 'False', 'target_path': 'None', 'use_colors': 'True', 'quiet': 'False', 'partial_parse': 'True', 'introspect': 'True', 'empty': 'False', 'debug': 'False', 'profiles_dir': '/Users/shatayu/.dbt', 'static_parser': 'True', 'indirect_selection': 'eager', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'fail_fast': 'False', 'log_cache_events': 'False', 'send_anonymous_usage_stats': 'True', 'write_json': 'True'}
[0m20:48:14.696554 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '203cdb76-21b6-452c-b3d0-eaf29752e108', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1208e0f50>]}
[0m20:48:14.716939 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '203cdb76-21b6-452c-b3d0-eaf29752e108', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1075f5750>]}
[0m20:48:14.717491 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m20:48:14.730977 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m20:48:14.806467 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m20:48:14.806859 [debug] [MainThread]: Partial parsing: updated file: build_fda://models/output/dmi_stock_summary.sql
[0m20:48:14.912136 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '203cdb76-21b6-452c-b3d0-eaf29752e108', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12073bb10>]}
[0m20:48:14.955172 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '203cdb76-21b6-452c-b3d0-eaf29752e108', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120c4b090>]}
[0m20:48:14.955512 [info ] [MainThread]: Found 5 models, 5 sources, 459 macros
[0m20:48:14.955689 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '203cdb76-21b6-452c-b3d0-eaf29752e108', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120c0db90>]}
[0m20:48:14.956572 [info ] [MainThread]: 
[0m20:48:14.956865 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m20:48:14.958886 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m20:48:14.965000 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m20:48:14.965178 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m20:48:14.965314 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:48:15.632938 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.666 seconds
[0m20:48:15.635727 [debug] [ThreadPool]: On list_dev: Close
[0m20:48:15.762784 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_analytics)
[0m20:48:15.772664 [debug] [ThreadPool]: Using snowflake connection "list_dev_analytics"
[0m20:48:15.773088 [debug] [ThreadPool]: On list_dev_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev_analytics"} */
show objects in dev.analytics limit 10000
[0m20:48:15.773340 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:48:16.312695 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.539 seconds
[0m20:48:16.316874 [debug] [ThreadPool]: On list_dev_analytics: Close
[0m20:48:16.432951 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '203cdb76-21b6-452c-b3d0-eaf29752e108', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1059a0dd0>]}
[0m20:48:16.433840 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m20:48:16.434277 [info ] [MainThread]: 
[0m20:48:16.438810 [debug] [Thread-1 (]: Began running node model.build_fda.dmi_stock_summary
[0m20:48:16.439475 [info ] [Thread-1 (]: 1 of 3 START sql table model analytics.dmi_stock_summary ....................... [RUN]
[0m20:48:16.439979 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_analytics, now model.build_fda.dmi_stock_summary)
[0m20:48:16.440353 [debug] [Thread-1 (]: Began compiling node model.build_fda.dmi_stock_summary
[0m20:48:16.448604 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.dmi_stock_summary"
[0m20:48:16.449866 [debug] [Thread-1 (]: Began executing node model.build_fda.dmi_stock_summary
[0m20:48:16.469490 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.dmi_stock_summary"
[0m20:48:16.470701 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.dmi_stock_summary"
[0m20:48:16.471044 [debug] [Thread-1 (]: On model.build_fda.dmi_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.dmi_stock_summary"} */
create or replace transient table dev.analytics.dmi_stock_summary
         as
        (WITH stock_prices AS (
    SELECT
        date,
        close,
        symbol
    FROM dev.raw_data.stock_data
    WHERE symbol IN ('AAPL', 'NVDA')  -- Including both Apple and Nvidia
),

-- Calculate the 20-day SMA and 20-day standard deviation for both symbols
sma_stddev AS (
    SELECT
        date,
        symbol,
        close,
        AVG(close) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS middle_band,
        STDDEV(close) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS stddev_20
    FROM stock_prices
),

-- Calculate the upper and lower bands
bands AS (
    SELECT
        date,
        symbol,
        close,
        middle_band,
        (middle_band + (2 * stddev_20)) AS upper_band,
        (middle_band - (2 * stddev_20)) AS lower_band
    FROM sma_stddev
)

SELECT
    date,
    symbol,  -- To differentiate between Apple and Nvidia
    close,
    middle_band,
    upper_band,
    lower_band
FROM bands
ORDER BY symbol, date
        );
[0m20:48:16.471306 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:48:18.106362 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.634 seconds
[0m20:48:18.130237 [debug] [Thread-1 (]: On model.build_fda.dmi_stock_summary: Close
[0m20:48:18.268853 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '203cdb76-21b6-452c-b3d0-eaf29752e108', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120db22d0>]}
[0m20:48:18.270028 [info ] [Thread-1 (]: 1 of 3 OK created sql table model analytics.dmi_stock_summary .................. [[32mSUCCESS 1[0m in 1.83s]
[0m20:48:18.270746 [debug] [Thread-1 (]: Finished running node model.build_fda.dmi_stock_summary
[0m20:48:18.271230 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_stock_summary
[0m20:48:18.271845 [info ] [Thread-1 (]: 2 of 3 START sql table model analytics.fsi_stock_summary ....................... [RUN]
[0m20:48:18.272433 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.dmi_stock_summary, now model.build_fda.fsi_stock_summary)
[0m20:48:18.272832 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_stock_summary
[0m20:48:18.276608 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_stock_summary"
[0m20:48:18.278027 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_stock_summary
[0m20:48:18.280833 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_stock_summary"
[0m20:48:18.282751 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_stock_summary"
[0m20:48:18.283166 [debug] [Thread-1 (]: On model.build_fda.fsi_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_stock_summary"} */
create or replace transient table dev.analytics.fsi_stock_summary
         as
        (WITH interval_widths AS (
    SELECT
        ts as date,
        forecast,
        lower_bound,
        upper_bound,
        REPLACE(series, '"', '') AS symbol,
        (upper_bound - lower_bound) AS interval_width,
        'FORECASTED' as record_type
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
),

statistics AS (
    SELECT
        symbol,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM interval_widths
    GROUP BY symbol
),

recent_data AS (
    SELECT
        date,
        close,
        symbol,
        'HISTORICAL' as record_type
    FROM dev.raw_data.stock_data
    WHERE date >= CURRENT_DATE() - INTERVAL '21 DAY'  -- Fetch data from the last 21 days (3 weeks)
      AND symbol IN ('AAPL', 'NVDA')                    -- Filter for specific symbols
)

SELECT
    a.record_type,
    a.symbol,
    a.date,
    a.forecast as close,
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM interval_widths a
JOIN statistics s
    ON a.symbol = s.symbol

UNION ALL

SELECT
    r.record_type,
    r.symbol,
    r.date,
    r.close,
    NULL AS avg_interval_width,  -- NULL for non-forecasted data
    NULL AS stddev_interval_width,  -- NULL for non-forecasted data
    NULL AS fsi,  -- NULL for non-forecasted data
FROM recent_data r
ORDER BY date, symbol
        );
[0m20:48:18.283566 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:48:19.795559 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.511 seconds
[0m20:48:19.799634 [debug] [Thread-1 (]: On model.build_fda.fsi_stock_summary: Close
[0m20:48:19.936405 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '203cdb76-21b6-452c-b3d0-eaf29752e108', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1209ea150>]}
[0m20:48:19.937620 [info ] [Thread-1 (]: 2 of 3 OK created sql table model analytics.fsi_stock_summary .................. [[32mSUCCESS 1[0m in 1.66s]
[0m20:48:19.938457 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_stock_summary
[0m20:48:19.939014 [debug] [Thread-1 (]: Began running node model.build_fda.obv_stock_summary
[0m20:48:19.939745 [info ] [Thread-1 (]: 3 of 3 START sql table model analytics.obv_stock_summary ....................... [RUN]
[0m20:48:19.940354 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_stock_summary, now model.build_fda.obv_stock_summary)
[0m20:48:19.940756 [debug] [Thread-1 (]: Began compiling node model.build_fda.obv_stock_summary
[0m20:48:19.944744 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.obv_stock_summary"
[0m20:48:19.945769 [debug] [Thread-1 (]: Began executing node model.build_fda.obv_stock_summary
[0m20:48:19.949793 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.obv_stock_summary"
[0m20:48:19.951409 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.obv_stock_summary"
[0m20:48:19.951789 [debug] [Thread-1 (]: On model.build_fda.obv_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.obv_stock_summary"} */
create or replace transient table dev.analytics.obv_stock_summary
         as
        (WITH ordered_data AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM dev.raw_data.stock_data -- Referencing the raw data table in the dev database
    WHERE symbol IN ('AAPL', 'NVDA')  -- Include both AAPL and NVDA symbols
),

obv_calculation AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        CASE
            WHEN close > LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN volume
            WHEN close < LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN -volume
            ELSE 0
        END AS volume_change
    FROM ordered_data
),

cumulative_obv AS (
    SELECT
        date,
        symbol,
        SUM(volume_change) OVER (PARTITION BY symbol ORDER BY date) AS obv
    FROM obv_calculation
)

SELECT
    date,
    symbol,
    obv
FROM cumulative_obv
ORDER BY symbol, date
        );
[0m20:48:19.952104 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:48:21.128905 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.177 seconds
[0m20:48:21.132475 [debug] [Thread-1 (]: On model.build_fda.obv_stock_summary: Close
[0m20:48:21.253507 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '203cdb76-21b6-452c-b3d0-eaf29752e108', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105c06510>]}
[0m20:48:21.254735 [info ] [Thread-1 (]: 3 of 3 OK created sql table model analytics.obv_stock_summary .................. [[32mSUCCESS 1[0m in 1.31s]
[0m20:48:21.255521 [debug] [Thread-1 (]: Finished running node model.build_fda.obv_stock_summary
[0m20:48:21.256095 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data
[0m20:48:21.256727 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.obv_stock_summary, now model.build_fda.stock_data)
[0m20:48:21.257241 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data
[0m20:48:21.261289 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data"
[0m20:48:21.262642 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data
[0m20:48:21.263084 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data_forecast
[0m20:48:21.263519 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.stock_data, now model.build_fda.stock_data_forecast)
[0m20:48:21.263869 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data_forecast
[0m20:48:21.266486 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data_forecast"
[0m20:48:21.267667 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data_forecast
[0m20:48:21.268899 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:48:21.269165 [debug] [MainThread]: Connection 'model.build_fda.stock_data_forecast' was properly closed.
[0m20:48:21.269491 [info ] [MainThread]: 
[0m20:48:21.269774 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 6.31 seconds (6.31s).
[0m20:48:21.270481 [debug] [MainThread]: Command end result
[0m20:48:21.291478 [info ] [MainThread]: 
[0m20:48:21.291783 [info ] [MainThread]: [32mCompleted successfully[0m
[0m20:48:21.291973 [info ] [MainThread]: 
[0m20:48:21.292169 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m20:48:21.294374 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 7.617518, "process_user_time": 2.513163, "process_kernel_time": 1.292232, "process_mem_max_rss": "203489280", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m20:48:21.294716 [debug] [MainThread]: Command `dbt run` succeeded at 20:48:21.294660 after 7.62 seconds
[0m20:48:21.294962 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103774150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10384d410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1037bf4d0>]}
[0m20:48:21.295184 [debug] [MainThread]: Flushing usage events
[0m20:48:51.358324 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d71550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106dbc750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106dbcc90>]}


============================== 20:48:51.360177 | 998dd413-b6ec-431b-96f9-b0e0ef2419b2 ==============================
[0m20:48:51.360177 [info ] [MainThread]: Running with dbt=1.8.7
[0m20:48:51.360509 [debug] [MainThread]: running dbt with arguments {'log_cache_events': 'False', 'write_json': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'partial_parse': 'True', 'static_parser': 'True', 'warn_error': 'None', 'use_colors': 'True', 'introspect': 'True', 'indirect_selection': 'eager', 'send_anonymous_usage_stats': 'True', 'no_print': 'None', 'quiet': 'False', 'fail_fast': 'False', 'target_path': 'None', 'invocation_command': 'dbt run', 'empty': 'False', 'log_path': '/Users/shatayu/Downloads/DATA226_Lab2Prep/build_fda/logs', 'version_check': 'True', 'printer_width': '80', 'debug': 'False', 'profiles_dir': '/Users/shatayu/.dbt', 'log_format': 'default'}
[0m20:48:52.119249 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '998dd413-b6ec-431b-96f9-b0e0ef2419b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ecca3d0>]}
[0m20:48:52.139551 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '998dd413-b6ec-431b-96f9-b0e0ef2419b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1068057d0>]}
[0m20:48:52.140345 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m20:48:52.152547 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m20:48:52.219794 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 1 files added, 0 files changed.
[0m20:48:52.220119 [debug] [MainThread]: Partial parsing: added file: build_fda://models/output/bollinger_stock_summary.sql
[0m20:48:52.220259 [debug] [MainThread]: Partial parsing: deleted file: build_fda://models/output/dmi_stock_summary.sql
[0m20:48:52.320914 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '998dd413-b6ec-431b-96f9-b0e0ef2419b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11efe0790>]}
[0m20:48:52.360658 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '998dd413-b6ec-431b-96f9-b0e0ef2419b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11fa5fb50>]}
[0m20:48:52.360954 [info ] [MainThread]: Found 5 models, 5 sources, 459 macros
[0m20:48:52.361114 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '998dd413-b6ec-431b-96f9-b0e0ef2419b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d849d0>]}
[0m20:48:52.361993 [info ] [MainThread]: 
[0m20:48:52.362297 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m20:48:52.364270 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m20:48:52.370156 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m20:48:52.370321 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m20:48:52.370451 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:48:52.821988 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.451 seconds
[0m20:48:52.826176 [debug] [ThreadPool]: On list_dev: Close
[0m20:48:52.949230 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_analytics)
[0m20:48:52.961673 [debug] [ThreadPool]: Using snowflake connection "list_dev_analytics"
[0m20:48:52.962058 [debug] [ThreadPool]: On list_dev_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev_analytics"} */
show objects in dev.analytics limit 10000
[0m20:48:52.962332 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:48:53.471586 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.509 seconds
[0m20:48:53.477491 [debug] [ThreadPool]: On list_dev_analytics: Close
[0m20:48:53.603338 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '998dd413-b6ec-431b-96f9-b0e0ef2419b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104bb0c90>]}
[0m20:48:53.604268 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m20:48:53.604578 [info ] [MainThread]: 
[0m20:48:53.609340 [debug] [Thread-1 (]: Began running node model.build_fda.bollinger_stock_summary
[0m20:48:53.609886 [info ] [Thread-1 (]: 1 of 3 START sql table model analytics.bollinger_stock_summary ................. [RUN]
[0m20:48:53.610273 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_analytics, now model.build_fda.bollinger_stock_summary)
[0m20:48:53.610552 [debug] [Thread-1 (]: Began compiling node model.build_fda.bollinger_stock_summary
[0m20:48:53.618168 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.bollinger_stock_summary"
[0m20:48:53.619068 [debug] [Thread-1 (]: Began executing node model.build_fda.bollinger_stock_summary
[0m20:48:53.639467 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.bollinger_stock_summary"
[0m20:48:53.640699 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.bollinger_stock_summary"
[0m20:48:53.641002 [debug] [Thread-1 (]: On model.build_fda.bollinger_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.bollinger_stock_summary"} */
create or replace transient table dev.analytics.bollinger_stock_summary
         as
        (WITH stock_prices AS (
    SELECT
        date,
        close,
        symbol
    FROM dev.raw_data.stock_data
    WHERE symbol IN ('AAPL', 'NVDA')  -- Including both Apple and Nvidia
),

-- Calculate the 20-day SMA and 20-day standard deviation for both symbols
sma_stddev AS (
    SELECT
        date,
        symbol,
        close,
        AVG(close) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS middle_band,
        STDDEV(close) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS stddev_20
    FROM stock_prices
),

-- Calculate the upper and lower bands
bands AS (
    SELECT
        date,
        symbol,
        close,
        middle_band,
        (middle_band + (2 * stddev_20)) AS upper_band,
        (middle_band - (2 * stddev_20)) AS lower_band
    FROM sma_stddev
)

SELECT
    date,
    symbol,  -- To differentiate between Apple and Nvidia
    close,
    middle_band,
    upper_band,
    lower_band
FROM bands
ORDER BY symbol, date
        );
[0m20:48:53.641276 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:48:54.714722 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.073 seconds
[0m20:48:54.735470 [debug] [Thread-1 (]: On model.build_fda.bollinger_stock_summary: Close
[0m20:48:54.862202 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '998dd413-b6ec-431b-96f9-b0e0ef2419b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ed17cd0>]}
[0m20:48:54.863730 [info ] [Thread-1 (]: 1 of 3 OK created sql table model analytics.bollinger_stock_summary ............ [[32mSUCCESS 1[0m in 1.25s]
[0m20:48:54.864618 [debug] [Thread-1 (]: Finished running node model.build_fda.bollinger_stock_summary
[0m20:48:54.865225 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_stock_summary
[0m20:48:54.865994 [info ] [Thread-1 (]: 2 of 3 START sql table model analytics.fsi_stock_summary ....................... [RUN]
[0m20:48:54.866601 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.bollinger_stock_summary, now model.build_fda.fsi_stock_summary)
[0m20:48:54.867004 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_stock_summary
[0m20:48:54.871295 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_stock_summary"
[0m20:48:54.872307 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_stock_summary
[0m20:48:54.874851 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_stock_summary"
[0m20:48:54.876727 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_stock_summary"
[0m20:48:54.877145 [debug] [Thread-1 (]: On model.build_fda.fsi_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_stock_summary"} */
create or replace transient table dev.analytics.fsi_stock_summary
         as
        (WITH interval_widths AS (
    SELECT
        ts as date,
        forecast,
        lower_bound,
        upper_bound,
        REPLACE(series, '"', '') AS symbol,
        (upper_bound - lower_bound) AS interval_width,
        'FORECASTED' as record_type
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
),

statistics AS (
    SELECT
        symbol,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM interval_widths
    GROUP BY symbol
),

recent_data AS (
    SELECT
        date,
        close,
        symbol,
        'HISTORICAL' as record_type
    FROM dev.raw_data.stock_data
    WHERE date >= CURRENT_DATE() - INTERVAL '21 DAY'  -- Fetch data from the last 21 days (3 weeks)
      AND symbol IN ('AAPL', 'NVDA')                    -- Filter for specific symbols
)

SELECT
    a.record_type,
    a.symbol,
    a.date,
    a.forecast as close,
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM interval_widths a
JOIN statistics s
    ON a.symbol = s.symbol

UNION ALL

SELECT
    r.record_type,
    r.symbol,
    r.date,
    r.close,
    NULL AS avg_interval_width,  -- NULL for non-forecasted data
    NULL AS stddev_interval_width,  -- NULL for non-forecasted data
    NULL AS fsi,  -- NULL for non-forecasted data
FROM recent_data r
ORDER BY date, symbol
        );
[0m20:48:54.877544 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:48:56.453540 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.575 seconds
[0m20:48:56.461039 [debug] [Thread-1 (]: On model.build_fda.fsi_stock_summary: Close
[0m20:48:56.571975 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '998dd413-b6ec-431b-96f9-b0e0ef2419b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11eda2210>]}
[0m20:48:56.574125 [info ] [Thread-1 (]: 2 of 3 OK created sql table model analytics.fsi_stock_summary .................. [[32mSUCCESS 1[0m in 1.70s]
[0m20:48:56.575478 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_stock_summary
[0m20:48:56.576120 [debug] [Thread-1 (]: Began running node model.build_fda.obv_stock_summary
[0m20:48:56.576866 [info ] [Thread-1 (]: 3 of 3 START sql table model analytics.obv_stock_summary ....................... [RUN]
[0m20:48:56.577564 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_stock_summary, now model.build_fda.obv_stock_summary)
[0m20:48:56.578043 [debug] [Thread-1 (]: Began compiling node model.build_fda.obv_stock_summary
[0m20:48:56.582090 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.obv_stock_summary"
[0m20:48:56.584470 [debug] [Thread-1 (]: Began executing node model.build_fda.obv_stock_summary
[0m20:48:56.589033 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.obv_stock_summary"
[0m20:48:56.590605 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.obv_stock_summary"
[0m20:48:56.590983 [debug] [Thread-1 (]: On model.build_fda.obv_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.obv_stock_summary"} */
create or replace transient table dev.analytics.obv_stock_summary
         as
        (WITH ordered_data AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM dev.raw_data.stock_data -- Referencing the raw data table in the dev database
    WHERE symbol IN ('AAPL', 'NVDA')  -- Include both AAPL and NVDA symbols
),

obv_calculation AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        CASE
            WHEN close > LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN volume
            WHEN close < LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN -volume
            ELSE 0
        END AS volume_change
    FROM ordered_data
),

cumulative_obv AS (
    SELECT
        date,
        symbol,
        SUM(volume_change) OVER (PARTITION BY symbol ORDER BY date) AS obv
    FROM obv_calculation
)

SELECT
    date,
    symbol,
    obv
FROM cumulative_obv
ORDER BY symbol, date
        );
[0m20:48:56.591334 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:48:57.874008 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.282 seconds
[0m20:48:57.880863 [debug] [Thread-1 (]: On model.build_fda.obv_stock_summary: Close
[0m20:48:58.018028 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '998dd413-b6ec-431b-96f9-b0e0ef2419b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11fcb8e10>]}
[0m20:48:58.019942 [info ] [Thread-1 (]: 3 of 3 OK created sql table model analytics.obv_stock_summary .................. [[32mSUCCESS 1[0m in 1.44s]
[0m20:48:58.021575 [debug] [Thread-1 (]: Finished running node model.build_fda.obv_stock_summary
[0m20:48:58.022802 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data
[0m20:48:58.024284 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.obv_stock_summary, now model.build_fda.stock_data)
[0m20:48:58.025090 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data
[0m20:48:58.031203 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data"
[0m20:48:58.033129 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data
[0m20:48:58.033801 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data_forecast
[0m20:48:58.034474 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.stock_data, now model.build_fda.stock_data_forecast)
[0m20:48:58.035016 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data_forecast
[0m20:48:58.039384 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data_forecast"
[0m20:48:58.040636 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data_forecast
[0m20:48:58.041587 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:48:58.041788 [debug] [MainThread]: Connection 'model.build_fda.stock_data_forecast' was properly closed.
[0m20:48:58.041990 [info ] [MainThread]: 
[0m20:48:58.042161 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 5.68 seconds (5.68s).
[0m20:48:58.042604 [debug] [MainThread]: Command end result
[0m20:48:58.059590 [info ] [MainThread]: 
[0m20:48:58.060041 [info ] [MainThread]: [32mCompleted successfully[0m
[0m20:48:58.060323 [info ] [MainThread]: 
[0m20:48:58.060608 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m20:48:58.063706 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 6.7552094, "process_user_time": 2.331471, "process_kernel_time": 1.464313, "process_mem_max_rss": "202784768", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m20:48:58.064149 [debug] [MainThread]: Command `dbt run` succeeded at 20:48:58.064085 after 6.76 seconds
[0m20:48:58.064389 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102984150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102973fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11edb4090>]}
[0m20:48:58.064624 [debug] [MainThread]: Flushing usage events
[0m21:32:30.084656 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a351810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a228950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a3bccd0>]}


============================== 21:32:30.086667 | c750a983-55bf-4793-b477-88cd99da5e14 ==============================
[0m21:32:30.086667 [info ] [MainThread]: Running with dbt=1.8.7
[0m21:32:30.086995 [debug] [MainThread]: running dbt with arguments {'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'printer_width': '80', 'use_colors': 'True', 'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'cache_selected_only': 'False', 'log_cache_events': 'False', 'quiet': 'False', 'debug': 'False', 'invocation_command': 'dbt run', 'empty': 'False', 'log_format': 'default', 'warn_error': 'None', 'partial_parse': 'True', 'profiles_dir': '/Users/shatayu/.dbt', 'introspect': 'True', 'no_print': 'None', 'write_json': 'True', 'target_path': 'None', 'indirect_selection': 'eager', 'version_check': 'True', 'log_path': '/Users/shatayu/Downloads/DATA226_Lab2Prep/build_fda/logs', 'use_experimental_parser': 'False'}
[0m21:32:31.050307 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c750a983-55bf-4793-b477-88cd99da5e14', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x132b0a8d0>]}
[0m21:32:31.070678 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c750a983-55bf-4793-b477-88cd99da5e14', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109c45650>]}
[0m21:32:31.071229 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m21:32:31.084025 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m21:32:31.153595 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:32:31.153953 [debug] [MainThread]: Partial parsing: updated file: build_fda://models/output/obv_stock_summary.sql
[0m21:32:31.256107 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c750a983-55bf-4793-b477-88cd99da5e14', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13776bad0>]}
[0m21:32:31.296788 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c750a983-55bf-4793-b477-88cd99da5e14', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14915bd10>]}
[0m21:32:31.297087 [info ] [MainThread]: Found 5 models, 5 sources, 459 macros
[0m21:32:31.297255 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c750a983-55bf-4793-b477-88cd99da5e14', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14908a710>]}
[0m21:32:31.298139 [info ] [MainThread]: 
[0m21:32:31.298424 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m21:32:31.300353 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m21:32:31.306255 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m21:32:31.306416 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m21:32:31.306544 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:32:31.827387 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.520 seconds
[0m21:32:31.830447 [debug] [ThreadPool]: On list_dev: Close
[0m21:32:31.944583 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_analytics)
[0m21:32:31.956910 [debug] [ThreadPool]: Using snowflake connection "list_dev_analytics"
[0m21:32:31.957347 [debug] [ThreadPool]: On list_dev_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev_analytics"} */
show objects in dev.analytics limit 10000
[0m21:32:31.957626 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:32:32.389993 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.432 seconds
[0m21:32:32.393743 [debug] [ThreadPool]: On list_dev_analytics: Close
[0m21:32:32.530889 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c750a983-55bf-4793-b477-88cd99da5e14', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1374ba250>]}
[0m21:32:32.531875 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m21:32:32.532363 [info ] [MainThread]: 
[0m21:32:32.537020 [debug] [Thread-1 (]: Began running node model.build_fda.bollinger_stock_summary
[0m21:32:32.537624 [info ] [Thread-1 (]: 1 of 3 START sql table model analytics.bollinger_stock_summary ................. [RUN]
[0m21:32:32.538112 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_analytics, now model.build_fda.bollinger_stock_summary)
[0m21:32:32.538470 [debug] [Thread-1 (]: Began compiling node model.build_fda.bollinger_stock_summary
[0m21:32:32.546341 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.bollinger_stock_summary"
[0m21:32:32.547588 [debug] [Thread-1 (]: Began executing node model.build_fda.bollinger_stock_summary
[0m21:32:32.567099 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.bollinger_stock_summary"
[0m21:32:32.568396 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.bollinger_stock_summary"
[0m21:32:32.568759 [debug] [Thread-1 (]: On model.build_fda.bollinger_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.bollinger_stock_summary"} */
create or replace transient table dev.analytics.bollinger_stock_summary
         as
        (WITH stock_prices AS (
    SELECT
        date,
        close,
        symbol
    FROM dev.raw_data.stock_data
    WHERE symbol IN ('AAPL', 'NVDA')  -- Including both Apple and Nvidia
),

-- Calculate the 20-day SMA and 20-day standard deviation for both symbols
sma_stddev AS (
    SELECT
        date,
        symbol,
        close,
        AVG(close) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS middle_band,
        STDDEV(close) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS stddev_20
    FROM stock_prices
),

-- Calculate the upper and lower bands
bands AS (
    SELECT
        date,
        symbol,
        close,
        middle_band,
        (middle_band + (2 * stddev_20)) AS upper_band,
        (middle_band - (2 * stddev_20)) AS lower_band
    FROM sma_stddev
)

SELECT
    date,
    symbol,  -- To differentiate between Apple and Nvidia
    close,
    middle_band,
    upper_band,
    lower_band
FROM bands
ORDER BY symbol, date
        );
[0m21:32:32.569060 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:32:33.858030 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.289 seconds
[0m21:32:33.881265 [debug] [Thread-1 (]: On model.build_fda.bollinger_stock_summary: Close
[0m21:32:34.025488 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c750a983-55bf-4793-b477-88cd99da5e14', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137551f50>]}
[0m21:32:34.026780 [info ] [Thread-1 (]: 1 of 3 OK created sql table model analytics.bollinger_stock_summary ............ [[32mSUCCESS 1[0m in 1.49s]
[0m21:32:34.027652 [debug] [Thread-1 (]: Finished running node model.build_fda.bollinger_stock_summary
[0m21:32:34.028265 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_stock_summary
[0m21:32:34.028992 [info ] [Thread-1 (]: 2 of 3 START sql table model analytics.fsi_stock_summary ....................... [RUN]
[0m21:32:34.029637 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.bollinger_stock_summary, now model.build_fda.fsi_stock_summary)
[0m21:32:34.030030 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_stock_summary
[0m21:32:34.033926 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_stock_summary"
[0m21:32:34.035244 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_stock_summary
[0m21:32:34.038146 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_stock_summary"
[0m21:32:34.040053 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_stock_summary"
[0m21:32:34.040476 [debug] [Thread-1 (]: On model.build_fda.fsi_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_stock_summary"} */
create or replace transient table dev.analytics.fsi_stock_summary
         as
        (WITH interval_widths AS (
    SELECT
        ts as date,
        forecast,
        lower_bound,
        upper_bound,
        REPLACE(series, '"', '') AS symbol,
        (upper_bound - lower_bound) AS interval_width,
        'FORECASTED' as record_type
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
),

statistics AS (
    SELECT
        symbol,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM interval_widths
    GROUP BY symbol
),

recent_data AS (
    SELECT
        date,
        close,
        symbol,
        'HISTORICAL' as record_type
    FROM dev.raw_data.stock_data
    WHERE date >= CURRENT_DATE() - INTERVAL '21 DAY'  -- Fetch data from the last 21 days (3 weeks)
      AND symbol IN ('AAPL', 'NVDA')                    -- Filter for specific symbols
)

SELECT
    a.record_type,
    a.symbol,
    a.date,
    a.forecast as close,
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM interval_widths a
JOIN statistics s
    ON a.symbol = s.symbol

UNION ALL

SELECT
    r.record_type,
    r.symbol,
    r.date,
    r.close,
    NULL AS avg_interval_width,  -- NULL for non-forecasted data
    NULL AS stddev_interval_width,  -- NULL for non-forecasted data
    NULL AS fsi,  -- NULL for non-forecasted data
FROM recent_data r
ORDER BY date, symbol
        );
[0m21:32:34.040857 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:32:35.226370 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.185 seconds
[0m21:32:35.229806 [debug] [Thread-1 (]: On model.build_fda.fsi_stock_summary: Close
[0m21:32:35.342784 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c750a983-55bf-4793-b477-88cd99da5e14', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1376cc790>]}
[0m21:32:35.343845 [info ] [Thread-1 (]: 2 of 3 OK created sql table model analytics.fsi_stock_summary .................. [[32mSUCCESS 1[0m in 1.31s]
[0m21:32:35.344473 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_stock_summary
[0m21:32:35.344905 [debug] [Thread-1 (]: Began running node model.build_fda.obv_stock_summary
[0m21:32:35.345423 [info ] [Thread-1 (]: 3 of 3 START sql table model analytics.obv_stock_summary ....................... [RUN]
[0m21:32:35.345957 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_stock_summary, now model.build_fda.obv_stock_summary)
[0m21:32:35.346299 [debug] [Thread-1 (]: Began compiling node model.build_fda.obv_stock_summary
[0m21:32:35.349853 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.obv_stock_summary"
[0m21:32:35.351931 [debug] [Thread-1 (]: Began executing node model.build_fda.obv_stock_summary
[0m21:32:35.355587 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.obv_stock_summary"
[0m21:32:35.356969 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.obv_stock_summary"
[0m21:32:35.357266 [debug] [Thread-1 (]: On model.build_fda.obv_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.obv_stock_summary"} */
create or replace transient table dev.analytics.obv_stock_summary
         as
        (WITH ordered_data AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM dev.raw_data.stock_data -- Referencing the raw data table in the dev database
    WHERE symbol IN ('AAPL', 'NVDA')  -- Include both AAPL and NVDA symbols
),

obv_calculation AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        CASE
            WHEN close > LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN volume
            WHEN close < LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN -volume
            ELSE 0
        END AS volume_change
    FROM ordered_data
),

cumulative_obv AS (
    SELECT
        date,
        symbol,
        close
        SUM(volume_change) OVER (PARTITION BY symbol ORDER BY date) AS obv
    FROM obv_calculation
)

SELECT
    date,
    symbol,
    close,
    obv
FROM cumulative_obv
ORDER BY symbol, date
        );
[0m21:32:35.357557 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:32:35.825146 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b8564c-0004-26b4-0000-000255f33fb9
[0m21:32:35.825905 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 33 at position 11 unexpected '('.
syntax error line 33 at position 12 unexpected 'volume_change'.
syntax error line 33 at position 27 unexpected 'OVER'.
syntax error line 33 at position 66 unexpected ')'.
[0m21:32:35.826472 [debug] [Thread-1 (]: On model.build_fda.obv_stock_summary: Close
[0m21:32:35.938160 [debug] [Thread-1 (]: Database Error in model obv_stock_summary (models/output/obv_stock_summary.sql)
  001003 (42000): SQL compilation error:
  syntax error line 33 at position 11 unexpected '('.
  syntax error line 33 at position 12 unexpected 'volume_change'.
  syntax error line 33 at position 27 unexpected 'OVER'.
  syntax error line 33 at position 66 unexpected ')'.
  compiled code at target/run/build_fda/models/output/obv_stock_summary.sql
[0m21:32:35.938930 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c750a983-55bf-4793-b477-88cd99da5e14', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a7b55d0>]}
[0m21:32:35.939710 [error] [Thread-1 (]: 3 of 3 ERROR creating sql table model analytics.obv_stock_summary .............. [[31mERROR[0m in 0.59s]
[0m21:32:35.940382 [debug] [Thread-1 (]: Finished running node model.build_fda.obv_stock_summary
[0m21:32:35.940859 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data
[0m21:32:35.941449 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.obv_stock_summary, now model.build_fda.stock_data)
[0m21:32:35.941798 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data
[0m21:32:35.944886 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data"
[0m21:32:35.945912 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data
[0m21:32:35.946268 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data_forecast
[0m21:32:35.947094 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.stock_data, now model.build_fda.stock_data_forecast)
[0m21:32:35.947378 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data_forecast
[0m21:32:35.949410 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data_forecast"
[0m21:32:35.950180 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data_forecast
[0m21:32:35.951216 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:32:35.951439 [debug] [MainThread]: Connection 'model.build_fda.stock_data_forecast' was properly closed.
[0m21:32:35.951739 [info ] [MainThread]: 
[0m21:32:35.951993 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 4.65 seconds (4.65s).
[0m21:32:35.952665 [debug] [MainThread]: Command end result
[0m21:32:35.972446 [info ] [MainThread]: 
[0m21:32:35.972692 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m21:32:35.972855 [info ] [MainThread]: 
[0m21:32:35.973057 [error] [MainThread]:   Database Error in model obv_stock_summary (models/output/obv_stock_summary.sql)
  001003 (42000): SQL compilation error:
  syntax error line 33 at position 11 unexpected '('.
  syntax error line 33 at position 12 unexpected 'volume_change'.
  syntax error line 33 at position 27 unexpected 'OVER'.
  syntax error line 33 at position 66 unexpected ')'.
  compiled code at target/run/build_fda/models/output/obv_stock_summary.sql
[0m21:32:35.973226 [info ] [MainThread]: 
[0m21:32:35.973396 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
[0m21:32:35.975436 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 5.9443226, "process_user_time": 2.161871, "process_kernel_time": 1.673427, "process_mem_max_rss": "204537856", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m21:32:35.975751 [debug] [MainThread]: Command `dbt run` failed at 21:32:35.975699 after 5.94 seconds
[0m21:32:35.975970 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105364150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107d02110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13752ff90>]}
[0m21:32:35.976163 [debug] [MainThread]: Flushing usage events
[0m21:33:13.909379 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10579ba50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10581c690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10581cbd0>]}


============================== 21:33:13.911036 | f918d539-6b61-42e1-be6c-e4aa1d303d82 ==============================
[0m21:33:13.911036 [info ] [MainThread]: Running with dbt=1.8.7
[0m21:33:13.911357 [debug] [MainThread]: running dbt with arguments {'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'cache_selected_only': 'False', 'printer_width': '80', 'profiles_dir': '/Users/shatayu/.dbt', 'partial_parse': 'True', 'log_cache_events': 'False', 'send_anonymous_usage_stats': 'True', 'static_parser': 'True', 'no_print': 'None', 'quiet': 'False', 'debug': 'False', 'use_experimental_parser': 'False', 'target_path': 'None', 'invocation_command': 'dbt run', 'empty': 'False', 'log_path': '/Users/shatayu/Downloads/DATA226_Lab2Prep/build_fda/logs', 'indirect_selection': 'eager', 'introspect': 'True', 'write_json': 'True', 'version_check': 'True', 'log_format': 'default'}
[0m21:33:14.583911 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f918d539-6b61-42e1-be6c-e4aa1d303d82', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106275f90>]}
[0m21:33:14.604189 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f918d539-6b61-42e1-be6c-e4aa1d303d82', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105265450>]}
[0m21:33:14.604857 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m21:33:14.617685 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m21:33:14.684658 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:33:14.685014 [debug] [MainThread]: Partial parsing: updated file: build_fda://models/output/obv_stock_summary.sql
[0m21:33:14.784998 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f918d539-6b61-42e1-be6c-e4aa1d303d82', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13ab5a110>]}
[0m21:33:14.824627 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f918d539-6b61-42e1-be6c-e4aa1d303d82', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13adaed50>]}
[0m21:33:14.824915 [info ] [MainThread]: Found 5 models, 5 sources, 459 macros
[0m21:33:14.825089 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f918d539-6b61-42e1-be6c-e4aa1d303d82', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13ab5add0>]}
[0m21:33:14.825978 [info ] [MainThread]: 
[0m21:33:14.826267 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m21:33:14.828199 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev'
[0m21:33:14.834051 [debug] [ThreadPool]: Using snowflake connection "list_dev"
[0m21:33:14.834220 [debug] [ThreadPool]: On list_dev: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev"} */
show terse schemas in database dev
    limit 10000
[0m21:33:14.834345 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:33:15.396247 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.561 seconds
[0m21:33:15.400563 [debug] [ThreadPool]: On list_dev: Close
[0m21:33:15.517266 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dev, now list_dev_analytics)
[0m21:33:15.529331 [debug] [ThreadPool]: Using snowflake connection "list_dev_analytics"
[0m21:33:15.529709 [debug] [ThreadPool]: On list_dev_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev_analytics"} */
show objects in dev.analytics limit 10000
[0m21:33:15.529972 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:33:16.000567 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.470 seconds
[0m21:33:16.005049 [debug] [ThreadPool]: On list_dev_analytics: Close
[0m21:33:16.130681 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f918d539-6b61-42e1-be6c-e4aa1d303d82', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1036187d0>]}
[0m21:33:16.131759 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m21:33:16.132150 [info ] [MainThread]: 
[0m21:33:16.135685 [debug] [Thread-1 (]: Began running node model.build_fda.bollinger_stock_summary
[0m21:33:16.136374 [info ] [Thread-1 (]: 1 of 3 START sql table model analytics.bollinger_stock_summary ................. [RUN]
[0m21:33:16.136881 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_analytics, now model.build_fda.bollinger_stock_summary)
[0m21:33:16.137201 [debug] [Thread-1 (]: Began compiling node model.build_fda.bollinger_stock_summary
[0m21:33:16.145092 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.bollinger_stock_summary"
[0m21:33:16.145910 [debug] [Thread-1 (]: Began executing node model.build_fda.bollinger_stock_summary
[0m21:33:16.165251 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.bollinger_stock_summary"
[0m21:33:16.166344 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.bollinger_stock_summary"
[0m21:33:16.166638 [debug] [Thread-1 (]: On model.build_fda.bollinger_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.bollinger_stock_summary"} */
create or replace transient table dev.analytics.bollinger_stock_summary
         as
        (WITH stock_prices AS (
    SELECT
        date,
        close,
        symbol
    FROM dev.raw_data.stock_data
    WHERE symbol IN ('AAPL', 'NVDA')  -- Including both Apple and Nvidia
),

-- Calculate the 20-day SMA and 20-day standard deviation for both symbols
sma_stddev AS (
    SELECT
        date,
        symbol,
        close,
        AVG(close) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS middle_band,
        STDDEV(close) OVER (PARTITION BY symbol ORDER BY date ROWS BETWEEN 19 PRECEDING AND CURRENT ROW) AS stddev_20
    FROM stock_prices
),

-- Calculate the upper and lower bands
bands AS (
    SELECT
        date,
        symbol,
        close,
        middle_band,
        (middle_band + (2 * stddev_20)) AS upper_band,
        (middle_band - (2 * stddev_20)) AS lower_band
    FROM sma_stddev
)

SELECT
    date,
    symbol,  -- To differentiate between Apple and Nvidia
    close,
    middle_band,
    upper_band,
    lower_band
FROM bands
ORDER BY symbol, date
        );
[0m21:33:16.166895 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:33:17.622257 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.454 seconds
[0m21:33:17.646627 [debug] [Thread-1 (]: On model.build_fda.bollinger_stock_summary: Close
[0m21:33:17.761331 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f918d539-6b61-42e1-be6c-e4aa1d303d82', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13ae90d90>]}
[0m21:33:17.763097 [info ] [Thread-1 (]: 1 of 3 OK created sql table model analytics.bollinger_stock_summary ............ [[32mSUCCESS 1[0m in 1.62s]
[0m21:33:17.764047 [debug] [Thread-1 (]: Finished running node model.build_fda.bollinger_stock_summary
[0m21:33:17.764556 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_stock_summary
[0m21:33:17.765176 [info ] [Thread-1 (]: 2 of 3 START sql table model analytics.fsi_stock_summary ....................... [RUN]
[0m21:33:17.765771 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.bollinger_stock_summary, now model.build_fda.fsi_stock_summary)
[0m21:33:17.766165 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_stock_summary
[0m21:33:17.770038 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_stock_summary"
[0m21:33:17.770882 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_stock_summary
[0m21:33:17.773698 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.fsi_stock_summary"
[0m21:33:17.775600 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.fsi_stock_summary"
[0m21:33:17.776011 [debug] [Thread-1 (]: On model.build_fda.fsi_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.fsi_stock_summary"} */
create or replace transient table dev.analytics.fsi_stock_summary
         as
        (WITH interval_widths AS (
    SELECT
        ts as date,
        forecast,
        lower_bound,
        upper_bound,
        REPLACE(series, '"', '') AS symbol,
        (upper_bound - lower_bound) AS interval_width,
        'FORECASTED' as record_type
    FROM dev.adhoc.stock_data_forecast  -- Referencing the stock data forecast table
),

statistics AS (
    SELECT
        symbol,
        AVG(interval_width) AS avg_interval_width,
        STDDEV(interval_width) AS stddev_interval_width
    FROM interval_widths
    GROUP BY symbol
),

recent_data AS (
    SELECT
        date,
        close,
        symbol,
        'HISTORICAL' as record_type
    FROM dev.raw_data.stock_data
    WHERE date >= CURRENT_DATE() - INTERVAL '21 DAY'  -- Fetch data from the last 21 days (3 weeks)
      AND symbol IN ('AAPL', 'NVDA')                    -- Filter for specific symbols
)

SELECT
    a.record_type,
    a.symbol,
    a.date,
    a.forecast as close,
    s.avg_interval_width,
    s.stddev_interval_width,
    -- FSI Calculation
    1 - (s.stddev_interval_width / s.avg_interval_width) AS fsi
FROM interval_widths a
JOIN statistics s
    ON a.symbol = s.symbol

UNION ALL

SELECT
    r.record_type,
    r.symbol,
    r.date,
    r.close,
    NULL AS avg_interval_width,  -- NULL for non-forecasted data
    NULL AS stddev_interval_width,  -- NULL for non-forecasted data
    NULL AS fsi,  -- NULL for non-forecasted data
FROM recent_data r
ORDER BY date, symbol
        );
[0m21:33:17.776393 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:33:18.851269 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.074 seconds
[0m21:33:18.854896 [debug] [Thread-1 (]: On model.build_fda.fsi_stock_summary: Close
[0m21:33:18.984390 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f918d539-6b61-42e1-be6c-e4aa1d303d82', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13ac547d0>]}
[0m21:33:18.985452 [info ] [Thread-1 (]: 2 of 3 OK created sql table model analytics.fsi_stock_summary .................. [[32mSUCCESS 1[0m in 1.22s]
[0m21:33:18.986282 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_stock_summary
[0m21:33:18.986856 [debug] [Thread-1 (]: Began running node model.build_fda.obv_stock_summary
[0m21:33:18.987607 [info ] [Thread-1 (]: 3 of 3 START sql table model analytics.obv_stock_summary ....................... [RUN]
[0m21:33:18.988285 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_stock_summary, now model.build_fda.obv_stock_summary)
[0m21:33:18.988763 [debug] [Thread-1 (]: Began compiling node model.build_fda.obv_stock_summary
[0m21:33:18.992566 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.obv_stock_summary"
[0m21:33:18.993450 [debug] [Thread-1 (]: Began executing node model.build_fda.obv_stock_summary
[0m21:33:18.997737 [debug] [Thread-1 (]: Writing runtime sql for node "model.build_fda.obv_stock_summary"
[0m21:33:18.999401 [debug] [Thread-1 (]: Using snowflake connection "model.build_fda.obv_stock_summary"
[0m21:33:18.999785 [debug] [Thread-1 (]: On model.build_fda.obv_stock_summary: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "model.build_fda.obv_stock_summary"} */
create or replace transient table dev.analytics.obv_stock_summary
         as
        (WITH ordered_data AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        LEAD(close) OVER (PARTITION BY symbol ORDER BY date) AS next_close
    FROM dev.raw_data.stock_data -- Referencing the raw data table in the dev database
    WHERE symbol IN ('AAPL', 'NVDA')  -- Include both AAPL and NVDA symbols
),

obv_calculation AS (
    SELECT
        date,
        close,
        volume,
        symbol,
        CASE
            WHEN close > LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN volume
            WHEN close < LAG(close) OVER (PARTITION BY symbol ORDER BY date) THEN -volume
            ELSE 0
        END AS volume_change
    FROM ordered_data
),

cumulative_obv AS (
    SELECT
        date,
        symbol,
        close,
        SUM(volume_change) OVER (PARTITION BY symbol ORDER BY date) AS obv
    FROM obv_calculation
)

SELECT
    date,
    symbol,
    close,
    obv
FROM cumulative_obv
ORDER BY symbol, date
        );
[0m21:33:19.000143 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:33:20.340903 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.340 seconds
[0m21:33:20.344950 [debug] [Thread-1 (]: On model.build_fda.obv_stock_summary: Close
[0m21:33:20.453973 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f918d539-6b61-42e1-be6c-e4aa1d303d82', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103895e10>]}
[0m21:33:20.454784 [info ] [Thread-1 (]: 3 of 3 OK created sql table model analytics.obv_stock_summary .................. [[32mSUCCESS 1[0m in 1.47s]
[0m21:33:20.455428 [debug] [Thread-1 (]: Finished running node model.build_fda.obv_stock_summary
[0m21:33:20.455929 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data
[0m21:33:20.456494 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.obv_stock_summary, now model.build_fda.stock_data)
[0m21:33:20.456946 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data
[0m21:33:20.460667 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data"
[0m21:33:20.461815 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data
[0m21:33:20.462177 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data_forecast
[0m21:33:20.462559 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.stock_data, now model.build_fda.stock_data_forecast)
[0m21:33:20.462858 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data_forecast
[0m21:33:20.465388 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data_forecast"
[0m21:33:20.466198 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data_forecast
[0m21:33:20.467451 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:33:20.467715 [debug] [MainThread]: Connection 'model.build_fda.stock_data_forecast' was properly closed.
[0m21:33:20.468012 [info ] [MainThread]: 
[0m21:33:20.468266 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 5.64 seconds (5.64s).
[0m21:33:20.468906 [debug] [MainThread]: Command end result
[0m21:33:20.488962 [info ] [MainThread]: 
[0m21:33:20.489239 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:33:20.489422 [info ] [MainThread]: 
[0m21:33:20.489619 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m21:33:20.492078 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 6.6295323, "process_user_time": 2.434137, "process_kernel_time": 1.295199, "process_mem_max_rss": "203603968", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m21:33:20.492438 [debug] [MainThread]: Command `dbt run` succeeded at 21:33:20.492383 after 6.63 seconds
[0m21:33:20.492691 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1013e4150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13aa58450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10142eed0>]}
[0m21:33:20.492906 [debug] [MainThread]: Flushing usage events
[0m22:21:10.591188 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109951190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10999fc10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1099bcb50>]}


============================== 22:21:10.593246 | 84942c4f-93ea-4f8f-8914-46766ea42768 ==============================
[0m22:21:10.593246 [info ] [MainThread]: Running with dbt=1.8.7
[0m22:21:10.593574 [debug] [MainThread]: running dbt with arguments {'fail_fast': 'False', 'target_path': 'None', 'debug': 'False', 'static_parser': 'True', 'quiet': 'False', 'log_cache_events': 'False', 'use_colors': 'True', 'partial_parse': 'True', 'warn_error': 'None', 'empty': 'None', 'write_json': 'True', 'log_path': '/Users/shatayu/Downloads/DATA226_Lab2Prep/build_fda/logs', 'cache_selected_only': 'False', 'no_print': 'None', 'profiles_dir': '/Users/shatayu/.dbt', 'use_experimental_parser': 'False', 'version_check': 'True', 'log_format': 'default', 'send_anonymous_usage_stats': 'True', 'invocation_command': 'dbt test', 'printer_width': '80', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'indirect_selection': 'eager'}
[0m22:21:11.545547 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '84942c4f-93ea-4f8f-8914-46766ea42768', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12c69e410>]}
[0m22:21:11.565590 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '84942c4f-93ea-4f8f-8914-46766ea42768', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108a45690>]}
[0m22:21:11.566162 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m22:21:11.578327 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m22:21:11.647717 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 1 files changed.
[0m22:21:11.648053 [debug] [MainThread]: Partial parsing: added file: build_fda://models/schema.yml
[0m22:21:11.648262 [debug] [MainThread]: Partial parsing: updated file: build_fda://models/source.yml
[0m22:21:11.795789 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '84942c4f-93ea-4f8f-8914-46766ea42768', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12caf9850>]}
[0m22:21:11.849161 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '84942c4f-93ea-4f8f-8914-46766ea42768', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12cdca8d0>]}
[0m22:21:11.849460 [info ] [MainThread]: Found 5 models, 6 data tests, 5 sources, 459 macros
[0m22:21:11.849627 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '84942c4f-93ea-4f8f-8914-46766ea42768', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12cbd47d0>]}
[0m22:21:11.850451 [info ] [MainThread]: 
[0m22:21:11.850722 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m22:21:11.852657 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev_analytics'
[0m22:21:11.859241 [debug] [ThreadPool]: Using snowflake connection "list_dev_analytics"
[0m22:21:11.859518 [debug] [ThreadPool]: On list_dev_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev_analytics"} */
show objects in dev.analytics limit 10000
[0m22:21:11.859800 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:21:12.498171 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.638 seconds
[0m22:21:12.501660 [debug] [ThreadPool]: On list_dev_analytics: Close
[0m22:21:12.654096 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '84942c4f-93ea-4f8f-8914-46766ea42768', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12ca14310>]}
[0m22:21:12.655723 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m22:21:12.656304 [info ] [MainThread]: 
[0m22:21:12.661710 [debug] [Thread-1 (]: Began running node test.build_fda.not_null_bollinger_stock_summary_close.4959e39a23
[0m22:21:12.662297 [info ] [Thread-1 (]: 1 of 6 START test not_null_bollinger_stock_summary_close ....................... [RUN]
[0m22:21:12.662848 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_analytics, now test.build_fda.not_null_bollinger_stock_summary_close.4959e39a23)
[0m22:21:12.663252 [debug] [Thread-1 (]: Began compiling node test.build_fda.not_null_bollinger_stock_summary_close.4959e39a23
[0m22:21:12.679686 [debug] [Thread-1 (]: Writing injected SQL for node "test.build_fda.not_null_bollinger_stock_summary_close.4959e39a23"
[0m22:21:12.680956 [debug] [Thread-1 (]: Began executing node test.build_fda.not_null_bollinger_stock_summary_close.4959e39a23
[0m22:21:12.695780 [debug] [Thread-1 (]: Writing runtime sql for node "test.build_fda.not_null_bollinger_stock_summary_close.4959e39a23"
[0m22:21:12.697029 [debug] [Thread-1 (]: Using snowflake connection "test.build_fda.not_null_bollinger_stock_summary_close.4959e39a23"
[0m22:21:12.697326 [debug] [Thread-1 (]: On test.build_fda.not_null_bollinger_stock_summary_close.4959e39a23: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "test.build_fda.not_null_bollinger_stock_summary_close.4959e39a23"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select close
from dev.analytics.bollinger_stock_summary
where close is null



      
    ) dbt_internal_test
[0m22:21:12.697571 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:21:13.714569 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.016 seconds
[0m22:21:13.728270 [debug] [Thread-1 (]: On test.build_fda.not_null_bollinger_stock_summary_close.4959e39a23: Close
[0m22:21:13.853265 [info ] [Thread-1 (]: 1 of 6 PASS not_null_bollinger_stock_summary_close ............................. [[32mPASS[0m in 1.19s]
[0m22:21:13.854252 [debug] [Thread-1 (]: Finished running node test.build_fda.not_null_bollinger_stock_summary_close.4959e39a23
[0m22:21:13.854799 [debug] [Thread-1 (]: Began running node test.build_fda.not_null_bollinger_stock_summary_date.b95d5b9419
[0m22:21:13.855362 [info ] [Thread-1 (]: 2 of 6 START test not_null_bollinger_stock_summary_date ........................ [RUN]
[0m22:21:13.855969 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.build_fda.not_null_bollinger_stock_summary_close.4959e39a23, now test.build_fda.not_null_bollinger_stock_summary_date.b95d5b9419)
[0m22:21:13.856390 [debug] [Thread-1 (]: Began compiling node test.build_fda.not_null_bollinger_stock_summary_date.b95d5b9419
[0m22:21:13.861592 [debug] [Thread-1 (]: Writing injected SQL for node "test.build_fda.not_null_bollinger_stock_summary_date.b95d5b9419"
[0m22:21:13.862558 [debug] [Thread-1 (]: Began executing node test.build_fda.not_null_bollinger_stock_summary_date.b95d5b9419
[0m22:21:13.864884 [debug] [Thread-1 (]: Writing runtime sql for node "test.build_fda.not_null_bollinger_stock_summary_date.b95d5b9419"
[0m22:21:13.865868 [debug] [Thread-1 (]: Using snowflake connection "test.build_fda.not_null_bollinger_stock_summary_date.b95d5b9419"
[0m22:21:13.866211 [debug] [Thread-1 (]: On test.build_fda.not_null_bollinger_stock_summary_date.b95d5b9419: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "test.build_fda.not_null_bollinger_stock_summary_date.b95d5b9419"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from dev.analytics.bollinger_stock_summary
where date is null



      
    ) dbt_internal_test
[0m22:21:13.866514 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:21:14.599610 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.733 seconds
[0m22:21:14.603978 [debug] [Thread-1 (]: On test.build_fda.not_null_bollinger_stock_summary_date.b95d5b9419: Close
[0m22:21:14.718135 [info ] [Thread-1 (]: 2 of 6 PASS not_null_bollinger_stock_summary_date .............................. [[32mPASS[0m in 0.86s]
[0m22:21:14.719538 [debug] [Thread-1 (]: Finished running node test.build_fda.not_null_bollinger_stock_summary_date.b95d5b9419
[0m22:21:14.719924 [debug] [Thread-1 (]: Began running node test.build_fda.not_null_bollinger_stock_summary_symbol.8adff61bcb
[0m22:21:14.720171 [info ] [Thread-1 (]: 3 of 6 START test not_null_bollinger_stock_summary_symbol ...................... [RUN]
[0m22:21:14.720632 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.build_fda.not_null_bollinger_stock_summary_date.b95d5b9419, now test.build_fda.not_null_bollinger_stock_summary_symbol.8adff61bcb)
[0m22:21:14.721036 [debug] [Thread-1 (]: Began compiling node test.build_fda.not_null_bollinger_stock_summary_symbol.8adff61bcb
[0m22:21:14.725287 [debug] [Thread-1 (]: Writing injected SQL for node "test.build_fda.not_null_bollinger_stock_summary_symbol.8adff61bcb"
[0m22:21:14.725911 [debug] [Thread-1 (]: Began executing node test.build_fda.not_null_bollinger_stock_summary_symbol.8adff61bcb
[0m22:21:14.727403 [debug] [Thread-1 (]: Writing runtime sql for node "test.build_fda.not_null_bollinger_stock_summary_symbol.8adff61bcb"
[0m22:21:14.728057 [debug] [Thread-1 (]: Using snowflake connection "test.build_fda.not_null_bollinger_stock_summary_symbol.8adff61bcb"
[0m22:21:14.728282 [debug] [Thread-1 (]: On test.build_fda.not_null_bollinger_stock_summary_symbol.8adff61bcb: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "test.build_fda.not_null_bollinger_stock_summary_symbol.8adff61bcb"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select symbol
from dev.analytics.bollinger_stock_summary
where symbol is null



      
    ) dbt_internal_test
[0m22:21:14.728488 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:21:15.390885 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.662 seconds
[0m22:21:15.397518 [debug] [Thread-1 (]: On test.build_fda.not_null_bollinger_stock_summary_symbol.8adff61bcb: Close
[0m22:21:15.502369 [info ] [Thread-1 (]: 3 of 6 PASS not_null_bollinger_stock_summary_symbol ............................ [[32mPASS[0m in 0.78s]
[0m22:21:15.503668 [debug] [Thread-1 (]: Finished running node test.build_fda.not_null_bollinger_stock_summary_symbol.8adff61bcb
[0m22:21:15.504503 [debug] [Thread-1 (]: Began running node test.build_fda.not_null_obv_stock_summary_date.50d0b7b73c
[0m22:21:15.505280 [info ] [Thread-1 (]: 4 of 6 START test not_null_obv_stock_summary_date .............................. [RUN]
[0m22:21:15.506003 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.build_fda.not_null_bollinger_stock_summary_symbol.8adff61bcb, now test.build_fda.not_null_obv_stock_summary_date.50d0b7b73c)
[0m22:21:15.506492 [debug] [Thread-1 (]: Began compiling node test.build_fda.not_null_obv_stock_summary_date.50d0b7b73c
[0m22:21:15.511544 [debug] [Thread-1 (]: Writing injected SQL for node "test.build_fda.not_null_obv_stock_summary_date.50d0b7b73c"
[0m22:21:15.512370 [debug] [Thread-1 (]: Began executing node test.build_fda.not_null_obv_stock_summary_date.50d0b7b73c
[0m22:21:15.514850 [debug] [Thread-1 (]: Writing runtime sql for node "test.build_fda.not_null_obv_stock_summary_date.50d0b7b73c"
[0m22:21:15.515716 [debug] [Thread-1 (]: Using snowflake connection "test.build_fda.not_null_obv_stock_summary_date.50d0b7b73c"
[0m22:21:15.516052 [debug] [Thread-1 (]: On test.build_fda.not_null_obv_stock_summary_date.50d0b7b73c: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "test.build_fda.not_null_obv_stock_summary_date.50d0b7b73c"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from dev.analytics.obv_stock_summary
where date is null



      
    ) dbt_internal_test
[0m22:21:15.516360 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:21:16.187180 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.670 seconds
[0m22:21:16.191986 [debug] [Thread-1 (]: On test.build_fda.not_null_obv_stock_summary_date.50d0b7b73c: Close
[0m22:21:16.337147 [info ] [Thread-1 (]: 4 of 6 PASS not_null_obv_stock_summary_date .................................... [[32mPASS[0m in 0.83s]
[0m22:21:16.339085 [debug] [Thread-1 (]: Finished running node test.build_fda.not_null_obv_stock_summary_date.50d0b7b73c
[0m22:21:16.339696 [debug] [Thread-1 (]: Began running node test.build_fda.not_null_obv_stock_summary_obv.0e7eb4ac61
[0m22:21:16.340333 [info ] [Thread-1 (]: 5 of 6 START test not_null_obv_stock_summary_obv ............................... [RUN]
[0m22:21:16.340917 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.build_fda.not_null_obv_stock_summary_date.50d0b7b73c, now test.build_fda.not_null_obv_stock_summary_obv.0e7eb4ac61)
[0m22:21:16.341324 [debug] [Thread-1 (]: Began compiling node test.build_fda.not_null_obv_stock_summary_obv.0e7eb4ac61
[0m22:21:16.346898 [debug] [Thread-1 (]: Writing injected SQL for node "test.build_fda.not_null_obv_stock_summary_obv.0e7eb4ac61"
[0m22:21:16.347958 [debug] [Thread-1 (]: Began executing node test.build_fda.not_null_obv_stock_summary_obv.0e7eb4ac61
[0m22:21:16.350400 [debug] [Thread-1 (]: Writing runtime sql for node "test.build_fda.not_null_obv_stock_summary_obv.0e7eb4ac61"
[0m22:21:16.351409 [debug] [Thread-1 (]: Using snowflake connection "test.build_fda.not_null_obv_stock_summary_obv.0e7eb4ac61"
[0m22:21:16.351775 [debug] [Thread-1 (]: On test.build_fda.not_null_obv_stock_summary_obv.0e7eb4ac61: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "test.build_fda.not_null_obv_stock_summary_obv.0e7eb4ac61"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select obv
from dev.analytics.obv_stock_summary
where obv is null



      
    ) dbt_internal_test
[0m22:21:16.352101 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:21:16.783127 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.431 seconds
[0m22:21:16.786298 [debug] [Thread-1 (]: On test.build_fda.not_null_obv_stock_summary_obv.0e7eb4ac61: Close
[0m22:21:16.922166 [info ] [Thread-1 (]: 5 of 6 PASS not_null_obv_stock_summary_obv ..................................... [[32mPASS[0m in 0.58s]
[0m22:21:16.923070 [debug] [Thread-1 (]: Finished running node test.build_fda.not_null_obv_stock_summary_obv.0e7eb4ac61
[0m22:21:16.923572 [debug] [Thread-1 (]: Began running node test.build_fda.not_null_obv_stock_summary_symbol.d37ec530e4
[0m22:21:16.924091 [info ] [Thread-1 (]: 6 of 6 START test not_null_obv_stock_summary_symbol ............................ [RUN]
[0m22:21:16.924670 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.build_fda.not_null_obv_stock_summary_obv.0e7eb4ac61, now test.build_fda.not_null_obv_stock_summary_symbol.d37ec530e4)
[0m22:21:16.925076 [debug] [Thread-1 (]: Began compiling node test.build_fda.not_null_obv_stock_summary_symbol.d37ec530e4
[0m22:21:16.930273 [debug] [Thread-1 (]: Writing injected SQL for node "test.build_fda.not_null_obv_stock_summary_symbol.d37ec530e4"
[0m22:21:16.931306 [debug] [Thread-1 (]: Began executing node test.build_fda.not_null_obv_stock_summary_symbol.d37ec530e4
[0m22:21:16.933624 [debug] [Thread-1 (]: Writing runtime sql for node "test.build_fda.not_null_obv_stock_summary_symbol.d37ec530e4"
[0m22:21:16.934525 [debug] [Thread-1 (]: Using snowflake connection "test.build_fda.not_null_obv_stock_summary_symbol.d37ec530e4"
[0m22:21:16.934826 [debug] [Thread-1 (]: On test.build_fda.not_null_obv_stock_summary_symbol.d37ec530e4: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "test.build_fda.not_null_obv_stock_summary_symbol.d37ec530e4"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select symbol
from dev.analytics.obv_stock_summary
where symbol is null



      
    ) dbt_internal_test
[0m22:21:16.935114 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:21:17.376361 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.441 seconds
[0m22:21:17.378528 [debug] [Thread-1 (]: On test.build_fda.not_null_obv_stock_summary_symbol.d37ec530e4: Close
[0m22:21:17.482792 [info ] [Thread-1 (]: 6 of 6 PASS not_null_obv_stock_summary_symbol .................................. [[32mPASS[0m in 0.56s]
[0m22:21:17.484307 [debug] [Thread-1 (]: Finished running node test.build_fda.not_null_obv_stock_summary_symbol.d37ec530e4
[0m22:21:17.486062 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:21:17.486540 [debug] [MainThread]: Connection 'test.build_fda.not_null_obv_stock_summary_symbol.d37ec530e4' was properly closed.
[0m22:21:17.486973 [info ] [MainThread]: 
[0m22:21:17.487383 [info ] [MainThread]: Finished running 6 data tests in 0 hours 0 minutes and 5.64 seconds (5.64s).
[0m22:21:17.488303 [debug] [MainThread]: Command end result
[0m22:21:17.515517 [info ] [MainThread]: 
[0m22:21:17.515837 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:21:17.516053 [info ] [MainThread]: 
[0m22:21:17.516277 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=0 SKIP=0 TOTAL=6
[0m22:21:17.518617 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 6.9809923, "process_user_time": 2.339765, "process_kernel_time": 1.683891, "process_mem_max_rss": "208732160", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m22:21:17.519011 [debug] [MainThread]: Command `dbt test` succeeded at 22:21:17.518948 after 6.98 seconds
[0m22:21:17.519264 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104a30150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104a7a310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104a7aed0>]}
[0m22:21:17.519503 [debug] [MainThread]: Flushing usage events
[0m22:31:25.043499 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107782690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1077d7990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1077f0a90>]}


============================== 22:31:25.045754 | 74ee7273-59d7-4326-ae0d-a2f7e18f9d6e ==============================
[0m22:31:25.045754 [info ] [MainThread]: Running with dbt=1.8.7
[0m22:31:25.046079 [debug] [MainThread]: running dbt with arguments {'empty': 'None', 'log_cache_events': 'False', 'log_format': 'default', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'fail_fast': 'False', 'printer_width': '80', 'debug': 'False', 'log_path': '/Users/shatayu/Downloads/DATA226_Lab2Prep/build_fda/logs', 'indirect_selection': 'eager', 'invocation_command': 'dbt test', 'version_check': 'True', 'profiles_dir': '/Users/shatayu/.dbt', 'static_parser': 'True', 'use_experimental_parser': 'False', 'partial_parse': 'True', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'target_path': 'None', 'write_json': 'True', 'introspect': 'True', 'no_print': 'None', 'use_colors': 'True', 'cache_selected_only': 'False', 'warn_error': 'None'}
[0m22:31:26.018743 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '74ee7273-59d7-4326-ae0d-a2f7e18f9d6e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120448850>]}
[0m22:31:26.038862 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '74ee7273-59d7-4326-ae0d-a2f7e18f9d6e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107241790>]}
[0m22:31:26.039478 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m22:31:26.051859 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m22:31:26.129075 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m22:31:26.129397 [debug] [MainThread]: Partial parsing: added file: build_fda://tests/check_null_fsi.sql
[0m22:31:26.176753 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.build_fda.check_null_fsi' (tests/check_null_fsi.sql) depends on a node named 'fsi_stock_summary' in package 'analytics' which was not found
[0m22:31:26.216971 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '74ee7273-59d7-4326-ae0d-a2f7e18f9d6e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1207d2110>]}
[0m22:31:26.275355 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '74ee7273-59d7-4326-ae0d-a2f7e18f9d6e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120abb450>]}
[0m22:31:26.275692 [info ] [MainThread]: Found 5 models, 6 data tests, 5 sources, 459 macros
[0m22:31:26.275852 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '74ee7273-59d7-4326-ae0d-a2f7e18f9d6e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12078a350>]}
[0m22:31:26.276671 [info ] [MainThread]: 
[0m22:31:26.276949 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m22:31:26.278863 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev_analytics'
[0m22:31:26.285394 [debug] [ThreadPool]: Using snowflake connection "list_dev_analytics"
[0m22:31:26.285551 [debug] [ThreadPool]: On list_dev_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev_analytics"} */
show objects in dev.analytics limit 10000
[0m22:31:26.285676 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:31:26.903154 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.615 seconds
[0m22:31:26.907792 [debug] [ThreadPool]: On list_dev_analytics: Close
[0m22:31:27.042304 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '74ee7273-59d7-4326-ae0d-a2f7e18f9d6e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1208bc0d0>]}
[0m22:31:27.043169 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m22:31:27.043624 [info ] [MainThread]: 
[0m22:31:27.047963 [debug] [Thread-1 (]: Began running node test.build_fda.not_null_bollinger_stock_summary_close.4959e39a23
[0m22:31:27.048469 [info ] [Thread-1 (]: 1 of 6 START test not_null_bollinger_stock_summary_close ....................... [RUN]
[0m22:31:27.048981 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_analytics, now test.build_fda.not_null_bollinger_stock_summary_close.4959e39a23)
[0m22:31:27.049355 [debug] [Thread-1 (]: Began compiling node test.build_fda.not_null_bollinger_stock_summary_close.4959e39a23
[0m22:31:27.064731 [debug] [Thread-1 (]: Writing injected SQL for node "test.build_fda.not_null_bollinger_stock_summary_close.4959e39a23"
[0m22:31:27.065579 [debug] [Thread-1 (]: Began executing node test.build_fda.not_null_bollinger_stock_summary_close.4959e39a23
[0m22:31:27.078100 [debug] [Thread-1 (]: Writing runtime sql for node "test.build_fda.not_null_bollinger_stock_summary_close.4959e39a23"
[0m22:31:27.078858 [debug] [Thread-1 (]: Using snowflake connection "test.build_fda.not_null_bollinger_stock_summary_close.4959e39a23"
[0m22:31:27.079240 [debug] [Thread-1 (]: On test.build_fda.not_null_bollinger_stock_summary_close.4959e39a23: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "test.build_fda.not_null_bollinger_stock_summary_close.4959e39a23"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select close
from dev.analytics.bollinger_stock_summary
where close is null



      
    ) dbt_internal_test
[0m22:31:27.079493 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:31:27.570230 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.490 seconds
[0m22:31:27.584127 [debug] [Thread-1 (]: On test.build_fda.not_null_bollinger_stock_summary_close.4959e39a23: Close
[0m22:31:27.698997 [info ] [Thread-1 (]: 1 of 6 PASS not_null_bollinger_stock_summary_close ............................. [[32mPASS[0m in 0.65s]
[0m22:31:27.700174 [debug] [Thread-1 (]: Finished running node test.build_fda.not_null_bollinger_stock_summary_close.4959e39a23
[0m22:31:27.700808 [debug] [Thread-1 (]: Began running node test.build_fda.not_null_bollinger_stock_summary_date.b95d5b9419
[0m22:31:27.701428 [info ] [Thread-1 (]: 2 of 6 START test not_null_bollinger_stock_summary_date ........................ [RUN]
[0m22:31:27.702093 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.build_fda.not_null_bollinger_stock_summary_close.4959e39a23, now test.build_fda.not_null_bollinger_stock_summary_date.b95d5b9419)
[0m22:31:27.702573 [debug] [Thread-1 (]: Began compiling node test.build_fda.not_null_bollinger_stock_summary_date.b95d5b9419
[0m22:31:27.707795 [debug] [Thread-1 (]: Writing injected SQL for node "test.build_fda.not_null_bollinger_stock_summary_date.b95d5b9419"
[0m22:31:27.708874 [debug] [Thread-1 (]: Began executing node test.build_fda.not_null_bollinger_stock_summary_date.b95d5b9419
[0m22:31:27.711156 [debug] [Thread-1 (]: Writing runtime sql for node "test.build_fda.not_null_bollinger_stock_summary_date.b95d5b9419"
[0m22:31:27.712059 [debug] [Thread-1 (]: Using snowflake connection "test.build_fda.not_null_bollinger_stock_summary_date.b95d5b9419"
[0m22:31:27.712418 [debug] [Thread-1 (]: On test.build_fda.not_null_bollinger_stock_summary_date.b95d5b9419: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "test.build_fda.not_null_bollinger_stock_summary_date.b95d5b9419"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from dev.analytics.bollinger_stock_summary
where date is null



      
    ) dbt_internal_test
[0m22:31:27.712731 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:31:28.207696 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.494 seconds
[0m22:31:28.211953 [debug] [Thread-1 (]: On test.build_fda.not_null_bollinger_stock_summary_date.b95d5b9419: Close
[0m22:31:28.335274 [info ] [Thread-1 (]: 2 of 6 PASS not_null_bollinger_stock_summary_date .............................. [[32mPASS[0m in 0.63s]
[0m22:31:28.336566 [debug] [Thread-1 (]: Finished running node test.build_fda.not_null_bollinger_stock_summary_date.b95d5b9419
[0m22:31:28.336964 [debug] [Thread-1 (]: Began running node test.build_fda.not_null_bollinger_stock_summary_symbol.8adff61bcb
[0m22:31:28.337393 [info ] [Thread-1 (]: 3 of 6 START test not_null_bollinger_stock_summary_symbol ...................... [RUN]
[0m22:31:28.337849 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.build_fda.not_null_bollinger_stock_summary_date.b95d5b9419, now test.build_fda.not_null_bollinger_stock_summary_symbol.8adff61bcb)
[0m22:31:28.338160 [debug] [Thread-1 (]: Began compiling node test.build_fda.not_null_bollinger_stock_summary_symbol.8adff61bcb
[0m22:31:28.400355 [debug] [Thread-1 (]: Writing injected SQL for node "test.build_fda.not_null_bollinger_stock_summary_symbol.8adff61bcb"
[0m22:31:28.400864 [debug] [Thread-1 (]: Began executing node test.build_fda.not_null_bollinger_stock_summary_symbol.8adff61bcb
[0m22:31:28.402008 [debug] [Thread-1 (]: Writing runtime sql for node "test.build_fda.not_null_bollinger_stock_summary_symbol.8adff61bcb"
[0m22:31:28.402431 [debug] [Thread-1 (]: Using snowflake connection "test.build_fda.not_null_bollinger_stock_summary_symbol.8adff61bcb"
[0m22:31:28.402594 [debug] [Thread-1 (]: On test.build_fda.not_null_bollinger_stock_summary_symbol.8adff61bcb: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "test.build_fda.not_null_bollinger_stock_summary_symbol.8adff61bcb"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select symbol
from dev.analytics.bollinger_stock_summary
where symbol is null



      
    ) dbt_internal_test
[0m22:31:28.402743 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:31:28.763188 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.360 seconds
[0m22:31:28.768633 [debug] [Thread-1 (]: On test.build_fda.not_null_bollinger_stock_summary_symbol.8adff61bcb: Close
[0m22:31:28.903402 [info ] [Thread-1 (]: 3 of 6 PASS not_null_bollinger_stock_summary_symbol ............................ [[32mPASS[0m in 0.57s]
[0m22:31:28.904468 [debug] [Thread-1 (]: Finished running node test.build_fda.not_null_bollinger_stock_summary_symbol.8adff61bcb
[0m22:31:28.905097 [debug] [Thread-1 (]: Began running node test.build_fda.not_null_obv_stock_summary_date.50d0b7b73c
[0m22:31:28.905722 [info ] [Thread-1 (]: 4 of 6 START test not_null_obv_stock_summary_date .............................. [RUN]
[0m22:31:28.906416 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.build_fda.not_null_bollinger_stock_summary_symbol.8adff61bcb, now test.build_fda.not_null_obv_stock_summary_date.50d0b7b73c)
[0m22:31:28.906856 [debug] [Thread-1 (]: Began compiling node test.build_fda.not_null_obv_stock_summary_date.50d0b7b73c
[0m22:31:28.912301 [debug] [Thread-1 (]: Writing injected SQL for node "test.build_fda.not_null_obv_stock_summary_date.50d0b7b73c"
[0m22:31:28.914529 [debug] [Thread-1 (]: Began executing node test.build_fda.not_null_obv_stock_summary_date.50d0b7b73c
[0m22:31:28.916949 [debug] [Thread-1 (]: Writing runtime sql for node "test.build_fda.not_null_obv_stock_summary_date.50d0b7b73c"
[0m22:31:28.917909 [debug] [Thread-1 (]: Using snowflake connection "test.build_fda.not_null_obv_stock_summary_date.50d0b7b73c"
[0m22:31:28.918261 [debug] [Thread-1 (]: On test.build_fda.not_null_obv_stock_summary_date.50d0b7b73c: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "test.build_fda.not_null_obv_stock_summary_date.50d0b7b73c"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from dev.analytics.obv_stock_summary
where date is null



      
    ) dbt_internal_test
[0m22:31:28.918591 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:31:29.409673 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.490 seconds
[0m22:31:29.413820 [debug] [Thread-1 (]: On test.build_fda.not_null_obv_stock_summary_date.50d0b7b73c: Close
[0m22:31:29.563318 [info ] [Thread-1 (]: 4 of 6 PASS not_null_obv_stock_summary_date .................................... [[32mPASS[0m in 0.66s]
[0m22:31:29.564507 [debug] [Thread-1 (]: Finished running node test.build_fda.not_null_obv_stock_summary_date.50d0b7b73c
[0m22:31:29.565155 [debug] [Thread-1 (]: Began running node test.build_fda.not_null_obv_stock_summary_obv.0e7eb4ac61
[0m22:31:29.565736 [info ] [Thread-1 (]: 5 of 6 START test not_null_obv_stock_summary_obv ............................... [RUN]
[0m22:31:29.566361 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.build_fda.not_null_obv_stock_summary_date.50d0b7b73c, now test.build_fda.not_null_obv_stock_summary_obv.0e7eb4ac61)
[0m22:31:29.566783 [debug] [Thread-1 (]: Began compiling node test.build_fda.not_null_obv_stock_summary_obv.0e7eb4ac61
[0m22:31:29.572265 [debug] [Thread-1 (]: Writing injected SQL for node "test.build_fda.not_null_obv_stock_summary_obv.0e7eb4ac61"
[0m22:31:29.574752 [debug] [Thread-1 (]: Began executing node test.build_fda.not_null_obv_stock_summary_obv.0e7eb4ac61
[0m22:31:29.577566 [debug] [Thread-1 (]: Writing runtime sql for node "test.build_fda.not_null_obv_stock_summary_obv.0e7eb4ac61"
[0m22:31:29.578492 [debug] [Thread-1 (]: Using snowflake connection "test.build_fda.not_null_obv_stock_summary_obv.0e7eb4ac61"
[0m22:31:29.578827 [debug] [Thread-1 (]: On test.build_fda.not_null_obv_stock_summary_obv.0e7eb4ac61: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "test.build_fda.not_null_obv_stock_summary_obv.0e7eb4ac61"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select obv
from dev.analytics.obv_stock_summary
where obv is null



      
    ) dbt_internal_test
[0m22:31:29.579108 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:31:30.009117 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.429 seconds
[0m22:31:30.013181 [debug] [Thread-1 (]: On test.build_fda.not_null_obv_stock_summary_obv.0e7eb4ac61: Close
[0m22:31:30.160921 [info ] [Thread-1 (]: 5 of 6 PASS not_null_obv_stock_summary_obv ..................................... [[32mPASS[0m in 0.59s]
[0m22:31:30.162074 [debug] [Thread-1 (]: Finished running node test.build_fda.not_null_obv_stock_summary_obv.0e7eb4ac61
[0m22:31:30.162715 [debug] [Thread-1 (]: Began running node test.build_fda.not_null_obv_stock_summary_symbol.d37ec530e4
[0m22:31:30.163368 [info ] [Thread-1 (]: 6 of 6 START test not_null_obv_stock_summary_symbol ............................ [RUN]
[0m22:31:30.164045 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.build_fda.not_null_obv_stock_summary_obv.0e7eb4ac61, now test.build_fda.not_null_obv_stock_summary_symbol.d37ec530e4)
[0m22:31:30.164527 [debug] [Thread-1 (]: Began compiling node test.build_fda.not_null_obv_stock_summary_symbol.d37ec530e4
[0m22:31:30.170310 [debug] [Thread-1 (]: Writing injected SQL for node "test.build_fda.not_null_obv_stock_summary_symbol.d37ec530e4"
[0m22:31:30.171438 [debug] [Thread-1 (]: Began executing node test.build_fda.not_null_obv_stock_summary_symbol.d37ec530e4
[0m22:31:30.173912 [debug] [Thread-1 (]: Writing runtime sql for node "test.build_fda.not_null_obv_stock_summary_symbol.d37ec530e4"
[0m22:31:30.174865 [debug] [Thread-1 (]: Using snowflake connection "test.build_fda.not_null_obv_stock_summary_symbol.d37ec530e4"
[0m22:31:30.175206 [debug] [Thread-1 (]: On test.build_fda.not_null_obv_stock_summary_symbol.d37ec530e4: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "test.build_fda.not_null_obv_stock_summary_symbol.d37ec530e4"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select symbol
from dev.analytics.obv_stock_summary
where symbol is null



      
    ) dbt_internal_test
[0m22:31:30.175531 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:31:30.668897 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.493 seconds
[0m22:31:30.672670 [debug] [Thread-1 (]: On test.build_fda.not_null_obv_stock_summary_symbol.d37ec530e4: Close
[0m22:31:30.809365 [info ] [Thread-1 (]: 6 of 6 PASS not_null_obv_stock_summary_symbol .................................. [[32mPASS[0m in 0.65s]
[0m22:31:30.810343 [debug] [Thread-1 (]: Finished running node test.build_fda.not_null_obv_stock_summary_symbol.d37ec530e4
[0m22:31:30.812139 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:31:30.812577 [debug] [MainThread]: Connection 'test.build_fda.not_null_obv_stock_summary_symbol.d37ec530e4' was properly closed.
[0m22:31:30.813003 [info ] [MainThread]: 
[0m22:31:30.813404 [info ] [MainThread]: Finished running 6 data tests in 0 hours 0 minutes and 4.54 seconds (4.54s).
[0m22:31:30.814897 [debug] [MainThread]: Command end result
[0m22:31:30.844508 [info ] [MainThread]: 
[0m22:31:30.844858 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:31:30.845067 [info ] [MainThread]: 
[0m22:31:30.845328 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=0 SKIP=0 TOTAL=6
[0m22:31:30.847851 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 5.8550386, "process_user_time": 2.586642, "process_kernel_time": 1.317231, "process_mem_max_rss": "204242944", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m22:31:30.848257 [debug] [MainThread]: Command `dbt test` succeeded at 22:31:30.848194 after 5.86 seconds
[0m22:31:30.848511 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1033c0150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103499410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105529b90>]}
[0m22:31:30.848751 [debug] [MainThread]: Flushing usage events
[0m22:32:16.707007 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105305510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104e54750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10533cb10>]}


============================== 22:32:16.708904 | 2d90b958-ffaf-47e8-bd6c-1e3f151abf03 ==============================
[0m22:32:16.708904 [info ] [MainThread]: Running with dbt=1.8.7
[0m22:32:16.709251 [debug] [MainThread]: running dbt with arguments {'introspect': 'True', 'log_path': '/Users/shatayu/Downloads/DATA226_Lab2Prep/build_fda/logs', 'send_anonymous_usage_stats': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'use_experimental_parser': 'False', 'printer_width': '80', 'static_parser': 'True', 'quiet': 'False', 'partial_parse': 'True', 'target_path': 'None', 'write_json': 'True', 'version_check': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/shatayu/.dbt', 'use_colors': 'True', 'empty': 'None', 'debug': 'False', 'warn_error': 'None', 'invocation_command': 'dbt test --select test_type:custom', 'no_print': 'None', 'log_cache_events': 'False', 'fail_fast': 'False', 'indirect_selection': 'eager', 'log_format': 'default'}
[0m22:32:17.484434 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2d90b958-ffaf-47e8-bd6c-1e3f151abf03', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13a4bb690>]}
[0m22:32:17.505099 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2d90b958-ffaf-47e8-bd6c-1e3f151abf03', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1041d8450>]}
[0m22:32:17.505642 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m22:32:17.518538 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m22:32:17.597220 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m22:32:17.597471 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m22:32:17.618668 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2d90b958-ffaf-47e8-bd6c-1e3f151abf03', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105305350>]}
[0m22:32:17.678299 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2d90b958-ffaf-47e8-bd6c-1e3f151abf03', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13b3e75d0>]}
[0m22:32:17.678611 [info ] [MainThread]: Found 5 models, 6 data tests, 5 sources, 459 macros
[0m22:32:17.678779 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2d90b958-ffaf-47e8-bd6c-1e3f151abf03', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13a6fad10>]}
[0m22:32:17.679088 [error] [MainThread]: Encountered an error:
Runtime Error
  Invalid test type selector custom: expected "generic", "singular", "unit", or "data"
[0m22:32:17.681049 [debug] [MainThread]: Resource report: {"command_name": "test", "command_wall_clock_time": 1.0267415, "process_user_time": 1.7381, "process_kernel_time": 1.439744, "process_mem_max_rss": "194215936", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m22:32:17.681330 [debug] [MainThread]: Command `dbt test` failed at 22:32:17.681284 after 1.03 seconds
[0m22:32:17.681526 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1052fd350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100f3c1d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105383b50>]}
[0m22:32:17.681677 [debug] [MainThread]: Flushing usage events
[0m22:32:28.038428 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10764ab10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107693110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10769ff10>]}


============================== 22:32:28.040025 | 7752533e-4786-49cc-8e47-b4157c746afe ==============================
[0m22:32:28.040025 [info ] [MainThread]: Running with dbt=1.8.7
[0m22:32:28.040370 [debug] [MainThread]: running dbt with arguments {'debug': 'False', 'partial_parse': 'True', 'send_anonymous_usage_stats': 'True', 'log_format': 'default', 'version_check': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'log_cache_events': 'False', 'introspect': 'True', 'target_path': 'None', 'profiles_dir': '/Users/shatayu/.dbt', 'printer_width': '80', 'quiet': 'False', 'static_parser': 'True', 'empty': 'None', 'use_experimental_parser': 'False', 'log_path': '/Users/shatayu/Downloads/DATA226_Lab2Prep/build_fda/logs', 'no_print': 'None', 'write_json': 'True', 'use_colors': 'True', 'warn_error': 'None', 'cache_selected_only': 'False', 'invocation_command': 'dbt test --select test_type:singular', 'fail_fast': 'False', 'indirect_selection': 'eager'}
[0m22:32:28.538195 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7752533e-4786-49cc-8e47-b4157c746afe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1349cdc10>]}
[0m22:32:28.558363 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7752533e-4786-49cc-8e47-b4157c746afe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106e45690>]}
[0m22:32:28.558745 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m22:32:28.570115 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m22:32:28.643104 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m22:32:28.643392 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m22:32:28.664176 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7752533e-4786-49cc-8e47-b4157c746afe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x134c731d0>]}
[0m22:32:28.723833 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7752533e-4786-49cc-8e47-b4157c746afe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1350e63d0>]}
[0m22:32:28.724166 [info ] [MainThread]: Found 5 models, 6 data tests, 5 sources, 459 macros
[0m22:32:28.724347 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7752533e-4786-49cc-8e47-b4157c746afe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x134cf7710>]}
[0m22:32:28.724663 [warn ] [MainThread]: The selection criterion 'test_type:singular' does not match any enabled nodes
[0m22:32:28.725092 [info ] [MainThread]: 
[0m22:32:28.725263 [warn ] [MainThread]: Nothing to do. Try checking your model configs and model specification args
[0m22:32:28.726030 [debug] [MainThread]: Command end result
[0m22:32:28.739832 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 0.75025195, "process_user_time": 1.391788, "process_kernel_time": 1.831788, "process_mem_max_rss": "198180864", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m22:32:28.740132 [debug] [MainThread]: Command `dbt test` succeeded at 22:32:28.740090 after 0.75 seconds
[0m22:32:28.740317 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1076bfb90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102e7c1d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x134d14090>]}
[0m22:32:28.740467 [debug] [MainThread]: Flushing usage events
[0m22:33:45.277216 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111daf850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111ddbf10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111df8a50>]}


============================== 22:33:45.279139 | 05c7a507-e511-4b60-b60b-593739102515 ==============================
[0m22:33:45.279139 [info ] [MainThread]: Running with dbt=1.8.7
[0m22:33:45.279468 [debug] [MainThread]: running dbt with arguments {'target_path': 'None', 'write_json': 'True', 'warn_error': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'no_print': 'None', 'log_cache_events': 'False', 'log_format': 'default', 'introspect': 'True', 'debug': 'False', 'invocation_command': 'dbt test', 'profiles_dir': '/Users/shatayu/.dbt', 'cache_selected_only': 'False', 'printer_width': '80', 'partial_parse': 'True', 'log_path': '/Users/shatayu/Downloads/DATA226_Lab2Prep/build_fda/logs', 'version_check': 'True', 'static_parser': 'True', 'empty': 'None', 'use_experimental_parser': 'False', 'indirect_selection': 'eager', 'use_colors': 'True', 'send_anonymous_usage_stats': 'True', 'fail_fast': 'False'}
[0m22:33:46.213270 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '05c7a507-e511-4b60-b60b-593739102515', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111df8510>]}
[0m22:33:46.234185 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '05c7a507-e511-4b60-b60b-593739102515', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1115415d0>]}
[0m22:33:46.234778 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m22:33:46.248234 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m22:33:46.329138 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m22:33:46.329556 [debug] [MainThread]: Partial parsing: updated file: build_fda://tests/check_null_fsi.sql
[0m22:33:46.415084 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '05c7a507-e511-4b60-b60b-593739102515', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13b363c90>]}
[0m22:33:46.473077 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '05c7a507-e511-4b60-b60b-593739102515', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13d52ff10>]}
[0m22:33:46.473374 [info ] [MainThread]: Found 5 models, 7 data tests, 5 sources, 459 macros
[0m22:33:46.473535 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '05c7a507-e511-4b60-b60b-593739102515', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13b480250>]}
[0m22:33:46.474427 [info ] [MainThread]: 
[0m22:33:46.474724 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m22:33:46.476648 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev_analytics'
[0m22:33:46.483197 [debug] [ThreadPool]: Using snowflake connection "list_dev_analytics"
[0m22:33:46.483361 [debug] [ThreadPool]: On list_dev_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev_analytics"} */
show objects in dev.analytics limit 10000
[0m22:33:46.483491 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:33:46.998288 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.513 seconds
[0m22:33:47.000476 [debug] [ThreadPool]: On list_dev_analytics: Close
[0m22:33:47.106461 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '05c7a507-e511-4b60-b60b-593739102515', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13d526a50>]}
[0m22:33:47.107099 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m22:33:47.107330 [info ] [MainThread]: 
[0m22:33:47.110055 [debug] [Thread-1 (]: Began running node test.build_fda.check_null_fsi
[0m22:33:47.110336 [info ] [Thread-1 (]: 1 of 7 START test check_null_fsi ............................................... [RUN]
[0m22:33:47.110606 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_analytics, now test.build_fda.check_null_fsi)
[0m22:33:47.110817 [debug] [Thread-1 (]: Began compiling node test.build_fda.check_null_fsi
[0m22:33:47.115989 [debug] [Thread-1 (]: Writing injected SQL for node "test.build_fda.check_null_fsi"
[0m22:33:47.116602 [debug] [Thread-1 (]: Began executing node test.build_fda.check_null_fsi
[0m22:33:47.129917 [debug] [Thread-1 (]: Writing runtime sql for node "test.build_fda.check_null_fsi"
[0m22:33:47.130909 [debug] [Thread-1 (]: Using snowflake connection "test.build_fda.check_null_fsi"
[0m22:33:47.131177 [debug] [Thread-1 (]: On test.build_fda.check_null_fsi: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "test.build_fda.check_null_fsi"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      SELECT *
FROM dev.analytics.fsi_stock_summary
WHERE symbol IN ('AAPL', 'NVDA')
  AND record_type = 'FORECASTED'
  AND fsi IS NULL
      
    ) dbt_internal_test
[0m22:33:47.131401 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:33:48.204459 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.072 seconds
[0m22:33:48.217709 [debug] [Thread-1 (]: On test.build_fda.check_null_fsi: Close
[0m22:33:48.335475 [info ] [Thread-1 (]: 1 of 7 PASS check_null_fsi ..................................................... [[32mPASS[0m in 1.22s]
[0m22:33:48.336401 [debug] [Thread-1 (]: Finished running node test.build_fda.check_null_fsi
[0m22:33:48.336790 [debug] [Thread-1 (]: Began running node test.build_fda.not_null_bollinger_stock_summary_close.4959e39a23
[0m22:33:48.337243 [info ] [Thread-1 (]: 2 of 7 START test not_null_bollinger_stock_summary_close ....................... [RUN]
[0m22:33:48.337671 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.build_fda.check_null_fsi, now test.build_fda.not_null_bollinger_stock_summary_close.4959e39a23)
[0m22:33:48.337980 [debug] [Thread-1 (]: Began compiling node test.build_fda.not_null_bollinger_stock_summary_close.4959e39a23
[0m22:33:48.345766 [debug] [Thread-1 (]: Writing injected SQL for node "test.build_fda.not_null_bollinger_stock_summary_close.4959e39a23"
[0m22:33:48.347663 [debug] [Thread-1 (]: Began executing node test.build_fda.not_null_bollinger_stock_summary_close.4959e39a23
[0m22:33:48.349536 [debug] [Thread-1 (]: Writing runtime sql for node "test.build_fda.not_null_bollinger_stock_summary_close.4959e39a23"
[0m22:33:48.350261 [debug] [Thread-1 (]: Using snowflake connection "test.build_fda.not_null_bollinger_stock_summary_close.4959e39a23"
[0m22:33:48.350514 [debug] [Thread-1 (]: On test.build_fda.not_null_bollinger_stock_summary_close.4959e39a23: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "test.build_fda.not_null_bollinger_stock_summary_close.4959e39a23"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select close
from dev.analytics.bollinger_stock_summary
where close is null



      
    ) dbt_internal_test
[0m22:33:48.350744 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:33:48.828528 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.477 seconds
[0m22:33:48.833045 [debug] [Thread-1 (]: On test.build_fda.not_null_bollinger_stock_summary_close.4959e39a23: Close
[0m22:33:48.950671 [info ] [Thread-1 (]: 2 of 7 PASS not_null_bollinger_stock_summary_close ............................. [[32mPASS[0m in 0.61s]
[0m22:33:48.951447 [debug] [Thread-1 (]: Finished running node test.build_fda.not_null_bollinger_stock_summary_close.4959e39a23
[0m22:33:48.951964 [debug] [Thread-1 (]: Began running node test.build_fda.not_null_bollinger_stock_summary_date.b95d5b9419
[0m22:33:48.952487 [info ] [Thread-1 (]: 3 of 7 START test not_null_bollinger_stock_summary_date ........................ [RUN]
[0m22:33:48.953057 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.build_fda.not_null_bollinger_stock_summary_close.4959e39a23, now test.build_fda.not_null_bollinger_stock_summary_date.b95d5b9419)
[0m22:33:48.953451 [debug] [Thread-1 (]: Began compiling node test.build_fda.not_null_bollinger_stock_summary_date.b95d5b9419
[0m22:33:48.960540 [debug] [Thread-1 (]: Writing injected SQL for node "test.build_fda.not_null_bollinger_stock_summary_date.b95d5b9419"
[0m22:33:48.962736 [debug] [Thread-1 (]: Began executing node test.build_fda.not_null_bollinger_stock_summary_date.b95d5b9419
[0m22:33:49.040714 [debug] [Thread-1 (]: Writing runtime sql for node "test.build_fda.not_null_bollinger_stock_summary_date.b95d5b9419"
[0m22:33:49.041446 [debug] [Thread-1 (]: Using snowflake connection "test.build_fda.not_null_bollinger_stock_summary_date.b95d5b9419"
[0m22:33:49.041639 [debug] [Thread-1 (]: On test.build_fda.not_null_bollinger_stock_summary_date.b95d5b9419: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "test.build_fda.not_null_bollinger_stock_summary_date.b95d5b9419"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from dev.analytics.bollinger_stock_summary
where date is null



      
    ) dbt_internal_test
[0m22:33:49.041797 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:33:49.472679 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.430 seconds
[0m22:33:49.478443 [debug] [Thread-1 (]: On test.build_fda.not_null_bollinger_stock_summary_date.b95d5b9419: Close
[0m22:33:49.622785 [info ] [Thread-1 (]: 3 of 7 PASS not_null_bollinger_stock_summary_date .............................. [[32mPASS[0m in 0.67s]
[0m22:33:49.623935 [debug] [Thread-1 (]: Finished running node test.build_fda.not_null_bollinger_stock_summary_date.b95d5b9419
[0m22:33:49.624550 [debug] [Thread-1 (]: Began running node test.build_fda.not_null_bollinger_stock_summary_symbol.8adff61bcb
[0m22:33:49.625169 [info ] [Thread-1 (]: 4 of 7 START test not_null_bollinger_stock_summary_symbol ...................... [RUN]
[0m22:33:49.625867 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.build_fda.not_null_bollinger_stock_summary_date.b95d5b9419, now test.build_fda.not_null_bollinger_stock_summary_symbol.8adff61bcb)
[0m22:33:49.626367 [debug] [Thread-1 (]: Began compiling node test.build_fda.not_null_bollinger_stock_summary_symbol.8adff61bcb
[0m22:33:49.631965 [debug] [Thread-1 (]: Writing injected SQL for node "test.build_fda.not_null_bollinger_stock_summary_symbol.8adff61bcb"
[0m22:33:49.632922 [debug] [Thread-1 (]: Began executing node test.build_fda.not_null_bollinger_stock_summary_symbol.8adff61bcb
[0m22:33:49.635268 [debug] [Thread-1 (]: Writing runtime sql for node "test.build_fda.not_null_bollinger_stock_summary_symbol.8adff61bcb"
[0m22:33:49.636282 [debug] [Thread-1 (]: Using snowflake connection "test.build_fda.not_null_bollinger_stock_summary_symbol.8adff61bcb"
[0m22:33:49.636648 [debug] [Thread-1 (]: On test.build_fda.not_null_bollinger_stock_summary_symbol.8adff61bcb: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "test.build_fda.not_null_bollinger_stock_summary_symbol.8adff61bcb"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select symbol
from dev.analytics.bollinger_stock_summary
where symbol is null



      
    ) dbt_internal_test
[0m22:33:49.636979 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:33:50.082190 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.445 seconds
[0m22:33:50.085516 [debug] [Thread-1 (]: On test.build_fda.not_null_bollinger_stock_summary_symbol.8adff61bcb: Close
[0m22:33:50.269105 [info ] [Thread-1 (]: 4 of 7 PASS not_null_bollinger_stock_summary_symbol ............................ [[32mPASS[0m in 0.64s]
[0m22:33:50.270143 [debug] [Thread-1 (]: Finished running node test.build_fda.not_null_bollinger_stock_summary_symbol.8adff61bcb
[0m22:33:50.270731 [debug] [Thread-1 (]: Began running node test.build_fda.not_null_obv_stock_summary_date.50d0b7b73c
[0m22:33:50.271325 [info ] [Thread-1 (]: 5 of 7 START test not_null_obv_stock_summary_date .............................. [RUN]
[0m22:33:50.272002 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.build_fda.not_null_bollinger_stock_summary_symbol.8adff61bcb, now test.build_fda.not_null_obv_stock_summary_date.50d0b7b73c)
[0m22:33:50.272494 [debug] [Thread-1 (]: Began compiling node test.build_fda.not_null_obv_stock_summary_date.50d0b7b73c
[0m22:33:50.278228 [debug] [Thread-1 (]: Writing injected SQL for node "test.build_fda.not_null_obv_stock_summary_date.50d0b7b73c"
[0m22:33:50.280631 [debug] [Thread-1 (]: Began executing node test.build_fda.not_null_obv_stock_summary_date.50d0b7b73c
[0m22:33:50.282972 [debug] [Thread-1 (]: Writing runtime sql for node "test.build_fda.not_null_obv_stock_summary_date.50d0b7b73c"
[0m22:33:50.284035 [debug] [Thread-1 (]: Using snowflake connection "test.build_fda.not_null_obv_stock_summary_date.50d0b7b73c"
[0m22:33:50.284378 [debug] [Thread-1 (]: On test.build_fda.not_null_obv_stock_summary_date.50d0b7b73c: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "test.build_fda.not_null_obv_stock_summary_date.50d0b7b73c"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date
from dev.analytics.obv_stock_summary
where date is null



      
    ) dbt_internal_test
[0m22:33:50.284709 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:33:50.712737 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.427 seconds
[0m22:33:50.717162 [debug] [Thread-1 (]: On test.build_fda.not_null_obv_stock_summary_date.50d0b7b73c: Close
[0m22:33:50.882438 [info ] [Thread-1 (]: 5 of 7 PASS not_null_obv_stock_summary_date .................................... [[32mPASS[0m in 0.61s]
[0m22:33:50.884254 [debug] [Thread-1 (]: Finished running node test.build_fda.not_null_obv_stock_summary_date.50d0b7b73c
[0m22:33:50.884975 [debug] [Thread-1 (]: Began running node test.build_fda.not_null_obv_stock_summary_obv.0e7eb4ac61
[0m22:33:50.885640 [info ] [Thread-1 (]: 6 of 7 START test not_null_obv_stock_summary_obv ............................... [RUN]
[0m22:33:50.886380 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.build_fda.not_null_obv_stock_summary_date.50d0b7b73c, now test.build_fda.not_null_obv_stock_summary_obv.0e7eb4ac61)
[0m22:33:50.886870 [debug] [Thread-1 (]: Began compiling node test.build_fda.not_null_obv_stock_summary_obv.0e7eb4ac61
[0m22:33:50.892499 [debug] [Thread-1 (]: Writing injected SQL for node "test.build_fda.not_null_obv_stock_summary_obv.0e7eb4ac61"
[0m22:33:50.894774 [debug] [Thread-1 (]: Began executing node test.build_fda.not_null_obv_stock_summary_obv.0e7eb4ac61
[0m22:33:50.897134 [debug] [Thread-1 (]: Writing runtime sql for node "test.build_fda.not_null_obv_stock_summary_obv.0e7eb4ac61"
[0m22:33:50.898265 [debug] [Thread-1 (]: Using snowflake connection "test.build_fda.not_null_obv_stock_summary_obv.0e7eb4ac61"
[0m22:33:50.898620 [debug] [Thread-1 (]: On test.build_fda.not_null_obv_stock_summary_obv.0e7eb4ac61: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "test.build_fda.not_null_obv_stock_summary_obv.0e7eb4ac61"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select obv
from dev.analytics.obv_stock_summary
where obv is null



      
    ) dbt_internal_test
[0m22:33:50.898946 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:33:51.344684 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.445 seconds
[0m22:33:51.350451 [debug] [Thread-1 (]: On test.build_fda.not_null_obv_stock_summary_obv.0e7eb4ac61: Close
[0m22:33:51.462548 [info ] [Thread-1 (]: 6 of 7 PASS not_null_obv_stock_summary_obv ..................................... [[32mPASS[0m in 0.58s]
[0m22:33:51.464071 [debug] [Thread-1 (]: Finished running node test.build_fda.not_null_obv_stock_summary_obv.0e7eb4ac61
[0m22:33:51.464716 [debug] [Thread-1 (]: Began running node test.build_fda.not_null_obv_stock_summary_symbol.d37ec530e4
[0m22:33:51.465340 [info ] [Thread-1 (]: 7 of 7 START test not_null_obv_stock_summary_symbol ............................ [RUN]
[0m22:33:51.466053 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.build_fda.not_null_obv_stock_summary_obv.0e7eb4ac61, now test.build_fda.not_null_obv_stock_summary_symbol.d37ec530e4)
[0m22:33:51.466553 [debug] [Thread-1 (]: Began compiling node test.build_fda.not_null_obv_stock_summary_symbol.d37ec530e4
[0m22:33:51.471938 [debug] [Thread-1 (]: Writing injected SQL for node "test.build_fda.not_null_obv_stock_summary_symbol.d37ec530e4"
[0m22:33:51.474170 [debug] [Thread-1 (]: Began executing node test.build_fda.not_null_obv_stock_summary_symbol.d37ec530e4
[0m22:33:51.478829 [debug] [Thread-1 (]: Writing runtime sql for node "test.build_fda.not_null_obv_stock_summary_symbol.d37ec530e4"
[0m22:33:51.479817 [debug] [Thread-1 (]: Using snowflake connection "test.build_fda.not_null_obv_stock_summary_symbol.d37ec530e4"
[0m22:33:51.480158 [debug] [Thread-1 (]: On test.build_fda.not_null_obv_stock_summary_symbol.d37ec530e4: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "node_id": "test.build_fda.not_null_obv_stock_summary_symbol.d37ec530e4"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select symbol
from dev.analytics.obv_stock_summary
where symbol is null



      
    ) dbt_internal_test
[0m22:33:51.480489 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:33:51.937618 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.457 seconds
[0m22:33:51.942503 [debug] [Thread-1 (]: On test.build_fda.not_null_obv_stock_summary_symbol.d37ec530e4: Close
[0m22:33:52.084336 [info ] [Thread-1 (]: 7 of 7 PASS not_null_obv_stock_summary_symbol .................................. [[32mPASS[0m in 0.62s]
[0m22:33:52.085329 [debug] [Thread-1 (]: Finished running node test.build_fda.not_null_obv_stock_summary_symbol.d37ec530e4
[0m22:33:52.087101 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:33:52.087487 [debug] [MainThread]: Connection 'test.build_fda.not_null_obv_stock_summary_symbol.d37ec530e4' was properly closed.
[0m22:33:52.087902 [info ] [MainThread]: 
[0m22:33:52.088257 [info ] [MainThread]: Finished running 7 data tests in 0 hours 0 minutes and 5.61 seconds (5.61s).
[0m22:33:52.089688 [debug] [MainThread]: Command end result
[0m22:33:52.116462 [info ] [MainThread]: 
[0m22:33:52.116761 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:33:52.116954 [info ] [MainThread]: 
[0m22:33:52.117158 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m22:33:52.119555 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 6.891239, "process_user_time": 2.473797, "process_kernel_time": 1.590491, "process_mem_max_rss": "204570624", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m22:33:52.119923 [debug] [MainThread]: Command `dbt test` succeeded at 22:33:52.119861 after 6.89 seconds
[0m22:33:52.120168 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102e58150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102ea2310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102ea2ed0>]}
[0m22:33:52.120404 [debug] [MainThread]: Flushing usage events
[0m22:34:59.244686 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107896d50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1078d09d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1078f9490>]}


============================== 22:34:59.246569 | 71492753-44c3-4a91-aa0b-5b537c8ac2f5 ==============================
[0m22:34:59.246569 [info ] [MainThread]: Running with dbt=1.8.7
[0m22:34:59.246895 [debug] [MainThread]: running dbt with arguments {'version_check': 'True', 'invocation_command': 'dbt docs generate', 'target_path': 'None', 'introspect': 'True', 'fail_fast': 'False', 'static_parser': 'True', 'log_format': 'default', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'write_json': 'True', 'printer_width': '80', 'log_cache_events': 'False', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'quiet': 'False', 'send_anonymous_usage_stats': 'True', 'debug': 'False', 'log_path': '/Users/shatayu/Downloads/DATA226_Lab2Prep/build_fda/logs', 'warn_error': 'None', 'no_print': 'None', 'indirect_selection': 'eager', 'profiles_dir': '/Users/shatayu/.dbt', 'partial_parse': 'True', 'empty': 'None', 'use_colors': 'True'}
[0m22:35:00.011796 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '71492753-44c3-4a91-aa0b-5b537c8ac2f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x117c75c10>]}
[0m22:35:00.034691 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '71492753-44c3-4a91-aa0b-5b537c8ac2f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10734d590>]}
[0m22:35:00.035459 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m22:35:00.047976 [debug] [MainThread]: checksum: 4af21dafb485259c48497ac86b711ddb1982f3d0f1c0ca4e09356de488b753c0, vars: {}, profile: , target: , version: 1.8.7
[0m22:35:00.130347 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m22:35:00.130648 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m22:35:00.153726 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '71492753-44c3-4a91-aa0b-5b537c8ac2f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13452e610>]}
[0m22:35:00.166285 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '71492753-44c3-4a91-aa0b-5b537c8ac2f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13470bed0>]}
[0m22:35:00.166625 [info ] [MainThread]: Found 5 models, 7 data tests, 5 sources, 459 macros
[0m22:35:00.166795 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '71492753-44c3-4a91-aa0b-5b537c8ac2f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x134784d10>]}
[0m22:35:00.167845 [info ] [MainThread]: 
[0m22:35:00.168176 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m22:35:00.170655 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dev_analytics'
[0m22:35:00.180257 [debug] [ThreadPool]: Using snowflake connection "list_dev_analytics"
[0m22:35:00.180534 [debug] [ThreadPool]: On list_dev_analytics: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "list_dev_analytics"} */
show objects in dev.analytics limit 10000
[0m22:35:00.180683 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:35:00.718370 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.536 seconds
[0m22:35:00.721915 [debug] [ThreadPool]: On list_dev_analytics: Close
[0m22:35:00.840634 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '71492753-44c3-4a91-aa0b-5b537c8ac2f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x134322e90>]}
[0m22:35:00.841732 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m22:35:00.842200 [info ] [MainThread]: 
[0m22:35:00.846682 [debug] [Thread-1 (]: Began running node model.build_fda.bollinger_stock_summary
[0m22:35:00.847202 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_dev_analytics, now model.build_fda.bollinger_stock_summary)
[0m22:35:00.847576 [debug] [Thread-1 (]: Began compiling node model.build_fda.bollinger_stock_summary
[0m22:35:00.856075 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.bollinger_stock_summary"
[0m22:35:00.857420 [debug] [Thread-1 (]: Began executing node model.build_fda.bollinger_stock_summary
[0m22:35:00.858282 [debug] [Thread-1 (]: Finished running node model.build_fda.bollinger_stock_summary
[0m22:35:00.858617 [debug] [Thread-1 (]: Began running node model.build_fda.fsi_stock_summary
[0m22:35:00.859037 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.bollinger_stock_summary, now model.build_fda.fsi_stock_summary)
[0m22:35:00.859475 [debug] [Thread-1 (]: Began compiling node model.build_fda.fsi_stock_summary
[0m22:35:00.861938 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.fsi_stock_summary"
[0m22:35:00.862659 [debug] [Thread-1 (]: Began executing node model.build_fda.fsi_stock_summary
[0m22:35:00.864359 [debug] [Thread-1 (]: Finished running node model.build_fda.fsi_stock_summary
[0m22:35:00.864655 [debug] [Thread-1 (]: Began running node model.build_fda.obv_stock_summary
[0m22:35:00.864938 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.fsi_stock_summary, now model.build_fda.obv_stock_summary)
[0m22:35:00.865163 [debug] [Thread-1 (]: Began compiling node model.build_fda.obv_stock_summary
[0m22:35:00.867057 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.obv_stock_summary"
[0m22:35:00.867814 [debug] [Thread-1 (]: Began executing node model.build_fda.obv_stock_summary
[0m22:35:00.868228 [debug] [Thread-1 (]: Finished running node model.build_fda.obv_stock_summary
[0m22:35:00.868473 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data
[0m22:35:00.868960 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.obv_stock_summary, now model.build_fda.stock_data)
[0m22:35:00.869199 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data
[0m22:35:00.870911 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data"
[0m22:35:00.871500 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data
[0m22:35:00.871771 [debug] [Thread-1 (]: Began running node model.build_fda.stock_data_forecast
[0m22:35:00.871998 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.stock_data, now model.build_fda.stock_data_forecast)
[0m22:35:00.872182 [debug] [Thread-1 (]: Began compiling node model.build_fda.stock_data_forecast
[0m22:35:00.873797 [debug] [Thread-1 (]: Writing injected SQL for node "model.build_fda.stock_data_forecast"
[0m22:35:00.874457 [debug] [Thread-1 (]: Finished running node model.build_fda.stock_data_forecast
[0m22:35:00.874702 [debug] [Thread-1 (]: Began running node test.build_fda.check_null_fsi
[0m22:35:00.874939 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.build_fda.stock_data_forecast, now test.build_fda.check_null_fsi)
[0m22:35:00.875129 [debug] [Thread-1 (]: Began compiling node test.build_fda.check_null_fsi
[0m22:35:00.876784 [debug] [Thread-1 (]: Writing injected SQL for node "test.build_fda.check_null_fsi"
[0m22:35:00.877185 [debug] [Thread-1 (]: Began executing node test.build_fda.check_null_fsi
[0m22:35:00.877535 [debug] [Thread-1 (]: Finished running node test.build_fda.check_null_fsi
[0m22:35:00.877793 [debug] [Thread-1 (]: Began running node test.build_fda.not_null_bollinger_stock_summary_close.4959e39a23
[0m22:35:00.878069 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.build_fda.check_null_fsi, now test.build_fda.not_null_bollinger_stock_summary_close.4959e39a23)
[0m22:35:00.878276 [debug] [Thread-1 (]: Began compiling node test.build_fda.not_null_bollinger_stock_summary_close.4959e39a23
[0m22:35:00.885027 [debug] [Thread-1 (]: Writing injected SQL for node "test.build_fda.not_null_bollinger_stock_summary_close.4959e39a23"
[0m22:35:00.885473 [debug] [Thread-1 (]: Began executing node test.build_fda.not_null_bollinger_stock_summary_close.4959e39a23
[0m22:35:00.885822 [debug] [Thread-1 (]: Finished running node test.build_fda.not_null_bollinger_stock_summary_close.4959e39a23
[0m22:35:00.886042 [debug] [Thread-1 (]: Began running node test.build_fda.not_null_bollinger_stock_summary_date.b95d5b9419
[0m22:35:00.886260 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.build_fda.not_null_bollinger_stock_summary_close.4959e39a23, now test.build_fda.not_null_bollinger_stock_summary_date.b95d5b9419)
[0m22:35:00.886436 [debug] [Thread-1 (]: Began compiling node test.build_fda.not_null_bollinger_stock_summary_date.b95d5b9419
[0m22:35:00.888599 [debug] [Thread-1 (]: Writing injected SQL for node "test.build_fda.not_null_bollinger_stock_summary_date.b95d5b9419"
[0m22:35:00.888967 [debug] [Thread-1 (]: Began executing node test.build_fda.not_null_bollinger_stock_summary_date.b95d5b9419
[0m22:35:00.889304 [debug] [Thread-1 (]: Finished running node test.build_fda.not_null_bollinger_stock_summary_date.b95d5b9419
[0m22:35:00.889518 [debug] [Thread-1 (]: Began running node test.build_fda.not_null_bollinger_stock_summary_symbol.8adff61bcb
[0m22:35:00.889739 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.build_fda.not_null_bollinger_stock_summary_date.b95d5b9419, now test.build_fda.not_null_bollinger_stock_summary_symbol.8adff61bcb)
[0m22:35:00.889916 [debug] [Thread-1 (]: Began compiling node test.build_fda.not_null_bollinger_stock_summary_symbol.8adff61bcb
[0m22:35:00.891961 [debug] [Thread-1 (]: Writing injected SQL for node "test.build_fda.not_null_bollinger_stock_summary_symbol.8adff61bcb"
[0m22:35:00.892283 [debug] [Thread-1 (]: Began executing node test.build_fda.not_null_bollinger_stock_summary_symbol.8adff61bcb
[0m22:35:00.892573 [debug] [Thread-1 (]: Finished running node test.build_fda.not_null_bollinger_stock_summary_symbol.8adff61bcb
[0m22:35:00.892759 [debug] [Thread-1 (]: Began running node test.build_fda.not_null_obv_stock_summary_date.50d0b7b73c
[0m22:35:00.892944 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.build_fda.not_null_bollinger_stock_summary_symbol.8adff61bcb, now test.build_fda.not_null_obv_stock_summary_date.50d0b7b73c)
[0m22:35:00.893100 [debug] [Thread-1 (]: Began compiling node test.build_fda.not_null_obv_stock_summary_date.50d0b7b73c
[0m22:35:00.894986 [debug] [Thread-1 (]: Writing injected SQL for node "test.build_fda.not_null_obv_stock_summary_date.50d0b7b73c"
[0m22:35:00.895285 [debug] [Thread-1 (]: Began executing node test.build_fda.not_null_obv_stock_summary_date.50d0b7b73c
[0m22:35:00.895562 [debug] [Thread-1 (]: Finished running node test.build_fda.not_null_obv_stock_summary_date.50d0b7b73c
[0m22:35:00.895741 [debug] [Thread-1 (]: Began running node test.build_fda.not_null_obv_stock_summary_obv.0e7eb4ac61
[0m22:35:00.895925 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.build_fda.not_null_obv_stock_summary_date.50d0b7b73c, now test.build_fda.not_null_obv_stock_summary_obv.0e7eb4ac61)
[0m22:35:00.896079 [debug] [Thread-1 (]: Began compiling node test.build_fda.not_null_obv_stock_summary_obv.0e7eb4ac61
[0m22:35:00.897958 [debug] [Thread-1 (]: Writing injected SQL for node "test.build_fda.not_null_obv_stock_summary_obv.0e7eb4ac61"
[0m22:35:00.898254 [debug] [Thread-1 (]: Began executing node test.build_fda.not_null_obv_stock_summary_obv.0e7eb4ac61
[0m22:35:00.898545 [debug] [Thread-1 (]: Finished running node test.build_fda.not_null_obv_stock_summary_obv.0e7eb4ac61
[0m22:35:00.898719 [debug] [Thread-1 (]: Began running node test.build_fda.not_null_obv_stock_summary_symbol.d37ec530e4
[0m22:35:00.898899 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.build_fda.not_null_obv_stock_summary_obv.0e7eb4ac61, now test.build_fda.not_null_obv_stock_summary_symbol.d37ec530e4)
[0m22:35:00.899052 [debug] [Thread-1 (]: Began compiling node test.build_fda.not_null_obv_stock_summary_symbol.d37ec530e4
[0m22:35:00.900944 [debug] [Thread-1 (]: Writing injected SQL for node "test.build_fda.not_null_obv_stock_summary_symbol.d37ec530e4"
[0m22:35:00.901250 [debug] [Thread-1 (]: Began executing node test.build_fda.not_null_obv_stock_summary_symbol.d37ec530e4
[0m22:35:00.901508 [debug] [Thread-1 (]: Finished running node test.build_fda.not_null_obv_stock_summary_symbol.d37ec530e4
[0m22:35:00.901982 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:35:00.902105 [debug] [MainThread]: Connection 'test.build_fda.not_null_obv_stock_summary_symbol.d37ec530e4' was properly closed.
[0m22:35:00.902772 [debug] [MainThread]: Command end result
[0m22:35:00.948886 [debug] [MainThread]: Acquiring new snowflake connection 'generate_catalog'
[0m22:35:00.949078 [info ] [MainThread]: Building catalog
[0m22:35:00.953230 [debug] [ThreadPool]: Acquiring new snowflake connection 'dev.information_schema'
[0m22:35:00.959645 [debug] [ThreadPool]: Using snowflake connection "dev.information_schema"
[0m22:35:00.959942 [debug] [ThreadPool]: On dev.information_schema: /* {"app": "dbt", "dbt_version": "1.8.7", "profile_name": "build_fda", "target_name": "dev", "connection_name": "dev.information_schema"} */
with tables as (
            select
        table_catalog as "table_database",
        table_schema as "table_schema",
        table_name as "table_name",
        case
            when is_dynamic = 'YES' and table_type = 'BASE TABLE' THEN 'DYNAMIC TABLE'
            else table_type
        end as "table_type",
        comment as "table_comment",

        -- note: this is the _role_ that owns the table
        table_owner as "table_owner",

        'Clustering Key' as "stats:clustering_key:label",
        clustering_key as "stats:clustering_key:value",
        'The key used to cluster this table' as "stats:clustering_key:description",
        (clustering_key is not null) as "stats:clustering_key:include",

        'Row Count' as "stats:row_count:label",
        row_count as "stats:row_count:value",
        'An approximate count of rows in this table' as "stats:row_count:description",
        (row_count is not null) as "stats:row_count:include",

        'Approximate Size' as "stats:bytes:label",
        bytes as "stats:bytes:value",
        'Approximate size of the table as reported by Snowflake' as "stats:bytes:description",
        (bytes is not null) as "stats:bytes:include",

        'Last Modified' as "stats:last_modified:label",
        to_varchar(convert_timezone('UTC', last_altered), 'yyyy-mm-dd HH24:MI'||'UTC') as "stats:last_modified:value",
        'The timestamp for last update/change' as "stats:last_modified:description",
        (last_altered is not null and table_type='BASE TABLE') as "stats:last_modified:include"
    from dev.INFORMATION_SCHEMA.tables
            where (
                (
                    
    "table_schema" ilike 'analytics' and upper("table_schema") = upper('analytics')

                    and 
    "table_name" ilike 'fsi_stock_summary' and upper("table_name") = upper('fsi_stock_summary')

                )
             or 
                (
                    
    "table_schema" ilike 'adhoc' and upper("table_schema") = upper('adhoc')

                    and 
    "table_name" ilike 'stock_data_forecast' and upper("table_name") = upper('stock_data_forecast')

                )
             or 
                (
                    
    "table_schema" ilike 'analytics' and upper("table_schema") = upper('analytics')

                    and 
    "table_name" ilike 'obv_stock_summary' and upper("table_name") = upper('obv_stock_summary')

                )
             or 
                (
                    
    "table_schema" ilike 'raw_data' and upper("table_schema") = upper('raw_data')

                    and 
    "table_name" ilike 'stock_data' and upper("table_name") = upper('stock_data')

                )
             or 
                (
                    
    "table_schema" ilike 'analytics' and upper("table_schema") = upper('analytics')

                    and 
    "table_name" ilike 'bollinger_stock_summary' and upper("table_name") = upper('bollinger_stock_summary')

                )
            )
        ),
        columns as (
            select
        table_catalog as "table_database",
        table_schema as "table_schema",
        table_name as "table_name",

        column_name as "column_name",
        ordinal_position as "column_index",
        data_type as "column_type",
        comment as "column_comment"
    from dev.INFORMATION_SCHEMA.columns
            where (
                (
                    
    "table_schema" ilike 'analytics' and upper("table_schema") = upper('analytics')

                    and 
    "table_name" ilike 'fsi_stock_summary' and upper("table_name") = upper('fsi_stock_summary')

                )
             or 
                (
                    
    "table_schema" ilike 'adhoc' and upper("table_schema") = upper('adhoc')

                    and 
    "table_name" ilike 'stock_data_forecast' and upper("table_name") = upper('stock_data_forecast')

                )
             or 
                (
                    
    "table_schema" ilike 'analytics' and upper("table_schema") = upper('analytics')

                    and 
    "table_name" ilike 'obv_stock_summary' and upper("table_name") = upper('obv_stock_summary')

                )
             or 
                (
                    
    "table_schema" ilike 'raw_data' and upper("table_schema") = upper('raw_data')

                    and 
    "table_name" ilike 'stock_data' and upper("table_name") = upper('stock_data')

                )
             or 
                (
                    
    "table_schema" ilike 'analytics' and upper("table_schema") = upper('analytics')

                    and 
    "table_name" ilike 'bollinger_stock_summary' and upper("table_name") = upper('bollinger_stock_summary')

                )
            )
        )
        select *
    from tables
    join columns using ("table_database", "table_schema", "table_name")
    order by "column_index"
[0m22:35:00.960202 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:35:04.186569 [debug] [ThreadPool]: SQL status: SUCCESS 29 in 3.226 seconds
[0m22:35:04.198637 [debug] [ThreadPool]: On dev.information_schema: Close
[0m22:35:04.360859 [info ] [MainThread]: Catalog written to /Users/shatayu/Downloads/DATA226_Lab2Prep/build_fda/target/catalog.json
[0m22:35:04.363223 [debug] [MainThread]: Resource report: {"command_name": "generate", "command_success": true, "command_wall_clock_time": 5.168535, "process_user_time": 1.889658, "process_kernel_time": 1.612311, "process_mem_max_rss": "201981952", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m22:35:04.363619 [debug] [MainThread]: Command `dbt docs generate` succeeded at 22:35:04.363564 after 5.17 seconds
[0m22:35:04.363810 [debug] [MainThread]: Connection 'generate_catalog' was properly closed.
[0m22:35:04.363956 [debug] [MainThread]: Connection 'dev.information_schema' was properly closed.
[0m22:35:04.364138 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105ec9550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1078e55d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1059254d0>]}
[0m22:35:04.364347 [debug] [MainThread]: Flushing usage events
[0m22:35:10.725838 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108f45450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108fbc950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108fbce90>]}


============================== 22:35:10.727489 | 0a301985-626e-4ab9-8ff0-71bbfed58a61 ==============================
[0m22:35:10.727489 [info ] [MainThread]: Running with dbt=1.8.7
[0m22:35:10.727807 [debug] [MainThread]: running dbt with arguments {'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'warn_error': 'None', 'log_cache_events': 'False', 'write_json': 'True', 'indirect_selection': 'eager', 'invocation_command': 'dbt docs serve', 'quiet': 'False', 'introspect': 'True', 'no_print': 'None', 'cache_selected_only': 'False', 'profiles_dir': '/Users/shatayu/.dbt', 'debug': 'False', 'send_anonymous_usage_stats': 'True', 'empty': 'None', 'partial_parse': 'True', 'log_path': '/Users/shatayu/Downloads/DATA226_Lab2Prep/build_fda/logs', 'use_colors': 'True', 'use_experimental_parser': 'False', 'log_format': 'default', 'fail_fast': 'False', 'printer_width': '80', 'version_check': 'True'}
[0m22:35:11.242259 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0a301985-626e-4ab9-8ff0-71bbfed58a61', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13fc87450>]}
[0m22:35:11.264159 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0a301985-626e-4ab9-8ff0-71bbfed58a61', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1089fd590>]}
